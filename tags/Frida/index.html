<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>Tag: Frida | 氕氘氚</title>
    <meta name="keywords" content="hexo,theme,otakism,otaku"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="google-site-verification" content=""/>
    <meta name="baidu-site-verification" content=""/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Open your eyes to see the light in life">
<meta property="og:type" content="website">
<meta property="og:title" content="氕氘氚">
<meta property="og:url" content="https://szczecin.github.io/tags/Frida/index.html">
<meta property="og:site_name" content="氕氘氚">
<meta property="og:description" content="Open your eyes to see the light in life">
<meta property="og:locale">
<meta property="article:author" content="Szczecin">
<meta name="twitter:card" content="summary">
    

    <!-- Favicon -->
    
        <link rel="icon" href="/img/favicon.ico" />
    

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css?family=Inconsolata|Roboto:300,400,700" rel="stylesheet">

    
<link rel="stylesheet" href="/style.css">

    <script>
      function setLoadingBarProgress(num) {
        document.getElementById('loading-bar').style.width = num + "%";
      }
    </script>

    


<meta name="generator" content="Hexo 6.2.0"></head>

<body>

<div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>

<script>setLoadingBarProgress(20)</script>

<div id="site-wrapper">

    <header id="header">
    <div id="header-wrapper" class="clearfix">
        <a id="logo" href="/">
            <img src="/img/logo.png"/>
            <span id="site-desc">
                Be A Gorgeous World
            </span>
        </a>
        <button id="site-nav-switch">
            <span class="icon icon-menu"></span>
        </button>
    </div>
</header>
    <script>setLoadingBarProgress(40);</script>

    <main id="main" role="main">
        
  <section class="page-header tag">
    <h1>- <span>Frida</span> -</h1>
  </section>






<section class="post-list">
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/05/29/Request-Resigned-2/">
                灰产-如何破解请求验签（下）
            </a>
        </h2>
    
    <time>
        May 29, 2024
    </time>
    <section class="content">
        <h1><span id="灰产-如何破解请求验签下">灰产-如何破解请求验签（下）</span></h1><p><img src="/2024/05/29/Request-Resigned-2/1.png" alt="image"></p>
<h2><span id="写在前面">写在前面</span></h2><blockquote>
<p>再来个前情提要：<a href="https://szczecin.github.io/2024/05/27/Request-Resigned-1/">灰产-如何破解请求验签（上）</a></p>
<p><strong>以下都是情节模拟，并非具体情况，请细加甄别</strong></p>
<p>阿哈！Showmak……啊不，是新的 Sign 替换后不久就，两周左右就又被破解了呢——</p>
<p>“我们新的加签，可是从多个随机数池取值生成的 sign1，然后把sign1和多个参数混合在一起按时间戳不同取模排列生成的sign2，怎么可能……”</p>
<p>啊，虽然很想吐槽这反派一般被反击了感叹自己部署被打乱了的感觉，但是来不及为已经逝去的 sign2 感到悲伤了，接下来赶到战场的是……</p>
<p>是我这个苦力！</p>
<p>我打灰产？真的假的？要上吗？</p>
<p><img src="/2024/05/29/Request-Resigned-2/2.png" alt="image"></p>
</blockquote>
<h2><span id="总而言之">总而言之</span></h2><blockquote>
<p>总而言之，在解释了旧 Sign 是怎么泄露的后，调查新 Sign 是怎么泄露的这个任务又又又落到我这里了&#x3D; &#x3D;，已经不想吐槽了</p>
</blockquote>
<h2><span id="实现漏洞">实现漏洞</span></h2><blockquote>
<p>“怎么实现的……额，实际上我们等于是接了一个生成库，你可以理解为类似SDK，里面有各种 Sign1 和 Sign2 的实现方式，什么移位啊取模啊都多久前的了，我都快忘了，你想看的话文档给你你可以看一下”</p>
<p>“有没有可能是这个实现的模块泄露了或者可以被调用啥的？”</p>
<p>“我觉得没有吧，感觉也有可能是 Hook 了，但就不知道是怎么弄的”</p>
<p>然后直到最后我除了在研发显示屏上看到了一眼实现文档，我再也没看到那实现方式一眼了</p>
<p><img src="/2024/05/29/Request-Resigned-2/3.png" alt="image"></p>
<p>摸索开始了——</p>
<p>首先通过请求日志我发现，灰产用到的 sign1 有一批量重复的（说好的随机池随机取呢），但是生成的 sign2 是不重复的（sign1 只作为一个参数参与生成 sign2 的计算），我们并没有对 sign1 进行校验，所以导致这个 sign1 可以在请求中被替换，重复利用。</p>
<p><del>顺带一提的是，在其他应用里很早就出现这个情况了，不是我的话都还没发现……</del></p>
<p><img src="/2024/05/29/Request-Resigned-2/4.png" alt="image"></p>
</blockquote>
<h2><span id="定向hook">定向Hook</span></h2><blockquote>
<p>sign1 的问题因为没有校验可以重复利用解决了，那 sign2 呢？</p>
<p>前端没有找到泄露 sign2 计算点，因为前端都可能没用新的 Sign；</p>
<p>应用端源码没看到 sign2 的计算方式，因为做了较好的混淆；</p>
<p>……</p>
<p>那选择就只有一个了！<del>（折断拐杖）</del></p>
<p>对它使用 Hook 吧！</p>
<p><img src="/2024/05/29/Request-Resigned-2/5.png" alt="image"></p>
<p>早在 <a href="https://szczecin.github.io/2024/01/19/MobSF/">MobSF移动安全测试框架|自动化静动态app分析框架</a> 的使用中，我就接触了 Frida，why？因为一开始装不上，并且因为种种原因（MobSF 自带证书冲突等）执行动态分析的效果很差，虽然后来还是能试出来。</p>
<p>扯远了，回到现在，利用 Frida 对应用进行 Hook，我是在 Genymotion 上做的，当然，由于应用配置的关系，你可能需要先：</p>
<ul>
<li>进行 ARM - X86 的转换才能跑起来应用，低版本 Android 不可运行要换成高版本转译：<a target="_blank" rel="noopener" href="https://github.com/niizam/Genymotion_A11_libhoudini">Genymotion_A11_libhoudini</a></li>
<li>高版本 Android 可以开启 SSL pinning 等，需要 Magisk + TrustMeAlready ：<a href="https://szczecin.github.io/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/">How to install Xposed&#x2F;EdXposed&#x2F;LSPosed + Magisk with Genymotion Desktop?</a></li>
<li>安装 Frida：<a href="https://szczecin.github.io/2024/05/27/Brida-Starting-From-Beginning/">brida从0配置</a></li>
</ul>
<p>这里就要说了，为什么涉及到 Brida？</p>
<p>因为一开始是想用 Brida 直接 Hook 调用函数，传到 BurpSuite 直接修改请求，但是后来发现你根本不知道是哪个函数计算 sign2 ，别说改了，Hook 都不知道 Hook 谁，怎么办？</p>
<p><img src="/2024/05/29/Request-Resigned-2/6.png" alt="image"></p>
</blockquote>
<h2><span id="javasecuritymessagedigest">java.security.MessageDigest</span></h2><blockquote>
<p>还记得旧 Sign 最后的加密算法吗？SHA1-Hash</p>
<p>再看看新 Sign，尤其是 sign2 的样式，分明也是 SHA1！</p>
<p>嘛，灵光一现：不如利用 js 跟踪“java.security.MessageDigest”的调用，并输出加密入参与之后的值，js 参考：</p>
<ul>
<li><a href="https://szczecin.github.io/2024/05/27/Android-Reverse-Frida-Hook/">安卓逆向 - Frida Hook（抓包实践）</a></li>
<li><a href="https://szczecin.github.io/2024/05/24/Frida-Hook-Signature/">Frida java层自吐加密算法</a></li>
</ul>
<p><img src="/2024/05/29/Request-Resigned-2/7.png" alt="image"></p>
<p>入参值反解出来是一堆字节码，需要用 java 重新转一下回去：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exchange</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="type">byte</span>[] b = &#123; <span class="number">108</span>, ……, <span class="number">102</span>,</span><br><span class="line">               <span class="number">105</span>, ……, <span class="number">105</span>,</span><br><span class="line">               <span class="number">111</span>, ……, <span class="number">107</span>,</span><br><span class="line">               <span class="number">45</span>, ……, <span class="number">61</span>,</span><br><span class="line">               <span class="number">50</span>, ……, <span class="number">52</span>,</span><br><span class="line">               <span class="number">32</span>, ……, <span class="number">117</span>,</span><br><span class="line">               <span class="number">115</span>, ……, <span class="number">118</span>,</span><br><span class="line">               <span class="number">105</span>, ……, <span class="number">110</span>,</span><br><span class="line">               <span class="number">118</span>, ……, <span class="number">73</span>,</span><br><span class="line">               <span class="number">70</span>, ……, <span class="number">78</span>,</span><br><span class="line">               <span class="number">74</span>, ……, <span class="number">85</span>,</span><br><span class="line">               <span class="number">85</span>, ……, <span class="number">108</span>,</span><br><span class="line">               <span class="number">107</span>, ……, <span class="number">107</span>,</span><br><span class="line">               <span class="number">45</span>, ……, <span class="number">110</span>,</span><br><span class="line">               <span class="number">61</span>, ……, <span class="number">48</span>,</span><br><span class="line">               <span class="number">67</span>, ……, <span class="number">45</span>,</span><br><span class="line">               <span class="number">116</span>, ……, <span class="number">112</span>,</span><br><span class="line">               <span class="number">61</span>, ……, <span class="number">104</span>,</span><br><span class="line">               <span class="number">73</span>, ……, <span class="number">57</span> &#125;;</span><br><span class="line">       <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(b);</span><br><span class="line">       System.out.println(s);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Output:</span><br><span class="line">……data=&#123;<span class="string">&quot;userId&quot;</span>:<span class="string">&quot;……&quot;</span>&#125;……sign1=GORNJPBOGXJXZQRRKYKYZNGZXZSYOUUSCMCM……timestamp=<span class="number">1714030269543</span>……</span><br></pre></td></tr></table></figure>

<h2><span id="sign1amptimestamp">sign1&amp;timestamp</span></h2><blockquote>
<p>ok，入参也出来了，现在只剩一个问题：sign1 在入参中的位置。</p>
<p>其实到这里直接去遍历都可以，但是我还是采集了几份 sign1 在 sign2 生成位置与 timestamp 的关系进行比对，然后发现比对了个寂寞——差一位数的时间戳里 sign1 的插入位置可以相同的 &#x3D; &#x3D;：</p>
<p><img src="/2024/05/29/Request-Resigned-2/8.png" alt="image"></p>
<p>所以不整了，收工！</p>
<p><img src="/2024/05/29/Request-Resigned-2/9.png" alt="image"></p>
</blockquote>
<h2><span id="写在后面">写在后面</span></h2><blockquote>
<p>下篇也写完了，感觉好像也就这样，后续把加固啥的弄上议程吧，不然好像还有些硬编码问题也是头疼，但还要验证一下效果。</p>
<p>沉默，然后……事已至此，先吃（pao）饭（lu）吧</p>
<p><img src="/2024/05/29/Request-Resigned-2/10.gif" alt="image"></p>
</blockquote>
<h2><span id="参考引用">参考引用</span></h2><blockquote>
<p><a href="https://szczecin.github.io/2024/05/27/Request-Resigned-1/">灰产-如何破解请求验签（上）</a></p>
<p><a href="https://szczecin.github.io/2024/01/19/MobSF/">MobSF移动安全测试框架|自动化静动态app分析框架</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/niizam/Genymotion_A11_libhoudini">Genymotion_A11_libhoudini</a></p>
<p><a href="https://szczecin.github.io/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/">How to install Xposed&#x2F;EdXposed&#x2F;LSPosed + Magisk with Genymotion Desktop?</a></p>
<p><a href="https://szczecin.github.io/2024/05/27/Brida-Starting-From-Beginning/">brida从0配置</a></p>
<p><a href="https://szczecin.github.io/2024/05/27/Android-Reverse-Frida-Hook/">安卓逆向 - Frida Hook（抓包实践）</a></p>
<p><a href="https://szczecin.github.io/2024/05/24/Frida-Hook-Signature/">Frida java层自吐加密算法</a></p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Android/" rel="tag">Android</a><a class="tag-none-link" href="/tags/Chaos/" rel="tag">Chaos</a><a class="tag-none-link" href="/tags/Frida/" rel="tag">Frida</a><a class="tag-none-link" href="/tags/Hook/" rel="tag">Hook</a><a class="tag-none-link" href="/tags/Signature/" rel="tag">Signature</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/05/27/Request-Resigned-1/">
                灰产-如何破解请求验签（上）
            </a>
        </h2>
    
    <time>
        May 27, 2024
    </time>
    <section class="content">
        <h1><span id="灰产-如何破解请求验签上">灰产-如何破解请求验签（上）</span></h1><p><img src="/2024/05/27/Request-Resigned-1/1.png" alt="image"></p>
<h2><span id="前情提要">前情提要</span></h2><blockquote>
<p>先来个前情提要：<a href="https://szczecin.github.io/2024/02/01/Apk-Resigned/">灰产-如何对APK修改后重签</a></p>
<p>在写那篇文章的我，是否会想到我竟然还有有关“灰产”的下文来写？而且就标题来说，还有分上下两篇！所以这4个月不到的时间我又经历了什么呢？</p>
<p><img src="/2024/05/27/Request-Resigned-1/2.png" alt="image"></p>
</blockquote>
<h2><span id="写在前面">写在前面</span></h2><blockquote>
<p><strong>以下都是情节模拟，并非具体情况，请细加甄别</strong></p>
<p>让我们把时间拨回到年后。</p>
<p>年后回来一阵子，接到业务风控同学的反馈，我们有用户发现自己的账户被盗了，自己购买了不是自己的商品（不产生金额）并对这个商品统一匿名评价……</p>
<p>我第一反应卧槽哥们我们应用不是做了端校验，不同设备必须验证码登录，怎么连手机一起丢了才有后面能说漏洞导致账密泄漏的事？</p>
<p><img src="/2024/05/27/Request-Resigned-1/3.png" alt="image"></p>
<p>后面通过网关日志、应用日志、接口日志等排查，发现这个用户的登录凭证（token）有从境外服务器请求服务的情况，可以基本确认是 token 的泄漏；</p>
<p>再和用户沟通以及进一步的深入排查，我们发现 token 的泄漏源于用户被钓鱼，这里细节不表；被社工得到的 token 会先从 ip 1 被收集并转发给 ip 2 进行购买请求与评论……</p>
<p>这里涉及到一个问题，我们的请求在各端做了验签，Sign 参数会根据不同端走不同的计算方式，想要更改 token 并发起购买请求，不重新计算 Sign是不可能通过校验的，只有两种可能：</p>
<ul>
<li>我们的 Sign 计算方式被破解</li>
<li>我们的 Sign 计算方式可被任意调用</li>
</ul>
</blockquote>
<h2><span id="总而言之">总而言之</span></h2><blockquote>
<p>总而言之，这个任务又落到我这里了&#x3D; &#x3D;</p>
<p>会议讨论对齐的时候，研发一致认为是在 H5 端的 Sign 计算方式太简单了，如何计算已经被破解，应该换上现在端上更安全的 Sign 计算就可以了！</p>
<p>直接破解一个计算方法理论上是不太容易的，我更在意的是是否是哪个地方泄漏了 Sign 的计算方法，或者在什么地方的计算代码可以被调用，直接入参入值然后得到结果。</p>
<p>但这里就要提到另一个事情了，研发不告诉你！</p>
<p>他们只表述这个好像比较简单就能破，但问他们怎么破的，不知道；问他们在哪里可能泄漏了，不知道：</p>
<p>“大概是从前端 JS 泄漏的？你看我们这里都做了混淆了，你看是不是就是这个位置，sign 关键词都命中了……”“可是为啥我调试&#x2F;下断点没反应啊？”</p>
<p><img src="/2024/05/27/Request-Resigned-1/4.png" alt="image"></p>
<p>后来嘛，在把钓鱼的口子堵了一下后，换上“更安全”的 Sign 计算方式后，喜闻乐见的钓鱼的口子也被绕过了，“更安全”的 Sign 计算也被破解了……</p>
<p>然后呢？</p>
<p>遭殃的还是我好吧，本来他们都认为可行的解决办法没用的时候，我就不得不花时间和精力来看看不在我 OKR 上的问题了</p>
<p><img src="/2024/05/27/Request-Resigned-1/5.png" alt="image"></p>
</blockquote>
<h2><span id="泄漏发现">泄漏发现</span></h2><blockquote>
<p>算研发很配合安全工作，虽然告诉了我一个错误的泄漏位置，但起码提醒了我可能是 JS 就已经泄露了，没必要一来就去逆向找源码。</p>
<p>开始的思路还是去利用前端给到的 JS 复用：<a href="https://szczecin.github.io/2024/05/21/JSFlash-BurpSuite/">Burp Suite作为代理，复用目标站点的js代码处理指定的内容</a></p>
<p>后来发现 JSFlash 必须要能够指定调用代码函数才行，前端 JS 混淆了，指向不出来，直接分析不了</p>
<p>然后我就在前端登录页 Source - js 找到了 Sign 计算点，并且下断点步进调试看到了所有 Sign 的计算入参：</p>
<p><img src="/2024/05/27/Request-Resigned-1/6.png" alt="image"></p>
<p><img src="/2024/05/27/Request-Resigned-1/7.png" alt="image"></p>
</blockquote>
<h2><span id="它端验证">它端验证</span></h2><blockquote>
<p>在前端 JS 调试的过程中能看到有一个 secret 参数是不会暴露在 request 里的，其他端的如何获得？</p>
<p>Jadx 逆向反编译一下应用端，以 SIGN 为关键词，在源代码中发现了硬编码在其他端使用的 secret，以及使用的 Sign 最后加签算法：</p>
<p><img src="/2024/05/27/Request-Resigned-1/8.png" alt="image"></p>
<p><img src="/2024/05/27/Request-Resigned-1/9.png" alt="image"></p>
</blockquote>
<h2><span id="写在后面">写在后面</span></h2><blockquote>
<p>上篇就到这里，写的好像很简单，解过程也没遇到什么麻烦，但是还得说和大伙配合的还是不好，我还是认为不管是锻炼或者检验个人能力也好，工作任务忙不想接手深入这个事情也好，如果是以把事情完成的结论来说，相互配合是很重要的。</p>
<p>以旧 Sign 为例，大家说的好像每个人都知道这个是怎么生成的，但就是没人和你说，告诉的还是错误的位置，即使真的可能知道是怎么生成的不知道是在哪里泄露的，那信息汇通还是更重要的。研发完全可以告诉你“我猜是在前端 JS 泄漏的，位置是在这里，他的调用是这样的……”给你演示出来，如果真的在前端直接 Debug 下断点走一遍，就会知道一开始的位置告诉错了，并且一下就把泄漏点找出来了。</p>
<p>不会浪费双方的时间的。</p>
<p><img src="/2024/05/27/Request-Resigned-1/10.png" alt="image"></p>
</blockquote>
<h2><span id="参考引用">参考引用</span></h2><blockquote>
<p><a href="https://szczecin.github.io/2024/02/01/Apk-Resigned/">灰产-如何对APK修改后重签</a></p>
<p><a href="https://szczecin.github.io/2024/05/21/JSFlash-BurpSuite/">Burp Suite作为代理，复用目标站点的js代码处理指定的内容</a></p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Android/" rel="tag">Android</a><a class="tag-none-link" href="/tags/Chaos/" rel="tag">Chaos</a><a class="tag-none-link" href="/tags/Frida/" rel="tag">Frida</a><a class="tag-none-link" href="/tags/Hook/" rel="tag">Hook</a><a class="tag-none-link" href="/tags/Signature/" rel="tag">Signature</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/05/27/Android-Reverse-Frida-Hook/">
                安卓逆向 - Frida Hook（抓包实践）
            </a>
        </h2>
    
    <time>
        May 27, 2024
    </time>
    <section class="content">
        <h1><span id="安卓逆向-基础入门教程">安卓逆向 - 基础入门教程</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42840266/article/details/132279975">小馒头yy</a> 并作补充</p>
</blockquote>
<h2><span id="一-引言">一、引言</span></h2><blockquote>
<p>上篇文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42840266/article/details/132080000">安卓逆向 - 基础入门教程_小馒头yy的博客-CSDN博客</a> 介绍了Frida的安装、基本使用，今天我们来看看Frida常用Hook和基于Frida抓包实践。</p>
</blockquote>
<h2><span id="二-frida常用-hook脚本">二、Frida常用 Hook脚本</span></h2><blockquote>
<p>1、hook java.net.URL</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook1</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable constant_">URL</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.net.URL&#x27;</span>);</span><br><span class="line">    <span class="variable constant_">URL</span>.<span class="property">$init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.lang.String&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">a</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;加密前：&#x27;</span> + a)</span><br><span class="line">        <span class="title function_">showStacks</span>()</span><br><span class="line">        <span class="variable language_">this</span>.$init(a)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、hook okhttp3 HttpUrl</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hookOkhttp3</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Builder</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;okhttp3.Request$Builder&#x27;</span>);</span><br><span class="line">    <span class="title class_">Builder</span>.<span class="property">url</span>.<span class="title function_">overload</span>(<span class="string">&#x27;okhttp3.HttpUrl&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">a</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;a: &#x27;</span> + a)</span><br><span class="line">        <span class="keyword">var</span> res = <span class="variable language_">this</span>.<span class="title function_">url</span>(a);</span><br><span class="line">        <span class="title function_">showStacks</span>()</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;res: &quot;</span> + res)</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、hook okhttp3 addHeader</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Builder</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;okhttp3.Request$Builder&quot;</span>);</span><br><span class="line">    <span class="title class_">Builder</span>[<span class="string">&quot;addHeader&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">str, str2</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;key: &quot;</span> + str)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;val: &quot;</span> + str2)</span><br><span class="line">        <span class="title function_">showStacks</span>()</span><br><span class="line">        <span class="keyword">var</span> result = <span class="variable language_">this</span>[<span class="string">&quot;addHeader&quot;</span>](str, str2);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;result: &quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、打印堆栈</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">showStacks</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.util.Log&quot;</span>).<span class="title function_">getStackTraceString</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.Exception&quot;</span>).$new()));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5、hook Base64</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hookBase</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// Base64</span></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Base64Class</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.util.Base64&quot;</span>);</span><br><span class="line">    <span class="title class_">Base64Class</span>.<span class="property">encodeToString</span>.<span class="title function_">overload</span>(<span class="string">&quot;[B&quot;</span>, <span class="string">&quot;int&quot;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">a, b</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> rc = <span class="variable language_">this</span>.<span class="title function_">encodeToString</span>(a, b);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;&gt;&gt;&gt; Base64 &quot;</span> + rc);</span><br><span class="line">        <span class="keyword">return</span> rc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>6、hook HashMap</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hookMap</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Build</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.util.HashMap&quot;</span>);</span><br><span class="line">    <span class="title class_">Build</span>[<span class="string">&quot;put&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">key, val</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;key : &quot;</span> + key)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;val : &quot;</span> + val)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">put</span>(key, val)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h2><span id="三-某麦网抓包实践">三、某麦网抓包实践</span></h2><blockquote>
<p>本篇以某麦网帖子详情接口，演示如何基于Frida hook抓包</p>
<p>1、安装某麦网8.<em>.</em>.apk</p>
<p>2、搭建Frida hook 环境，注入 hook java.net.URL脚本</p>
<p>3、点进帖子详情打印出如下堆栈，我们可以根据打印出的信息，跟栈分析该接口的请求头。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//acs.m.taobao.com/gw/mtop.damai.wireless.discovery.detail.get/1.4/?source=10101&amp;version=6000168&amp;type=originaljson&amp;data=%7B%22contentId%22%3A%2211088650%22%2C%22appType%22%3A%221%22%2C%22source%22%3A%2210101%22%2C%22osType%22%3A%222%22%2C%22pageSize%22%3A%2230%22%2C%22pageIndex%22%3A%221%22%2C%22version%22%3A%226000168%22%2C%22channel_from%22%3A%22damai_market%22%7D&amp;appType=1&amp;osType=2&amp;channel_from=damai_market</span></span><br><span class="line">java.lang.Exception</span><br><span class="line">        at java.net.URL.&lt;init&gt;(Native Method)</span><br><span class="line">        at tb.yy0.m(Taobao:<span class="number">1</span>)</span><br><span class="line">        at anet.channel.request.a.p(Taobao:<span class="number">2</span>)</span><br><span class="line">        at anet.channel.session.TnetSpdySession.w(Taobao:<span class="number">18</span>)</span><br><span class="line">        at anetwork.channel.unified.NetworkTask.sendRequest(Taobao:<span class="number">6</span>)</span><br><span class="line">        at anetwork.channel.unified.NetworkTask.run(Taobao:<span class="number">44</span>)</span><br><span class="line">        at anetwork.channel.unified.UnifiedRequestTask$a.proceed(Taobao:<span class="number">15</span>)</span><br><span class="line">        at com.taobao.orange.sync.NetworkInterceptor.intercept(Taobao:<span class="number">30</span>)</span><br><span class="line">        at anetwork.channel.unified.UnifiedRequestTask$a.proceed(Taobao:<span class="number">7</span>)</span><br><span class="line">        at anetwork.channel.unified.UnifiedRequestTask$<span class="number">3.</span>run(Taobao:<span class="number">2</span>)</span><br><span class="line">        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:<span class="number">428</span>)</span><br><span class="line">        at java.util.concurrent.FutureTask.run(FutureTask.java:<span class="number">237</span>)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:<span class="number">1133</span>)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:<span class="number">607</span>)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:<span class="number">761</span>)</span><br></pre></td></tr></table></figure>

<p>4、使用Jadx打开某麦网apk</p>
<p>从at tb.yy0.m(Taobao:1)跟栈分析</p>
<p><img src="/2024/05/27/Android-Reverse-Frida-Hook/1.png" alt="image"></p>
<p> 根据调用栈往上走，定位到如下位置，注意这行代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALog.f(<span class="string">&quot;awcn.TnetSpdySession&quot;</span>, <span class="string">&quot;&quot;</span>, aVar.n(), <span class="string">&quot;request headers&quot;</span>, aVar.g());</span><br></pre></td></tr></table></figure>

<p><img src="/2024/05/27/Android-Reverse-Frida-Hook/2.png" alt="image"></p>
<p>代码注释很清楚了 request headers，我们跟进 hook aVar.g() 这个方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">g</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Collections.unmodifiableMap(<span class="built_in">this</span>.f);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>hook之，对象输出可以使用 JSONObject转一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">var</span> <span class="variable">JSONObject</span> <span class="operator">=</span> Java.use(<span class="string">&quot;com.alibaba.fastjson.JSONObject&quot;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook6</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">JSON</span><span class="built_in">Object</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.alibaba.fastjson.JSONObject&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> a = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;anet.channel.request.a&quot;</span>);</span><br><span class="line">    a[<span class="string">&quot;g&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> result = <span class="variable language_">this</span>[<span class="string">&quot;g&quot;</span>]();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;result : &quot;</span> + <span class="title class_">JSON</span><span class="built_in">Object</span>.<span class="title function_">toJSON</span>(result).<span class="title function_">toString</span>());</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打印出如下内容：</p>
<p><img src="/2024/05/27/Android-Reverse-Frida-Hook/3.png" alt="image"></p>
<p>请求 URL、 请求方法这边都写得很清楚啦。</p>
<p><img src="/2024/05/27/Android-Reverse-Frida-Hook/4.png" alt="image"></p>
<p>收工！</p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Android/" rel="tag">Android</a><a class="tag-none-link" href="/tags/Frida/" rel="tag">Frida</a><a class="tag-none-link" href="/tags/Hook/" rel="tag">Hook</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/05/27/Android-Reverse-Base/">
                安卓逆向 - 基础入门教程
            </a>
        </h2>
    
    <time>
        May 27, 2024
    </time>
    <section class="content">
        <h1><span id="安卓逆向-基础入门教程">安卓逆向 - 基础入门教程</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42840266/article/details/132080000">小馒头yy</a> 并作补充</p>
</blockquote>
<h2><span id="一-引言">一、引言</span></h2><blockquote>
<p>1、我们在采集app数据时，有些字段是加密的，如某麦网x-mini-wua x-sgext x-sign x-umt x-utdid等参数，这时候我们需要去分析加密字段的生成。本篇将以采集的角度讲解入门安卓逆向需要掌握的技能、工具。</p>
<p>2、安卓（Android）是一种基于Linux内核操作系统，架构图（了解即可）</p>
<p><img src="/2024/05/27/Android-Reverse-Base/1.png" alt="image"></p>
<p>3、安卓应用程序使用JAVA语言编写（重要），作为一名安卓逆向人员我们必须掌握Java语言基础（基本语法、类、接口、面向对象、网络类库、加密解密等等）</p>
<p>4、安卓逆向是对已经打包好的APP进行反编译，分析源码了解应用逻辑的一门技术，这一部分我们需要学习静态分析，动态分析。各种反编译工具（推荐 jadx），Frida Hook。</p>
</blockquote>
<h2><span id="二-静态分析学习jadx反编译">二、静态分析，学习jadx反编译</span></h2><blockquote>
<p>1、安装jadx，github地址： <a target="_blank" rel="noopener" href="https://github.com/skylot/jadx/releases?page=1">Releases · skylot&#x2F;jadx · GitHub</a>，下载 <a target="_blank" rel="noopener" href="https://github.com/skylot/jadx/releases/download/v1.4.7/jadx-1.4.7.zip">jadx-1.4.7.zip</a> 解压即可。</p>
<p><img src="/2024/05/27/Android-Reverse-Base/2.png" alt="image"></p>
<p>2、调整jadx最大内存，打开bin目录下的 jadx-gui.bat文件，搜索DEFAULT_JVM_OPTS。</p>
<p>将 -XX:MaxRAMPercentage&#x3D;70.0 修改成 -Xmx16g </p>
<p><img src="/2024/05/27/Android-Reverse-Base/3.png" alt="image"></p>
<p>3、jadx使用，打开apk，jadx会自动反编译apk</p>
<p><img src="/2024/05/27/Android-Reverse-Base/4.png" alt="image"></p>
<p>全局搜索：点击左上角的导航 - 文本搜索，输入关键字，并且下方可以筛选检索的位置</p>
<p><img src="/2024/05/27/Android-Reverse-Base/5.png" alt="image"></p>
<p>根据关键字定位到关键代码后，我们就可以进行分析加密参数的生成啦。</p>
</blockquote>
<h2><span id="三-动态分析frida-初使用">三、动态分析，Frida 初使用</span></h2><blockquote>
<p>1、安装 adb （Android Debug Bridge），通过命令行使用adb，对安卓设备进行操作</p>
<p>2、下载模拟器，我使用的逍遥模拟器 （有Root好的真机更棒）</p>
<p>模拟器启动后，在命令行依次执行命令：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">adb forward tcp:<span class="number">27043</span> tcp:<span class="number">27043</span></span><br><span class="line">adb forward tcp:<span class="number">27042</span> tcp:<span class="number">27042</span></span><br><span class="line">adb connect <span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">21503</span></span><br><span class="line">adb devices</span><br></pre></td></tr></table></figure>

<p>再执行 adb shell，即可进入模拟器， #字符代表已 Root </p>
<p><img src="/2024/05/27/Android-Reverse-Base/6.png" alt="image"></p>
<p>3、安装Frida</p>
<p>本地直接使用 pip install frida 命令安装 （需有Python环境）</p>
<p>模拟器（手机）端下载对应的Frida-server: Releases · frida&#x2F;frida · GitHub</p>
<p>低版本安卓推荐下载：12.8.13，高版本安卓直接下载最新版</p>
<p>模拟器是 x86架构，真机是 arm架构，请下载对应的 frida-server</p>
<p>4、开启Hook，动态分析应用运行时数据</p>
<ul>
<li>将frida-server传到手机 &#x2F;data&#x2F;local&#x2F;tmp 目录，转到本地frida-server存放的目录，依次执行以下命令</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">adb push frida-server-12.8.13-android-x86 /data/local/tmp</span><br><span class="line">adb shell</span><br><span class="line"><span class="built_in">cd</span> /data/local/tmp</span><br><span class="line"><span class="built_in">chmod</span> 777 frida-server-12.8.13-android-x86</span><br><span class="line">./frida-server-12.8.13-android-x86</span><br></pre></td></tr></table></figure>

<ul>
<li>编写 hook脚本，使用js方式启动，本例为 hook URL的构造方法：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook1</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable constant_">URL</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.net.URL&#x27;</span>);</span><br><span class="line">    <span class="variable constant_">URL</span>.<span class="property">$init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.lang.String&#x27;</span>).<span class="property">implementation</span>= <span class="keyword">function</span>(<span class="params">a</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;加密前：&#x27;</span>+a)               </span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;                    &#x27;</span>)</span><br><span class="line">            <span class="variable language_">this</span>.$init(a)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title function_">hook</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="title function_">setImmediate</span>(main);</span><br></pre></td></tr></table></figure>

<ul>
<li>开始 hook，注意高版本 frida不需要带 –no-pause</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida -U -l dm_hook.js -f cn.damai --no-pause</span><br></pre></td></tr></table></figure>

<p>其中 dm_hook.js是 hook脚本的文件名，cn.damai是apk的包名。</p>
<p>滑动应用，正常打印出 url信息。</p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Android/" rel="tag">Android</a><a class="tag-none-link" href="/tags/Frida/" rel="tag">Frida</a><a class="tag-none-link" href="/tags/Jadx/" rel="tag">Jadx</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/05/24/Frida-Hook-Signature/">
                Frida java层自吐加密算法
            </a>
        </h2>
    
    <time>
        May 24, 2024
    </time>
    <section class="content">
        <h1><span id="frida-java层自吐加密算法">Frida java层自吐加密算法</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://kuizuo.cn/docs/frida-java-encryption-algorithm/">愧怍</a> 并作补充</p>
</blockquote>
<h2><span id="代码">代码</span></h2><blockquote>
<p>针对 java 层加密算法，能 hook 到 java 自带的加密函数库</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  <span class="attr">showStacks</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">showDivider</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// console.log(&#x27;frida 已启动&#x27;);</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">showStacks</span>(<span class="params">name = <span class="string">&#x27;&#x27;</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (config.<span class="property">showStacks</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;android.util.Log&#x27;</span>).<span class="title function_">getStackTraceString</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.lang.Throwable&#x27;</span>).$new(name)))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">showDivider</span>(<span class="params">name = <span class="string">&#x27;&#x27;</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (config.<span class="property">showDivider</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`==============================<span class="subst">$&#123;name&#125;</span>==============================`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">showArguments</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;arguments: &#x27;</span>, ...<span class="variable language_">arguments</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">ByteString</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;com.android.okhttp.okio.ByteString&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Encode</span> = &#123;</span><br><span class="line">    <span class="title function_">toBase64</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(tag + <span class="string">&#x27; Base64: &#x27;</span>, <span class="title class_">ByteString</span>.<span class="title function_">of</span>(data).<span class="title function_">base64</span>())</span><br><span class="line">      <span class="comment">// console.log(tag + &#x27; Base64: &#x27;, bytesToBase64(data));</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">toHex</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(tag + <span class="string">&#x27; Hex: &#x27;</span>, <span class="title class_">ByteString</span>.<span class="title function_">of</span>(data).<span class="title function_">hex</span>())</span><br><span class="line">      <span class="comment">// console.log(tag + &#x27; Hex: &#x27;, bytesToHex(data));</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">toUtf8</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(tag + <span class="string">&#x27; Utf8: &#x27;</span>, <span class="title class_">ByteString</span>.<span class="title function_">of</span>(data).<span class="title function_">utf8</span>())</span><br><span class="line">      <span class="comment">// console.log(tag + &#x27; Utf8: &#x27;, bytesToString(data));</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">toAll</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">      <span class="title class_">Encode</span>.<span class="title function_">toUtf8</span>(tag, data)</span><br><span class="line">      <span class="title class_">Encode</span>.<span class="title function_">toHex</span>(tag, data)</span><br><span class="line">      <span class="title class_">Encode</span>.<span class="title function_">toBase64</span>(tag, data)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">toResult</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">      <span class="title class_">Encode</span>.<span class="title function_">toHex</span>(tag, data)</span><br><span class="line">      <span class="title class_">Encode</span>.<span class="title function_">toBase64</span>(tag, data)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">MessageDigest</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="params"><span class="string">&#x27;java.security.MessageDigest&#x27;</span></span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">let</span> overloads_update = <span class="title class_">MessageDigest</span>.<span class="property">update</span>.<span class="property">overloads</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_update) &#123;</span><br><span class="line">      overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">        <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">        <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">update</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> overloads_digest = <span class="title class_">MessageDigest</span>.<span class="property">digest</span>.<span class="property">overloads</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_digest) &#123;</span><br><span class="line">      overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">        <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">        <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">        <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="title function_">digest</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">3</span>) &#123;</span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toResult</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> digest result`</span>, result)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Mac</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="params"><span class="string">&#x27;javax.crypto.Mac&#x27;</span></span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="title class_">Mac</span>.<span class="property">init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.security.Key&#x27;</span>, <span class="string">&#x27;java.security.spec.AlgorithmParameterSpec&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">key, AlgorithmParameterSpec</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">init</span>(key, <span class="title class_">AlgorithmParameterSpec</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">Mac</span>.<span class="property">init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.security.Key&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">key</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">      <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">      <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">      <span class="keyword">const</span> keyBytes = key.<span class="title function_">getEncoded</span>()</span><br><span class="line">      <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> init Key`</span>, keyBytes)</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">init</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// let overloads_update = Mac.update.overloads;</span></span><br><span class="line">    <span class="comment">// for (const overload of overloads_update) &#123;</span></span><br><span class="line">    <span class="comment">//   overload.implementation = function () &#123;</span></span><br><span class="line">    <span class="comment">//     const algorithm = this.getAlgorithm();</span></span><br><span class="line">    <span class="comment">//     showDivider(algorithm);</span></span><br><span class="line">    <span class="comment">//     showStacks(algorithm);</span></span><br><span class="line">    <span class="comment">//     Encode.toAll(`$&#123;algorithm&#125; update data`, arguments[0]);</span></span><br><span class="line">    <span class="comment">//     return this.update(...arguments);</span></span><br><span class="line">    <span class="comment">//   &#125;;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> overloads_doFinal = <span class="title class_">Mac</span>.<span class="property">doFinal</span>.<span class="property">overloads</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_doFinal) &#123;</span><br><span class="line">      overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">        <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">        <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">        <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="title function_">doFinal</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">3</span>) &#123;</span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toResult</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> doFinal result`</span>, result)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Cipher</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="params"><span class="string">&#x27;javax.crypto.Cipher&#x27;</span></span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">let</span> overloads_init = <span class="title class_">Cipher</span>.<span class="property">init</span>.<span class="property">overloads</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_init) &#123;</span><br><span class="line">      overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">        <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">        <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">arguments</span>[<span class="number">0</span>]) &#123;</span><br><span class="line">          <span class="keyword">const</span> mode = <span class="variable language_">arguments</span>[<span class="number">0</span>]</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> init mode`</span>, mode)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">arguments</span>[<span class="number">1</span>]) &#123;</span><br><span class="line">          <span class="keyword">const</span> className = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">arguments</span>[<span class="number">1</span>])</span><br><span class="line">          <span class="comment">// 安卓10以上私钥是有可能输出不了的</span></span><br><span class="line">          <span class="keyword">if</span> (className.<span class="title function_">includes</span>(<span class="string">&#x27;OpenSSLRSAPrivateKey&#x27;</span>)) &#123;</span><br><span class="line">            <span class="comment">// const keyBytes = arguments[1];</span></span><br><span class="line">            <span class="comment">// console.log(`$&#123;algorithm&#125; init key`, keyBytes);</span></span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> keyBytes = <span class="variable language_">arguments</span>[<span class="number">1</span>].<span class="title function_">getEncoded</span>()</span><br><span class="line">            <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> init key`</span>, keyBytes)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">arguments</span>[<span class="number">2</span>]) &#123;</span><br><span class="line">          <span class="keyword">const</span> className = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">arguments</span>[<span class="number">2</span>])</span><br><span class="line">          <span class="keyword">if</span> (className.<span class="title function_">includes</span>(<span class="string">&#x27;javax.crypto.spec.IvParameterSpec&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">const</span> iv = <span class="title class_">Java</span>.<span class="title function_">cast</span>(<span class="variable language_">arguments</span>[<span class="number">2</span>], <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;javax.crypto.spec.IvParameterSpec&#x27;</span>))</span><br><span class="line">            <span class="keyword">const</span> ivBytes = iv.<span class="title function_">getIV</span>()</span><br><span class="line">            <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> init iv`</span>, ivBytes)</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (className.<span class="title function_">includes</span>(<span class="string">&#x27;java.security.SecureRandom&#x27;</span>)) &#123;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">init</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// let overloads_update = Cipher.update.overloads;</span></span><br><span class="line">    <span class="comment">// for (const overload of overloads_update) &#123;</span></span><br><span class="line">    <span class="comment">//   overload.implementation = function () &#123;</span></span><br><span class="line">    <span class="comment">//     const algorithm = this.getAlgorithm();</span></span><br><span class="line">    <span class="comment">//     showDivider(algorithm);</span></span><br><span class="line">    <span class="comment">//     showStacks(algorithm);</span></span><br><span class="line">    <span class="comment">//     Encode.toAll(`$&#123;algorithm&#125; update data`, arguments[0]);</span></span><br><span class="line">    <span class="comment">//     return this.update(...arguments);</span></span><br><span class="line">    <span class="comment">//   &#125;;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> overloads_doFinal = <span class="title class_">Cipher</span>.<span class="property">doFinal</span>.<span class="property">overloads</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_doFinal) &#123;</span><br><span class="line">      overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">        <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">        <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">        <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="title function_">doFinal</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">3</span>) &#123;</span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toResult</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> doFinal result`</span>, result)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Signature</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="params"><span class="string">&#x27;java.security.Signature&#x27;</span></span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">let</span> overloads_update = <span class="title class_">Signature</span>.<span class="property">update</span>.<span class="property">overloads</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_update) &#123;</span><br><span class="line">      overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">        <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">        <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">update</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> overloads_sign = <span class="title class_">Signature</span>.<span class="property">sign</span>.<span class="property">overloads</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_sign) &#123;</span><br><span class="line">      overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">        <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">        <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">        <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="title function_">sign</span>()</span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toResult</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> sign result`</span>, result)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">sign</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Exploit/" rel="tag">Exploit</a><a class="tag-none-link" href="/tags/Frida/" rel="tag">Frida</a><a class="tag-none-link" href="/tags/Hook/" rel="tag">Hook</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
</section>


        <script>setLoadingBarProgress(60);</script>
    </main>

    <footer id="footer" class="clearfix">

    

    <div class="social-wrapper">
        
            
                <a href="https://github.com/szczecin" class="social github"
                   target="_blank" rel="external">
                    <span class="icon icon-github"></span>
                </a>
            
                <a href="/atom.xml" class="social rss"
                   target="_blank" rel="external">
                    <span class="icon icon-rss"></span>
                </a>
            
        
    </div>

    <div class="theme-by">Theme <span class="codename">Memory</span> designed by <a href="https://artifact.me/"
                                                                                    target="_blank">Art Chen</a>.
    </div>
    <div>&copy; <a href="/">氕氘氚</a></div>

</footer>


    <script>setLoadingBarProgress(80);</script>
    <div class="overlay"></div>
</div>

<div class="site-sidebar" id="site-sidebar">

    

    <div class="sidebar-switch clearfix "
         style="display: none">
        <a class="dark-btn active" data-toggle="toc">
            <span class="icon icon-list"></span>
            <span class="text">Index</span>
        </a>
        <a class="dark-btn" data-toggle="bio">
            <span class="icon icon-person"></span>
            <span class="text">Bio</span>
        </a>
    </div>

    <div class="site-toc "
         style="display: none">
        
            <div class="no-index">No Index</div>
        
    </div>

    <div class="site-bio show"
         style="display: block">

        <div class="about-me clearfix">
            <div class="avatar">
                <img src="/img/avatar.png"/>
            </div>
            <div class="info">
                <a class="name dark-btn" href="/about">
                    Szczecin
                </a>
            </div>
            <div class="info">
                <span class="item desc">
                    Open your eyes to see the light in life
                </span>
            </div>
        </div>

        <div class="menu section">
            <ul class="clearfix">
                
                    <li class="left">
                        <a href="/about"
                           onfocus="this.blur();"
                           class="nav-about dark-btn block">
                            简介
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/archives"
                           onfocus="this.blur();"
                           class="nav-archives dark-btn block">
                            归档
                        </a>
                    </li>
                
                    <li class="left">
                        <a href="/categories"
                           onfocus="this.blur();"
                           class="nav-categories dark-btn block">
                            分类
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/tags"
                           onfocus="this.blur();"
                           class="nav-tags dark-btn block">
                            TAGs
                        </a>
                    </li>
                
                    <li class="left">
                        <a href="/WriteUP"
                           onfocus="this.blur();"
                           class="nav-WriteUP dark-btn block">
                            WriteUP
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/EXP"
                           onfocus="this.blur();"
                           class="nav-EXP dark-btn block">
                            EXP
                        </a>
                    </li>
                
                    <li class="left">
                        <a href="/tags/SRC"
                           onfocus="this.blur();"
                           class="nav-SRC dark-btn block">
                            SRC
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/Life"
                           onfocus="this.blur();"
                           class="nav-Life dark-btn block">
                            Life
                        </a>
                    </li>
                
            </ul>
        </div>

    </div>

    <div class="shortcuts">
        <a href="#header" class="top window-nav dark-btn" id="go-top">
            <span class="icon icon-chevron-thin-up"></span>
        </a>
        <a class="close dark-btn" id="sidebar-close">
            <span class="icon icon-close"></span>
        </a>
        <a href="#footer" class="top window-nav dark-btn" id="go-bottom">
            <span class="icon icon-chevron-thin-down"></span>
        </a>
    </div>

</div>





<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script>window.jQuery || document.write('<script src="/js/jquery.min.js"><\/script>')</script>


<script src="/js/jquery.fitvids.js"></script>

<script>
  var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
  var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
  var ALGOLIA_API_KEY = "";
  var ALGOLIA_APP_ID = "";
  var ALGOLIA_INDEX_NAME = "";
  var AZURE_SERVICE_NAME = "";
  var AZURE_INDEX_NAME = "";
  var AZURE_QUERY_KEY = "";
  var SEARCH_SERVICE = "";
  var universalSearchConfig = {};
  if (SEARCH_SERVICE === 'google') {
    universalSearchConfig = {
      searchService: SEARCH_SERVICE,
      apiKey: GOOGLE_CUSTOM_SEARCH_API_KEY,
      engineId: GOOGLE_CUSTOM_SEARCH_ENGINE_ID,
      imagePath: "/img/"
    };
  } else if (SEARCH_SERVICE === 'algolia') {
    universalSearchConfig = {
      searchService: SEARCH_SERVICE,
      apiKey: ALGOLIA_API_KEY,
      appId: ALGOLIA_APP_ID,
      indexName: ALGOLIA_INDEX_NAME,
      imagePath: "/img/"
    };
  } else if (SEARCH_SERVICE === 'azure') {
    universalSearchConfig = {
      searchService: SEARCH_SERVICE,
      serviceName: AZURE_SERVICE_NAME,
      indexName: AZURE_INDEX_NAME,
      apiKey: AZURE_QUERY_KEY,
      imagePath: "/img/"
    };
  }
</script>

<script src="/js/app.js"></script>


<script src="/js/search.js"></script>





<script>setLoadingBarProgress(100);</script>

</body>
</html>
