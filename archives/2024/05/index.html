<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>Archives: 2024/5 | 氕氘氚</title>
    <meta name="keywords" content="hexo,theme,otakism,otaku"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="google-site-verification" content=""/>
    <meta name="baidu-site-verification" content=""/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Open your eyes to see the light in life">
<meta property="og:type" content="website">
<meta property="og:title" content="氕氘氚">
<meta property="og:url" content="https://szczecin.github.io/archives/2024/05/index.html">
<meta property="og:site_name" content="氕氘氚">
<meta property="og:description" content="Open your eyes to see the light in life">
<meta property="og:locale">
<meta property="article:author" content="Szczecin">
<meta name="twitter:card" content="summary">
    

    <!-- Favicon -->
    
        <link rel="icon" href="/img/favicon.ico" />
    

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css?family=Inconsolata|Roboto:300,400,700" rel="stylesheet">

    
<link rel="stylesheet" href="/style.css">

    <script>
      function setLoadingBarProgress(num) {
        document.getElementById('loading-bar').style.width = num + "%";
      }
    </script>

    


<meta name="generator" content="Hexo 6.2.0"></head>

<body>

<div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>

<script>setLoadingBarProgress(20)</script>

<div id="site-wrapper">

    <header id="header">
    <div id="header-wrapper" class="clearfix">
        <a id="logo" href="/">
            <img src="/img/logo.png"/>
            <span id="site-desc">
                Be A Gorgeous World
            </span>
        </a>
        <button id="site-nav-switch">
            <span class="icon icon-menu"></span>
        </button>
    </div>
</header>
    <script>setLoadingBarProgress(40);</script>

    <main id="main" role="main">
        
    


  <section class="page-header archive">
    <h1>- <span>2024.5</span> -</h1>
  </section>




<section class="post-list">
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/05/29/Silence/">
                Silence-赫默
            </a>
        </h2>
    
    <time>
        May 29, 2024
    </time>
    <section class="content">
        <h1><span id="silence-赫默">Silence-赫默</span></h1><p><img src="/2024/05/29/Silence/1.png" alt="image"></p>
<blockquote>
<p>诶，我看到这个皮肤的时候，整个人脑内立刻就是下面这张表情包了：</p>
</blockquote>
<p><img src="/2024/05/29/Silence/2.png" alt="image"></p>
<blockquote>
<p>因为是开服第一个五星，因为和过去某位很像，因为一起度过了艰难的岁月，因为内心目前仍有歉意，所以赫默确实是我很喜欢的角色……</p>
<p>所以我 Pixiv 上第一幅有关的明日方舟的画作才会是：<a target="_blank" rel="noopener" href="https://www.pixiv.net/artworks/76865361">一枚斑羽毛【A spotted feather】</a></p>
</blockquote>
<p><img src="/2024/05/29/Silence/3.png" alt="image"></p>
<blockquote>
<p>19年啊，晃眼5年过去了，该忘掉的没忘掉，所幸不该忘掉的也没怎么忘掉。</p>
<p>现在看板干员换了一个又一个，但我也没法说我厨哪个，只觉得这个角色可爱，吃这个人设和故事，摆上去一段时间，但更多的感情也没有了，所以是个假二次元（没有一个季度换一次老婆真对不起呢）</p>
<p>赫默有塞雷娅、伊芙利特、白面鸮陪着，实话是羡慕的，感觉自己也不配代替或成为其中任何一个位置……</p>
<p>写到这里刷刷手机发现“生路”的PV发了，一眼二队长新皮肤（感觉不如返航）</p>
</blockquote>
<p><img src="/2024/05/29/Silence/4.png" alt="image"></p>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Arknights/" rel="tag">Arknights</a><a class="tag-none-link" href="/tags/Picture/" rel="tag">Picture</a><a class="tag-none-link" href="/tags/Silence/" rel="tag">Silence</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/05/29/Request-Resigned-2/">
                灰产-如何破解请求验签（下）
            </a>
        </h2>
    
    <time>
        May 29, 2024
    </time>
    <section class="content">
        <h1><span id="灰产-如何破解请求验签下">灰产-如何破解请求验签（下）</span></h1><p><img src="/2024/05/29/Request-Resigned-2/1.png" alt="image"></p>
<h2><span id="写在前面">写在前面</span></h2><blockquote>
<p>再来个前情提要：<a href="https://szczecin.github.io/2024/05/27/Request-Resigned-1/">灰产-如何破解请求验签（上）</a></p>
<p><strong>以下都是情节模拟，并非具体情况，请细加甄别</strong></p>
<p>阿哈！Showmak……啊不，是新的 Sign 替换后不久就，两周左右就又被破解了呢——</p>
<p>“我们新的加签，可是从多个随机数池取值生成的 sign1，然后把sign1和多个参数混合在一起按时间戳不同取模排列生成的sign2，怎么可能……”</p>
<p>啊，虽然很想吐槽这反派一般被反击了感叹自己部署被打乱了的感觉，但是来不及为已经逝去的 sign2 感到悲伤了，接下来赶到战场的是……</p>
<p>是我这个苦力！</p>
<p>我打灰产？真的假的？要上吗？</p>
<p><img src="/2024/05/29/Request-Resigned-2/2.png" alt="image"></p>
</blockquote>
<h2><span id="总而言之">总而言之</span></h2><blockquote>
<p>总而言之，在解释了旧 Sign 是怎么泄露的后，调查新 Sign 是怎么泄露的这个任务又又又落到我这里了&#x3D; &#x3D;，已经不想吐槽了</p>
</blockquote>
<h2><span id="实现漏洞">实现漏洞</span></h2><blockquote>
<p>“怎么实现的……额，实际上我们等于是接了一个生成库，你可以理解为类似SDK，里面有各种 Sign1 和 Sign2 的实现方式，什么移位啊取模啊都多久前的了，我都快忘了，你想看的话文档给你你可以看一下”</p>
<p>“有没有可能是这个实现的模块泄露了或者可以被调用啥的？”</p>
<p>“我觉得没有吧，感觉也有可能是 Hook 了，但就不知道是怎么弄的”</p>
<p>然后直到最后我除了在研发显示屏上看到了一眼实现文档，我再也没看到那实现方式一眼了</p>
<p><img src="/2024/05/29/Request-Resigned-2/3.png" alt="image"></p>
<p>摸索开始了——</p>
<p>首先通过请求日志我发现，灰产用到的 sign1 有一批量重复的（说好的随机池随机取呢），但是生成的 sign2 是不重复的（sign1 只作为一个参数参与生成 sign2 的计算），我们并没有对 sign1 进行校验，所以导致这个 sign1 可以在请求中被替换，重复利用。</p>
<p><del>顺带一提的是，在其他应用里很早就出现这个情况了，不是我的话都还没发现……</del></p>
<p><img src="/2024/05/29/Request-Resigned-2/4.png" alt="image"></p>
</blockquote>
<h2><span id="定向hook">定向Hook</span></h2><blockquote>
<p>sign1 的问题因为没有校验可以重复利用解决了，那 sign2 呢？</p>
<p>前端没有找到泄露 sign2 计算点，因为前端都可能没用新的 Sign；</p>
<p>应用端源码没看到 sign2 的计算方式，因为做了较好的混淆；</p>
<p>……</p>
<p>那选择就只有一个了！<del>（折断拐杖）</del></p>
<p>对它使用 Hook 吧！</p>
<p><img src="/2024/05/29/Request-Resigned-2/5.png" alt="image"></p>
<p>早在 <a href="https://szczecin.github.io/2024/01/19/MobSF/">MobSF移动安全测试框架|自动化静动态app分析框架</a> 的使用中，我就接触了 Frida，why？因为一开始装不上，并且因为种种原因（MobSF 自带证书冲突等）执行动态分析的效果很差，虽然后来还是能试出来。</p>
<p>扯远了，回到现在，利用 Frida 对应用进行 Hook，我是在 Genymotion 上做的，当然，由于应用配置的关系，你可能需要先：</p>
<ul>
<li>进行 ARM - X86 的转换才能跑起来应用，低版本 Android 不可运行要换成高版本转译：<a target="_blank" rel="noopener" href="https://github.com/niizam/Genymotion_A11_libhoudini">Genymotion_A11_libhoudini</a></li>
<li>高版本 Android 可以开启 SSL pinning 等，需要 Magisk + TrustMeAlready ：<a href="https://szczecin.github.io/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/">How to install Xposed&#x2F;EdXposed&#x2F;LSPosed + Magisk with Genymotion Desktop?</a></li>
<li>安装 Frida：<a href="https://szczecin.github.io/2024/05/27/Brida-Starting-From-Beginning/">brida从0配置</a></li>
</ul>
<p>这里就要说了，为什么涉及到 Brida？</p>
<p>因为一开始是想用 Brida 直接 Hook 调用函数，传到 BurpSuite 直接修改请求，但是后来发现你根本不知道是哪个函数计算 sign2 ，别说改了，Hook 都不知道 Hook 谁，怎么办？</p>
<p><img src="/2024/05/29/Request-Resigned-2/6.png" alt="image"></p>
</blockquote>
<h2><span id="javasecuritymessagedigest">java.security.MessageDigest</span></h2><blockquote>
<p>还记得旧 Sign 最后的加密算法吗？SHA1-Hash</p>
<p>再看看新 Sign，尤其是 sign2 的样式，分明也是 SHA1！</p>
<p>嘛，灵光一现：不如利用 js 跟踪“java.security.MessageDigest”的调用，并输出加密入参与之后的值，js 参考：</p>
<ul>
<li><a href="https://szczecin.github.io/2024/05/27/Android-Reverse-Frida-Hook/">安卓逆向 - Frida Hook（抓包实践）</a></li>
<li><a href="https://szczecin.github.io/2024/05/24/Frida-Hook-Signature/">Frida java层自吐加密算法</a></li>
</ul>
<p><img src="/2024/05/29/Request-Resigned-2/7.png" alt="image"></p>
<p>入参值反解出来是一堆字节码，需要用 java 重新转一下回去：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">exchange</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="type">byte</span>[] b = &#123; <span class="number">108</span>, ……, <span class="number">102</span>,</span><br><span class="line">               <span class="number">105</span>, ……, <span class="number">105</span>,</span><br><span class="line">               <span class="number">111</span>, ……, <span class="number">107</span>,</span><br><span class="line">               <span class="number">45</span>, ……, <span class="number">61</span>,</span><br><span class="line">               <span class="number">50</span>, ……, <span class="number">52</span>,</span><br><span class="line">               <span class="number">32</span>, ……, <span class="number">117</span>,</span><br><span class="line">               <span class="number">115</span>, ……, <span class="number">118</span>,</span><br><span class="line">               <span class="number">105</span>, ……, <span class="number">110</span>,</span><br><span class="line">               <span class="number">118</span>, ……, <span class="number">73</span>,</span><br><span class="line">               <span class="number">70</span>, ……, <span class="number">78</span>,</span><br><span class="line">               <span class="number">74</span>, ……, <span class="number">85</span>,</span><br><span class="line">               <span class="number">85</span>, ……, <span class="number">108</span>,</span><br><span class="line">               <span class="number">107</span>, ……, <span class="number">107</span>,</span><br><span class="line">               <span class="number">45</span>, ……, <span class="number">110</span>,</span><br><span class="line">               <span class="number">61</span>, ……, <span class="number">48</span>,</span><br><span class="line">               <span class="number">67</span>, ……, <span class="number">45</span>,</span><br><span class="line">               <span class="number">116</span>, ……, <span class="number">112</span>,</span><br><span class="line">               <span class="number">61</span>, ……, <span class="number">104</span>,</span><br><span class="line">               <span class="number">73</span>, ……, <span class="number">57</span> &#125;;</span><br><span class="line">       <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(b);</span><br><span class="line">       System.out.println(s);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Output:</span><br><span class="line">……data=&#123;<span class="string">&quot;userId&quot;</span>:<span class="string">&quot;……&quot;</span>&#125;……sign1=GORNJPBOGXJXZQRRKYKYZNGZXZSYOUUSCMCM……timestamp=<span class="number">1714030269543</span>……</span><br></pre></td></tr></table></figure>

<h2><span id="sign1amptimestamp">sign1&amp;timestamp</span></h2><blockquote>
<p>ok，入参也出来了，现在只剩一个问题：sign1 在入参中的位置。</p>
<p>其实到这里直接去遍历都可以，但是我还是采集了几份 sign1 在 sign2 生成位置与 timestamp 的关系进行比对，然后发现比对了个寂寞——差一位数的时间戳里 sign1 的插入位置可以相同的 &#x3D; &#x3D;：</p>
<p><img src="/2024/05/29/Request-Resigned-2/8.png" alt="image"></p>
<p>所以不整了，收工！</p>
<p><img src="/2024/05/29/Request-Resigned-2/9.png" alt="image"></p>
</blockquote>
<h2><span id="写在后面">写在后面</span></h2><blockquote>
<p>下篇也写完了，感觉好像也就这样，后续把加固啥的弄上议程吧，不然好像还有些硬编码问题也是头疼，但还要验证一下效果。</p>
<p>沉默，然后……事已至此，先吃（pao）饭（lu）吧</p>
<p><img src="/2024/05/29/Request-Resigned-2/10.gif" alt="image"></p>
</blockquote>
<h2><span id="参考引用">参考引用</span></h2><blockquote>
<p><a href="https://szczecin.github.io/2024/05/27/Request-Resigned-1/">灰产-如何破解请求验签（上）</a></p>
<p><a href="https://szczecin.github.io/2024/01/19/MobSF/">MobSF移动安全测试框架|自动化静动态app分析框架</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/niizam/Genymotion_A11_libhoudini">Genymotion_A11_libhoudini</a></p>
<p><a href="https://szczecin.github.io/2024/01/22/Genymotion-Install-Xposed:EdXposed:LSPosed:Magisk/">How to install Xposed&#x2F;EdXposed&#x2F;LSPosed + Magisk with Genymotion Desktop?</a></p>
<p><a href="https://szczecin.github.io/2024/05/27/Brida-Starting-From-Beginning/">brida从0配置</a></p>
<p><a href="https://szczecin.github.io/2024/05/27/Android-Reverse-Frida-Hook/">安卓逆向 - Frida Hook（抓包实践）</a></p>
<p><a href="https://szczecin.github.io/2024/05/24/Frida-Hook-Signature/">Frida java层自吐加密算法</a></p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Android/" rel="tag">Android</a><a class="tag-none-link" href="/tags/Chaos/" rel="tag">Chaos</a><a class="tag-none-link" href="/tags/Frida/" rel="tag">Frida</a><a class="tag-none-link" href="/tags/Hook/" rel="tag">Hook</a><a class="tag-none-link" href="/tags/Signature/" rel="tag">Signature</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/05/27/Request-Resigned-1/">
                灰产-如何破解请求验签（上）
            </a>
        </h2>
    
    <time>
        May 27, 2024
    </time>
    <section class="content">
        <h1><span id="灰产-如何破解请求验签上">灰产-如何破解请求验签（上）</span></h1><p><img src="/2024/05/27/Request-Resigned-1/1.png" alt="image"></p>
<h2><span id="前情提要">前情提要</span></h2><blockquote>
<p>先来个前情提要：<a href="https://szczecin.github.io/2024/02/01/Apk-Resigned/">灰产-如何对APK修改后重签</a></p>
<p>在写那篇文章的我，是否会想到我竟然还有有关“灰产”的下文来写？而且就标题来说，还有分上下两篇！所以这4个月不到的时间我又经历了什么呢？</p>
<p><img src="/2024/05/27/Request-Resigned-1/2.png" alt="image"></p>
</blockquote>
<h2><span id="写在前面">写在前面</span></h2><blockquote>
<p><strong>以下都是情节模拟，并非具体情况，请细加甄别</strong></p>
<p>让我们把时间拨回到年后。</p>
<p>年后回来一阵子，接到业务风控同学的反馈，我们有用户发现自己的账户被盗了，自己购买了不是自己的商品（不产生金额）并对这个商品统一匿名评价……</p>
<p>我第一反应卧槽哥们我们应用不是做了端校验，不同设备必须验证码登录，怎么连手机一起丢了才有后面能说漏洞导致账密泄漏的事？</p>
<p><img src="/2024/05/27/Request-Resigned-1/3.png" alt="image"></p>
<p>后面通过网关日志、应用日志、接口日志等排查，发现这个用户的登录凭证（token）有从境外服务器请求服务的情况，可以基本确认是 token 的泄漏；</p>
<p>再和用户沟通以及进一步的深入排查，我们发现 token 的泄漏源于用户被钓鱼，这里细节不表；被社工得到的 token 会先从 ip 1 被收集并转发给 ip 2 进行购买请求与评论……</p>
<p>这里涉及到一个问题，我们的请求在各端做了验签，Sign 参数会根据不同端走不同的计算方式，想要更改 token 并发起购买请求，不重新计算 Sign是不可能通过校验的，只有两种可能：</p>
<ul>
<li>我们的 Sign 计算方式被破解</li>
<li>我们的 Sign 计算方式可被任意调用</li>
</ul>
</blockquote>
<h2><span id="总而言之">总而言之</span></h2><blockquote>
<p>总而言之，这个任务又落到我这里了&#x3D; &#x3D;</p>
<p>会议讨论对齐的时候，研发一致认为是在 H5 端的 Sign 计算方式太简单了，如何计算已经被破解，应该换上现在端上更安全的 Sign 计算就可以了！</p>
<p>直接破解一个计算方法理论上是不太容易的，我更在意的是是否是哪个地方泄漏了 Sign 的计算方法，或者在什么地方的计算代码可以被调用，直接入参入值然后得到结果。</p>
<p>但这里就要提到另一个事情了，研发不告诉你！</p>
<p>他们只表述这个好像比较简单就能破，但问他们怎么破的，不知道；问他们在哪里可能泄漏了，不知道：</p>
<p>“大概是从前端 JS 泄漏的？你看我们这里都做了混淆了，你看是不是就是这个位置，sign 关键词都命中了……”“可是为啥我调试&#x2F;下断点没反应啊？”</p>
<p><img src="/2024/05/27/Request-Resigned-1/4.png" alt="image"></p>
<p>后来嘛，在把钓鱼的口子堵了一下后，换上“更安全”的 Sign 计算方式后，喜闻乐见的钓鱼的口子也被绕过了，“更安全”的 Sign 计算也被破解了……</p>
<p>然后呢？</p>
<p>遭殃的还是我好吧，本来他们都认为可行的解决办法没用的时候，我就不得不花时间和精力来看看不在我 OKR 上的问题了</p>
<p><img src="/2024/05/27/Request-Resigned-1/5.png" alt="image"></p>
</blockquote>
<h2><span id="泄漏发现">泄漏发现</span></h2><blockquote>
<p>算研发很配合安全工作，虽然告诉了我一个错误的泄漏位置，但起码提醒了我可能是 JS 就已经泄露了，没必要一来就去逆向找源码。</p>
<p>开始的思路还是去利用前端给到的 JS 复用：<a href="https://szczecin.github.io/2024/05/21/JSFlash-BurpSuite/">Burp Suite作为代理，复用目标站点的js代码处理指定的内容</a></p>
<p>后来发现 JSFlash 必须要能够指定调用代码函数才行，前端 JS 混淆了，指向不出来，直接分析不了</p>
<p>然后我就在前端登录页 Source - js 找到了 Sign 计算点，并且下断点步进调试看到了所有 Sign 的计算入参：</p>
<p><img src="/2024/05/27/Request-Resigned-1/6.png" alt="image"></p>
<p><img src="/2024/05/27/Request-Resigned-1/7.png" alt="image"></p>
</blockquote>
<h2><span id="它端验证">它端验证</span></h2><blockquote>
<p>在前端 JS 调试的过程中能看到有一个 secret 参数是不会暴露在 request 里的，其他端的如何获得？</p>
<p>Jadx 逆向反编译一下应用端，以 SIGN 为关键词，在源代码中发现了硬编码在其他端使用的 secret，以及使用的 Sign 最后加签算法：</p>
<p><img src="/2024/05/27/Request-Resigned-1/8.png" alt="image"></p>
<p><img src="/2024/05/27/Request-Resigned-1/9.png" alt="image"></p>
</blockquote>
<h2><span id="写在后面">写在后面</span></h2><blockquote>
<p>上篇就到这里，写的好像很简单，解过程也没遇到什么麻烦，但是还得说和大伙配合的还是不好，我还是认为不管是锻炼或者检验个人能力也好，工作任务忙不想接手深入这个事情也好，如果是以把事情完成的结论来说，相互配合是很重要的。</p>
<p>以旧 Sign 为例，大家说的好像每个人都知道这个是怎么生成的，但就是没人和你说，告诉的还是错误的位置，即使真的可能知道是怎么生成的不知道是在哪里泄露的，那信息汇通还是更重要的。研发完全可以告诉你“我猜是在前端 JS 泄漏的，位置是在这里，他的调用是这样的……”给你演示出来，如果真的在前端直接 Debug 下断点走一遍，就会知道一开始的位置告诉错了，并且一下就把泄漏点找出来了。</p>
<p>不会浪费双方的时间的。</p>
<p><img src="/2024/05/27/Request-Resigned-1/10.png" alt="image"></p>
</blockquote>
<h2><span id="参考引用">参考引用</span></h2><blockquote>
<p><a href="https://szczecin.github.io/2024/02/01/Apk-Resigned/">灰产-如何对APK修改后重签</a></p>
<p><a href="https://szczecin.github.io/2024/05/21/JSFlash-BurpSuite/">Burp Suite作为代理，复用目标站点的js代码处理指定的内容</a></p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Android/" rel="tag">Android</a><a class="tag-none-link" href="/tags/Chaos/" rel="tag">Chaos</a><a class="tag-none-link" href="/tags/Frida/" rel="tag">Frida</a><a class="tag-none-link" href="/tags/Hook/" rel="tag">Hook</a><a class="tag-none-link" href="/tags/Signature/" rel="tag">Signature</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/05/27/Android-Reverse-Frida-Hook/">
                安卓逆向 - Frida Hook（抓包实践）
            </a>
        </h2>
    
    <time>
        May 27, 2024
    </time>
    <section class="content">
        <h1><span id="安卓逆向-基础入门教程">安卓逆向 - 基础入门教程</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42840266/article/details/132279975">小馒头yy</a> 并作补充</p>
</blockquote>
<h2><span id="一-引言">一、引言</span></h2><blockquote>
<p>上篇文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42840266/article/details/132080000">安卓逆向 - 基础入门教程_小馒头yy的博客-CSDN博客</a> 介绍了Frida的安装、基本使用，今天我们来看看Frida常用Hook和基于Frida抓包实践。</p>
</blockquote>
<h2><span id="二-frida常用-hook脚本">二、Frida常用 Hook脚本</span></h2><blockquote>
<p>1、hook java.net.URL</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook1</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable constant_">URL</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.net.URL&#x27;</span>);</span><br><span class="line">    <span class="variable constant_">URL</span>.<span class="property">$init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.lang.String&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">a</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;加密前：&#x27;</span> + a)</span><br><span class="line">        <span class="title function_">showStacks</span>()</span><br><span class="line">        <span class="variable language_">this</span>.$init(a)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、hook okhttp3 HttpUrl</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hookOkhttp3</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Builder</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;okhttp3.Request$Builder&#x27;</span>);</span><br><span class="line">    <span class="title class_">Builder</span>.<span class="property">url</span>.<span class="title function_">overload</span>(<span class="string">&#x27;okhttp3.HttpUrl&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">a</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;a: &#x27;</span> + a)</span><br><span class="line">        <span class="keyword">var</span> res = <span class="variable language_">this</span>.<span class="title function_">url</span>(a);</span><br><span class="line">        <span class="title function_">showStacks</span>()</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;res: &quot;</span> + res)</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、hook okhttp3 addHeader</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Builder</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;okhttp3.Request$Builder&quot;</span>);</span><br><span class="line">    <span class="title class_">Builder</span>[<span class="string">&quot;addHeader&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">str, str2</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;key: &quot;</span> + str)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;val: &quot;</span> + str2)</span><br><span class="line">        <span class="title function_">showStacks</span>()</span><br><span class="line">        <span class="keyword">var</span> result = <span class="variable language_">this</span>[<span class="string">&quot;addHeader&quot;</span>](str, str2);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;result: &quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、打印堆栈</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">showStacks</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.util.Log&quot;</span>).<span class="title function_">getStackTraceString</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.Exception&quot;</span>).$new()));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5、hook Base64</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hookBase</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// Base64</span></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Base64Class</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.util.Base64&quot;</span>);</span><br><span class="line">    <span class="title class_">Base64Class</span>.<span class="property">encodeToString</span>.<span class="title function_">overload</span>(<span class="string">&quot;[B&quot;</span>, <span class="string">&quot;int&quot;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">a, b</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> rc = <span class="variable language_">this</span>.<span class="title function_">encodeToString</span>(a, b);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;&gt;&gt;&gt; Base64 &quot;</span> + rc);</span><br><span class="line">        <span class="keyword">return</span> rc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>6、hook HashMap</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hookMap</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Build</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.util.HashMap&quot;</span>);</span><br><span class="line">    <span class="title class_">Build</span>[<span class="string">&quot;put&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">key, val</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;key : &quot;</span> + key)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;val : &quot;</span> + val)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">put</span>(key, val)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h2><span id="三-某麦网抓包实践">三、某麦网抓包实践</span></h2><blockquote>
<p>本篇以某麦网帖子详情接口，演示如何基于Frida hook抓包</p>
<p>1、安装某麦网8.<em>.</em>.apk</p>
<p>2、搭建Frida hook 环境，注入 hook java.net.URL脚本</p>
<p>3、点进帖子详情打印出如下堆栈，我们可以根据打印出的信息，跟栈分析该接口的请求头。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//acs.m.taobao.com/gw/mtop.damai.wireless.discovery.detail.get/1.4/?source=10101&amp;version=6000168&amp;type=originaljson&amp;data=%7B%22contentId%22%3A%2211088650%22%2C%22appType%22%3A%221%22%2C%22source%22%3A%2210101%22%2C%22osType%22%3A%222%22%2C%22pageSize%22%3A%2230%22%2C%22pageIndex%22%3A%221%22%2C%22version%22%3A%226000168%22%2C%22channel_from%22%3A%22damai_market%22%7D&amp;appType=1&amp;osType=2&amp;channel_from=damai_market</span></span><br><span class="line">java.lang.Exception</span><br><span class="line">        at java.net.URL.&lt;init&gt;(Native Method)</span><br><span class="line">        at tb.yy0.m(Taobao:<span class="number">1</span>)</span><br><span class="line">        at anet.channel.request.a.p(Taobao:<span class="number">2</span>)</span><br><span class="line">        at anet.channel.session.TnetSpdySession.w(Taobao:<span class="number">18</span>)</span><br><span class="line">        at anetwork.channel.unified.NetworkTask.sendRequest(Taobao:<span class="number">6</span>)</span><br><span class="line">        at anetwork.channel.unified.NetworkTask.run(Taobao:<span class="number">44</span>)</span><br><span class="line">        at anetwork.channel.unified.UnifiedRequestTask$a.proceed(Taobao:<span class="number">15</span>)</span><br><span class="line">        at com.taobao.orange.sync.NetworkInterceptor.intercept(Taobao:<span class="number">30</span>)</span><br><span class="line">        at anetwork.channel.unified.UnifiedRequestTask$a.proceed(Taobao:<span class="number">7</span>)</span><br><span class="line">        at anetwork.channel.unified.UnifiedRequestTask$<span class="number">3.</span>run(Taobao:<span class="number">2</span>)</span><br><span class="line">        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:<span class="number">428</span>)</span><br><span class="line">        at java.util.concurrent.FutureTask.run(FutureTask.java:<span class="number">237</span>)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:<span class="number">1133</span>)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:<span class="number">607</span>)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:<span class="number">761</span>)</span><br></pre></td></tr></table></figure>

<p>4、使用Jadx打开某麦网apk</p>
<p>从at tb.yy0.m(Taobao:1)跟栈分析</p>
<p><img src="/2024/05/27/Android-Reverse-Frida-Hook/1.png" alt="image"></p>
<p> 根据调用栈往上走，定位到如下位置，注意这行代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALog.f(<span class="string">&quot;awcn.TnetSpdySession&quot;</span>, <span class="string">&quot;&quot;</span>, aVar.n(), <span class="string">&quot;request headers&quot;</span>, aVar.g());</span><br></pre></td></tr></table></figure>

<p><img src="/2024/05/27/Android-Reverse-Frida-Hook/2.png" alt="image"></p>
<p>代码注释很清楚了 request headers，我们跟进 hook aVar.g() 这个方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">g</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Collections.unmodifiableMap(<span class="built_in">this</span>.f);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>hook之，对象输出可以使用 JSONObject转一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">var</span> <span class="variable">JSONObject</span> <span class="operator">=</span> Java.use(<span class="string">&quot;com.alibaba.fastjson.JSONObject&quot;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook6</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">JSON</span><span class="built_in">Object</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.alibaba.fastjson.JSONObject&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> a = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;anet.channel.request.a&quot;</span>);</span><br><span class="line">    a[<span class="string">&quot;g&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> result = <span class="variable language_">this</span>[<span class="string">&quot;g&quot;</span>]();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;result : &quot;</span> + <span class="title class_">JSON</span><span class="built_in">Object</span>.<span class="title function_">toJSON</span>(result).<span class="title function_">toString</span>());</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打印出如下内容：</p>
<p><img src="/2024/05/27/Android-Reverse-Frida-Hook/3.png" alt="image"></p>
<p>请求 URL、 请求方法这边都写得很清楚啦。</p>
<p><img src="/2024/05/27/Android-Reverse-Frida-Hook/4.png" alt="image"></p>
<p>收工！</p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Android/" rel="tag">Android</a><a class="tag-none-link" href="/tags/Frida/" rel="tag">Frida</a><a class="tag-none-link" href="/tags/Hook/" rel="tag">Hook</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/05/27/Android-Reverse-Base/">
                安卓逆向 - 基础入门教程
            </a>
        </h2>
    
    <time>
        May 27, 2024
    </time>
    <section class="content">
        <h1><span id="安卓逆向-基础入门教程">安卓逆向 - 基础入门教程</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42840266/article/details/132080000">小馒头yy</a> 并作补充</p>
</blockquote>
<h2><span id="一-引言">一、引言</span></h2><blockquote>
<p>1、我们在采集app数据时，有些字段是加密的，如某麦网x-mini-wua x-sgext x-sign x-umt x-utdid等参数，这时候我们需要去分析加密字段的生成。本篇将以采集的角度讲解入门安卓逆向需要掌握的技能、工具。</p>
<p>2、安卓（Android）是一种基于Linux内核操作系统，架构图（了解即可）</p>
<p><img src="/2024/05/27/Android-Reverse-Base/1.png" alt="image"></p>
<p>3、安卓应用程序使用JAVA语言编写（重要），作为一名安卓逆向人员我们必须掌握Java语言基础（基本语法、类、接口、面向对象、网络类库、加密解密等等）</p>
<p>4、安卓逆向是对已经打包好的APP进行反编译，分析源码了解应用逻辑的一门技术，这一部分我们需要学习静态分析，动态分析。各种反编译工具（推荐 jadx），Frida Hook。</p>
</blockquote>
<h2><span id="二-静态分析学习jadx反编译">二、静态分析，学习jadx反编译</span></h2><blockquote>
<p>1、安装jadx，github地址： <a target="_blank" rel="noopener" href="https://github.com/skylot/jadx/releases?page=1">Releases · skylot&#x2F;jadx · GitHub</a>，下载 <a target="_blank" rel="noopener" href="https://github.com/skylot/jadx/releases/download/v1.4.7/jadx-1.4.7.zip">jadx-1.4.7.zip</a> 解压即可。</p>
<p><img src="/2024/05/27/Android-Reverse-Base/2.png" alt="image"></p>
<p>2、调整jadx最大内存，打开bin目录下的 jadx-gui.bat文件，搜索DEFAULT_JVM_OPTS。</p>
<p>将 -XX:MaxRAMPercentage&#x3D;70.0 修改成 -Xmx16g </p>
<p><img src="/2024/05/27/Android-Reverse-Base/3.png" alt="image"></p>
<p>3、jadx使用，打开apk，jadx会自动反编译apk</p>
<p><img src="/2024/05/27/Android-Reverse-Base/4.png" alt="image"></p>
<p>全局搜索：点击左上角的导航 - 文本搜索，输入关键字，并且下方可以筛选检索的位置</p>
<p><img src="/2024/05/27/Android-Reverse-Base/5.png" alt="image"></p>
<p>根据关键字定位到关键代码后，我们就可以进行分析加密参数的生成啦。</p>
</blockquote>
<h2><span id="三-动态分析frida-初使用">三、动态分析，Frida 初使用</span></h2><blockquote>
<p>1、安装 adb （Android Debug Bridge），通过命令行使用adb，对安卓设备进行操作</p>
<p>2、下载模拟器，我使用的逍遥模拟器 （有Root好的真机更棒）</p>
<p>模拟器启动后，在命令行依次执行命令：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">adb forward tcp:<span class="number">27043</span> tcp:<span class="number">27043</span></span><br><span class="line">adb forward tcp:<span class="number">27042</span> tcp:<span class="number">27042</span></span><br><span class="line">adb connect <span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">21503</span></span><br><span class="line">adb devices</span><br></pre></td></tr></table></figure>

<p>再执行 adb shell，即可进入模拟器， #字符代表已 Root </p>
<p><img src="/2024/05/27/Android-Reverse-Base/6.png" alt="image"></p>
<p>3、安装Frida</p>
<p>本地直接使用 pip install frida 命令安装 （需有Python环境）</p>
<p>模拟器（手机）端下载对应的Frida-server: Releases · frida&#x2F;frida · GitHub</p>
<p>低版本安卓推荐下载：12.8.13，高版本安卓直接下载最新版</p>
<p>模拟器是 x86架构，真机是 arm架构，请下载对应的 frida-server</p>
<p>4、开启Hook，动态分析应用运行时数据</p>
<ul>
<li>将frida-server传到手机 &#x2F;data&#x2F;local&#x2F;tmp 目录，转到本地frida-server存放的目录，依次执行以下命令</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">adb push frida-server-12.8.13-android-x86 /data/local/tmp</span><br><span class="line">adb shell</span><br><span class="line"><span class="built_in">cd</span> /data/local/tmp</span><br><span class="line"><span class="built_in">chmod</span> 777 frida-server-12.8.13-android-x86</span><br><span class="line">./frida-server-12.8.13-android-x86</span><br></pre></td></tr></table></figure>

<ul>
<li>编写 hook脚本，使用js方式启动，本例为 hook URL的构造方法：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook1</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable constant_">URL</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.net.URL&#x27;</span>);</span><br><span class="line">    <span class="variable constant_">URL</span>.<span class="property">$init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.lang.String&#x27;</span>).<span class="property">implementation</span>= <span class="keyword">function</span>(<span class="params">a</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;加密前：&#x27;</span>+a)               </span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;                    &#x27;</span>)</span><br><span class="line">            <span class="variable language_">this</span>.$init(a)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title function_">hook</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="title function_">setImmediate</span>(main);</span><br></pre></td></tr></table></figure>

<ul>
<li>开始 hook，注意高版本 frida不需要带 –no-pause</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida -U -l dm_hook.js -f cn.damai --no-pause</span><br></pre></td></tr></table></figure>

<p>其中 dm_hook.js是 hook脚本的文件名，cn.damai是apk的包名。</p>
<p>滑动应用，正常打印出 url信息。</p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Android/" rel="tag">Android</a><a class="tag-none-link" href="/tags/Frida/" rel="tag">Frida</a><a class="tag-none-link" href="/tags/Jadx/" rel="tag">Jadx</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/05/27/Brida-How-To-Using/">
                Burpsuite插件-Brida
            </a>
        </h2>
    
    <time>
        May 27, 2024
    </time>
    <section class="content">
        <h1><span id="burpsuite插件-brida">Burpsuite插件-Brida</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://blog.csdn.net/samlirongsheng/article/details/134966158">sam.li</a> 并作补充</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/samlirongsheng/article/details/134950536">通过一道CTF题目来认识一下Frida</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/samlirongsheng/article/details/134952350">objection</a><br>前面两篇通过对<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Frida&spm=1001.2101.3001.7020">Frida</a>的了解，以及利用objection来分析，这篇来了解一下分析后实际利用，以及通过实现插件自动化的方式来利用。</p>
</blockquote>
<h2><span id="brida介绍">Brida介绍</span></h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/federicodotta/Brida">https://github.com/federicodotta/Brida</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/federicodotta/Brida/wiki/Brida-components">Brida components</a></p>
<p><img src="/2024/05/27/Brida-How-To-Using/1.png" alt="image"></p>
<h3><span id="官方使用文档翻译">官方使用文档翻译</span></h3><p>时间记录，20230725；</p>
<p>测试版本：0.5</p>
<p>虽然说官方文档是最新的，但是使用文档的截图依旧跟新版本的插件不一致，然后能够查到的资料也是比较久的内容，不过大体功能是差不多，但是还是自己操作一遍后记录一下相关问题；</p>
<p>这里只记录自己测试的环境，其他环境参考官方文档；</p>
<h4><span id="android">Android</span></h4><ol>
<li>安装frida和其server，并启动具体可以参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/samlirongsheng/article/details/134950536">通过一道CTF题目来认识一下Frida</a></li>
<li>配置brida</li>
</ol>
<p>在配置之前先简单了解一下brida的UI及其功能；</p>
<p><img src="/2024/05/27/Brida-How-To-Using/2.png" alt="image"></p>
<h4><span id="1-主面板">1 主面板</span></h4><p>这里包含所有brida工具和配置</p>
<ol>
<li>Configurations</li>
<li>JS Editor</li>
<li>Hooks and functions</li>
<li>Graphical analysis</li>
<li>Graphical hooks</li>
<li>Custom plugins</li>
<li>Generate stubs</li>
<li>Debug export</li>
</ol>
<h4><span id="2-brida按钮面板">2 brida按钮面板</span></h4><p>Brida按钮面板由三个不同的部分组成：</p>
<ul>
<li>顶部（前两行）是 Pyro4 服务器的状态（启动&#x2F;停止）和应用程序的状态（hook状态）</li>
<li>（在两条黄线上方的按钮）在中间有一组固定在Brida所有选项卡上的按钮。这些按钮用于执行常规任务，如启动&#x2F;停止 Pyro4 服务器、生成&#x2F;附加&#x2F;停止&#x2F;分离应用程序（使用 frida-compile 编译）、重新加载 JS 文件、编译重新加载JS、分离所有hook、清除log等。</li>
<li>（黄线下）底部有一组按钮，取决于特定的Brida子选项卡</li>
</ul>
<h4><span id="3-brida控制台">3 brida控制台</span></h4><p>log输出</p>
</blockquote>
<h2><span id="brida工具介绍">brida工具介绍</span></h2><blockquote>
<h3><span id="configurations">Configurations</span></h3><p>配置界面</p>
<p>从上往下依次是</p>
<ol>
<li>Pyro服务状态</li>
<li>应用状态</li>
<li>是否使用虚拟的python环境</li>
<li>python可以执行文件的路径</li>
<li>Pyro服务地址（默认）</li>
<li>Pyro端口（默认）</li>
<li>frida-complile可以执行文件的路径</li>
<li>是否使用旧版本的frida-complile，尽量使用10以下的版本，一开始用默认版本会出现问题，hook上了，但是总有奇怪的报错</li>
<li>包含所有Brida JS文件的文件夹，第一次需要先生成一下默认的JS文件</li>
<li>需要hook的应用名&#x2F;PID，如果为应用名，则在连接的时候是点按钮面板的Spawn application，如果为PID，则Attach；</li>
<li>Frida连接方式</li>
<li>如果配置是远程连接frida，需要配置对应的地址和端口；</li>
</ol>
<p><img src="/2024/05/27/Brida-How-To-Using/3.png" alt="image"></p>
<h3><span id="js-editor">JS Editor</span></h3><p><img src="/2024/05/27/Brida-How-To-Using/4.png" alt="image"></p>
<p>集成到Burp Suite中的JS编辑器，以便能够编辑Brida JS文件并直接从Burp Suite添加自定义hook和导出函数。编辑器具有JS语法突出显示。</p>
<h3><span id="hooks-and-functions">Hooks and functions</span></h3><p><img src="/2024/05/27/Brida-How-To-Using/5.png" alt="image"></p>
<p>此选项卡包括许多默认hooks和方法，可以通过按钮启用&#x2F;执行。这些Frida脚本包括最新的Android和iOS平台的hook能力，以绕过和检查安全功能。</p>
<h3><span id="graphical-analysis">Graphical analysis</span></h3><p><img src="/2024/05/27/Brida-How-To-Using/6.png" alt="image"></p>
<p><a target="_blank" rel="noopener" href="https://github.com/federicodotta/Brida/wiki/Graphical-analysis">Graphical analysis</a></p>
<p>这里功能类似于objection的能力集成进来：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">load tree = android hooking list classes //展示所有class </span><br><span class="line"></span><br><span class="line">搜索 = android hooking search methods [search_name] //在内存中所有已加载的方法中搜索包含特定关键词的方法</span><br><span class="line">//但是这里Android的用起来会导致应用闪退，官方提了这个，只有iOS支持；</span><br><span class="line"></span><br><span class="line">双击对应的class = android hooking watch class com.xxx.xxx //hook指定类, 会打印该类下的所以调用</span><br><span class="line">右键Inspect = android hooking watch class_method com.xxx.xxx.methodName --dump-args --dump-backtrace --dump-return //hook指定类, 会打印该类下的所以调用</span><br><span class="line">右键change return vule = android hooking set return_value com.xxx.xxx.methodName false //设置返回值</span><br></pre></td></tr></table></figure>

<h4><span id="实际使用">实际使用</span></h4><p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/samlirongsheng/article/details/134950536">通过一道CTF题目来认识一下Frida</a></p>
<p>对函数进行打印，然后替换返回值，但是这里官方提供的返回值没有byte</p>
<p><img src="/2024/05/27/Brida-How-To-Using/7.png" alt="image"></p>
<h3><span id="graphical-hooks">Graphical hooks</span></h3><p><img src="/2024/05/27/Brida-How-To-Using/8.png" alt="image"></p>
<p>管理之前hook的所有内容；</p>
<h3><span id="custom-plugins">Custom plugins</span></h3><p><img src="/2024/05/27/Brida-How-To-Using/9.png" alt="image"></p>
<p>强大的功能；</p>
<p>可以理解成自定义生成burpsuite插件，有四种可自定义插件类型；</p>
<ul>
<li>IHttpListener：能让所有请求，通过正则匹配去替换&#x2F;修改指定的内容，并让这个匹配到的内容通过frida构造的hook脚本处理（加解密、重新生成sign等）</li>
<li>IMessageEditorTab：将自定义选项卡添加到Burp Suite请求&#x2F;响应窗格，以便能够使用Frida导出的函数解密&#x2F;解码&#x2F;处理请求&#x2F;响应（或其中的一部分）（然后加密&#x2F;编码&#x2F;处理修改并替换原始请求&#x2F;响应，如果有）</li>
<li>IContextMenu：将自定义上下文菜单选项添加到Burp Suite的右键菜单中，用于在请求和响应（或其中的一部分）上调用Frida导出的函数</li>
<li>JButton：添加调用&#x2F;启用 Frida 导出函数的按钮</li>
</ul>
<h3><span id="generate-stubs">Generate stubs</span></h3><p><img src="/2024/05/27/Brida-How-To-Using/10.png" alt="image"></p>
<p>如果内部自定义插件引擎无法解决复杂情况，则可以从外部Burp Suite插件使用Brida引擎。此选项卡生成 Java 和 Python 存根，可以复制并粘贴到外部插件中，以便允许 Burp Suite 和 Frida 使用 Brida 进行通信。</p>
<h3><span id="debug-export">Debug export</span></h3><p><img src="/2024/05/27/Brida-How-To-Using/11.png" alt="image"></p>
<p>此选项卡可用于在 Brida 插件中使用 Frida 导出的函数之前对其进行调试。为了使用 Brida 自定义插件（或使用 Brida 的外部插件），有必要将 Frida 代码放入一些由插件调用的 Frida 导出函数中。在此选项卡中，可以直接调用 Frida 导出，以便轻松调试。</p>
</blockquote>
<h2><span id="使用问题记录">使用问题记录</span></h2><blockquote>
<p>Windows环境</p>
<p><strong>Spawn&#x2F;Attach application时报错：entrypoint must be inside the project root</strong><br><a target="_blank" rel="noopener" href="https://cn-sec.com/archives/1639064.html">【移动安全】Frida + Burp -&gt; Brida | APP加解密 | CN-SEC 中文网</a></p>
<p>把Frida的js文件放到burpsuite应用的目录下；</p>
<p><strong>在Debug export中Run export是报错[frida.core.RPCException] unable to find method ‘test’</strong><br>排查了很久，只找到了frida-compile版本过高这种情况，只能测试一下低版本是否会有问题，用npm在burpsuite应用的目录下执行npm install <a href="mailto:&#102;&#114;&#105;&#x64;&#97;&#45;&#x63;&#111;&#x6d;&#112;&#105;&#108;&#x65;&#64;&#57;&#x2e;&#x35;&#46;&#x32;">&#102;&#114;&#105;&#x64;&#97;&#45;&#x63;&#111;&#x6d;&#112;&#105;&#108;&#x65;&#64;&#57;&#x2e;&#x35;&#46;&#x32;</a>，然后将安装的目录配置到frida-compile path中就能解决；</p>
<p><strong>使用了低版本的frida-compile后报错java.io.IOException: Cannot run program</strong></p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;C:\AAAA\agent\BurpSuiteCommunity\node_modules\.bin\frida-compile&quot;: </span><br><span class="line">CreateProcess error=<span class="number">193</span>, %<span class="number">1</span> 不是有效的 Win32 应用程序。</span><br></pre></td></tr></table></figure>

<p>一开始配置没有带.cmd</p>
<p><img src="/2024/05/27/Brida-How-To-Using/12.png" alt="image"></p>
<p><img src="/2024/05/27/Brida-How-To-Using/13.png" alt="image"></p>
<p><img src="/2024/05/27/Brida-How-To-Using/14.png" alt="image"></p>
<p><strong>UnicodeEncodeError: ‘gbk’ codec can’t encode</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">character <span class="string">&#x27;\u03f1&#x27;</span> <span class="keyword">in</span> position 49: illegal multibyte sequence**</span><br></pre></td></tr></table></figure>

<p>刚好遇到一个反编译后用中文混淆的，这里用objection和python执行相关处理的时候就会报编码错误，在对应路径相关代码输出处加上utf-8编码输出就能解决；然后objection需要修改后重新编译；</p>
<p><img src="/2024/05/27/Brida-How-To-Using/15.png" alt="image"></p>
</blockquote>
<h2><span id="源码解析">源码解析</span></h2><blockquote>
<p>java调用python脚本</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"><span class="keyword">import</span> Pyro4</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment">#reload(sys)   </span></span><br><span class="line"><span class="comment">#sys.setdefaultencoding(&#x27;utf-8&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Unbuffered</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">   <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, stream</span>):</span><br><span class="line">       self.stream = stream</span><br><span class="line">   <span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">self, data</span>):</span><br><span class="line">       self.stream.write(data)</span><br><span class="line">       self.stream.flush()</span><br><span class="line">   <span class="keyword">def</span> <span class="title function_">writelines</span>(<span class="params">self, datas</span>):</span><br><span class="line">       self.stream.writelines(datas)</span><br><span class="line">       self.stream.flush()</span><br><span class="line">   <span class="keyword">def</span> <span class="title function_">__getattr__</span>(<span class="params">self, attr</span>):</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">getattr</span>(self.stream, attr)</span><br><span class="line"></span><br><span class="line"><span class="meta">@Pyro4.expose</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BridaServicePyro</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, daemon</span>):</span><br><span class="line">        self.daemon = daemon</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">attach_application</span>(<span class="params">self,pid,frida_script,device,host_port_device_id</span>):</span><br><span class="line"></span><br><span class="line">        self.frida_script = frida_script</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> pid.isnumeric():</span><br><span class="line">            self.pid = <span class="built_in">int</span>(pid)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.pid = pid</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> device == <span class="string">&#x27;remote&#x27;</span>:</span><br><span class="line">            self.device = frida.get_remote_device()</span><br><span class="line">        <span class="keyword">elif</span> device == <span class="string">&#x27;usb&#x27;</span>:</span><br><span class="line">            self.device = frida.get_usb_device()</span><br><span class="line">        <span class="keyword">elif</span> device == <span class="string">&#x27;local&#x27;</span>:</span><br><span class="line">            self.device = frida.get_local_device()</span><br><span class="line">        <span class="keyword">elif</span> device == <span class="string">&#x27;device&#x27;</span>:</span><br><span class="line">            self.device = frida.get_device(host_port_device_id)        </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.device = frida.get_device_manager().add_remote_device(host_port_device_id)</span><br><span class="line"></span><br><span class="line">        self.session = self.device.attach(self.pid)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> codecs.<span class="built_in">open</span>(self.frida_script, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            source = f.read()</span><br><span class="line"></span><br><span class="line">        self.script = self.session.create_script(source)</span><br><span class="line">        self.script.load()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span>    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">spawn_application</span>(<span class="params">self,application_id,frida_script,device,host_port_device_id</span>):</span><br><span class="line"></span><br><span class="line">        self.application_id = application_id</span><br><span class="line">        self.frida_script = frida_script</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> device == <span class="string">&#x27;remote&#x27;</span>:</span><br><span class="line">            self.device = frida.get_remote_device()</span><br><span class="line">        <span class="keyword">elif</span> device == <span class="string">&#x27;usb&#x27;</span>:</span><br><span class="line">            self.device = frida.get_usb_device()</span><br><span class="line">        <span class="keyword">elif</span> device == <span class="string">&#x27;local&#x27;</span>:</span><br><span class="line">            self.device = frida.get_local_device()</span><br><span class="line">        <span class="keyword">elif</span> device == <span class="string">&#x27;device&#x27;</span>:</span><br><span class="line">            self.device = frida.get_device(host_port_device_id)        </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.device = frida.get_device_manager().add_remote_device(host_port_device_id)</span><br><span class="line"></span><br><span class="line">        self.pid = self.device.spawn([self.application_id])</span><br><span class="line"></span><br><span class="line">        self.session = self.device.attach(self.pid)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> codecs.<span class="built_in">open</span>(self.frida_script, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            source = f.read()</span><br><span class="line"></span><br><span class="line">        self.script = self.session.create_script(source)</span><br><span class="line">        self.script.load()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">resume_application</span>(<span class="params">self</span>):</span><br><span class="line"></span><br><span class="line">        self.device.resume(self.pid)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reload_script</span>(<span class="params">self</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> codecs.<span class="built_in">open</span>(self.frida_script, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            source = f.read()</span><br><span class="line"></span><br><span class="line">        self.script = self.session.create_script(source)</span><br><span class="line">        self.script.load()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">disconnect_application</span>(<span class="params">self</span>):</span><br><span class="line"></span><br><span class="line">        self.device.kill(self.pid)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">detach_application</span>(<span class="params">self</span>):</span><br><span class="line"></span><br><span class="line">        self.session.detach()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">callexportfunction</span>(<span class="params">self, methodName, args</span>):</span><br><span class="line">        method_to_call = <span class="built_in">getattr</span>(self.script.exports, methodName)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Take the Java list passed as argument and create a new variable list of argument</span></span><br><span class="line">        <span class="comment"># (necessary for bridge Python - Java, I think)</span></span><br><span class="line">        s = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> args:</span><br><span class="line">            s.append(i)</span><br><span class="line"></span><br><span class="line">        return_value = method_to_call(*s)</span><br><span class="line">        <span class="keyword">return</span> return_value</span><br><span class="line"></span><br><span class="line"><span class="meta">    @Pyro4.oneway</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">shutdown</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;shutting down...&#x27;</span>)</span><br><span class="line">        self.daemon.shutdown()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable python buffering (cause issues when communicating with Java...)</span></span><br><span class="line">sys.stdout = Unbuffered(sys.stdout)</span><br><span class="line">sys.stderr = Unbuffered(sys.stderr)</span><br><span class="line"></span><br><span class="line">host = sys.argv[<span class="number">1</span>]</span><br><span class="line">port = <span class="built_in">int</span>(sys.argv[<span class="number">2</span>])</span><br><span class="line">daemon = Pyro4.Daemon(host=host,port=port)</span><br><span class="line"></span><br><span class="line"><span class="comment">#daemon = Pyro4.Daemon(host=&#x27;127.0.0.1&#x27;,port=9999)</span></span><br><span class="line">bs = BridaServicePyro(daemon)</span><br><span class="line">uri = daemon.register(bs,objectId=<span class="string">&#x27;BridaServicePyro&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Ready.&quot;</span>)</span><br><span class="line">daemon.requestLoop()</span><br></pre></td></tr></table></figure>



        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Brida/" rel="tag">Brida</a><a class="tag-none-link" href="/tags/Burpsuite/" rel="tag">Burpsuite</a><a class="tag-none-link" href="/tags/Hook/" rel="tag">Hook</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/05/27/Brida-Starting-From-Beginning/">
                brida从0配置
            </a>
        </h2>
    
    <time>
        May 27, 2024
    </time>
    <section class="content">
        <h1><span id="brida从0配置">brida从0配置</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://www.cnblogs.com/howtime/p/13170537.html">how&#x3D;time</a> 并作补充</p>
</blockquote>
<h2><span id="前言">前言</span></h2><blockquote>
<p>因为最近测的一个app，做了ssl pinning。查了一下资料，可以使用frida从内存中hook<br>住加密函数，用来解密传输信息。而brida是连接frida与burp的桥梁。使用了brida就可以正常使用burp抓取加密数据包。而网上关于brida的安装环境都不是最新的。brida原本默认是py2的，现在0.4版本已经支持py3的环境。接下来，我就带大家从0开始安装环境吧。</p>
</blockquote>
<h2><span id="基础环境">基础环境</span></h2><blockquote>
<ul>
<li>系统 win10</li>
<li>python 3.8.3</li>
<li>java 13</li>
<li>夜神模拟器 android版本7.0</li>
<li>burp 2020.5 crack</li>
<li>node 14.4.0</li>
</ul>
<p>基本上是一个全新的环境。adb，frida也都没有配置。问题不大。</p>
</blockquote>
<h2><span id="设置与准备">设置与准备</span></h2><h3><span id="1brida下载安装">1.brida下载安装</span></h3><blockquote>
<p>github上的<a target="_blank" rel="noopener" href="https://github.com/federicodotta/Brida/releases">release</a></p>
<p>此时两个status还未启动起来，那需要我们去配置frida的环境了。</p>
<p>或者burpsuite中BAPP store安装</p>
</blockquote>
<h3><span id="2adb设置">2.adb设置</span></h3><blockquote>
<p>adb是连接模拟器和电脑的桥梁</p>
<p>adb的版本需要和nox的版本一致。我们可以直接使用everything去查找nox的adb，然后配置环境变量即可。</p>
</blockquote>
<h3><span id="3frida设置">3.frida设置</span></h3><blockquote>
<p>frida分为server和client</p>
<h4><span id="客户端安装frida">客户端安装frida</span></h4><p>这一步比较容易，pip安装即可</p>
<p>我们可以设置pip国内源来加快安装</p>
<p>1.进入c盘用户文件夹，新建pip的目录。pip目录下新建pip.ini的文件。</p>
<p>2.在pip.ini中添加下面代码：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[global]</span></span><br><span class="line"><span class="attr">timeout</span>=<span class="number">6000</span></span><br><span class="line"><span class="attr">index-url</span>=https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line"><span class="attr">trusted-host</span>=pypi.tuna.tsinghua.edu.cn</span><br><span class="line"></span><br><span class="line"><span class="comment"># pip源同样适用python3和python2。(适用python2的firda下载包时可能会出现卡死，可以试试这个方法改善)</span></span><br></pre></td></tr></table></figure>

<h5><span id="安装第三方库">安装第三方库</span></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install Pyro4</span><br><span class="line">pip install frida-tools</span><br><span class="line">npm install frida-compile <span class="comment">#这个生成frida-conpile.cmd.burpsuite中需要填写frida compile path</span></span><br></pre></td></tr></table></figure>



<h4><span id="服务端安装frida">服务端安装frida</span></h4><p>查看模拟器cpu版本</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getprop ro.product.cpu.abi</span><br></pre></td></tr></table></figure>

<p>根据cpu版本选择<a target="_blank" rel="noopener" href="https://github.com/frida/frida/releases">frida-server</a></p>
<p>将下载好的文件解压并放入&#x2F;data&#x2F;local&#x2F;tmp 模拟器中。在adb 进入模拟器，文件赋值777后启动server</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">adb push C:\Users\howti\Desktop\frida-server-<span class="number">12</span>.<span class="number">9</span>.<span class="number">7</span>-android-x86 /data/local/tmp</span><br><span class="line">adb shell</span><br><span class="line"><span class="built_in">cd</span> /data/local/tmp/</span><br><span class="line">chmod  <span class="number">777</span> frida-server-<span class="number">12</span>.<span class="number">9</span>.<span class="number">7</span>-android-x86</span><br><span class="line">./frida-server-<span class="number">12</span>.<span class="number">9</span>.<span class="number">7</span>-android-x86</span><br></pre></td></tr></table></figure>

<p>android版本最好使用android7，不然会一些报错。</p>
<p>什么都不显示即可</p>
<p>将frida端口转发</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb forward tcp:<span class="number">27042</span> tcp:<span class="number">27042</span></span><br><span class="line">adb forward tcp:<span class="number">27043</span> tcp:<span class="number">27043</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h3><span id="4burp设置">4.burp设置</span></h3><blockquote>
<h4><span id="设置代理">设置代理</span></h4><h4><span id="设置brida">设置brida</span></h4><ul>
<li>Python binary path: 就填入python3的路径（使用brida0.4就可以支持py3）</li>
<li>Pyro host: 默认</li>
<li>Pyro port: 默认</li>
<li>frida-compile: (frida-compile的二进制文件的路径)之前npm安装的包,里面有frida-compile.cmd .使用everything搜索frida 然后填入.</li>
<li>Frida JS files folder: 包含带有所有Frida和Brida钩子和导出文件的Frida工具JavaScript文件的文件夹的路径。我们可以使用默认文件夹</li>
</ul>
<h4><span id="运行brida">运行brida</span></h4><p><em><strong>我之前的环境找不到了，我用自己本机的环境结个图吧</strong></em></p>
<ul>
<li><p>获取 android包名</p>
</li>
<li><p>启动server 和Spawn application</p>
</li>
</ul>
</blockquote>
<p>正常启动，全绿。<br>配置完成<br>这里给出一件启动server的脚本（图中用的startfridaservice.py）<br>python3 startfridaserver.py 即可</p>
<p>链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/11IdhpG8I5vMb1q33-7C4qg">https://pan.baidu.com/s/11IdhpG8I5vMb1q33-7C4qg</a><br>提取码：46c0</p>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Brida/" rel="tag">Brida</a><a class="tag-none-link" href="/tags/Hook/" rel="tag">Hook</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/05/24/Frida-Hook-Signature/">
                Frida java层自吐加密算法
            </a>
        </h2>
    
    <time>
        May 24, 2024
    </time>
    <section class="content">
        <h1><span id="frida-java层自吐加密算法">Frida java层自吐加密算法</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://kuizuo.cn/docs/frida-java-encryption-algorithm/">愧怍</a> 并作补充</p>
</blockquote>
<h2><span id="代码">代码</span></h2><blockquote>
<p>针对 java 层加密算法，能 hook 到 java 自带的加密函数库</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  <span class="attr">showStacks</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">showDivider</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// console.log(&#x27;frida 已启动&#x27;);</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">showStacks</span>(<span class="params">name = <span class="string">&#x27;&#x27;</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (config.<span class="property">showStacks</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;android.util.Log&#x27;</span>).<span class="title function_">getStackTraceString</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.lang.Throwable&#x27;</span>).$new(name)))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">showDivider</span>(<span class="params">name = <span class="string">&#x27;&#x27;</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (config.<span class="property">showDivider</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`==============================<span class="subst">$&#123;name&#125;</span>==============================`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">showArguments</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;arguments: &#x27;</span>, ...<span class="variable language_">arguments</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">ByteString</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;com.android.okhttp.okio.ByteString&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Encode</span> = &#123;</span><br><span class="line">    <span class="title function_">toBase64</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(tag + <span class="string">&#x27; Base64: &#x27;</span>, <span class="title class_">ByteString</span>.<span class="title function_">of</span>(data).<span class="title function_">base64</span>())</span><br><span class="line">      <span class="comment">// console.log(tag + &#x27; Base64: &#x27;, bytesToBase64(data));</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">toHex</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(tag + <span class="string">&#x27; Hex: &#x27;</span>, <span class="title class_">ByteString</span>.<span class="title function_">of</span>(data).<span class="title function_">hex</span>())</span><br><span class="line">      <span class="comment">// console.log(tag + &#x27; Hex: &#x27;, bytesToHex(data));</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">toUtf8</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(tag + <span class="string">&#x27; Utf8: &#x27;</span>, <span class="title class_">ByteString</span>.<span class="title function_">of</span>(data).<span class="title function_">utf8</span>())</span><br><span class="line">      <span class="comment">// console.log(tag + &#x27; Utf8: &#x27;, bytesToString(data));</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">toAll</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">      <span class="title class_">Encode</span>.<span class="title function_">toUtf8</span>(tag, data)</span><br><span class="line">      <span class="title class_">Encode</span>.<span class="title function_">toHex</span>(tag, data)</span><br><span class="line">      <span class="title class_">Encode</span>.<span class="title function_">toBase64</span>(tag, data)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">toResult</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">      <span class="title class_">Encode</span>.<span class="title function_">toHex</span>(tag, data)</span><br><span class="line">      <span class="title class_">Encode</span>.<span class="title function_">toBase64</span>(tag, data)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">MessageDigest</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="params"><span class="string">&#x27;java.security.MessageDigest&#x27;</span></span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">let</span> overloads_update = <span class="title class_">MessageDigest</span>.<span class="property">update</span>.<span class="property">overloads</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_update) &#123;</span><br><span class="line">      overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">        <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">        <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">update</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> overloads_digest = <span class="title class_">MessageDigest</span>.<span class="property">digest</span>.<span class="property">overloads</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_digest) &#123;</span><br><span class="line">      overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">        <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">        <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">        <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="title function_">digest</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">3</span>) &#123;</span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toResult</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> digest result`</span>, result)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Mac</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="params"><span class="string">&#x27;javax.crypto.Mac&#x27;</span></span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="title class_">Mac</span>.<span class="property">init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.security.Key&#x27;</span>, <span class="string">&#x27;java.security.spec.AlgorithmParameterSpec&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">key, AlgorithmParameterSpec</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">init</span>(key, <span class="title class_">AlgorithmParameterSpec</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">Mac</span>.<span class="property">init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.security.Key&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">key</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">      <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">      <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">      <span class="keyword">const</span> keyBytes = key.<span class="title function_">getEncoded</span>()</span><br><span class="line">      <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> init Key`</span>, keyBytes)</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">init</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// let overloads_update = Mac.update.overloads;</span></span><br><span class="line">    <span class="comment">// for (const overload of overloads_update) &#123;</span></span><br><span class="line">    <span class="comment">//   overload.implementation = function () &#123;</span></span><br><span class="line">    <span class="comment">//     const algorithm = this.getAlgorithm();</span></span><br><span class="line">    <span class="comment">//     showDivider(algorithm);</span></span><br><span class="line">    <span class="comment">//     showStacks(algorithm);</span></span><br><span class="line">    <span class="comment">//     Encode.toAll(`$&#123;algorithm&#125; update data`, arguments[0]);</span></span><br><span class="line">    <span class="comment">//     return this.update(...arguments);</span></span><br><span class="line">    <span class="comment">//   &#125;;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> overloads_doFinal = <span class="title class_">Mac</span>.<span class="property">doFinal</span>.<span class="property">overloads</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_doFinal) &#123;</span><br><span class="line">      overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">        <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">        <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">        <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="title function_">doFinal</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">3</span>) &#123;</span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toResult</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> doFinal result`</span>, result)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Cipher</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="params"><span class="string">&#x27;javax.crypto.Cipher&#x27;</span></span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">let</span> overloads_init = <span class="title class_">Cipher</span>.<span class="property">init</span>.<span class="property">overloads</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_init) &#123;</span><br><span class="line">      overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">        <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">        <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">arguments</span>[<span class="number">0</span>]) &#123;</span><br><span class="line">          <span class="keyword">const</span> mode = <span class="variable language_">arguments</span>[<span class="number">0</span>]</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> init mode`</span>, mode)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">arguments</span>[<span class="number">1</span>]) &#123;</span><br><span class="line">          <span class="keyword">const</span> className = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">arguments</span>[<span class="number">1</span>])</span><br><span class="line">          <span class="comment">// 安卓10以上私钥是有可能输出不了的</span></span><br><span class="line">          <span class="keyword">if</span> (className.<span class="title function_">includes</span>(<span class="string">&#x27;OpenSSLRSAPrivateKey&#x27;</span>)) &#123;</span><br><span class="line">            <span class="comment">// const keyBytes = arguments[1];</span></span><br><span class="line">            <span class="comment">// console.log(`$&#123;algorithm&#125; init key`, keyBytes);</span></span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> keyBytes = <span class="variable language_">arguments</span>[<span class="number">1</span>].<span class="title function_">getEncoded</span>()</span><br><span class="line">            <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> init key`</span>, keyBytes)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">arguments</span>[<span class="number">2</span>]) &#123;</span><br><span class="line">          <span class="keyword">const</span> className = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">arguments</span>[<span class="number">2</span>])</span><br><span class="line">          <span class="keyword">if</span> (className.<span class="title function_">includes</span>(<span class="string">&#x27;javax.crypto.spec.IvParameterSpec&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">const</span> iv = <span class="title class_">Java</span>.<span class="title function_">cast</span>(<span class="variable language_">arguments</span>[<span class="number">2</span>], <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;javax.crypto.spec.IvParameterSpec&#x27;</span>))</span><br><span class="line">            <span class="keyword">const</span> ivBytes = iv.<span class="title function_">getIV</span>()</span><br><span class="line">            <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> init iv`</span>, ivBytes)</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (className.<span class="title function_">includes</span>(<span class="string">&#x27;java.security.SecureRandom&#x27;</span>)) &#123;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">init</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// let overloads_update = Cipher.update.overloads;</span></span><br><span class="line">    <span class="comment">// for (const overload of overloads_update) &#123;</span></span><br><span class="line">    <span class="comment">//   overload.implementation = function () &#123;</span></span><br><span class="line">    <span class="comment">//     const algorithm = this.getAlgorithm();</span></span><br><span class="line">    <span class="comment">//     showDivider(algorithm);</span></span><br><span class="line">    <span class="comment">//     showStacks(algorithm);</span></span><br><span class="line">    <span class="comment">//     Encode.toAll(`$&#123;algorithm&#125; update data`, arguments[0]);</span></span><br><span class="line">    <span class="comment">//     return this.update(...arguments);</span></span><br><span class="line">    <span class="comment">//   &#125;;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> overloads_doFinal = <span class="title class_">Cipher</span>.<span class="property">doFinal</span>.<span class="property">overloads</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_doFinal) &#123;</span><br><span class="line">      overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">        <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">        <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">        <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="title function_">doFinal</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">3</span>) &#123;</span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toResult</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> doFinal result`</span>, result)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Signature</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="params"><span class="string">&#x27;java.security.Signature&#x27;</span></span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">let</span> overloads_update = <span class="title class_">Signature</span>.<span class="property">update</span>.<span class="property">overloads</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_update) &#123;</span><br><span class="line">      overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">        <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">        <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">update</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> overloads_sign = <span class="title class_">Signature</span>.<span class="property">sign</span>.<span class="property">overloads</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_sign) &#123;</span><br><span class="line">      overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">        <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">        <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">        <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="title function_">sign</span>()</span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toResult</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> sign result`</span>, result)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">sign</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Exploit/" rel="tag">Exploit</a><a class="tag-none-link" href="/tags/Frida/" rel="tag">Frida</a><a class="tag-none-link" href="/tags/Hook/" rel="tag">Hook</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/05/21/CVE-2020-12440-Nginx/">
                （CVE-2020-12440）Nginx \&lt;= 1.8.0 请求走私
            </a>
        </h2>
    
    <time>
        May 21, 2024
    </time>
    <section class="content">
        <h1><span id="cve-2020-12440nginx-ltx3d-180-请求走私">（CVE-2020-12440）Nginx &lt;&#x3D; 1.8.0 请求走私</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://wiki.96.mk/Web%E5%AE%89%E5%85%A8/Nginx/%EF%BC%88CVE-2020-12440%EF%BC%89Nginx%20%3C%3D%201.8.0%20%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/">nosafer</a> 并作补充</p>
</blockquote>
<h2><span id="一-漏洞简介">一、漏洞简介</span></h2><blockquote>
<p>Nginx 1.18.0及之前版本中存在安全漏洞。攻击者可利用该漏洞进行缓存投毒，劫持凭证或绕过安全保护。</p>
</blockquote>
<h2><span id="二-漏洞影响">二、漏洞影响</span></h2><blockquote>
<p>Nginx &lt;&#x3D; 1.8.0</p>
</blockquote>
<h2><span id="三-复现过程">三、复现过程</span></h2><blockquote>
<p><img src="/2024/05/21/CVE-2020-12440-Nginx/1.png" alt="image"></p>
</blockquote>
<h3><span id="request">Request</span></h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/test.html</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>www.0-sec.org</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>2</span><br><span class="line"></span><br><span class="line"><span class="language-http"><span class="keyword">GET</span> <span class="string">/poc.html</span> <span class="meta">HTTP/1.1</span></span></span><br><span class="line"><span class="language-http"><span class="attribute">Host</span><span class="punctuation">: </span>www.0-sec.org</span></span><br><span class="line"><span class="language-http"><span class="attribute">Content-Length</span><span class="punctuation">: </span>15</span></span><br></pre></td></tr></table></figure>

<h3><span id="response">Response</span></h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>nginx/1.18.0</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Fri, 01 May 2020 18:28:44 GMT</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>33</span><br><span class="line"><span class="attribute">Last-Modified</span><span class="punctuation">: </span>Thu, 30 Apr 2020 14:36:32 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"><span class="attribute">ETag</span><span class="punctuation">: </span>&quot;5eaae270-21&quot;</span><br><span class="line"><span class="attribute">Accept-Ranges</span><span class="punctuation">: </span>bytes</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="section">&lt;html&gt;</span><span class="section">&lt;h1&gt;</span><span class="attribute">Test</span> Page!&lt;/h1&gt;&lt;/html&gt;</span></span><br><span class="line"><span class="language-apache"><span class="attribute">HTTP</span>/<span class="number">1</span>.<span class="number">1</span> <span class="number">200</span> OK</span></span><br><span class="line"><span class="language-apache"><span class="attribute">Server</span>: nginx/<span class="number">1</span>.<span class="number">18</span>.<span class="number">0</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">Date</span>: Fri, <span class="number">01</span> May <span class="number">2020</span> <span class="number">18</span>:<span class="number">28</span>:<span class="number">44</span> GMT</span></span><br><span class="line"><span class="language-apache"><span class="attribute">Content</span>-Type: text/html</span></span><br><span class="line"><span class="language-apache"><span class="attribute">Content</span>-Length: <span class="number">15</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">Last</span>-Modified: Thu, <span class="number">30</span> Apr <span class="number">2020</span> <span class="number">14</span>:<span class="number">35</span>:<span class="number">41</span> GMT</span></span><br><span class="line"><span class="language-apache"><span class="attribute">Connection</span>: keep-alive</span></span><br><span class="line"><span class="language-apache"><span class="attribute">ETag</span>: <span class="string">&quot;5eaae23d-f&quot;</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">Accept</span>-Ranges: bytes</span></span><br><span class="line"><span class="language-apache"></span></span><br><span class="line"><span class="language-apache"><span class="attribute">NGINX</span> PoC File</span></span><br></pre></td></tr></table></figure>



<h2><span id="其他例子">其他例子</span></h2><h3><span id="request200-ok-405-method-not-allowed">Request（200 OK + 405 Method Not Allowed）</span></h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>www.0-sec.org</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>4</span><br><span class="line">Transfer-Encoding : chunked</span><br><span class="line"></span><br><span class="line"><span class="language-apache"></span></span><br><span class="line"><span class="language-apache"><span class="attribute">46</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">TRACE</span> / HTTP/<span class="number">1</span>.<span class="number">1</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">Host</span>:www.<span class="number">0</span>-sec.org</span></span><br><span class="line"><span class="language-apache"><span class="attribute">Content</span>-Length:<span class="number">15</span></span></span><br><span class="line"><span class="language-apache"></span></span><br><span class="line"><span class="language-apache"></span></span><br><span class="line"><span class="language-apache"><span class="attribute">kk</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">0s</span></span></span><br></pre></td></tr></table></figure>



<h3><span id="response200-ok-405-method-not-allowed">Response（200 OK + 405 Method Not Allowed）</span></h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>nginx/1.18.0</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Tue, 21 Apr 2020 16:28:12 GMT</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>612</span><br><span class="line"><span class="attribute">Last-Modified</span><span class="punctuation">: </span>Tue, 21 Apr 2020 16:08:59 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"><span class="attribute">ETag</span><span class="punctuation">: </span>&quot;5e9f1a9b-264&quot;</span><br><span class="line"><span class="attribute">Accept-Ranges</span><span class="punctuation">: </span>bytes</span><br><span class="line"></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="selector-tag">body</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">width</span>: <span class="number">35em</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">margin</span>: <span class="number">0</span> auto;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">font-family</span>: Tahoma, Verdana, Arial, sans-serif;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>If you see this page, the nginx web server is successfully installed and</span></span><br><span class="line"><span class="language-xml">working. Further configuration is required.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>For online documentation and support please refer to</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://nginx.org/&quot;</span>&gt;</span>nginx.org<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">Commercial support is available at</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://nginx.com/&quot;</span>&gt;</span>nginx.com<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>Thank you for using nginx.<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">HTTP/1.1 405 Not Allowed</span></span><br><span class="line"><span class="language-xml">Server: nginx/1.18.0</span></span><br><span class="line"><span class="language-xml">Date: Tue, 21 Apr 2020 16:28:12 GMT</span></span><br><span class="line"><span class="language-xml">Content-Type: text/html</span></span><br><span class="line"><span class="language-xml">Content-Length: 157</span></span><br><span class="line"><span class="language-xml">Connection: close</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>405 Not Allowed<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>405 Not Allowed<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">hr</span>&gt;</span><span class="tag">&lt;<span class="name">center</span>&gt;</span>nginx/1.18.0<span class="tag">&lt;/<span class="name">center</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>



<h3><span id="request200-ok-404-not-found">Request（200 OK + 404 Not Found）</span></h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>www.0-sec.org</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>4</span><br><span class="line">Transfer-Encoding : chunked</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">46</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">GET</span> /<span class="number">404</span> HTTP/<span class="number">1</span>.<span class="number">1</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">Host</span>:www.<span class="number">0</span>-sec.org</span></span><br><span class="line"><span class="language-apache"><span class="attribute">Content</span>-Length:<span class="number">15</span></span></span><br><span class="line"><span class="language-apache"></span></span><br><span class="line"><span class="language-apache"><span class="attribute">kk</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">0s</span></span></span><br></pre></td></tr></table></figure>



<h3><span id="response200-ok-404-not-found">Response（200 OK + 404 Not Found）</span></h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>nginx/1.18.0</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Tue, 21 Apr 2020 16:23:52 GMT</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>612</span><br><span class="line"><span class="attribute">Last-Modified</span><span class="punctuation">: </span>Tue, 21 Apr 2020 16:08:59 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"><span class="attribute">ETag</span><span class="punctuation">: </span>&quot;5e9f1a9b-264&quot;</span><br><span class="line"><span class="attribute">Accept-Ranges</span><span class="punctuation">: </span>bytes</span><br><span class="line"></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="selector-tag">body</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">width</span>: <span class="number">35em</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">margin</span>: <span class="number">0</span> auto;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">font-family</span>: Tahoma, Verdana, Arial, sans-serif;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>If you see this page, the nginx web server is successfully installed and</span></span><br><span class="line"><span class="language-xml">working. Further configuration is required.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>For online documentation and support please refer to</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://nginx.org/&quot;</span>&gt;</span>nginx.org<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">Commercial support is available at</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://nginx.com/&quot;</span>&gt;</span>nginx.com<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>Thank you for using nginx.<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">HTTP/1.1 404 Not Found</span></span><br><span class="line"><span class="language-xml">Server: nginx/1.18.0</span></span><br><span class="line"><span class="language-xml">Date: Tue, 21 Apr 2020 16:23:52 GMT</span></span><br><span class="line"><span class="language-xml">Content-Type: text/html</span></span><br><span class="line"><span class="language-xml">Content-Length: 153</span></span><br><span class="line"><span class="language-xml">Connection: keep-alive</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>404 Not Found<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>404 Not Found<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">hr</span>&gt;</span><span class="tag">&lt;<span class="name">center</span>&gt;</span>nginx/1.18.0<span class="tag">&lt;/<span class="name">center</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>



        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Exploit/" rel="tag">Exploit</a><a class="tag-none-link" href="/tags/Nginx/" rel="tag">Nginx</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/05/21/JSFlash-BurpSuite/">
                BurpSuite作为代理，复用目标站点的js代码处理指定的内容
            </a>
        </h2>
    
    <time>
        May 21, 2024
    </time>
    <section class="content">
        <h1><span id="burpsuite作为代理复用目标站点的js代码处理指定的内容">BurpSuite作为代理，复用目标站点的js代码处理指定的内容</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://www.freebuf.com/sectool/247374.html">thinkoaa</a> 并作补充</p>
</blockquote>
<h2><span id="0x01-前言">0x01 前言</span></h2><blockquote>
<p>之前写了一个burp插件，直接使用目标站点的加密js来解决用intruder模块爆破时的payload加密问题</p>
<p>地址：<a target="_blank" rel="noopener" href="https://www.freebuf.com/sectool/242363.html">https://www.freebuf.com/sectool/242363.html</a></p>
<p>除了上面的情况外，有时还会遇到把burp当作代理，调用网站的js代码处理来自浏览器、sqlmap等工具的内容情况。</p>
<p>比如目标网站的参数调用了js加密算法，不管是手动访问也好，还是sqlmap注入也好，需要调用指定算法处理参数，用python或java重写算法的话呢，时间成本太高，有些算法还挺复杂……但，如果能够直接复用目标网站的js代码的话就太方便了。</p>
<p>因此，简单写了一个burp suite插件，专门解决上述问题：下载地址：<a target="_blank" rel="noopener" href="https://github.com/thinkoaa/JSFlash/">JSFlash</a></p>
<p>使用步骤是  可以参考我之前另一个插件的文章 <a target="_blank" rel="noopener" href="https://www.freebuf.com/sectool/242363.html">参考地址</a>：</p>
<ol>
<li>1.把目标站点的相关js代码放到本地js文件中，调试可用；</li>
<li>2.把JSFlash插件导入到Burp Suite中，在插件中加载指定的js文件并填写对应的参数；</li>
<li>3.抓包发repeater做测试，如果效果符合预期，则该插件会根据指定的规则，调用js代码，处理指定的内容。</li>
</ol>
<p>效果图：</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/1.png" alt="image"></p>
</blockquote>
<h2><span id="0x02-使用方法">0x02 使用方法</span></h2><h3><span id="1从目标站点复制修改或者手动写好js代码调试正确">1.从目标站点复制修改或者手动写好js代码，调试正确</span></h3><blockquote>
<p><img src="/2024/05/21/JSFlash-BurpSuite/2.png" alt="image"></p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/3.png" alt="image"></p>
<p>因为插件是通过java调用js，因此window、document等对象及方法，还有一些很新的js特性可能在浏览器中执行正确，但插件调用时会报错，因此插件会把可能产生的错误信息弹出显示，方便根据实际逻辑修改，根据我的经历来看，不管多复杂，只要耐心点，没有改不了的情况，如图：</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/4.png" alt="image"></p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/5.png" alt="image"></p>
<p>再举一个例：</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/6.png" alt="image"></p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/7.png" alt="image"></p>
</blockquote>
<h3><span id="2导入插件设置参数">2.导入插件，设置参数</span></h3><blockquote>
<p><img src="/2024/05/21/JSFlash-BurpSuite/8.png" alt="image"></p>
<p>2.1 设置url，一定要用burp的Copy URL菜单复制，不要手动填写，以免出错：</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/9.png" alt="image"></p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/10.png" alt="image"></p>
<p>2.2 设置处理指定内容的规则</p>
<p>GET方式:</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/11.png" alt="image"></p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/12.png" alt="image"></p>
<p>php代码如图：</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/13.png" alt="image"></p>
<p>处理结果：</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/14.png" alt="image"></p>
<p>POST方式：</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/15.png" alt="image"></p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/16.png" alt="image"></p>
<p>php代码如图：</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/17.png" alt="image"></p>
<p>结果如图：</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/18.png" alt="image"></p>
<p>一次调用多个方法，处理多个指定内容：</p>
<p>数据包：</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/19.png" alt="image"></p>
<p>规则：</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/20.png" alt="image"></p>
<p>php代码：</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/21.png" alt="image"></p>
<p>结果：</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/22.png" alt="image"></p>
</blockquote>
<h2><span id="0x03-总结">0x03 总结</span></h2><blockquote>
<p>这个插件用到的时候，需要具体情况具体分析，不过思路是这么个思路，目的就是复用js代码，提高工作效率。</p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/BurpSuite/" rel="tag">BurpSuite</a><a class="tag-none-link" href="/tags/Exploit/" rel="tag">Exploit</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
</section>


  <nav id="page-nav" class="clearfix">
    
    
    <a class="next" rel="next" href="/archives/2024/05/page/2/">
      <span class="text">Next</span>
      <span class="icon icon-chevron-right"></span>
    </a>
    
  </nav>


        <script>setLoadingBarProgress(60);</script>
    </main>

    <footer id="footer" class="clearfix">

    

    <div class="social-wrapper">
        
            
                <a href="https://github.com/szczecin" class="social github"
                   target="_blank" rel="external">
                    <span class="icon icon-github"></span>
                </a>
            
                <a href="/atom.xml" class="social rss"
                   target="_blank" rel="external">
                    <span class="icon icon-rss"></span>
                </a>
            
        
    </div>

    <div class="theme-by">Theme <span class="codename">Memory</span> designed by <a href="https://artifact.me/"
                                                                                    target="_blank">Art Chen</a>.
    </div>
    <div>&copy; <a href="/">氕氘氚</a></div>

</footer>


    <script>setLoadingBarProgress(80);</script>
    <div class="overlay"></div>
</div>

<div class="site-sidebar" id="site-sidebar">

    

    <div class="sidebar-switch clearfix "
         style="display: none">
        <a class="dark-btn active" data-toggle="toc">
            <span class="icon icon-list"></span>
            <span class="text">Index</span>
        </a>
        <a class="dark-btn" data-toggle="bio">
            <span class="icon icon-person"></span>
            <span class="text">Bio</span>
        </a>
    </div>

    <div class="site-toc "
         style="display: none">
        
            <div class="no-index">No Index</div>
        
    </div>

    <div class="site-bio show"
         style="display: block">

        <div class="about-me clearfix">
            <div class="avatar">
                <img src="/img/avatar.png"/>
            </div>
            <div class="info">
                <a class="name dark-btn" href="/about">
                    Szczecin
                </a>
            </div>
            <div class="info">
                <span class="item desc">
                    Open your eyes to see the light in life
                </span>
            </div>
        </div>

        <div class="menu section">
            <ul class="clearfix">
                
                    <li class="left">
                        <a href="/about"
                           onfocus="this.blur();"
                           class="nav-about dark-btn block">
                            简介
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/archives"
                           onfocus="this.blur();"
                           class="nav-archives dark-btn block">
                            归档
                        </a>
                    </li>
                
                    <li class="left">
                        <a href="/categories"
                           onfocus="this.blur();"
                           class="nav-categories dark-btn block">
                            分类
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/tags"
                           onfocus="this.blur();"
                           class="nav-tags dark-btn block">
                            TAGs
                        </a>
                    </li>
                
                    <li class="left">
                        <a href="/WriteUP"
                           onfocus="this.blur();"
                           class="nav-WriteUP dark-btn block">
                            WriteUP
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/EXP"
                           onfocus="this.blur();"
                           class="nav-EXP dark-btn block">
                            EXP
                        </a>
                    </li>
                
                    <li class="left">
                        <a href="/tags/SRC"
                           onfocus="this.blur();"
                           class="nav-SRC dark-btn block">
                            SRC
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/Life"
                           onfocus="this.blur();"
                           class="nav-Life dark-btn block">
                            Life
                        </a>
                    </li>
                
            </ul>
        </div>

    </div>

    <div class="shortcuts">
        <a href="#header" class="top window-nav dark-btn" id="go-top">
            <span class="icon icon-chevron-thin-up"></span>
        </a>
        <a class="close dark-btn" id="sidebar-close">
            <span class="icon icon-close"></span>
        </a>
        <a href="#footer" class="top window-nav dark-btn" id="go-bottom">
            <span class="icon icon-chevron-thin-down"></span>
        </a>
    </div>

</div>





<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script>window.jQuery || document.write('<script src="/js/jquery.min.js"><\/script>')</script>


<script src="/js/jquery.fitvids.js"></script>

<script>
  var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
  var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
  var ALGOLIA_API_KEY = "";
  var ALGOLIA_APP_ID = "";
  var ALGOLIA_INDEX_NAME = "";
  var AZURE_SERVICE_NAME = "";
  var AZURE_INDEX_NAME = "";
  var AZURE_QUERY_KEY = "";
  var SEARCH_SERVICE = "";
  var universalSearchConfig = {};
  if (SEARCH_SERVICE === 'google') {
    universalSearchConfig = {
      searchService: SEARCH_SERVICE,
      apiKey: GOOGLE_CUSTOM_SEARCH_API_KEY,
      engineId: GOOGLE_CUSTOM_SEARCH_ENGINE_ID,
      imagePath: "/img/"
    };
  } else if (SEARCH_SERVICE === 'algolia') {
    universalSearchConfig = {
      searchService: SEARCH_SERVICE,
      apiKey: ALGOLIA_API_KEY,
      appId: ALGOLIA_APP_ID,
      indexName: ALGOLIA_INDEX_NAME,
      imagePath: "/img/"
    };
  } else if (SEARCH_SERVICE === 'azure') {
    universalSearchConfig = {
      searchService: SEARCH_SERVICE,
      serviceName: AZURE_SERVICE_NAME,
      indexName: AZURE_INDEX_NAME,
      apiKey: AZURE_QUERY_KEY,
      imagePath: "/img/"
    };
  }
</script>

<script src="/js/app.js"></script>


<script src="/js/search.js"></script>





<script>setLoadingBarProgress(100);</script>

</body>
</html>
