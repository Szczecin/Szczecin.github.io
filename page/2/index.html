<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>氕氘氚</title>
    <meta name="keywords" content="hexo,theme,otakism,otaku"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="google-site-verification" content=""/>
    <meta name="baidu-site-verification" content=""/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Open your eyes to see the light in life">
<meta property="og:type" content="website">
<meta property="og:title" content="氕氘氚">
<meta property="og:url" content="https://szczecin.github.io/page/2/index.html">
<meta property="og:site_name" content="氕氘氚">
<meta property="og:description" content="Open your eyes to see the light in life">
<meta property="og:locale">
<meta property="article:author" content="Szczecin">
<meta name="twitter:card" content="summary">
    

    <!-- Favicon -->
    
        <link rel="icon" href="/img/favicon.ico" />
    

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css?family=Inconsolata|Roboto:300,400,700" rel="stylesheet">

    
<link rel="stylesheet" href="/style.css">

    <script>
      function setLoadingBarProgress(num) {
        document.getElementById('loading-bar').style.width = num + "%";
      }
    </script>

    


<meta name="generator" content="Hexo 6.2.0"></head>

<body>

<div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>

<script>setLoadingBarProgress(20)</script>

<div id="site-wrapper">

    <header id="header">
    <div id="header-wrapper" class="clearfix">
        <a id="logo" href="/">
            <img src="/img/logo.png"/>
            <span id="site-desc">
                Be A Gorgeous World
            </span>
        </a>
        <button id="site-nav-switch">
            <span class="icon icon-menu"></span>
        </button>
    </div>
</header>
    <script>setLoadingBarProgress(40);</script>

    <main id="main" role="main">
        





<section class="post-list">
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/05/27/Brida-How-To-Using/">
                Burpsuite插件-Brida
            </a>
        </h2>
    
    <time>
        May 27, 2024
    </time>
    <section class="content">
        <h1><span id="burpsuite插件-brida">Burpsuite插件-Brida</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://blog.csdn.net/samlirongsheng/article/details/134966158">sam.li</a> 并作补充</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/samlirongsheng/article/details/134950536">通过一道CTF题目来认识一下Frida</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/samlirongsheng/article/details/134952350">objection</a><br>前面两篇通过对<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Frida&spm=1001.2101.3001.7020">Frida</a>的了解，以及利用objection来分析，这篇来了解一下分析后实际利用，以及通过实现插件自动化的方式来利用。</p>
</blockquote>
<h2><span id="brida介绍">Brida介绍</span></h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/federicodotta/Brida">https://github.com/federicodotta/Brida</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/federicodotta/Brida/wiki/Brida-components">Brida components</a></p>
<p><img src="/2024/05/27/Brida-How-To-Using/1.png" alt="image"></p>
<h3><span id="官方使用文档翻译">官方使用文档翻译</span></h3><p>时间记录，20230725；</p>
<p>测试版本：0.5</p>
<p>虽然说官方文档是最新的，但是使用文档的截图依旧跟新版本的插件不一致，然后能够查到的资料也是比较久的内容，不过大体功能是差不多，但是还是自己操作一遍后记录一下相关问题；</p>
<p>这里只记录自己测试的环境，其他环境参考官方文档；</p>
<h4><span id="android">Android</span></h4><ol>
<li>安装frida和其server，并启动具体可以参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/samlirongsheng/article/details/134950536">通过一道CTF题目来认识一下Frida</a></li>
<li>配置brida</li>
</ol>
<p>在配置之前先简单了解一下brida的UI及其功能；</p>
<p><img src="/2024/05/27/Brida-How-To-Using/2.png" alt="image"></p>
<h4><span id="1-主面板">1 主面板</span></h4><p>这里包含所有brida工具和配置</p>
<ol>
<li>Configurations</li>
<li>JS Editor</li>
<li>Hooks and functions</li>
<li>Graphical analysis</li>
<li>Graphical hooks</li>
<li>Custom plugins</li>
<li>Generate stubs</li>
<li>Debug export</li>
</ol>
<h4><span id="2-brida按钮面板">2 brida按钮面板</span></h4><p>Brida按钮面板由三个不同的部分组成：</p>
<ul>
<li>顶部（前两行）是 Pyro4 服务器的状态（启动&#x2F;停止）和应用程序的状态（hook状态）</li>
<li>（在两条黄线上方的按钮）在中间有一组固定在Brida所有选项卡上的按钮。这些按钮用于执行常规任务，如启动&#x2F;停止 Pyro4 服务器、生成&#x2F;附加&#x2F;停止&#x2F;分离应用程序（使用 frida-compile 编译）、重新加载 JS 文件、编译重新加载JS、分离所有hook、清除log等。</li>
<li>（黄线下）底部有一组按钮，取决于特定的Brida子选项卡</li>
</ul>
<h4><span id="3-brida控制台">3 brida控制台</span></h4><p>log输出</p>
</blockquote>
<h2><span id="brida工具介绍">brida工具介绍</span></h2><blockquote>
<h3><span id="configurations">Configurations</span></h3><p>配置界面</p>
<p>从上往下依次是</p>
<ol>
<li>Pyro服务状态</li>
<li>应用状态</li>
<li>是否使用虚拟的python环境</li>
<li>python可以执行文件的路径</li>
<li>Pyro服务地址（默认）</li>
<li>Pyro端口（默认）</li>
<li>frida-complile可以执行文件的路径</li>
<li>是否使用旧版本的frida-complile，尽量使用10以下的版本，一开始用默认版本会出现问题，hook上了，但是总有奇怪的报错</li>
<li>包含所有Brida JS文件的文件夹，第一次需要先生成一下默认的JS文件</li>
<li>需要hook的应用名&#x2F;PID，如果为应用名，则在连接的时候是点按钮面板的Spawn application，如果为PID，则Attach；</li>
<li>Frida连接方式</li>
<li>如果配置是远程连接frida，需要配置对应的地址和端口；</li>
</ol>
<p><img src="/2024/05/27/Brida-How-To-Using/3.png" alt="image"></p>
<h3><span id="js-editor">JS Editor</span></h3><p><img src="/2024/05/27/Brida-How-To-Using/4.png" alt="image"></p>
<p>集成到Burp Suite中的JS编辑器，以便能够编辑Brida JS文件并直接从Burp Suite添加自定义hook和导出函数。编辑器具有JS语法突出显示。</p>
<h3><span id="hooks-and-functions">Hooks and functions</span></h3><p><img src="/2024/05/27/Brida-How-To-Using/5.png" alt="image"></p>
<p>此选项卡包括许多默认hooks和方法，可以通过按钮启用&#x2F;执行。这些Frida脚本包括最新的Android和iOS平台的hook能力，以绕过和检查安全功能。</p>
<h3><span id="graphical-analysis">Graphical analysis</span></h3><p><img src="/2024/05/27/Brida-How-To-Using/6.png" alt="image"></p>
<p><a target="_blank" rel="noopener" href="https://github.com/federicodotta/Brida/wiki/Graphical-analysis">Graphical analysis</a></p>
<p>这里功能类似于objection的能力集成进来：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">load tree = android hooking list classes //展示所有class </span><br><span class="line"></span><br><span class="line">搜索 = android hooking search methods [search_name] //在内存中所有已加载的方法中搜索包含特定关键词的方法</span><br><span class="line">//但是这里Android的用起来会导致应用闪退，官方提了这个，只有iOS支持；</span><br><span class="line"></span><br><span class="line">双击对应的class = android hooking watch class com.xxx.xxx //hook指定类, 会打印该类下的所以调用</span><br><span class="line">右键Inspect = android hooking watch class_method com.xxx.xxx.methodName --dump-args --dump-backtrace --dump-return //hook指定类, 会打印该类下的所以调用</span><br><span class="line">右键change return vule = android hooking set return_value com.xxx.xxx.methodName false //设置返回值</span><br></pre></td></tr></table></figure>

<h4><span id="实际使用">实际使用</span></h4><p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/samlirongsheng/article/details/134950536">通过一道CTF题目来认识一下Frida</a></p>
<p>对函数进行打印，然后替换返回值，但是这里官方提供的返回值没有byte</p>
<p><img src="/2024/05/27/Brida-How-To-Using/7.png" alt="image"></p>
<h3><span id="graphical-hooks">Graphical hooks</span></h3><p><img src="/2024/05/27/Brida-How-To-Using/8.png" alt="image"></p>
<p>管理之前hook的所有内容；</p>
<h3><span id="custom-plugins">Custom plugins</span></h3><p><img src="/2024/05/27/Brida-How-To-Using/9.png" alt="image"></p>
<p>强大的功能；</p>
<p>可以理解成自定义生成burpsuite插件，有四种可自定义插件类型；</p>
<ul>
<li>IHttpListener：能让所有请求，通过正则匹配去替换&#x2F;修改指定的内容，并让这个匹配到的内容通过frida构造的hook脚本处理（加解密、重新生成sign等）</li>
<li>IMessageEditorTab：将自定义选项卡添加到Burp Suite请求&#x2F;响应窗格，以便能够使用Frida导出的函数解密&#x2F;解码&#x2F;处理请求&#x2F;响应（或其中的一部分）（然后加密&#x2F;编码&#x2F;处理修改并替换原始请求&#x2F;响应，如果有）</li>
<li>IContextMenu：将自定义上下文菜单选项添加到Burp Suite的右键菜单中，用于在请求和响应（或其中的一部分）上调用Frida导出的函数</li>
<li>JButton：添加调用&#x2F;启用 Frida 导出函数的按钮</li>
</ul>
<h3><span id="generate-stubs">Generate stubs</span></h3><p><img src="/2024/05/27/Brida-How-To-Using/10.png" alt="image"></p>
<p>如果内部自定义插件引擎无法解决复杂情况，则可以从外部Burp Suite插件使用Brida引擎。此选项卡生成 Java 和 Python 存根，可以复制并粘贴到外部插件中，以便允许 Burp Suite 和 Frida 使用 Brida 进行通信。</p>
<h3><span id="debug-export">Debug export</span></h3><p><img src="/2024/05/27/Brida-How-To-Using/11.png" alt="image"></p>
<p>此选项卡可用于在 Brida 插件中使用 Frida 导出的函数之前对其进行调试。为了使用 Brida 自定义插件（或使用 Brida 的外部插件），有必要将 Frida 代码放入一些由插件调用的 Frida 导出函数中。在此选项卡中，可以直接调用 Frida 导出，以便轻松调试。</p>
</blockquote>
<h2><span id="使用问题记录">使用问题记录</span></h2><blockquote>
<p>Windows环境</p>
<p><strong>Spawn&#x2F;Attach application时报错：entrypoint must be inside the project root</strong><br><a target="_blank" rel="noopener" href="https://cn-sec.com/archives/1639064.html">【移动安全】Frida + Burp -&gt; Brida | APP加解密 | CN-SEC 中文网</a></p>
<p>把Frida的js文件放到burpsuite应用的目录下；</p>
<p><strong>在Debug export中Run export是报错[frida.core.RPCException] unable to find method ‘test’</strong><br>排查了很久，只找到了frida-compile版本过高这种情况，只能测试一下低版本是否会有问题，用npm在burpsuite应用的目录下执行npm install <a href="mailto:&#x66;&#114;&#x69;&#100;&#97;&#x2d;&#99;&#x6f;&#109;&#112;&#x69;&#108;&#101;&#64;&#x39;&#46;&#53;&#x2e;&#x32;">&#x66;&#114;&#x69;&#100;&#97;&#x2d;&#99;&#x6f;&#109;&#112;&#x69;&#108;&#101;&#64;&#x39;&#46;&#53;&#x2e;&#x32;</a>，然后将安装的目录配置到frida-compile path中就能解决；</p>
<p><strong>使用了低版本的frida-compile后报错java.io.IOException: Cannot run program</strong></p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;C:\AAAA\agent\BurpSuiteCommunity\node_modules\.bin\frida-compile&quot;: </span><br><span class="line">CreateProcess error=<span class="number">193</span>, %<span class="number">1</span> 不是有效的 Win32 应用程序。</span><br></pre></td></tr></table></figure>

<p>一开始配置没有带.cmd</p>
<p><img src="/2024/05/27/Brida-How-To-Using/12.png" alt="image"></p>
<p><img src="/2024/05/27/Brida-How-To-Using/13.png" alt="image"></p>
<p><img src="/2024/05/27/Brida-How-To-Using/14.png" alt="image"></p>
<p><strong>UnicodeEncodeError: ‘gbk’ codec can’t encode</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">character <span class="string">&#x27;\u03f1&#x27;</span> <span class="keyword">in</span> position 49: illegal multibyte sequence**</span><br></pre></td></tr></table></figure>

<p>刚好遇到一个反编译后用中文混淆的，这里用objection和python执行相关处理的时候就会报编码错误，在对应路径相关代码输出处加上utf-8编码输出就能解决；然后objection需要修改后重新编译；</p>
<p><img src="/2024/05/27/Brida-How-To-Using/15.png" alt="image"></p>
</blockquote>
<h2><span id="源码解析">源码解析</span></h2><blockquote>
<p>java调用python脚本</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"><span class="keyword">import</span> Pyro4</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment">#reload(sys)   </span></span><br><span class="line"><span class="comment">#sys.setdefaultencoding(&#x27;utf-8&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Unbuffered</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">   <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, stream</span>):</span><br><span class="line">       self.stream = stream</span><br><span class="line">   <span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">self, data</span>):</span><br><span class="line">       self.stream.write(data)</span><br><span class="line">       self.stream.flush()</span><br><span class="line">   <span class="keyword">def</span> <span class="title function_">writelines</span>(<span class="params">self, datas</span>):</span><br><span class="line">       self.stream.writelines(datas)</span><br><span class="line">       self.stream.flush()</span><br><span class="line">   <span class="keyword">def</span> <span class="title function_">__getattr__</span>(<span class="params">self, attr</span>):</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">getattr</span>(self.stream, attr)</span><br><span class="line"></span><br><span class="line"><span class="meta">@Pyro4.expose</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BridaServicePyro</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, daemon</span>):</span><br><span class="line">        self.daemon = daemon</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">attach_application</span>(<span class="params">self,pid,frida_script,device,host_port_device_id</span>):</span><br><span class="line"></span><br><span class="line">        self.frida_script = frida_script</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> pid.isnumeric():</span><br><span class="line">            self.pid = <span class="built_in">int</span>(pid)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.pid = pid</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> device == <span class="string">&#x27;remote&#x27;</span>:</span><br><span class="line">            self.device = frida.get_remote_device()</span><br><span class="line">        <span class="keyword">elif</span> device == <span class="string">&#x27;usb&#x27;</span>:</span><br><span class="line">            self.device = frida.get_usb_device()</span><br><span class="line">        <span class="keyword">elif</span> device == <span class="string">&#x27;local&#x27;</span>:</span><br><span class="line">            self.device = frida.get_local_device()</span><br><span class="line">        <span class="keyword">elif</span> device == <span class="string">&#x27;device&#x27;</span>:</span><br><span class="line">            self.device = frida.get_device(host_port_device_id)        </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.device = frida.get_device_manager().add_remote_device(host_port_device_id)</span><br><span class="line"></span><br><span class="line">        self.session = self.device.attach(self.pid)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> codecs.<span class="built_in">open</span>(self.frida_script, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            source = f.read()</span><br><span class="line"></span><br><span class="line">        self.script = self.session.create_script(source)</span><br><span class="line">        self.script.load()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span>    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">spawn_application</span>(<span class="params">self,application_id,frida_script,device,host_port_device_id</span>):</span><br><span class="line"></span><br><span class="line">        self.application_id = application_id</span><br><span class="line">        self.frida_script = frida_script</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> device == <span class="string">&#x27;remote&#x27;</span>:</span><br><span class="line">            self.device = frida.get_remote_device()</span><br><span class="line">        <span class="keyword">elif</span> device == <span class="string">&#x27;usb&#x27;</span>:</span><br><span class="line">            self.device = frida.get_usb_device()</span><br><span class="line">        <span class="keyword">elif</span> device == <span class="string">&#x27;local&#x27;</span>:</span><br><span class="line">            self.device = frida.get_local_device()</span><br><span class="line">        <span class="keyword">elif</span> device == <span class="string">&#x27;device&#x27;</span>:</span><br><span class="line">            self.device = frida.get_device(host_port_device_id)        </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.device = frida.get_device_manager().add_remote_device(host_port_device_id)</span><br><span class="line"></span><br><span class="line">        self.pid = self.device.spawn([self.application_id])</span><br><span class="line"></span><br><span class="line">        self.session = self.device.attach(self.pid)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> codecs.<span class="built_in">open</span>(self.frida_script, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            source = f.read()</span><br><span class="line"></span><br><span class="line">        self.script = self.session.create_script(source)</span><br><span class="line">        self.script.load()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">resume_application</span>(<span class="params">self</span>):</span><br><span class="line"></span><br><span class="line">        self.device.resume(self.pid)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reload_script</span>(<span class="params">self</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> codecs.<span class="built_in">open</span>(self.frida_script, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            source = f.read()</span><br><span class="line"></span><br><span class="line">        self.script = self.session.create_script(source)</span><br><span class="line">        self.script.load()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">disconnect_application</span>(<span class="params">self</span>):</span><br><span class="line"></span><br><span class="line">        self.device.kill(self.pid)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">detach_application</span>(<span class="params">self</span>):</span><br><span class="line"></span><br><span class="line">        self.session.detach()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">callexportfunction</span>(<span class="params">self, methodName, args</span>):</span><br><span class="line">        method_to_call = <span class="built_in">getattr</span>(self.script.exports, methodName)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Take the Java list passed as argument and create a new variable list of argument</span></span><br><span class="line">        <span class="comment"># (necessary for bridge Python - Java, I think)</span></span><br><span class="line">        s = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> args:</span><br><span class="line">            s.append(i)</span><br><span class="line"></span><br><span class="line">        return_value = method_to_call(*s)</span><br><span class="line">        <span class="keyword">return</span> return_value</span><br><span class="line"></span><br><span class="line"><span class="meta">    @Pyro4.oneway</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">shutdown</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;shutting down...&#x27;</span>)</span><br><span class="line">        self.daemon.shutdown()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable python buffering (cause issues when communicating with Java...)</span></span><br><span class="line">sys.stdout = Unbuffered(sys.stdout)</span><br><span class="line">sys.stderr = Unbuffered(sys.stderr)</span><br><span class="line"></span><br><span class="line">host = sys.argv[<span class="number">1</span>]</span><br><span class="line">port = <span class="built_in">int</span>(sys.argv[<span class="number">2</span>])</span><br><span class="line">daemon = Pyro4.Daemon(host=host,port=port)</span><br><span class="line"></span><br><span class="line"><span class="comment">#daemon = Pyro4.Daemon(host=&#x27;127.0.0.1&#x27;,port=9999)</span></span><br><span class="line">bs = BridaServicePyro(daemon)</span><br><span class="line">uri = daemon.register(bs,objectId=<span class="string">&#x27;BridaServicePyro&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Ready.&quot;</span>)</span><br><span class="line">daemon.requestLoop()</span><br></pre></td></tr></table></figure>



        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Brida/" rel="tag">Brida</a><a class="tag-none-link" href="/tags/Burpsuite/" rel="tag">Burpsuite</a><a class="tag-none-link" href="/tags/Hook/" rel="tag">Hook</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/05/27/Brida-Starting-From-Beginning/">
                brida从0配置
            </a>
        </h2>
    
    <time>
        May 27, 2024
    </time>
    <section class="content">
        <h1><span id="brida从0配置">brida从0配置</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://www.cnblogs.com/howtime/p/13170537.html">how&#x3D;time</a> 并作补充</p>
</blockquote>
<h2><span id="前言">前言</span></h2><blockquote>
<p>因为最近测的一个app，做了ssl pinning。查了一下资料，可以使用frida从内存中hook<br>住加密函数，用来解密传输信息。而brida是连接frida与burp的桥梁。使用了brida就可以正常使用burp抓取加密数据包。而网上关于brida的安装环境都不是最新的。brida原本默认是py2的，现在0.4版本已经支持py3的环境。接下来，我就带大家从0开始安装环境吧。</p>
</blockquote>
<h2><span id="基础环境">基础环境</span></h2><blockquote>
<ul>
<li>系统 win10</li>
<li>python 3.8.3</li>
<li>java 13</li>
<li>夜神模拟器 android版本7.0</li>
<li>burp 2020.5 crack</li>
<li>node 14.4.0</li>
</ul>
<p>基本上是一个全新的环境。adb，frida也都没有配置。问题不大。</p>
</blockquote>
<h2><span id="设置与准备">设置与准备</span></h2><h3><span id="1brida下载安装">1.brida下载安装</span></h3><blockquote>
<p>github上的<a target="_blank" rel="noopener" href="https://github.com/federicodotta/Brida/releases">release</a></p>
<p>此时两个status还未启动起来，那需要我们去配置frida的环境了。</p>
<p>或者burpsuite中BAPP store安装</p>
</blockquote>
<h3><span id="2adb设置">2.adb设置</span></h3><blockquote>
<p>adb是连接模拟器和电脑的桥梁</p>
<p>adb的版本需要和nox的版本一致。我们可以直接使用everything去查找nox的adb，然后配置环境变量即可。</p>
</blockquote>
<h3><span id="3frida设置">3.frida设置</span></h3><blockquote>
<p>frida分为server和client</p>
<h4><span id="客户端安装frida">客户端安装frida</span></h4><p>这一步比较容易，pip安装即可</p>
<p>我们可以设置pip国内源来加快安装</p>
<p>1.进入c盘用户文件夹，新建pip的目录。pip目录下新建pip.ini的文件。</p>
<p>2.在pip.ini中添加下面代码：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[global]</span></span><br><span class="line"><span class="attr">timeout</span>=<span class="number">6000</span></span><br><span class="line"><span class="attr">index-url</span>=https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line"><span class="attr">trusted-host</span>=pypi.tuna.tsinghua.edu.cn</span><br><span class="line"></span><br><span class="line"><span class="comment"># pip源同样适用python3和python2。(适用python2的firda下载包时可能会出现卡死，可以试试这个方法改善)</span></span><br></pre></td></tr></table></figure>

<h5><span id="安装第三方库">安装第三方库</span></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install Pyro4</span><br><span class="line">pip install frida-tools</span><br><span class="line">npm install frida-compile <span class="comment">#这个生成frida-conpile.cmd.burpsuite中需要填写frida compile path</span></span><br></pre></td></tr></table></figure>



<h4><span id="服务端安装frida">服务端安装frida</span></h4><p>查看模拟器cpu版本</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getprop ro.product.cpu.abi</span><br></pre></td></tr></table></figure>

<p>根据cpu版本选择<a target="_blank" rel="noopener" href="https://github.com/frida/frida/releases">frida-server</a></p>
<p>将下载好的文件解压并放入&#x2F;data&#x2F;local&#x2F;tmp 模拟器中。在adb 进入模拟器，文件赋值777后启动server</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">adb push C:\Users\howti\Desktop\frida-server-<span class="number">12</span>.<span class="number">9</span>.<span class="number">7</span>-android-x86 /data/local/tmp</span><br><span class="line">adb shell</span><br><span class="line"><span class="built_in">cd</span> /data/local/tmp/</span><br><span class="line">chmod  <span class="number">777</span> frida-server-<span class="number">12</span>.<span class="number">9</span>.<span class="number">7</span>-android-x86</span><br><span class="line">./frida-server-<span class="number">12</span>.<span class="number">9</span>.<span class="number">7</span>-android-x86</span><br></pre></td></tr></table></figure>

<p>android版本最好使用android7，不然会一些报错。</p>
<p>什么都不显示即可</p>
<p>将frida端口转发</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb forward tcp:<span class="number">27042</span> tcp:<span class="number">27042</span></span><br><span class="line">adb forward tcp:<span class="number">27043</span> tcp:<span class="number">27043</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h3><span id="4burp设置">4.burp设置</span></h3><blockquote>
<h4><span id="设置代理">设置代理</span></h4><h4><span id="设置brida">设置brida</span></h4><ul>
<li>Python binary path: 就填入python3的路径（使用brida0.4就可以支持py3）</li>
<li>Pyro host: 默认</li>
<li>Pyro port: 默认</li>
<li>frida-compile: (frida-compile的二进制文件的路径)之前npm安装的包,里面有frida-compile.cmd .使用everything搜索frida 然后填入.</li>
<li>Frida JS files folder: 包含带有所有Frida和Brida钩子和导出文件的Frida工具JavaScript文件的文件夹的路径。我们可以使用默认文件夹</li>
</ul>
<h4><span id="运行brida">运行brida</span></h4><p><em><strong>我之前的环境找不到了，我用自己本机的环境结个图吧</strong></em></p>
<ul>
<li><p>获取 android包名</p>
</li>
<li><p>启动server 和Spawn application</p>
</li>
</ul>
</blockquote>
<p>正常启动，全绿。<br>配置完成<br>这里给出一件启动server的脚本（图中用的startfridaservice.py）<br>python3 startfridaserver.py 即可</p>
<p>链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/11IdhpG8I5vMb1q33-7C4qg">https://pan.baidu.com/s/11IdhpG8I5vMb1q33-7C4qg</a><br>提取码：46c0</p>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Brida/" rel="tag">Brida</a><a class="tag-none-link" href="/tags/Hook/" rel="tag">Hook</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/05/24/Frida-Hook-Signature/">
                Frida java层自吐加密算法
            </a>
        </h2>
    
    <time>
        May 24, 2024
    </time>
    <section class="content">
        <h1><span id="frida-java层自吐加密算法">Frida java层自吐加密算法</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://kuizuo.cn/docs/frida-java-encryption-algorithm/">愧怍</a> 并作补充</p>
</blockquote>
<h2><span id="代码">代码</span></h2><blockquote>
<p>针对 java 层加密算法，能 hook 到 java 自带的加密函数库</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  <span class="attr">showStacks</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">showDivider</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// console.log(&#x27;frida 已启动&#x27;);</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">showStacks</span>(<span class="params">name = <span class="string">&#x27;&#x27;</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (config.<span class="property">showStacks</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;android.util.Log&#x27;</span>).<span class="title function_">getStackTraceString</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.lang.Throwable&#x27;</span>).$new(name)))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">showDivider</span>(<span class="params">name = <span class="string">&#x27;&#x27;</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (config.<span class="property">showDivider</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`==============================<span class="subst">$&#123;name&#125;</span>==============================`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">showArguments</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;arguments: &#x27;</span>, ...<span class="variable language_">arguments</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">ByteString</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;com.android.okhttp.okio.ByteString&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Encode</span> = &#123;</span><br><span class="line">    <span class="title function_">toBase64</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(tag + <span class="string">&#x27; Base64: &#x27;</span>, <span class="title class_">ByteString</span>.<span class="title function_">of</span>(data).<span class="title function_">base64</span>())</span><br><span class="line">      <span class="comment">// console.log(tag + &#x27; Base64: &#x27;, bytesToBase64(data));</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">toHex</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(tag + <span class="string">&#x27; Hex: &#x27;</span>, <span class="title class_">ByteString</span>.<span class="title function_">of</span>(data).<span class="title function_">hex</span>())</span><br><span class="line">      <span class="comment">// console.log(tag + &#x27; Hex: &#x27;, bytesToHex(data));</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">toUtf8</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(tag + <span class="string">&#x27; Utf8: &#x27;</span>, <span class="title class_">ByteString</span>.<span class="title function_">of</span>(data).<span class="title function_">utf8</span>())</span><br><span class="line">      <span class="comment">// console.log(tag + &#x27; Utf8: &#x27;, bytesToString(data));</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">toAll</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">      <span class="title class_">Encode</span>.<span class="title function_">toUtf8</span>(tag, data)</span><br><span class="line">      <span class="title class_">Encode</span>.<span class="title function_">toHex</span>(tag, data)</span><br><span class="line">      <span class="title class_">Encode</span>.<span class="title function_">toBase64</span>(tag, data)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">toResult</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">      <span class="title class_">Encode</span>.<span class="title function_">toHex</span>(tag, data)</span><br><span class="line">      <span class="title class_">Encode</span>.<span class="title function_">toBase64</span>(tag, data)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">MessageDigest</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="params"><span class="string">&#x27;java.security.MessageDigest&#x27;</span></span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">let</span> overloads_update = <span class="title class_">MessageDigest</span>.<span class="property">update</span>.<span class="property">overloads</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_update) &#123;</span><br><span class="line">      overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">        <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">        <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">update</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> overloads_digest = <span class="title class_">MessageDigest</span>.<span class="property">digest</span>.<span class="property">overloads</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_digest) &#123;</span><br><span class="line">      overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">        <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">        <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">        <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="title function_">digest</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">3</span>) &#123;</span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toResult</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> digest result`</span>, result)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Mac</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="params"><span class="string">&#x27;javax.crypto.Mac&#x27;</span></span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="title class_">Mac</span>.<span class="property">init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.security.Key&#x27;</span>, <span class="string">&#x27;java.security.spec.AlgorithmParameterSpec&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">key, AlgorithmParameterSpec</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">init</span>(key, <span class="title class_">AlgorithmParameterSpec</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">Mac</span>.<span class="property">init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.security.Key&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">key</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">      <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">      <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">      <span class="keyword">const</span> keyBytes = key.<span class="title function_">getEncoded</span>()</span><br><span class="line">      <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> init Key`</span>, keyBytes)</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">init</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// let overloads_update = Mac.update.overloads;</span></span><br><span class="line">    <span class="comment">// for (const overload of overloads_update) &#123;</span></span><br><span class="line">    <span class="comment">//   overload.implementation = function () &#123;</span></span><br><span class="line">    <span class="comment">//     const algorithm = this.getAlgorithm();</span></span><br><span class="line">    <span class="comment">//     showDivider(algorithm);</span></span><br><span class="line">    <span class="comment">//     showStacks(algorithm);</span></span><br><span class="line">    <span class="comment">//     Encode.toAll(`$&#123;algorithm&#125; update data`, arguments[0]);</span></span><br><span class="line">    <span class="comment">//     return this.update(...arguments);</span></span><br><span class="line">    <span class="comment">//   &#125;;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> overloads_doFinal = <span class="title class_">Mac</span>.<span class="property">doFinal</span>.<span class="property">overloads</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_doFinal) &#123;</span><br><span class="line">      overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">        <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">        <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">        <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="title function_">doFinal</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">3</span>) &#123;</span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toResult</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> doFinal result`</span>, result)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Cipher</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="params"><span class="string">&#x27;javax.crypto.Cipher&#x27;</span></span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">let</span> overloads_init = <span class="title class_">Cipher</span>.<span class="property">init</span>.<span class="property">overloads</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_init) &#123;</span><br><span class="line">      overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">        <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">        <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">arguments</span>[<span class="number">0</span>]) &#123;</span><br><span class="line">          <span class="keyword">const</span> mode = <span class="variable language_">arguments</span>[<span class="number">0</span>]</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> init mode`</span>, mode)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">arguments</span>[<span class="number">1</span>]) &#123;</span><br><span class="line">          <span class="keyword">const</span> className = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">arguments</span>[<span class="number">1</span>])</span><br><span class="line">          <span class="comment">// 安卓10以上私钥是有可能输出不了的</span></span><br><span class="line">          <span class="keyword">if</span> (className.<span class="title function_">includes</span>(<span class="string">&#x27;OpenSSLRSAPrivateKey&#x27;</span>)) &#123;</span><br><span class="line">            <span class="comment">// const keyBytes = arguments[1];</span></span><br><span class="line">            <span class="comment">// console.log(`$&#123;algorithm&#125; init key`, keyBytes);</span></span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> keyBytes = <span class="variable language_">arguments</span>[<span class="number">1</span>].<span class="title function_">getEncoded</span>()</span><br><span class="line">            <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> init key`</span>, keyBytes)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">arguments</span>[<span class="number">2</span>]) &#123;</span><br><span class="line">          <span class="keyword">const</span> className = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">arguments</span>[<span class="number">2</span>])</span><br><span class="line">          <span class="keyword">if</span> (className.<span class="title function_">includes</span>(<span class="string">&#x27;javax.crypto.spec.IvParameterSpec&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">const</span> iv = <span class="title class_">Java</span>.<span class="title function_">cast</span>(<span class="variable language_">arguments</span>[<span class="number">2</span>], <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;javax.crypto.spec.IvParameterSpec&#x27;</span>))</span><br><span class="line">            <span class="keyword">const</span> ivBytes = iv.<span class="title function_">getIV</span>()</span><br><span class="line">            <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> init iv`</span>, ivBytes)</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (className.<span class="title function_">includes</span>(<span class="string">&#x27;java.security.SecureRandom&#x27;</span>)) &#123;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">init</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// let overloads_update = Cipher.update.overloads;</span></span><br><span class="line">    <span class="comment">// for (const overload of overloads_update) &#123;</span></span><br><span class="line">    <span class="comment">//   overload.implementation = function () &#123;</span></span><br><span class="line">    <span class="comment">//     const algorithm = this.getAlgorithm();</span></span><br><span class="line">    <span class="comment">//     showDivider(algorithm);</span></span><br><span class="line">    <span class="comment">//     showStacks(algorithm);</span></span><br><span class="line">    <span class="comment">//     Encode.toAll(`$&#123;algorithm&#125; update data`, arguments[0]);</span></span><br><span class="line">    <span class="comment">//     return this.update(...arguments);</span></span><br><span class="line">    <span class="comment">//   &#125;;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> overloads_doFinal = <span class="title class_">Cipher</span>.<span class="property">doFinal</span>.<span class="property">overloads</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_doFinal) &#123;</span><br><span class="line">      overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">        <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">        <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">        <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="title function_">doFinal</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">3</span>) &#123;</span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toResult</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> doFinal result`</span>, result)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Signature</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="params"><span class="string">&#x27;java.security.Signature&#x27;</span></span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">let</span> overloads_update = <span class="title class_">Signature</span>.<span class="property">update</span>.<span class="property">overloads</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_update) &#123;</span><br><span class="line">      overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">        <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">        <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">update</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> overloads_sign = <span class="title class_">Signature</span>.<span class="property">sign</span>.<span class="property">overloads</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_sign) &#123;</span><br><span class="line">      overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">        <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">        <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">        <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="title function_">sign</span>()</span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toResult</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> sign result`</span>, result)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">sign</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Exploit/" rel="tag">Exploit</a><a class="tag-none-link" href="/tags/Frida/" rel="tag">Frida</a><a class="tag-none-link" href="/tags/Hook/" rel="tag">Hook</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/05/21/CVE-2020-12440-Nginx/">
                （CVE-2020-12440）Nginx \&lt;= 1.8.0 请求走私
            </a>
        </h2>
    
    <time>
        May 21, 2024
    </time>
    <section class="content">
        <h1><span id="cve-2020-12440nginx-ltx3d-180-请求走私">（CVE-2020-12440）Nginx &lt;&#x3D; 1.8.0 请求走私</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://wiki.96.mk/Web%E5%AE%89%E5%85%A8/Nginx/%EF%BC%88CVE-2020-12440%EF%BC%89Nginx%20%3C%3D%201.8.0%20%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/">nosafer</a> 并作补充</p>
</blockquote>
<h2><span id="一-漏洞简介">一、漏洞简介</span></h2><blockquote>
<p>Nginx 1.18.0及之前版本中存在安全漏洞。攻击者可利用该漏洞进行缓存投毒，劫持凭证或绕过安全保护。</p>
</blockquote>
<h2><span id="二-漏洞影响">二、漏洞影响</span></h2><blockquote>
<p>Nginx &lt;&#x3D; 1.8.0</p>
</blockquote>
<h2><span id="三-复现过程">三、复现过程</span></h2><blockquote>
<p><img src="/2024/05/21/CVE-2020-12440-Nginx/1.png" alt="image"></p>
</blockquote>
<h3><span id="request">Request</span></h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/test.html</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>www.0-sec.org</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>2</span><br><span class="line"></span><br><span class="line"><span class="language-http"><span class="keyword">GET</span> <span class="string">/poc.html</span> <span class="meta">HTTP/1.1</span></span></span><br><span class="line"><span class="language-http"><span class="attribute">Host</span><span class="punctuation">: </span>www.0-sec.org</span></span><br><span class="line"><span class="language-http"><span class="attribute">Content-Length</span><span class="punctuation">: </span>15</span></span><br></pre></td></tr></table></figure>

<h3><span id="response">Response</span></h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>nginx/1.18.0</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Fri, 01 May 2020 18:28:44 GMT</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>33</span><br><span class="line"><span class="attribute">Last-Modified</span><span class="punctuation">: </span>Thu, 30 Apr 2020 14:36:32 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"><span class="attribute">ETag</span><span class="punctuation">: </span>&quot;5eaae270-21&quot;</span><br><span class="line"><span class="attribute">Accept-Ranges</span><span class="punctuation">: </span>bytes</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="section">&lt;html&gt;</span><span class="section">&lt;h1&gt;</span><span class="attribute">Test</span> Page!&lt;/h1&gt;&lt;/html&gt;</span></span><br><span class="line"><span class="language-apache"><span class="attribute">HTTP</span>/<span class="number">1</span>.<span class="number">1</span> <span class="number">200</span> OK</span></span><br><span class="line"><span class="language-apache"><span class="attribute">Server</span>: nginx/<span class="number">1</span>.<span class="number">18</span>.<span class="number">0</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">Date</span>: Fri, <span class="number">01</span> May <span class="number">2020</span> <span class="number">18</span>:<span class="number">28</span>:<span class="number">44</span> GMT</span></span><br><span class="line"><span class="language-apache"><span class="attribute">Content</span>-Type: text/html</span></span><br><span class="line"><span class="language-apache"><span class="attribute">Content</span>-Length: <span class="number">15</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">Last</span>-Modified: Thu, <span class="number">30</span> Apr <span class="number">2020</span> <span class="number">14</span>:<span class="number">35</span>:<span class="number">41</span> GMT</span></span><br><span class="line"><span class="language-apache"><span class="attribute">Connection</span>: keep-alive</span></span><br><span class="line"><span class="language-apache"><span class="attribute">ETag</span>: <span class="string">&quot;5eaae23d-f&quot;</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">Accept</span>-Ranges: bytes</span></span><br><span class="line"><span class="language-apache"></span></span><br><span class="line"><span class="language-apache"><span class="attribute">NGINX</span> PoC File</span></span><br></pre></td></tr></table></figure>



<h2><span id="其他例子">其他例子</span></h2><h3><span id="request200-ok-405-method-not-allowed">Request（200 OK + 405 Method Not Allowed）</span></h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>www.0-sec.org</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>4</span><br><span class="line">Transfer-Encoding : chunked</span><br><span class="line"></span><br><span class="line"><span class="language-apache"></span></span><br><span class="line"><span class="language-apache"><span class="attribute">46</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">TRACE</span> / HTTP/<span class="number">1</span>.<span class="number">1</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">Host</span>:www.<span class="number">0</span>-sec.org</span></span><br><span class="line"><span class="language-apache"><span class="attribute">Content</span>-Length:<span class="number">15</span></span></span><br><span class="line"><span class="language-apache"></span></span><br><span class="line"><span class="language-apache"></span></span><br><span class="line"><span class="language-apache"><span class="attribute">kk</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">0s</span></span></span><br></pre></td></tr></table></figure>



<h3><span id="response200-ok-405-method-not-allowed">Response（200 OK + 405 Method Not Allowed）</span></h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>nginx/1.18.0</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Tue, 21 Apr 2020 16:28:12 GMT</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>612</span><br><span class="line"><span class="attribute">Last-Modified</span><span class="punctuation">: </span>Tue, 21 Apr 2020 16:08:59 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"><span class="attribute">ETag</span><span class="punctuation">: </span>&quot;5e9f1a9b-264&quot;</span><br><span class="line"><span class="attribute">Accept-Ranges</span><span class="punctuation">: </span>bytes</span><br><span class="line"></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="selector-tag">body</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">width</span>: <span class="number">35em</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">margin</span>: <span class="number">0</span> auto;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">font-family</span>: Tahoma, Verdana, Arial, sans-serif;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>If you see this page, the nginx web server is successfully installed and</span></span><br><span class="line"><span class="language-xml">working. Further configuration is required.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>For online documentation and support please refer to</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://nginx.org/&quot;</span>&gt;</span>nginx.org<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">Commercial support is available at</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://nginx.com/&quot;</span>&gt;</span>nginx.com<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>Thank you for using nginx.<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">HTTP/1.1 405 Not Allowed</span></span><br><span class="line"><span class="language-xml">Server: nginx/1.18.0</span></span><br><span class="line"><span class="language-xml">Date: Tue, 21 Apr 2020 16:28:12 GMT</span></span><br><span class="line"><span class="language-xml">Content-Type: text/html</span></span><br><span class="line"><span class="language-xml">Content-Length: 157</span></span><br><span class="line"><span class="language-xml">Connection: close</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>405 Not Allowed<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>405 Not Allowed<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">hr</span>&gt;</span><span class="tag">&lt;<span class="name">center</span>&gt;</span>nginx/1.18.0<span class="tag">&lt;/<span class="name">center</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>



<h3><span id="request200-ok-404-not-found">Request（200 OK + 404 Not Found）</span></h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>www.0-sec.org</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>4</span><br><span class="line">Transfer-Encoding : chunked</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">46</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">GET</span> /<span class="number">404</span> HTTP/<span class="number">1</span>.<span class="number">1</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">Host</span>:www.<span class="number">0</span>-sec.org</span></span><br><span class="line"><span class="language-apache"><span class="attribute">Content</span>-Length:<span class="number">15</span></span></span><br><span class="line"><span class="language-apache"></span></span><br><span class="line"><span class="language-apache"><span class="attribute">kk</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">0s</span></span></span><br></pre></td></tr></table></figure>



<h3><span id="response200-ok-404-not-found">Response（200 OK + 404 Not Found）</span></h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>nginx/1.18.0</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Tue, 21 Apr 2020 16:23:52 GMT</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>612</span><br><span class="line"><span class="attribute">Last-Modified</span><span class="punctuation">: </span>Tue, 21 Apr 2020 16:08:59 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"><span class="attribute">ETag</span><span class="punctuation">: </span>&quot;5e9f1a9b-264&quot;</span><br><span class="line"><span class="attribute">Accept-Ranges</span><span class="punctuation">: </span>bytes</span><br><span class="line"></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    <span class="selector-tag">body</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">width</span>: <span class="number">35em</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">margin</span>: <span class="number">0</span> auto;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">        <span class="attribute">font-family</span>: Tahoma, Verdana, Arial, sans-serif;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to nginx!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>If you see this page, the nginx web server is successfully installed and</span></span><br><span class="line"><span class="language-xml">working. Further configuration is required.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>For online documentation and support please refer to</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://nginx.org/&quot;</span>&gt;</span>nginx.org<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">Commercial support is available at</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://nginx.com/&quot;</span>&gt;</span>nginx.com<span class="tag">&lt;/<span class="name">a</span>&gt;</span>.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>Thank you for using nginx.<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">HTTP/1.1 404 Not Found</span></span><br><span class="line"><span class="language-xml">Server: nginx/1.18.0</span></span><br><span class="line"><span class="language-xml">Date: Tue, 21 Apr 2020 16:23:52 GMT</span></span><br><span class="line"><span class="language-xml">Content-Type: text/html</span></span><br><span class="line"><span class="language-xml">Content-Length: 153</span></span><br><span class="line"><span class="language-xml">Connection: keep-alive</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>404 Not Found<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>404 Not Found<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">hr</span>&gt;</span><span class="tag">&lt;<span class="name">center</span>&gt;</span>nginx/1.18.0<span class="tag">&lt;/<span class="name">center</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>



        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Exploit/" rel="tag">Exploit</a><a class="tag-none-link" href="/tags/Nginx/" rel="tag">Nginx</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/05/21/JSFlash-BurpSuite/">
                BurpSuite作为代理，复用目标站点的js代码处理指定的内容
            </a>
        </h2>
    
    <time>
        May 21, 2024
    </time>
    <section class="content">
        <h1><span id="burpsuite作为代理复用目标站点的js代码处理指定的内容">BurpSuite作为代理，复用目标站点的js代码处理指定的内容</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://www.freebuf.com/sectool/247374.html">thinkoaa</a> 并作补充</p>
</blockquote>
<h2><span id="0x01-前言">0x01 前言</span></h2><blockquote>
<p>之前写了一个burp插件，直接使用目标站点的加密js来解决用intruder模块爆破时的payload加密问题</p>
<p>地址：<a target="_blank" rel="noopener" href="https://www.freebuf.com/sectool/242363.html">https://www.freebuf.com/sectool/242363.html</a></p>
<p>除了上面的情况外，有时还会遇到把burp当作代理，调用网站的js代码处理来自浏览器、sqlmap等工具的内容情况。</p>
<p>比如目标网站的参数调用了js加密算法，不管是手动访问也好，还是sqlmap注入也好，需要调用指定算法处理参数，用python或java重写算法的话呢，时间成本太高，有些算法还挺复杂……但，如果能够直接复用目标网站的js代码的话就太方便了。</p>
<p>因此，简单写了一个burp suite插件，专门解决上述问题：下载地址：<a target="_blank" rel="noopener" href="https://github.com/thinkoaa/JSFlash/">JSFlash</a></p>
<p>使用步骤是  可以参考我之前另一个插件的文章 <a target="_blank" rel="noopener" href="https://www.freebuf.com/sectool/242363.html">参考地址</a>：</p>
<ol>
<li>1.把目标站点的相关js代码放到本地js文件中，调试可用；</li>
<li>2.把JSFlash插件导入到Burp Suite中，在插件中加载指定的js文件并填写对应的参数；</li>
<li>3.抓包发repeater做测试，如果效果符合预期，则该插件会根据指定的规则，调用js代码，处理指定的内容。</li>
</ol>
<p>效果图：</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/1.png" alt="image"></p>
</blockquote>
<h2><span id="0x02-使用方法">0x02 使用方法</span></h2><h3><span id="1从目标站点复制修改或者手动写好js代码调试正确">1.从目标站点复制修改或者手动写好js代码，调试正确</span></h3><blockquote>
<p><img src="/2024/05/21/JSFlash-BurpSuite/2.png" alt="image"></p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/3.png" alt="image"></p>
<p>因为插件是通过java调用js，因此window、document等对象及方法，还有一些很新的js特性可能在浏览器中执行正确，但插件调用时会报错，因此插件会把可能产生的错误信息弹出显示，方便根据实际逻辑修改，根据我的经历来看，不管多复杂，只要耐心点，没有改不了的情况，如图：</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/4.png" alt="image"></p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/5.png" alt="image"></p>
<p>再举一个例：</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/6.png" alt="image"></p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/7.png" alt="image"></p>
</blockquote>
<h3><span id="2导入插件设置参数">2.导入插件，设置参数</span></h3><blockquote>
<p><img src="/2024/05/21/JSFlash-BurpSuite/8.png" alt="image"></p>
<p>2.1 设置url，一定要用burp的Copy URL菜单复制，不要手动填写，以免出错：</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/9.png" alt="image"></p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/10.png" alt="image"></p>
<p>2.2 设置处理指定内容的规则</p>
<p>GET方式:</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/11.png" alt="image"></p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/12.png" alt="image"></p>
<p>php代码如图：</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/13.png" alt="image"></p>
<p>处理结果：</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/14.png" alt="image"></p>
<p>POST方式：</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/15.png" alt="image"></p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/16.png" alt="image"></p>
<p>php代码如图：</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/17.png" alt="image"></p>
<p>结果如图：</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/18.png" alt="image"></p>
<p>一次调用多个方法，处理多个指定内容：</p>
<p>数据包：</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/19.png" alt="image"></p>
<p>规则：</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/20.png" alt="image"></p>
<p>php代码：</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/21.png" alt="image"></p>
<p>结果：</p>
<p><img src="/2024/05/21/JSFlash-BurpSuite/22.png" alt="image"></p>
</blockquote>
<h2><span id="0x03-总结">0x03 总结</span></h2><blockquote>
<p>这个插件用到的时候，需要具体情况具体分析，不过思路是这么个思路，目的就是复用js代码，提高工作效率。</p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/BurpSuite/" rel="tag">BurpSuite</a><a class="tag-none-link" href="/tags/Exploit/" rel="tag">Exploit</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/05/14/JS-Signature/">
                JS逆向-数据包解签名实战案例
            </a>
        </h2>
    
    <time>
        May 14, 2024
    </time>
    <section class="content">
        <h1><span id="js逆向-数据包解签名实战案例">JS逆向-数据包解签名实战案例</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/373757.html">ichi9o</a> 并作补充</p>
</blockquote>
<h2><span id="0x00-前言">0x00 前言</span></h2><blockquote>
<p>通常情况下，数据包中的签名字段会包含<strong>sign</strong>字符串，如<strong>sign</strong>、<strong>appsign</strong>等等，然后根据字段在JS代码中寻找签名的过程，并进行分析。<br>以下内容为一个真实案例，撒，哈气灭路！</p>
</blockquote>
<h2><span id="0x01-获取被签名数据">0x01 获取被签名数据</span></h2><blockquote>
<p>通过数据包可知该网站的签名字段是 <strong>sign</strong></p>
<p><img src="/2024/05/14/JS-Signature/1.png" alt="image"></p>
<p>在浏览器中的源代码搜索字段<strong>sign</strong>，找到签名代码<br>首当其冲的就是<strong>app.*.js</strong>样式的文件，在<strong>app.72b81572.js</strong>文件中发现了可疑点</p>
<p><img src="/2024/05/14/JS-Signature/2.png" alt="image"></p>
<p>分析 function k(e) 可知，是要对 r 参数进行签名的，r 又跟e、t、a、n 这几个参数相关，因此要搞清楚这几个参数的值是怎么来的，所有就在函数开始的第一行就下断点来跟进。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">k</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> t = <span class="title function_">g</span>()</span><br><span class="line">      , n = <span class="title function_">m</span>();</span><br><span class="line">    <span class="keyword">let</span> a;</span><br><span class="line">    a = e ? <span class="title function_">b</span>(e) : &#123;&#125;;</span><br><span class="line">    <span class="keyword">const</span> r = e ? <span class="string">`<span class="subst">$&#123;c.a.stringify(a.hasParams)&#125;</span>&amp;<span class="subst">$&#123;t&#125;</span>&amp;time=<span class="subst">$&#123;n&#125;</span>`</span> : <span class="string">`&amp;<span class="subst">$&#123;t&#125;</span>&amp;time=<span class="subst">$&#123;n&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">return</span> e = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, a.<span class="property">params</span>, &#123;</span><br><span class="line">        <span class="attr">sign</span>: <span class="title function_">h</span>()(<span class="built_in">decodeURIComponent</span>(r)),</span><br><span class="line">        <span class="attr">time</span>: n</span><br><span class="line">    &#125;),</span><br><span class="line">    e</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先是 t，跟进 g 函数，执行到 return 就可以发现 t &#x3D; 年 + “5616” + 月 + 日</p>
<p><img src="/2024/05/14/JS-Signature/3.png" alt="image"></p>
<p>然后就是 n，这个 e 的值呢，根据跟进可知是 cookie 里面的，不过这个 e 在本案例的作用不大，最后通过 return 就可以知道返回的值就是：当前时间戳- e</p>
<p><img src="/2024/05/14/JS-Signature/4.png" alt="image"></p>
<p>接下来就是 a，根据返回的结果可知 a 的值和 e 相同，通过分析数据包可知，e的内容即请求参数（GET）或请求体（POST）</p>
<p><img src="/2024/05/14/JS-Signature/5.png" alt="image"></p>
<p>然后 r 的值就出来了，也就是签名的明文</p>
<p><img src="/2024/05/14/JS-Signature/6.png" alt="image"></p>
<p>综上所述<br><strong>r &#x3D; 请求内容 + &amp; + t + &amp; + n</strong>（这里的请求内容需要注意的是，POST Data是Json格式的要转换为：key1&#x3D;value1&amp;key1&#x3D;value1…）<br>其中<br><strong>t &#x3D; 年 + “5616” + 月 + 日</strong><br><strong>n &#x3D; 当前时间戳</strong>（本案例可不减e也可成功）</p>
</blockquote>
<h2><span id="0x02-分析加密算法">0x02 分析加密算法</span></h2><blockquote>
<p>将断点打在签名代码行，跟进代码的执行，发现加密的类名是 Md5，所有可以计算 r 的 md5 值，与代码执行的 sign 结果进行比较。</p>
<p><img src="/2024/05/14/JS-Signature/7.png" alt="image"></p>
<p>可以看到，该网站使用的是 md5 计算的 sign</p>
<p><img src="/2024/05/14/JS-Signature/8.png" alt="image"></p>
</blockquote>
<h2><span id="0x03-编写-mitmproxy-脚本">0x03 编写 mitmproxy 脚本</span></h2><blockquote>
<p>mitmproxy 脚本是实时加载的，因此 mitmproxy 只要带着脚本运行，就可以边调试了。<br>mitmproxy 使用命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mitmdump -p 777 -s .\mitmscript.py --flow-detail 0</span><br></pre></td></tr></table></figure>

<p><img src="/2024/05/14/JS-Signature/9.png" alt="image"></p>
<p>关于脚本的编写这里给出以下 mitmproxy 的一些常用的属性和方法<strong>ctx：</strong></p>
<ul>
<li>ctx.log.info(): 用于在 mitmproxy 的日志中输出信息。</li>
<li>ctx.options: 用于访问 mitmproxy 的配置选项，您可以在配置文件中定义这些选项。</li>
<li>ctx.master: mitmproxy 的 Master 对象，提供了一些控制代理行为的方法。</li>
<li>ctx.proxy: mitmproxy 的 ProxyConfig 对象，提供了有关代理配置的信息。</li>
<li>ctx.client: mitmproxy 的 ClientConnection 对象，表示客户端连接的相关信息。</li>
<li>ctx.server: mitmproxy 的 ServerConnection 对象，表示服务器连接的相关信息。</li>
<li>ctx.protocol: mitmproxy 的 ProtocolHandler 对象，表示处理请求和响应的协议处理器。</li>
</ul>
<p>在 mitmproxy 脚本中，可以使用以下一些回调函数来处理不同阶段的 flow 对象：</p>
<ul>
<li>def request(flow: mitmproxy.http.HTTPFlow) -&gt; None: 当 mitmproxy 拦截到请求时调用此回调函数，可以获取和处理请求的各种信息。</li>
<li>def response(flow: mitmproxy.http.HTTPFlow) -&gt; None: 当 mitmproxy 拦截到响应时调用此回调函数，可以获取和处理响应的各种信息。</li>
<li>def error(flow: mitmproxy.http.HTTPFlow) -&gt; None: 当请求或响应出现错误时调用此回调函数，可以获取和处理错误信息。</li>
<li>def clientconnect(flow: mitmproxy.tcp.TCPFlow) -&gt; None: 当客户端连接到 mitmproxy 时调用此回调函数，可以获取和处理客户端连接的相关信息。</li>
<li>def serverconnect(flow: mitmproxy.tcp.TCPFlow) -&gt; None: 当 mitmproxy 连接到服务器时调用此回调函数，可以获取和处理服务器连接的相关信息。</li>
<li>flow.request.method: 获取请求的方法（GET、POST等）。</li>
<li>flow.request.scheme: 获取请求的协议（http 或 https）。</li>
<li>flow.request.host: 获取请求的主机名。</li>
<li>flow.request.port: 获取请求的端口号。</li>
<li>flow.request.path: 获取请求的路径部分。</li>
<li>flow.request.url: 获取完整的请求URL。</li>
<li>flow.request.headers: 获取请求的头部信息，是一个字典对象，可以通过键来访问特定的头部字段。</li>
<li>flow.request.cookies: 获取请求中的Cookie信息，是一个字典对象，可以通过键来访问特定的Cookie。</li>
<li>flow.request.query: 获取请求的查询参数，是一个字典对象，可以通过键来访问特定的查询参数。</li>
<li>flow.request.content: 获取请求的内容，如果请求是POST请求且带有内容，则可以通过该属性来访问请求的内容。</li>
<li>flow.request.text: 获取请求的内容，并以文本形式返回。</li>
<li>flow.request.urlencoded_form: 获取请求的URL编码表单数据，是一个字典对象，可以通过键来访问特定的表单字段。</li>
<li>flow.request.multipart_form: 获取请求的多部分表单数据，是一个列表对象，列表中的每个元素都是一个字典，表示一个表单字段。</li>
<li>flow.request.content: 获取请求的原始内容，以字节形式返回。</li>
</ul>
<p>附上本案例的代码供参考</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> mitmproxy <span class="keyword">import</span> ctx</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Modify</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.plaintext = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        self.new_sign = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        current_datetime = datetime.now()</span><br><span class="line">        self.today = <span class="string">f&quot;<span class="subst">&#123;current_datetime.year&#125;</span>5616<span class="subst">&#123;current_datetime.month:02d&#125;</span><span class="subst">&#123;current_datetime.day:02d&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">md5</span>(<span class="params">self</span>):</span><br><span class="line">        md5_hash = hashlib.md5()</span><br><span class="line">        md5_hash.update(self.plaintext.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        self.new_sign = md5_hash.hexdigest()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self, flow</span>):</span><br><span class="line">        <span class="keyword">if</span> flow.request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">            ctx.log.info(<span class="string">f&#x27;\n原POST请求体：<span class="subst">&#123;flow.request.text&#125;</span>&#x27;</span>)</span><br><span class="line">            data = json.loads(flow.request.get_text())</span><br><span class="line">            <span class="keyword">if</span> data != <span class="string">&#x27;&#123;&#125;&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;sign&#x27;</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">del</span> data[<span class="string">&#x27;sign&#x27;</span>]</span><br><span class="line">                <span class="keyword">del</span> data[<span class="string">&#x27;time&#x27;</span>]</span><br><span class="line">                <span class="keyword">for</span> k <span class="keyword">in</span> data:</span><br><span class="line">                    self.plaintext += <span class="string">f&quot;<span class="subst">&#123;k&#125;</span>=<span class="subst">&#123;<span class="built_in">str</span>(data[k])&#125;</span>&amp;&quot;</span></span><br><span class="line">                timestamp = <span class="built_in">int</span>(time.time() * <span class="number">1000</span>)</span><br><span class="line">                self.plaintext += <span class="string">f&quot;<span class="subst">&#123;self.today&#125;</span>&amp;time=<span class="subst">&#123;timestamp&#125;</span>&quot;</span></span><br><span class="line">                self.md5()</span><br><span class="line"></span><br><span class="line">                data[<span class="string">&quot;sign&quot;</span>] = self.new_sign</span><br><span class="line">                data[<span class="string">&quot;time&quot;</span>] = timestamp</span><br><span class="line">                flow.request.set_text(json.dumps(data).replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>))</span><br><span class="line">                ctx.log.info(<span class="string">f&#x27;\n新POST请求体：<span class="subst">&#123;flow.request.text&#125;</span>&#x27;</span>)</span><br><span class="line">                self.plaintext = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                ctx.log.info(<span class="string">&#x27;无参数，无需改签&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> flow.request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">            ctx.log.info(<span class="string">f&#x27;\n原GET请求体：<span class="subst">&#123;flow.request.query&#125;</span>&#x27;</span>)</span><br><span class="line">            query = flow.request.query</span><br><span class="line">            <span class="keyword">if</span> query != <span class="string">&#x27;&#123;&#125;&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;sign&#x27;</span> <span class="keyword">in</span> query:</span><br><span class="line">                <span class="keyword">del</span> query[<span class="string">&#x27;sign&#x27;</span>]</span><br><span class="line">                <span class="keyword">del</span> query[<span class="string">&#x27;time&#x27;</span>]</span><br><span class="line">                <span class="keyword">if</span> query:</span><br><span class="line">                    <span class="keyword">for</span> k <span class="keyword">in</span> query:</span><br><span class="line">                        self.plaintext += <span class="string">f&quot;<span class="subst">&#123;k&#125;</span>=<span class="subst">&#123;<span class="built_in">str</span>(query[k])&#125;</span>&amp;&quot;</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self.plaintext = <span class="string">&quot;&amp;&quot;</span></span><br><span class="line">                timestamp = <span class="built_in">int</span>(time.time()) * <span class="number">1000</span></span><br><span class="line">                self.plaintext += <span class="string">f&quot;<span class="subst">&#123;self.today&#125;</span>&amp;time=<span class="subst">&#123;timestamp&#125;</span>&quot;</span></span><br><span class="line">                self.md5()</span><br><span class="line"></span><br><span class="line">                query[<span class="string">&quot;sign&quot;</span>] = self.new_sign</span><br><span class="line">                query[<span class="string">&quot;time&quot;</span>] = timestamp</span><br><span class="line">                ctx.log.info(<span class="string">f&#x27;\n新GET请求体：<span class="subst">&#123;flow.request.query&#125;</span>&#x27;</span>)</span><br><span class="line">                self.plaintext = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                ctx.log.info(<span class="string">&#x27;无参数，无需改签&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">response</span>(<span class="params">flow</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;签名校验失败!&#x27;</span> <span class="keyword">in</span> flow.response.text:</span><br><span class="line">            ctx.log.error(<span class="string">f&#x27;\n签名异常：\nurl =&gt; <span class="subst">&#123;flow.request.path&#125;</span>\n异常信息 =&gt; <span class="subst">&#123;flow.response.text&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">addons = [</span><br><span class="line">    Modify()</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Exploit/" rel="tag">Exploit</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a><a class="tag-none-link" href="/tags/Signature/" rel="tag">Signature</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/03/06/nRF-Connect-Replay/">
                【nRF Connect】事件记录及录播和重演
            </a>
        </h2>
    
    <time>
        Mar 6, 2024
    </time>
    <section class="content">
        <h1><span id="nrf-connect事件记录及录播和重演">【nRF Connect】事件记录及录播和重演</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43352285/article/details/124550750">强人电子</a> 并作补充</p>
</blockquote>
<h2><span id="1-前言">1. 前言</span></h2><blockquote>
<p>nRF Connect支持缓存事件记录以及录播和重演，接下来我们看看这到底是个怎样的功能。</p>
</blockquote>
<h2><span id="2-事件记录">2. 事件记录</span></h2><blockquote>
<p>在连接上设备后，向左滑动可以切换到事件记录页面，同时支持多种LOG格式，如下图中连接上后执行了一次读取电量的操作：</p>
<p><img src="/2024/03/06/nRF-Connect-Replay/1.png" alt="image"></p>
<p><img src="/2024/03/06/nRF-Connect-Replay/2.png" alt="image"></p>
<p>LOG记录支持复制、保存为文件、分享和清除：</p>
<p><img src="/2024/03/06/nRF-Connect-Replay/3.png" alt="image"></p>
</blockquote>
<h2><span id="3-事件录播和重演">3. 事件录播和重演</span></h2><blockquote>
<p>nRF Connect支持事件的录播和重演，实质上就是在上一节记录的基础上，从某个时间点开始截取然后保存，录播是根据刚刚保存的记录对蓝牙设备进行一模一样的指令及数据操作。</p>
<p>在已连接界面中，点击右下角的红色部分：</p>
<p><img src="/2024/03/06/nRF-Connect-Replay/4.png" alt="image"></p>
<p>会弹出三个图标，分别表示：</p>
<ol>
<li>新建文件夹（用于存放后续的录播文件）</li>
<li>导入录播文件（导入其他地方的录播文件，本机录播的会默认显示在文件列表里，不需要导入）</li>
<li>开始录播</li>
</ol>
<p><img src="/2024/03/06/nRF-Connect-Replay/5.png" alt="image"></p>
</blockquote>
<h3><span id="31-事件录播">3.1 事件录播</span></h3><blockquote>
<ol>
<li>创建一个“da bai”文件夹</li>
</ol>
<p><img src="/2024/03/06/nRF-Connect-Replay/6.png" alt="image"></p>
<p><img src="/2024/03/06/nRF-Connect-Replay/7.png" alt="image"></p>
<ol start="2">
<li>点击第三个图标开始录播</li>
</ol>
<p><img src="/2024/03/06/nRF-Connect-Replay/8.png" alt="image"></p>
<ol start="3">
<li>开始录播后，可以发起通信事件<br>顺序为：开始录播 &#x3D;&gt; 读取电量 &#x3D;&gt; 读取厂商信息 &#x3D;&gt; 读取硬件版本号 &#x3D;&gt; 读取软件版本号 &#x3D;&gt; 结束录播</li>
</ol>
<p>可以看到LOG记录是这样的：</p>
<p><img src="/2024/03/06/nRF-Connect-Replay/9.png" alt="image"></p>
<p>命名录播文件为”read info”以及将其移动到”da bai”文件夹下：</p>
<p><img src="/2024/03/06/nRF-Connect-Replay/10.png" alt="image"></p>
<p><img src="/2024/03/06/nRF-Connect-Replay/11.png" alt="image"></p>
</blockquote>
<h3><span id="32-事件重演">3.2 事件重演</span></h3><blockquote>
<p>录播文件保存下来后，可以对其进行重演，相当于执行一遍刚刚录播的操作：</p>
<p><img src="/2024/03/06/nRF-Connect-Replay/12.png" alt="image"></p>
<p>重演录播后，我们再去看看事件记录，确实再一次操作了录播的内容，时间间隔竟然也是一样的：</p>
<p><img src="/2024/03/06/nRF-Connect-Replay/13.png" alt="image"></p>
</blockquote>
<h3><span id="33-事件录播文件操作">3.3 事件录播文件操作</span></h3><blockquote>
<p>录播文件支持这些操作：</p>
<ol>
<li>Export to XML</li>
<li>Rename</li>
<li>Move</li>
<li>Mirror</li>
</ol>
<p><img src="/2024/03/06/nRF-Connect-Replay/14.png" alt="image"></p>
<p>这里重点聊聊 Export to XML 和 Mirror。</p>
</blockquote>
<h4><span id="331-export-to-xml">3.3.1 Export to XML</span></h4><blockquote>
<p>支持将录播文件导出为XML文件可以分享给他人使用，导出之后是这样的：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">macro</span> <span class="attr">name</span>=<span class="string">&quot;read info&quot;</span> <span class="attr">icon</span>=<span class="string">&quot;PLAY&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">assert-service</span> <span class="attr">description</span>=<span class="string">&quot;Ensure Battery Service&quot;</span> <span class="attr">uuid</span>=<span class="string">&quot;0000180f-0000-1000-8000-00805f9b34fb&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">assert-characteristic</span> <span class="attr">description</span>=<span class="string">&quot;Ensure Battery Level&quot;</span> <span class="attr">uuid</span>=<span class="string">&quot;00002a19-0000-1000-8000-00805f9b34fb&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;READ&quot;</span> <span class="attr">requirement</span>=<span class="string">&quot;MANDATORY&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">assert-characteristic</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">assert-service</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">assert-service</span> <span class="attr">description</span>=<span class="string">&quot;Ensure Device Information&quot;</span> <span class="attr">uuid</span>=<span class="string">&quot;0000180a-0000-1000-8000-00805f9b34fb&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">assert-characteristic</span> <span class="attr">description</span>=<span class="string">&quot;Ensure Manufacturer Name String&quot;</span> <span class="attr">uuid</span>=<span class="string">&quot;00002a29-0000-1000-8000-00805f9b34fb&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;READ&quot;</span> <span class="attr">requirement</span>=<span class="string">&quot;MANDATORY&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">assert-characteristic</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">assert-characteristic</span> <span class="attr">description</span>=<span class="string">&quot;Ensure Hardware Revision String&quot;</span> <span class="attr">uuid</span>=<span class="string">&quot;00002a27-0000-1000-8000-00805f9b34fb&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;READ&quot;</span> <span class="attr">requirement</span>=<span class="string">&quot;MANDATORY&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">assert-characteristic</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">assert-characteristic</span> <span class="attr">description</span>=<span class="string">&quot;Ensure Software Revision String&quot;</span> <span class="attr">uuid</span>=<span class="string">&quot;00002a28-0000-1000-8000-00805f9b34fb&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;READ&quot;</span> <span class="attr">requirement</span>=<span class="string">&quot;MANDATORY&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">assert-characteristic</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">assert-service</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">read</span> <span class="attr">description</span>=<span class="string">&quot;Read value of Battery Level&quot;</span> <span class="attr">characteristic-uuid</span>=<span class="string">&quot;00002a19-0000-1000-8000-00805f9b34fb&quot;</span> <span class="attr">service-uuid</span>=<span class="string">&quot;0000180f-0000-1000-8000-00805f9b34fb&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">assert-value</span> <span class="attr">description</span>=<span class="string">&quot;Assert value equals <span class="symbol">&amp;apos;</span>d<span class="symbol">&amp;apos;</span>&quot;</span> <span class="attr">value-string</span>=<span class="string">&quot;d&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">read</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">read</span> <span class="attr">description</span>=<span class="string">&quot;Read value of Manufacturer Name String&quot;</span> <span class="attr">characteristic-uuid</span>=<span class="string">&quot;00002a29-0000-1000-8000-00805f9b34fb&quot;</span> <span class="attr">service-uuid</span>=<span class="string">&quot;0000180a-0000-1000-8000-00805f9b34fb&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">assert-value</span> <span class="attr">description</span>=<span class="string">&quot;Assert value equals <span class="symbol">&amp;apos;</span>YFTech<span class="symbol">&amp;apos;</span>&quot;</span> <span class="attr">value-string</span>=<span class="string">&quot;YFTech&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">read</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">read</span> <span class="attr">description</span>=<span class="string">&quot;Read value of Hardware Revision String&quot;</span> <span class="attr">characteristic-uuid</span>=<span class="string">&quot;00002a27-0000-1000-8000-00805f9b34fb&quot;</span> <span class="attr">service-uuid</span>=<span class="string">&quot;0000180a-0000-1000-8000-00805f9b34fb&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">assert-value</span> <span class="attr">description</span>=<span class="string">&quot;Assert value equals <span class="symbol">&amp;apos;</span>UVWbejJZpqrsPtwuvxy<span class="symbol">&amp;apos;</span>&quot;</span> <span class="attr">value-string</span>=<span class="string">&quot;UVWbejJZpqrsPtwuvxy&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">read</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">read</span> <span class="attr">description</span>=<span class="string">&quot;Read value of Software Revision String&quot;</span> <span class="attr">characteristic-uuid</span>=<span class="string">&quot;00002a28-0000-1000-8000-00805f9b34fb&quot;</span> <span class="attr">service-uuid</span>=<span class="string">&quot;0000180a-0000-1000-8000-00805f9b34fb&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">assert-value</span> <span class="attr">description</span>=<span class="string">&quot;Assert value equals <span class="symbol">&amp;apos;</span>V 2.66.0329<span class="symbol">&amp;apos;</span>&quot;</span> <span class="attr">value-string</span>=<span class="string">&quot;V 2.66.0329&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">read</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">macro</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h4><span id="332-录播文件导入">3.3.2 录播文件导入</span></h4><blockquote>
<p>导入之后自动重命名为read info 2。</p>
<p><img src="/2024/03/06/nRF-Connect-Replay/15.png" alt="image"></p>
</blockquote>
<h4><span id="333-mirror">3.3.3 Mirror</span></h4><blockquote>
<p>这里的镜像指的是角色镜像，比如录播文件里面你是中央设备，镜像之后你就变成了外围设备。这里必须注意当你是外围设备的时候，需要将<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=GATT&spm=1001.2101.3001.7020">GATT</a> SERVICE配置成录播文件的一样的配置，具体配置方法可以参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43352285/article/details/124529159">GATT SERVICE配置</a>，建议使用克隆方式。</p>
</blockquote>
<h2><span id="4-写在最后">4. 写在最后</span></h2><blockquote>
<p>在BLE开发中，同样的测试内容通常不止操作一次，此时我们可以用上本章的内容，事半功倍！</p>
<p>看完本文觉得有帮助点赞鼓励鼓励吧~如果有问题可以在评论区留言，大白会用光的速度回复您。想了解关于nRF Connect的更多用法及使用技巧，可以关注<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43352285/category_11793765.html">nRF Connect 专栏</a>。</p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/BlueTooth/" rel="tag">BlueTooth</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a><a class="tag-none-link" href="/tags/nRF-Connect/" rel="tag">nRF Connect</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/03/06/BtleJuice-BLE-Bulbs/">
                技术分享 | 如何使用BtleJuice黑入BLE智能电灯泡
            </a>
        </h2>
    
    <time>
        Mar 6, 2024
    </time>
    <section class="content">
        <h1><span id="技术分享-如何使用btlejuice黑入ble智能电灯泡">技术分享 | 如何使用BtleJuice黑入BLE智能电灯泡</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/wireless/180716.html">seclst</a> 并作补充</p>
</blockquote>
<h2><span id="前言">前言</span></h2><blockquote>
<p><strong>在这篇文章中，我们将讨论如何使用BtleJuice通过执行中间人（MiTM）攻击来利用一个蓝牙低能耗（BLE）智能灯泡。本文中探讨的技术，也同样适用于其他基于BLE的智能设备。</strong></p>
<p><img src="/2024/03/06/BtleJuice-BLE-Bulbs/1.png" alt="image"></p>
</blockquote>
<h2><span id="概述">概述</span></h2><blockquote>
<p>本文的主要内容包括：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">安装BtleJuice；</span><br><span class="line"></span><br><span class="line">分析在目标设备上运行的所有截获的GATT操作；</span><br><span class="line"></span><br><span class="line">使用GATT操作执行Man-in-the-middle（中间人）攻击；</span><br><span class="line"></span><br><span class="line">将数据导出到文件。</span><br></pre></td></tr></table></figure>

<p><strong>以下是一些必须满足的基本硬软件要求：</strong></p>
</blockquote>
<h3><span id="硬件">硬件</span></h3><blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">基于BLE的物联网智能灯泡</span><br><span class="line"></span><br><span class="line">两个蓝牙适配器</span><br></pre></td></tr></table></figure>
</blockquote>
<h3><span id="软件">软件</span></h3><blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Node.js &gt; 4.3.2</span><br><span class="line"></span><br><span class="line">虚拟机（VMware/Virtual Box）</span><br><span class="line"></span><br><span class="line">BtleJuice</span><br></pre></td></tr></table></figure>
</blockquote>
<h2><span id="安装-btlejuice">安装 BtleJuice</span></h2><blockquote>
<p>BtleJuice是执行蓝牙智能设备的中间人攻击（也被称为蓝牙低能量）的完整框架。BtleJuice由两个组件组成 - 拦截代理和核心。这两个组件需要在两个系统上单独运行，每个系统都连接了蓝牙4.0+适配器。我们将使用一台物理机器和另一台运行在同一主机上的虚拟机（VM）。</p>
<p><strong>注意：</strong>不是使用两台独立的物理机器。其中一个适配器将连接到主机，另一个适配器连接到VM。下面，我们按照以下步骤在主机和VM上来安装BtleJuice。</p>
<p><strong>Step 1：</strong>Btlejuice需要一个相当新版本的node(&gt;&#x3D;4.3.2) 和npm。你可以按照<a target="_blank" rel="noopener" href="https://yoember.com/nodejs/the-best-way-to-install-node-js/">本指南</a>使用nvm（Node 版本管理器）来进行安装。</p>
<p><strong>Step 2：</strong>使用包管理器安装BtleJuice的依赖项：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install bluetooth bluez pbbluetooth-dev pbudev-dev</span><br></pre></td></tr></table></figure>

<p><strong>Step 3：</strong>安装 Btlejuice：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g btlejuice</span><br></pre></td></tr></table></figure>
</blockquote>
<h2><span id="设置btlejuice代理在vm中">设置BtleJuice代理（在VM中）</span></h2><blockquote>
<p><strong>Step 1：</strong>将蓝牙适配器连接到VM并启动蓝牙：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service bluetooth start</span><br></pre></td></tr></table></figure>

<p><img src="/2024/03/06/BtleJuice-BLE-Bulbs/2.png" alt="image"></p>
<p><strong>Step 2：</strong>通过hciconfig命令查看适配器是否已按预期工作：</p>
<p><img src="/2024/03/06/BtleJuice-BLE-Bulbs/3.png" alt="image"></p>
<p><strong>Step 3：</strong>在虚拟机中启动btlejuice-proxy：</p>
<p><img src="/2024/03/06/BtleJuice-BLE-Bulbs/4.png" alt="image"></p>
<p><strong>Step 4：</strong>找到VM的IP地址，以便我们可以从主机连接到它。或在终端中运行ifconfig来获取IP：</p>
<p><img src="/2024/03/06/BtleJuice-BLE-Bulbs/5.png" alt="image"></p>
</blockquote>
<h2><span id="设置btlejuice核心在主机上">设置BtleJuice核心（在主机上）</span></h2><blockquote>
<p><strong>Step 1：</strong>在主机上打开终端并运行hciconfig：</p>
<p><img src="/2024/03/06/BtleJuice-BLE-Bulbs/6.png" alt="image"></p>
<p><strong>Step 2：</strong>运行sudo service bluetooth stop停止蓝牙服务：</p>
<p><img src="/2024/03/06/BtleJuice-BLE-Bulbs/7.png" alt="image"></p>
<p><strong>Step 3：</strong>在主机上插入蓝牙适配器：</p>
<p><img src="/2024/03/06/BtleJuice-BLE-Bulbs/8.png" alt="image"></p>
<p><strong>Step 4：</strong>通过hciconfig命令查看连接到主机的蓝牙适配器是否已按预期工作：</p>
<p><img src="/2024/03/06/BtleJuice-BLE-Bulbs/9.png" alt="image"></p>
<p><strong>Step 5：</strong>通过运行sudo hciconfig hciX up打开蓝牙适配器，其中的X是上一步中获得的蓝牙适配器号：</p>
<p><img src="/2024/03/06/BtleJuice-BLE-Bulbs/10.png" alt="image"></p>
<p><strong>Step 6：</strong>现在我们需要运行BtleJuice核心并连接虚拟机：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo btlejuice -u &lt;VM IP address&gt; -w</span><br></pre></td></tr></table></figure>

<p>其中u是运行btlejuice-proxy的VM的IP地址，w表示启动Web界面：</p>
<p><img src="/2024/03/06/BtleJuice-BLE-Bulbs/11.png" alt="image"></p>
<p>与此同时，在VM中运行的btlejuice-proxy将会显示客户端连接的消息：</p>
<p><img src="/2024/03/06/BtleJuice-BLE-Bulbs/12.png" alt="image"></p>
<p><strong>Step 7：</strong>一旦主机上运行的BtleJuice核心成功连接到bltjejuice-proxy，我们打开浏览器并导航至<a target="_blank" rel="noopener" href="http://localhost:8080/%EF%BC%9A">http://localhost:8080/：</a></p>
<p><img src="/2024/03/06/BtleJuice-BLE-Bulbs/13.png" alt="image"></p>
<p><strong>Step 8：</strong>单击蓝牙图标的 “Select Target”按钮。此时将会出现一个对话框，并显示核心检测到的所有可用蓝牙设备：</p>
<p><img src="/2024/03/06/BtleJuice-BLE-Bulbs/14.png" alt="image"></p>
<p><strong>Step 9：</strong>双击目标设备并等待接口准备就绪（蓝牙按钮方面将改变）：</p>
<p><img src="/2024/03/06/BtleJuice-BLE-Bulbs/15.png" alt="image"></p>
<p><strong>Step 10：</strong>将关联的移动应用程序与刚创建的dummy设备连接：</p>
<p><img src="/2024/03/06/BtleJuice-BLE-Bulbs/16.png" alt="image"></p>
<p><strong>Step 11：</strong>如果连接成功，则主界面上将显示已连接的事件：</p>
<p><img src="/2024/03/06/BtleJuice-BLE-Bulbs/17.png" alt="image"></p>
</blockquote>
<h2><span id="通过重放gatt操作执行中间人攻击">通过重放GATT操作执行中间人攻击</span></h2><blockquote>
<p>BtleJuice充当移动应用程序和BLE智能灯泡之间的代理，发送到灯泡的任何命令都将被BtleJuice捕获并被转发给灯泡。</p>
<p>让我们使用移动应用程序与灯泡进行交互，并尝试破译命令的结构方式。</p>
<p><strong>Step 1：</strong>使用Android应用程序将灯泡颜色更改为蓝色，蓝色的RGB值为：2, 0, 255：</p>
<p><img src="/2024/03/06/BtleJuice-BLE-Bulbs/18.png" alt="image"></p>
<p>BtleJuice捕获相应的数据包：</p>
<p><img src="/2024/03/06/BtleJuice-BLE-Bulbs/19.png" alt="image"></p>
<p>现在将灯泡颜色更改为红色，RGB值为： 255, 8, 0：</p>
<p><img src="/2024/03/06/BtleJuice-BLE-Bulbs/20.png" alt="image"></p>
<p>BtleJuice捕获与命令相对应的数据包，以将颜色更改为红色：</p>
<p><img src="/2024/03/06/BtleJuice-BLE-Bulbs/21.png" alt="image"></p>
<p>检查数据包，我们可以注意到一个模式。应用程序中显示的颜色的RGB值与捕获中的第二个，第三个和第四个字节匹配。</p>
<p>因此，如果我们更改这些字节然后重放数据包，应该能够获得不同的颜色。</p>
<p><strong>Step 2：</strong>从捕获的数据包列表中，右键单击颜色更改命令，然后单击replay：</p>
<p><img src="/2024/03/06/BtleJuice-BLE-Bulbs/22.png" alt="image"></p>
<p><strong>Step 3：</strong>将数据值中的颜色字节从8c 86 ff更改为任何其他值，例如8c 45 ff，这是一种带有紫色调的颜色：</p>
<p><img src="/2024/03/06/BtleJuice-BLE-Bulbs/23.png" alt="image"></p>
<p><img src="/2024/03/06/BtleJuice-BLE-Bulbs/24.png" alt="image"></p>
<p><strong>Step 4：</strong>单击“ Write”按钮。 我们会注意到灯泡颜色变为了紫色：</p>
<p><img src="/2024/03/06/BtleJuice-BLE-Bulbs/25.png" alt="image"></p>
</blockquote>
<h2><span id="导出捕获的数据">导出捕获的数据</span></h2><blockquote>
<p>BtleJuice可以将捕获的数据导出到文件中，以便以后使用或在其他工具中进行分析。</p>
<p>单击export按钮并下载捕获数据的JSON（或文本）版本：</p>
<p><img src="/2024/03/06/BtleJuice-BLE-Bulbs/26.png" alt="image"></p>
<p>至此，我们已经演示了BtleJuice作为独立工具的使用。</p>
<p>此外，BtleJuice还提供了NodeJS和Python bindings，我们可以在我们自己的BLE攻击工具中使用它。有关更多信息，请<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/btlejuice-bindings">参阅此处</a>。</p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/BlueTooth/" rel="tag">BlueTooth</a><a class="tag-none-link" href="/tags/BtleJuice/" rel="tag">BtleJuice</a><a class="tag-none-link" href="/tags/Exploit/" rel="tag">Exploit</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/02/01/Shu/">
                Shu-黍
            </a>
        </h2>
    
    <time>
        Feb 1, 2024
    </time>
    <section class="content">
        <h1><span id="shu-黍">Shu-黍</span></h1><p><img src="/2024/02/01/Shu/1.jpg" alt="image"><img src="/2024/02/01/Shu/1.png" alt="image"></p>
<h4><span id="所聚越多所负也越重-你我呀都只是自己天地间的一栗罢了"><strong>“所聚越多，所负也越重。你我呀，都只是自己天地间的一栗罢了”</strong></span></h4><blockquote>
<p>我得说一句，这可能是明日方舟第一次限定把陪跑风头几乎完全压住的一次</p>
<p>虽然我并不认为黍太超出预期，一是看莱茵看多了习惯这样的配色，而是梯田与闽南语这样的象征我从小就在接触（有生之年能听到客家话嘛？）……</p>
<p>但是确实还是超出预期了（这都什么发言啊，已经混乱了），然而我还要两三个小时才下班QAQ</p>
<p>最后感谢鹰角送的新年贺词，诶，是什么来着？</p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Arknights/" rel="tag">Arknights</a><a class="tag-none-link" href="/tags/Picture/" rel="tag">Picture</a><a class="tag-none-link" href="/tags/Shu/" rel="tag">Shu</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2024/02/01/Schwarz-Resin-Kit/">
                Schwarz-黑
            </a>
        </h2>
    
    <time>
        Feb 1, 2024
    </time>
    <section class="content">
        <h1><span id="schwarz-黑">Schwarz-黑</span></h1><p>感觉是可以拿来镇宅子的存在了(“▔□▔)……</p>
<p><img src="/2024/02/01/Schwarz-Resin-Kit/1.png" alt="image"><img src="/2024/02/01/Schwarz-Resin-Kit/2.png" alt="image"><img src="/2024/02/01/Schwarz-Resin-Kit/3.png" alt="image"><img src="/2024/02/01/Schwarz-Resin-Kit/4.png" alt="image"></p>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Arknights/" rel="tag">Arknights</a><a class="tag-none-link" href="/tags/Picture/" rel="tag">Picture</a><a class="tag-none-link" href="/tags/Schwarz/" rel="tag">Schwarz</a>
            </div>
        

    </section>
</article>
  
</section>


  <nav id="page-nav" class="clearfix">
    
    <a class="prev" rel="prev" href="/">
      <span class="icon icon-chevron-left"></span>
      <span class="text">Previous</span>
    </a>
    
    
    <a class="next" rel="next" href="/page/3/">
      <span class="text">Next</span>
      <span class="icon icon-chevron-right"></span>
    </a>
    
  </nav>

        <script>setLoadingBarProgress(60);</script>
    </main>

    <footer id="footer" class="clearfix">

    

    <div class="social-wrapper">
        
            
                <a href="https://github.com/szczecin" class="social github"
                   target="_blank" rel="external">
                    <span class="icon icon-github"></span>
                </a>
            
                <a href="/atom.xml" class="social rss"
                   target="_blank" rel="external">
                    <span class="icon icon-rss"></span>
                </a>
            
        
    </div>

    <div class="theme-by">Theme <span class="codename">Memory</span> designed by <a href="https://artifact.me/"
                                                                                    target="_blank">Art Chen</a>.
    </div>
    <div>&copy; <a href="/">氕氘氚</a></div>

</footer>


    <script>setLoadingBarProgress(80);</script>
    <div class="overlay"></div>
</div>

<div class="site-sidebar" id="site-sidebar">

    

    <div class="sidebar-switch clearfix "
         style="display: none">
        <a class="dark-btn active" data-toggle="toc">
            <span class="icon icon-list"></span>
            <span class="text">Index</span>
        </a>
        <a class="dark-btn" data-toggle="bio">
            <span class="icon icon-person"></span>
            <span class="text">Bio</span>
        </a>
    </div>

    <div class="site-toc "
         style="display: none">
        
            <div class="no-index">No Index</div>
        
    </div>

    <div class="site-bio show"
         style="display: block">

        <div class="about-me clearfix">
            <div class="avatar">
                <img src="/img/avatar.png"/>
            </div>
            <div class="info">
                <a class="name dark-btn" href="/about">
                    Szczecin
                </a>
            </div>
            <div class="info">
                <span class="item desc">
                    Open your eyes to see the light in life
                </span>
            </div>
        </div>

        <div class="menu section">
            <ul class="clearfix">
                
                    <li class="left">
                        <a href="/about"
                           onfocus="this.blur();"
                           class="nav-about dark-btn block">
                            简介
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/archives"
                           onfocus="this.blur();"
                           class="nav-archives dark-btn block">
                            归档
                        </a>
                    </li>
                
                    <li class="left">
                        <a href="/categories"
                           onfocus="this.blur();"
                           class="nav-categories dark-btn block">
                            分类
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/tags"
                           onfocus="this.blur();"
                           class="nav-tags dark-btn block">
                            TAGs
                        </a>
                    </li>
                
                    <li class="left">
                        <a href="/WriteUP"
                           onfocus="this.blur();"
                           class="nav-WriteUP dark-btn block">
                            WriteUP
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/EXP"
                           onfocus="this.blur();"
                           class="nav-EXP dark-btn block">
                            EXP
                        </a>
                    </li>
                
                    <li class="left">
                        <a href="/tags/SRC"
                           onfocus="this.blur();"
                           class="nav-SRC dark-btn block">
                            SRC
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/Life"
                           onfocus="this.blur();"
                           class="nav-Life dark-btn block">
                            Life
                        </a>
                    </li>
                
            </ul>
        </div>

    </div>

    <div class="shortcuts">
        <a href="#header" class="top window-nav dark-btn" id="go-top">
            <span class="icon icon-chevron-thin-up"></span>
        </a>
        <a class="close dark-btn" id="sidebar-close">
            <span class="icon icon-close"></span>
        </a>
        <a href="#footer" class="top window-nav dark-btn" id="go-bottom">
            <span class="icon icon-chevron-thin-down"></span>
        </a>
    </div>

</div>





<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script>window.jQuery || document.write('<script src="/js/jquery.min.js"><\/script>')</script>


<script src="/js/jquery.fitvids.js"></script>

<script>
  var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
  var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
  var ALGOLIA_API_KEY = "";
  var ALGOLIA_APP_ID = "";
  var ALGOLIA_INDEX_NAME = "";
  var AZURE_SERVICE_NAME = "";
  var AZURE_INDEX_NAME = "";
  var AZURE_QUERY_KEY = "";
  var SEARCH_SERVICE = "";
  var universalSearchConfig = {};
  if (SEARCH_SERVICE === 'google') {
    universalSearchConfig = {
      searchService: SEARCH_SERVICE,
      apiKey: GOOGLE_CUSTOM_SEARCH_API_KEY,
      engineId: GOOGLE_CUSTOM_SEARCH_ENGINE_ID,
      imagePath: "/img/"
    };
  } else if (SEARCH_SERVICE === 'algolia') {
    universalSearchConfig = {
      searchService: SEARCH_SERVICE,
      apiKey: ALGOLIA_API_KEY,
      appId: ALGOLIA_APP_ID,
      indexName: ALGOLIA_INDEX_NAME,
      imagePath: "/img/"
    };
  } else if (SEARCH_SERVICE === 'azure') {
    universalSearchConfig = {
      searchService: SEARCH_SERVICE,
      serviceName: AZURE_SERVICE_NAME,
      indexName: AZURE_INDEX_NAME,
      apiKey: AZURE_QUERY_KEY,
      imagePath: "/img/"
    };
  }
</script>

<script src="/js/app.js"></script>


<script src="/js/search.js"></script>





<script>setLoadingBarProgress(100);</script>

</body>
</html>
